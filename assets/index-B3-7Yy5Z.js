(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function vx(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var nd={exports:{}},Aa={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N0;function RS(){if(N0)return Aa;N0=1;var o=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,r,a){var c=null;if(a!==void 0&&(c=""+a),r.key!==void 0&&(c=""+r.key),"key"in r){a={};for(var d in r)d!=="key"&&(a[d]=r[d])}else a=r;return r=a.ref,{$$typeof:o,type:i,key:c,ref:r!==void 0?r:null,props:a}}return Aa.Fragment=e,Aa.jsx=t,Aa.jsxs=t,Aa}var k0;function wS(){return k0||(k0=1,nd.exports=RS()),nd.exports}var g=wS(),rd={exports:{}},Pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0;function DS(){if(M0)return Pe;M0=1;var o=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),x=Symbol.for("react.activity"),v=Symbol.iterator;function b(I){return I===null||typeof I!="object"?null:(I=v&&I[v]||I["@@iterator"],typeof I=="function"?I:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,E={};function _(I,M,G){this.props=I,this.context=M,this.refs=E,this.updater=G||S}_.prototype.isReactComponent={},_.prototype.setState=function(I,M){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,M,"setState")},_.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function R(){}R.prototype=_.prototype;function D(I,M,G){this.props=I,this.context=M,this.refs=E,this.updater=G||S}var k=D.prototype=new R;k.constructor=D,A(k,_.prototype),k.isPureReactComponent=!0;var O=Array.isArray;function F(){}var N={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function C(I,M,G){var Z=G.ref;return{$$typeof:o,type:I,key:M,ref:Z!==void 0?Z:null,props:G}}function P(I,M){return C(I.type,M,I.props)}function W(I){return typeof I=="object"&&I!==null&&I.$$typeof===o}function ue(I){var M={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(G){return M[G]})}var me=/\/+/g;function ee(I,M){return typeof I=="object"&&I!==null&&I.key!=null?ue(""+I.key):M.toString(36)}function ce(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(F,F):(I.status="pending",I.then(function(M){I.status==="pending"&&(I.status="fulfilled",I.value=M)},function(M){I.status==="pending"&&(I.status="rejected",I.reason=M)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function j(I,M,G,Z,re){var V=typeof I;(V==="undefined"||V==="boolean")&&(I=null);var ge=!1;if(I===null)ge=!0;else switch(V){case"bigint":case"string":case"number":ge=!0;break;case"object":switch(I.$$typeof){case o:case e:ge=!0;break;case m:return ge=I._init,j(ge(I._payload),M,G,Z,re)}}if(ge)return re=re(I),ge=Z===""?"."+ee(I,0):Z,O(re)?(G="",ge!=null&&(G=ge.replace(me,"$&/")+"/"),j(re,M,G,"",function(Ce){return Ce})):re!=null&&(W(re)&&(re=P(re,G+(re.key==null||I&&I.key===re.key?"":(""+re.key).replace(me,"$&/")+"/")+ge)),M.push(re)),1;ge=0;var Re=Z===""?".":Z+":";if(O(I))for(var Ae=0;Ae<I.length;Ae++)Z=I[Ae],V=Re+ee(Z,Ae),ge+=j(Z,M,G,V,re);else if(Ae=b(I),typeof Ae=="function")for(I=Ae.call(I),Ae=0;!(Z=I.next()).done;)Z=Z.value,V=Re+ee(Z,Ae++),ge+=j(Z,M,G,V,re);else if(V==="object"){if(typeof I.then=="function")return j(ce(I),M,G,Z,re);throw M=String(I),Error("Objects are not valid as a React child (found: "+(M==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":M)+"). If you meant to render a collection of children, use an array instead.")}return ge}function X(I,M,G){if(I==null)return I;var Z=[],re=0;return j(I,Z,"","",function(V){return M.call(G,V,re++)}),Z}function se(I){if(I._status===-1){var M=I._result;M=M(),M.then(function(G){(I._status===0||I._status===-1)&&(I._status=1,I._result=G)},function(G){(I._status===0||I._status===-1)&&(I._status=2,I._result=G)}),I._status===-1&&(I._status=0,I._result=M)}if(I._status===1)return I._result.default;throw I._result}var de=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var M=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(M))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},te={map:X,forEach:function(I,M,G){X(I,function(){M.apply(this,arguments)},G)},count:function(I){var M=0;return X(I,function(){M++}),M},toArray:function(I){return X(I,function(M){return M})||[]},only:function(I){if(!W(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return Pe.Activity=x,Pe.Children=te,Pe.Component=_,Pe.Fragment=t,Pe.Profiler=r,Pe.PureComponent=D,Pe.StrictMode=i,Pe.Suspense=h,Pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,Pe.__COMPILER_RUNTIME={__proto__:null,c:function(I){return N.H.useMemoCache(I)}},Pe.cache=function(I){return function(){return I.apply(null,arguments)}},Pe.cacheSignal=function(){return null},Pe.cloneElement=function(I,M,G){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var Z=A({},I.props),re=I.key;if(M!=null)for(V in M.key!==void 0&&(re=""+M.key),M)!B.call(M,V)||V==="key"||V==="__self"||V==="__source"||V==="ref"&&M.ref===void 0||(Z[V]=M[V]);var V=arguments.length-2;if(V===1)Z.children=G;else if(1<V){for(var ge=Array(V),Re=0;Re<V;Re++)ge[Re]=arguments[Re+2];Z.children=ge}return C(I.type,re,Z)},Pe.createContext=function(I){return I={$$typeof:c,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:a,_context:I},I},Pe.createElement=function(I,M,G){var Z,re={},V=null;if(M!=null)for(Z in M.key!==void 0&&(V=""+M.key),M)B.call(M,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(re[Z]=M[Z]);var ge=arguments.length-2;if(ge===1)re.children=G;else if(1<ge){for(var Re=Array(ge),Ae=0;Ae<ge;Ae++)Re[Ae]=arguments[Ae+2];re.children=Re}if(I&&I.defaultProps)for(Z in ge=I.defaultProps,ge)re[Z]===void 0&&(re[Z]=ge[Z]);return C(I,V,re)},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(I){return{$$typeof:d,render:I}},Pe.isValidElement=W,Pe.lazy=function(I){return{$$typeof:m,_payload:{_status:-1,_result:I},_init:se}},Pe.memo=function(I,M){return{$$typeof:f,type:I,compare:M===void 0?null:M}},Pe.startTransition=function(I){var M=N.T,G={};N.T=G;try{var Z=I(),re=N.S;re!==null&&re(G,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(F,de)}catch(V){de(V)}finally{M!==null&&G.types!==null&&(M.types=G.types),N.T=M}},Pe.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},Pe.use=function(I){return N.H.use(I)},Pe.useActionState=function(I,M,G){return N.H.useActionState(I,M,G)},Pe.useCallback=function(I,M){return N.H.useCallback(I,M)},Pe.useContext=function(I){return N.H.useContext(I)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(I,M){return N.H.useDeferredValue(I,M)},Pe.useEffect=function(I,M){return N.H.useEffect(I,M)},Pe.useEffectEvent=function(I){return N.H.useEffectEvent(I)},Pe.useId=function(){return N.H.useId()},Pe.useImperativeHandle=function(I,M,G){return N.H.useImperativeHandle(I,M,G)},Pe.useInsertionEffect=function(I,M){return N.H.useInsertionEffect(I,M)},Pe.useLayoutEffect=function(I,M){return N.H.useLayoutEffect(I,M)},Pe.useMemo=function(I,M){return N.H.useMemo(I,M)},Pe.useOptimistic=function(I,M){return N.H.useOptimistic(I,M)},Pe.useReducer=function(I,M,G){return N.H.useReducer(I,M,G)},Pe.useRef=function(I){return N.H.useRef(I)},Pe.useState=function(I){return N.H.useState(I)},Pe.useSyncExternalStore=function(I,M,G){return N.H.useSyncExternalStore(I,M,G)},Pe.useTransition=function(){return N.H.useTransition()},Pe.version="19.2.4",Pe}var O0;function lf(){return O0||(O0=1,rd.exports=DS()),rd.exports}var Y=lf();const IS=vx(Y);var ad={exports:{}},La={},ld={exports:{}},od={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P0;function CS(){return P0||(P0=1,(function(o){function e(j,X){var se=j.length;j.push(X);e:for(;0<se;){var de=se-1>>>1,te=j[de];if(0<r(te,X))j[de]=X,j[se]=te,se=de;else break e}}function t(j){return j.length===0?null:j[0]}function i(j){if(j.length===0)return null;var X=j[0],se=j.pop();if(se!==X){j[0]=se;e:for(var de=0,te=j.length,I=te>>>1;de<I;){var M=2*(de+1)-1,G=j[M],Z=M+1,re=j[Z];if(0>r(G,se))Z<te&&0>r(re,G)?(j[de]=re,j[Z]=se,de=Z):(j[de]=G,j[M]=se,de=M);else if(Z<te&&0>r(re,se))j[de]=re,j[Z]=se,de=Z;else break e}}return X}function r(j,X){var se=j.sortIndex-X.sortIndex;return se!==0?se:j.id-X.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;o.unstable_now=function(){return a.now()}}else{var c=Date,d=c.now();o.unstable_now=function(){return c.now()-d}}var h=[],f=[],m=1,x=null,v=3,b=!1,S=!1,A=!1,E=!1,_=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function k(j){for(var X=t(f);X!==null;){if(X.callback===null)i(f);else if(X.startTime<=j)i(f),X.sortIndex=X.expirationTime,e(h,X);else break;X=t(f)}}function O(j){if(A=!1,k(j),!S)if(t(h)!==null)S=!0,F||(F=!0,ue());else{var X=t(f);X!==null&&ce(O,X.startTime-j)}}var F=!1,N=-1,B=5,C=-1;function P(){return E?!0:!(o.unstable_now()-C<B)}function W(){if(E=!1,F){var j=o.unstable_now();C=j;var X=!0;try{e:{S=!1,A&&(A=!1,R(N),N=-1),b=!0;var se=v;try{t:{for(k(j),x=t(h);x!==null&&!(x.expirationTime>j&&P());){var de=x.callback;if(typeof de=="function"){x.callback=null,v=x.priorityLevel;var te=de(x.expirationTime<=j);if(j=o.unstable_now(),typeof te=="function"){x.callback=te,k(j),X=!0;break t}x===t(h)&&i(h),k(j)}else i(h);x=t(h)}if(x!==null)X=!0;else{var I=t(f);I!==null&&ce(O,I.startTime-j),X=!1}}break e}finally{x=null,v=se,b=!1}X=void 0}}finally{X?ue():F=!1}}}var ue;if(typeof D=="function")ue=function(){D(W)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,ee=me.port2;me.port1.onmessage=W,ue=function(){ee.postMessage(null)}}else ue=function(){_(W,0)};function ce(j,X){N=_(function(){j(o.unstable_now())},X)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(j){j.callback=null},o.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<j?Math.floor(1e3/j):5},o.unstable_getCurrentPriorityLevel=function(){return v},o.unstable_next=function(j){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var se=v;v=X;try{return j()}finally{v=se}},o.unstable_requestPaint=function(){E=!0},o.unstable_runWithPriority=function(j,X){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var se=v;v=j;try{return X()}finally{v=se}},o.unstable_scheduleCallback=function(j,X,se){var de=o.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?de+se:de):se=de,j){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=se+te,j={id:m++,callback:X,priorityLevel:j,startTime:se,expirationTime:te,sortIndex:-1},se>de?(j.sortIndex=se,e(f,j),t(h)===null&&j===t(f)&&(A?(R(N),N=-1):A=!0,ce(O,se-de))):(j.sortIndex=te,e(h,j),S||b||(S=!0,F||(F=!0,ue()))),j},o.unstable_shouldYield=P,o.unstable_wrapCallback=function(j){var X=v;return function(){var se=v;v=X;try{return j.apply(this,arguments)}finally{v=se}}}})(od)),od}var j0;function NS(){return j0||(j0=1,ld.exports=CS()),ld.exports}var cd={exports:{}},ts={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U0;function kS(){if(U0)return ts;U0=1;var o=lf();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(h,f,m){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:x==null?null:""+x,children:h,containerInfo:f,implementation:m}}var c=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return ts.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ts.createPortal=function(h,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return a(h,f,null,m)},ts.flushSync=function(h){var f=c.T,m=i.p;try{if(c.T=null,i.p=2,h)return h()}finally{c.T=f,i.p=m,i.d.f()}},ts.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(h,f))},ts.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},ts.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var m=f.as,x=d(m,f.crossOrigin),v=typeof f.integrity=="string"?f.integrity:void 0,b=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?i.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:x,integrity:v,fetchPriority:b}):m==="script"&&i.d.X(h,{crossOrigin:x,integrity:v,fetchPriority:b,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},ts.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=d(f.as,f.crossOrigin);i.d.M(h,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(h)},ts.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,x=d(m,f.crossOrigin);i.d.L(h,m,{crossOrigin:x,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},ts.preloadModule=function(h,f){if(typeof h=="string")if(f){var m=d(f.as,f.crossOrigin);i.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(h)},ts.requestFormReset=function(h){i.d.r(h)},ts.unstable_batchedUpdates=function(h,f){return h(f)},ts.useFormState=function(h,f,m){return c.H.useFormState(h,f,m)},ts.useFormStatus=function(){return c.H.useHostTransitionStatus()},ts.version="19.2.4",ts}var F0;function MS(){if(F0)return cd.exports;F0=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(e){console.error(e)}}return o(),cd.exports=kS(),cd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B0;function OS(){if(B0)return La;B0=1;var o=NS(),e=lf(),t=MS();function i(s){var n="https://react.dev/errors/"+s;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)n+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function a(s){var n=s,l=s;if(s.alternate)for(;n.return;)n=n.return;else{s=n;do n=s,(n.flags&4098)!==0&&(l=n.return),s=n.return;while(s)}return n.tag===3?l:null}function c(s){if(s.tag===13){var n=s.memoizedState;if(n===null&&(s=s.alternate,s!==null&&(n=s.memoizedState)),n!==null)return n.dehydrated}return null}function d(s){if(s.tag===31){var n=s.memoizedState;if(n===null&&(s=s.alternate,s!==null&&(n=s.memoizedState)),n!==null)return n.dehydrated}return null}function h(s){if(a(s)!==s)throw Error(i(188))}function f(s){var n=s.alternate;if(!n){if(n=a(s),n===null)throw Error(i(188));return n!==s?null:s}for(var l=s,u=n;;){var p=l.return;if(p===null)break;var y=p.alternate;if(y===null){if(u=p.return,u!==null){l=u;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===l)return h(p),s;if(y===u)return h(p),n;y=y.sibling}throw Error(i(188))}if(l.return!==u.return)l=p,u=y;else{for(var T=!1,w=p.child;w;){if(w===l){T=!0,l=p,u=y;break}if(w===u){T=!0,u=p,l=y;break}w=w.sibling}if(!T){for(w=y.child;w;){if(w===l){T=!0,l=y,u=p;break}if(w===u){T=!0,u=y,l=p;break}w=w.sibling}if(!T)throw Error(i(189))}}if(l.alternate!==u)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?s:n}function m(s){var n=s.tag;if(n===5||n===26||n===27||n===6)return s;for(s=s.child;s!==null;){if(n=m(s),n!==null)return n;s=s.sibling}return null}var x=Object.assign,v=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),D=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function ue(s){return s===null||typeof s!="object"?null:(s=W&&s[W]||s["@@iterator"],typeof s=="function"?s:null)}var me=Symbol.for("react.client.reference");function ee(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===me?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case A:return"Fragment";case _:return"Profiler";case E:return"StrictMode";case O:return"Suspense";case F:return"SuspenseList";case C:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case S:return"Portal";case D:return s.displayName||"Context";case R:return(s._context.displayName||"Context")+".Consumer";case k:var n=s.render;return s=s.displayName,s||(s=n.displayName||n.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case N:return n=s.displayName||null,n!==null?n:ee(s.type)||"Memo";case B:n=s._payload,s=s._init;try{return ee(s(n))}catch{}}return null}var ce=Array.isArray,j=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se={pending:!1,data:null,method:null,action:null},de=[],te=-1;function I(s){return{current:s}}function M(s){0>te||(s.current=de[te],de[te]=null,te--)}function G(s,n){te++,de[te]=s.current,s.current=n}var Z=I(null),re=I(null),V=I(null),ge=I(null);function Re(s,n){switch(G(V,n),G(re,s),G(Z,null),n.nodeType){case 9:case 11:s=(s=n.documentElement)&&(s=s.namespaceURI)?t0(s):0;break;default:if(s=n.tagName,n=n.namespaceURI)n=t0(n),s=s0(n,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}M(Z),G(Z,s)}function Ae(){M(Z),M(re),M(V)}function Ce(s){s.memoizedState!==null&&G(ge,s);var n=Z.current,l=s0(n,s.type);n!==l&&(G(re,s),G(Z,l))}function it(s){re.current===s&&(M(Z),M(re)),ge.current===s&&(M(ge),ba._currentValue=se)}var Mt,bt;function ft(s){if(Mt===void 0)try{throw Error()}catch(l){var n=l.stack.trim().match(/\n( *(at )?)/);Mt=n&&n[1]||"",bt=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Mt+s+bt}var At=!1;function le(s,n){if(!s||At)return"";At=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(n){var fe=function(){throw Error()};if(Object.defineProperty(fe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(fe,[])}catch(ie){var J=ie}Reflect.construct(s,[],fe)}else{try{fe.call()}catch(ie){J=ie}s.call(fe.prototype)}}else{try{throw Error()}catch(ie){J=ie}(fe=s())&&typeof fe.catch=="function"&&fe.catch(function(){})}}catch(ie){if(ie&&J&&typeof ie.stack=="string")return[ie.stack,J.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=u.DetermineComponentFrameRoot(),T=y[0],w=y[1];if(T&&w){var U=T.split(`
`),Q=w.split(`
`);for(p=u=0;u<U.length&&!U[u].includes("DetermineComponentFrameRoot");)u++;for(;p<Q.length&&!Q[p].includes("DetermineComponentFrameRoot");)p++;if(u===U.length||p===Q.length)for(u=U.length-1,p=Q.length-1;1<=u&&0<=p&&U[u]!==Q[p];)p--;for(;1<=u&&0<=p;u--,p--)if(U[u]!==Q[p]){if(u!==1||p!==1)do if(u--,p--,0>p||U[u]!==Q[p]){var ne=`
`+U[u].replace(" at new "," at ");return s.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",s.displayName)),ne}while(1<=u&&0<=p);break}}}finally{At=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?ft(l):""}function Te(s,n){switch(s.tag){case 26:case 27:case 5:return ft(s.type);case 16:return ft("Lazy");case 13:return s.child!==n&&n!==null?ft("Suspense Fallback"):ft("Suspense");case 19:return ft("SuspenseList");case 0:case 15:return le(s.type,!1);case 11:return le(s.type.render,!1);case 1:return le(s.type,!0);case 31:return ft("Activity");default:return""}}function Ye(s){try{var n="",l=null;do n+=Te(s,l),l=s,s=s.return;while(s);return n}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var ke=Object.prototype.hasOwnProperty,Fe=o.unstable_scheduleCallback,pe=o.unstable_cancelCallback,be=o.unstable_shouldYield,Xe=o.unstable_requestPaint,Ge=o.unstable_now,Zt=o.unstable_getCurrentPriorityLevel,nt=o.unstable_ImmediatePriority,Jt=o.unstable_UserBlockingPriority,gt=o.unstable_NormalPriority,xt=o.unstable_LowPriority,Ft=o.unstable_IdlePriority,Lt=o.log,es=o.unstable_setDisableYieldValue,ns=null,he=null;function Se(s){if(typeof Lt=="function"&&es(s),he&&typeof he.setStrictMode=="function")try{he.setStrictMode(ns,s)}catch{}}var we=Math.clz32?Math.clz32:kn,Bt=Math.log,Dt=Math.LN2;function kn(s){return s>>>=0,s===0?32:31-(Bt(s)/Dt|0)|0}var Ot=256,Mn=262144,Ii=4194304;function cn(s){var n=s&42;if(n!==0)return n;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Ha(s,n,l){var u=s.pendingLanes;if(u===0)return 0;var p=0,y=s.suspendedLanes,T=s.pingedLanes;s=s.warmLanes;var w=u&134217727;return w!==0?(u=w&~y,u!==0?p=cn(u):(T&=w,T!==0?p=cn(T):l||(l=w&~s,l!==0&&(p=cn(l))))):(w=u&~y,w!==0?p=cn(w):T!==0?p=cn(T):l||(l=u&~s,l!==0&&(p=cn(l)))),p===0?0:n!==0&&n!==p&&(n&y)===0&&(y=p&-p,l=n&-n,y>=l||y===32&&(l&4194048)!==0)?n:p}function kr(s,n){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&n)===0}function mv(s,n){switch(s){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pf(){var s=Ii;return Ii<<=1,(Ii&62914560)===0&&(Ii=4194304),s}function Ko(s){for(var n=[],l=0;31>l;l++)n.push(s);return n}function Mr(s,n){s.pendingLanes|=n,n!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function gv(s,n,l,u,p,y){var T=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var w=s.entanglements,U=s.expirationTimes,Q=s.hiddenUpdates;for(l=T&~l;0<l;){var ne=31-we(l),fe=1<<ne;w[ne]=0,U[ne]=-1;var J=Q[ne];if(J!==null)for(Q[ne]=null,ne=0;ne<J.length;ne++){var ie=J[ne];ie!==null&&(ie.lane&=-536870913)}l&=~fe}u!==0&&jf(s,u,0),y!==0&&p===0&&s.tag!==0&&(s.suspendedLanes|=y&~(T&~n))}function jf(s,n,l){s.pendingLanes|=n,s.suspendedLanes&=~n;var u=31-we(n);s.entangledLanes|=n,s.entanglements[u]=s.entanglements[u]|1073741824|l&261930}function Uf(s,n){var l=s.entangledLanes|=n;for(s=s.entanglements;l;){var u=31-we(l),p=1<<u;p&n|s[u]&n&&(s[u]|=n),l&=~p}}function Ff(s,n){var l=n&-n;return l=(l&42)!==0?1:Yo(l),(l&(s.suspendedLanes|n))!==0?0:l}function Yo(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function qo(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Bf(){var s=X.p;return s!==0?s:(s=window.event,s===void 0?32:L0(s.type))}function $f(s,n){var l=X.p;try{return X.p=s,n()}finally{X.p=l}}var Ci=Math.random().toString(36).slice(2),Ht="__reactFiber$"+Ci,rs="__reactProps$"+Ci,On="__reactContainer$"+Ci,Xo="__reactEvents$"+Ci,pv="__reactListeners$"+Ci,xv="__reactHandles$"+Ci,Gf="__reactResources$"+Ci,Or="__reactMarker$"+Ci;function Qo(s){delete s[Ht],delete s[rs],delete s[Xo],delete s[pv],delete s[xv]}function Pn(s){var n=s[Ht];if(n)return n;for(var l=s.parentNode;l;){if(n=l[On]||l[Ht]){if(l=n.alternate,n.child!==null||l!==null&&l.child!==null)for(s=c0(s);s!==null;){if(l=s[Ht])return l;s=c0(s)}return n}s=l,l=s.parentNode}return null}function jn(s){if(s=s[Ht]||s[On]){var n=s.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return s}return null}function Pr(s){var n=s.tag;if(n===5||n===26||n===27||n===6)return s.stateNode;throw Error(i(33))}function Un(s){var n=s[Gf];return n||(n=s[Gf]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function $t(s){s[Or]=!0}var zf=new Set,Hf={};function un(s,n){Fn(s,n),Fn(s+"Capture",n)}function Fn(s,n){for(Hf[s]=n,s=0;s<n.length;s++)zf.add(n[s])}var yv=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vf={},Kf={};function vv(s){return ke.call(Kf,s)?!0:ke.call(Vf,s)?!1:yv.test(s)?Kf[s]=!0:(Vf[s]=!0,!1)}function Va(s,n,l){if(vv(n))if(l===null)s.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(n);return;case"boolean":var u=n.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(n);return}}s.setAttribute(n,""+l)}}function Ka(s,n,l){if(l===null)s.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(n);return}s.setAttribute(n,""+l)}}function oi(s,n,l,u){if(u===null)s.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(n,l,""+u)}}function Ds(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Yf(s){var n=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function bv(s,n,l){var u=Object.getOwnPropertyDescriptor(s.constructor.prototype,n);if(!s.hasOwnProperty(n)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,y=u.set;return Object.defineProperty(s,n,{configurable:!0,get:function(){return p.call(this)},set:function(T){l=""+T,y.call(this,T)}}),Object.defineProperty(s,n,{enumerable:u.enumerable}),{getValue:function(){return l},setValue:function(T){l=""+T},stopTracking:function(){s._valueTracker=null,delete s[n]}}}}function Wo(s){if(!s._valueTracker){var n=Yf(s)?"checked":"value";s._valueTracker=bv(s,n,""+s[n])}}function qf(s){if(!s)return!1;var n=s._valueTracker;if(!n)return!0;var l=n.getValue(),u="";return s&&(u=Yf(s)?s.checked?"true":"false":s.value),s=u,s!==l?(n.setValue(s),!0):!1}function Ya(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Sv=/[\n"\\]/g;function Is(s){return s.replace(Sv,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Zo(s,n,l,u,p,y,T,w){s.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?s.type=T:s.removeAttribute("type"),n!=null?T==="number"?(n===0&&s.value===""||s.value!=n)&&(s.value=""+Ds(n)):s.value!==""+Ds(n)&&(s.value=""+Ds(n)):T!=="submit"&&T!=="reset"||s.removeAttribute("value"),n!=null?Jo(s,T,Ds(n)):l!=null?Jo(s,T,Ds(l)):u!=null&&s.removeAttribute("value"),p==null&&y!=null&&(s.defaultChecked=!!y),p!=null&&(s.checked=p&&typeof p!="function"&&typeof p!="symbol"),w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?s.name=""+Ds(w):s.removeAttribute("name")}function Xf(s,n,l,u,p,y,T,w){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(s.type=y),n!=null||l!=null){if(!(y!=="submit"&&y!=="reset"||n!=null)){Wo(s);return}l=l!=null?""+Ds(l):"",n=n!=null?""+Ds(n):l,w||n===s.value||(s.value=n),s.defaultValue=n}u=u??p,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=w?s.checked:!!u,s.defaultChecked=!!u,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(s.name=T),Wo(s)}function Jo(s,n,l){n==="number"&&Ya(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Bn(s,n,l,u){if(s=s.options,n){n={};for(var p=0;p<l.length;p++)n["$"+l[p]]=!0;for(l=0;l<s.length;l++)p=n.hasOwnProperty("$"+s[l].value),s[l].selected!==p&&(s[l].selected=p),p&&u&&(s[l].defaultSelected=!0)}else{for(l=""+Ds(l),n=null,p=0;p<s.length;p++){if(s[p].value===l){s[p].selected=!0,u&&(s[p].defaultSelected=!0);return}n!==null||s[p].disabled||(n=s[p])}n!==null&&(n.selected=!0)}}function Qf(s,n,l){if(n!=null&&(n=""+Ds(n),n!==s.value&&(s.value=n),l==null)){s.defaultValue!==n&&(s.defaultValue=n);return}s.defaultValue=l!=null?""+Ds(l):""}function Wf(s,n,l,u){if(n==null){if(u!=null){if(l!=null)throw Error(i(92));if(ce(u)){if(1<u.length)throw Error(i(93));u=u[0]}l=u}l==null&&(l=""),n=l}l=Ds(n),s.defaultValue=l,u=s.textContent,u===l&&u!==""&&u!==null&&(s.value=u),Wo(s)}function $n(s,n){if(n){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=n;return}}s.textContent=n}var Ev=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zf(s,n,l){var u=n.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?s.setProperty(n,""):n==="float"?s.cssFloat="":s[n]="":u?s.setProperty(n,l):typeof l!="number"||l===0||Ev.has(n)?n==="float"?s.cssFloat=l:s[n]=(""+l).trim():s[n]=l+"px"}function Jf(s,n,l){if(n!=null&&typeof n!="object")throw Error(i(62));if(s=s.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||n!=null&&n.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var p in n)u=n[p],n.hasOwnProperty(p)&&l[p]!==u&&Zf(s,p,u)}else for(var y in n)n.hasOwnProperty(y)&&Zf(s,y,n[y])}function ec(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Av=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function qa(s){return Av.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function ci(){}var tc=null;function sc(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Gn=null,zn=null;function eh(s){var n=jn(s);if(n&&(s=n.stateNode)){var l=s[rs]||null;e:switch(s=n.stateNode,n.type){case"input":if(Zo(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),n=l.name,l.type==="radio"&&n!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Is(""+n)+'"][type="radio"]'),n=0;n<l.length;n++){var u=l[n];if(u!==s&&u.form===s.form){var p=u[rs]||null;if(!p)throw Error(i(90));Zo(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(n=0;n<l.length;n++)u=l[n],u.form===s.form&&qf(u)}break e;case"textarea":Qf(s,l.value,l.defaultValue);break e;case"select":n=l.value,n!=null&&Bn(s,!!l.multiple,n,!1)}}}var ic=!1;function th(s,n,l){if(ic)return s(n,l);ic=!0;try{var u=s(n);return u}finally{if(ic=!1,(Gn!==null||zn!==null)&&(Ol(),Gn&&(n=Gn,s=zn,zn=Gn=null,eh(n),s)))for(n=0;n<s.length;n++)eh(s[n])}}function jr(s,n){var l=s.stateNode;if(l===null)return null;var u=l[rs]||null;if(u===null)return null;l=u[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(i(231,n,typeof l));return l}var ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nc=!1;if(ui)try{var Ur={};Object.defineProperty(Ur,"passive",{get:function(){nc=!0}}),window.addEventListener("test",Ur,Ur),window.removeEventListener("test",Ur,Ur)}catch{nc=!1}var Ni=null,rc=null,Xa=null;function sh(){if(Xa)return Xa;var s,n=rc,l=n.length,u,p="value"in Ni?Ni.value:Ni.textContent,y=p.length;for(s=0;s<l&&n[s]===p[s];s++);var T=l-s;for(u=1;u<=T&&n[l-u]===p[y-u];u++);return Xa=p.slice(s,1<u?1-u:void 0)}function Qa(s){var n=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&n===13&&(s=13)):s=n,s===10&&(s=13),32<=s||s===13?s:0}function Wa(){return!0}function ih(){return!1}function as(s){function n(l,u,p,y,T){this._reactName=l,this._targetInst=p,this.type=u,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var w in s)s.hasOwnProperty(w)&&(l=s[w],this[w]=l?l(y):y[w]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Wa:ih,this.isPropagationStopped=ih,this}return x(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Wa)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Wa)},persist:function(){},isPersistent:Wa}),n}var dn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Za=as(dn),Fr=x({},dn,{view:0,detail:0}),Lv=as(Fr),ac,lc,Br,Ja=x({},Fr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Br&&(Br&&s.type==="mousemove"?(ac=s.screenX-Br.screenX,lc=s.screenY-Br.screenY):lc=ac=0,Br=s),ac)},movementY:function(s){return"movementY"in s?s.movementY:lc}}),nh=as(Ja),_v=x({},Ja,{dataTransfer:0}),Rv=as(_v),wv=x({},Fr,{relatedTarget:0}),oc=as(wv),Dv=x({},dn,{animationName:0,elapsedTime:0,pseudoElement:0}),Iv=as(Dv),Cv=x({},dn,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Nv=as(Cv),kv=x({},dn,{data:0}),rh=as(kv),Mv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ov={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jv(s){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(s):(s=Pv[s])?!!n[s]:!1}function cc(){return jv}var Uv=x({},Fr,{key:function(s){if(s.key){var n=Mv[s.key]||s.key;if(n!=="Unidentified")return n}return s.type==="keypress"?(s=Qa(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Ov[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cc,charCode:function(s){return s.type==="keypress"?Qa(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Qa(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Fv=as(Uv),Bv=x({},Ja,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ah=as(Bv),$v=x({},Fr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cc}),Gv=as($v),zv=x({},dn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hv=as(zv),Vv=x({},Ja,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Kv=as(Vv),Yv=x({},dn,{newState:0,oldState:0}),qv=as(Yv),Xv=[9,13,27,32],uc=ui&&"CompositionEvent"in window,$r=null;ui&&"documentMode"in document&&($r=document.documentMode);var Qv=ui&&"TextEvent"in window&&!$r,lh=ui&&(!uc||$r&&8<$r&&11>=$r),oh=" ",ch=!1;function uh(s,n){switch(s){case"keyup":return Xv.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dh(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Hn=!1;function Wv(s,n){switch(s){case"compositionend":return dh(n);case"keypress":return n.which!==32?null:(ch=!0,oh);case"textInput":return s=n.data,s===oh&&ch?null:s;default:return null}}function Zv(s,n){if(Hn)return s==="compositionend"||!uc&&uh(s,n)?(s=sh(),Xa=rc=Ni=null,Hn=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return lh&&n.locale!=="ko"?null:n.data;default:return null}}var Jv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fh(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n==="input"?!!Jv[s.type]:n==="textarea"}function hh(s,n,l,u){Gn?zn?zn.push(u):zn=[u]:Gn=u,n=Gl(n,"onChange"),0<n.length&&(l=new Za("onChange","change",null,l,u),s.push({event:l,listeners:n}))}var Gr=null,zr=null;function eb(s){Xg(s,0)}function el(s){var n=Pr(s);if(qf(n))return s}function mh(s,n){if(s==="change")return n}var gh=!1;if(ui){var dc;if(ui){var fc="oninput"in document;if(!fc){var ph=document.createElement("div");ph.setAttribute("oninput","return;"),fc=typeof ph.oninput=="function"}dc=fc}else dc=!1;gh=dc&&(!document.documentMode||9<document.documentMode)}function xh(){Gr&&(Gr.detachEvent("onpropertychange",yh),zr=Gr=null)}function yh(s){if(s.propertyName==="value"&&el(zr)){var n=[];hh(n,zr,s,sc(s)),th(eb,n)}}function tb(s,n,l){s==="focusin"?(xh(),Gr=n,zr=l,Gr.attachEvent("onpropertychange",yh)):s==="focusout"&&xh()}function sb(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return el(zr)}function ib(s,n){if(s==="click")return el(n)}function nb(s,n){if(s==="input"||s==="change")return el(n)}function rb(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var ms=typeof Object.is=="function"?Object.is:rb;function Hr(s,n){if(ms(s,n))return!0;if(typeof s!="object"||s===null||typeof n!="object"||n===null)return!1;var l=Object.keys(s),u=Object.keys(n);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var p=l[u];if(!ke.call(n,p)||!ms(s[p],n[p]))return!1}return!0}function vh(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function bh(s,n){var l=vh(s);s=0;for(var u;l;){if(l.nodeType===3){if(u=s+l.textContent.length,s<=n&&u>=n)return{node:l,offset:n-s};s=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=vh(l)}}function Sh(s,n){return s&&n?s===n?!0:s&&s.nodeType===3?!1:n&&n.nodeType===3?Sh(s,n.parentNode):"contains"in s?s.contains(n):s.compareDocumentPosition?!!(s.compareDocumentPosition(n)&16):!1:!1}function Eh(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var n=Ya(s.document);n instanceof s.HTMLIFrameElement;){try{var l=typeof n.contentWindow.location.href=="string"}catch{l=!1}if(l)s=n.contentWindow;else break;n=Ya(s.document)}return n}function hc(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n&&(n==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||n==="textarea"||s.contentEditable==="true")}var ab=ui&&"documentMode"in document&&11>=document.documentMode,Vn=null,mc=null,Vr=null,gc=!1;function Th(s,n,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;gc||Vn==null||Vn!==Ya(u)||(u=Vn,"selectionStart"in u&&hc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Vr&&Hr(Vr,u)||(Vr=u,u=Gl(mc,"onSelect"),0<u.length&&(n=new Za("onSelect","select",null,n,l),s.push({event:n,listeners:u}),n.target=Vn)))}function fn(s,n){var l={};return l[s.toLowerCase()]=n.toLowerCase(),l["Webkit"+s]="webkit"+n,l["Moz"+s]="moz"+n,l}var Kn={animationend:fn("Animation","AnimationEnd"),animationiteration:fn("Animation","AnimationIteration"),animationstart:fn("Animation","AnimationStart"),transitionrun:fn("Transition","TransitionRun"),transitionstart:fn("Transition","TransitionStart"),transitioncancel:fn("Transition","TransitionCancel"),transitionend:fn("Transition","TransitionEnd")},pc={},Ah={};ui&&(Ah=document.createElement("div").style,"AnimationEvent"in window||(delete Kn.animationend.animation,delete Kn.animationiteration.animation,delete Kn.animationstart.animation),"TransitionEvent"in window||delete Kn.transitionend.transition);function hn(s){if(pc[s])return pc[s];if(!Kn[s])return s;var n=Kn[s],l;for(l in n)if(n.hasOwnProperty(l)&&l in Ah)return pc[s]=n[l];return s}var Lh=hn("animationend"),_h=hn("animationiteration"),Rh=hn("animationstart"),lb=hn("transitionrun"),ob=hn("transitionstart"),cb=hn("transitioncancel"),wh=hn("transitionend"),Dh=new Map,xc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xc.push("scrollEnd");function zs(s,n){Dh.set(s,n),un(n,[s])}var tl=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Cs=[],Yn=0,yc=0;function sl(){for(var s=Yn,n=yc=Yn=0;n<s;){var l=Cs[n];Cs[n++]=null;var u=Cs[n];Cs[n++]=null;var p=Cs[n];Cs[n++]=null;var y=Cs[n];if(Cs[n++]=null,u!==null&&p!==null){var T=u.pending;T===null?p.next=p:(p.next=T.next,T.next=p),u.pending=p}y!==0&&Ih(l,p,y)}}function il(s,n,l,u){Cs[Yn++]=s,Cs[Yn++]=n,Cs[Yn++]=l,Cs[Yn++]=u,yc|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function vc(s,n,l,u){return il(s,n,l,u),nl(s)}function mn(s,n){return il(s,null,null,n),nl(s)}function Ih(s,n,l){s.lanes|=l;var u=s.alternate;u!==null&&(u.lanes|=l);for(var p=!1,y=s.return;y!==null;)y.childLanes|=l,u=y.alternate,u!==null&&(u.childLanes|=l),y.tag===22&&(s=y.stateNode,s===null||s._visibility&1||(p=!0)),s=y,y=y.return;return s.tag===3?(y=s.stateNode,p&&n!==null&&(p=31-we(l),s=y.hiddenUpdates,u=s[p],u===null?s[p]=[n]:u.push(n),n.lane=l|536870912),y):null}function nl(s){if(50<ha)throw ha=0,wu=null,Error(i(185));for(var n=s.return;n!==null;)s=n,n=s.return;return s.tag===3?s.stateNode:null}var qn={};function ub(s,n,l,u){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gs(s,n,l,u){return new ub(s,n,l,u)}function bc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function di(s,n){var l=s.alternate;return l===null?(l=gs(s.tag,n,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=n,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,n=s.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function Ch(s,n){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,n=l.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),s}function rl(s,n,l,u,p,y){var T=0;if(u=s,typeof s=="function")bc(s)&&(T=1);else if(typeof s=="string")T=gS(s,l,Z.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case C:return s=gs(31,l,n,p),s.elementType=C,s.lanes=y,s;case A:return gn(l.children,p,y,n);case E:T=8,p|=24;break;case _:return s=gs(12,l,n,p|2),s.elementType=_,s.lanes=y,s;case O:return s=gs(13,l,n,p),s.elementType=O,s.lanes=y,s;case F:return s=gs(19,l,n,p),s.elementType=F,s.lanes=y,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case D:T=10;break e;case R:T=9;break e;case k:T=11;break e;case N:T=14;break e;case B:T=16,u=null;break e}T=29,l=Error(i(130,s===null?"null":typeof s,"")),u=null}return n=gs(T,l,n,p),n.elementType=s,n.type=u,n.lanes=y,n}function gn(s,n,l,u){return s=gs(7,s,u,n),s.lanes=l,s}function Sc(s,n,l){return s=gs(6,s,null,n),s.lanes=l,s}function Nh(s){var n=gs(18,null,null,0);return n.stateNode=s,n}function Ec(s,n,l){return n=gs(4,s.children!==null?s.children:[],s.key,n),n.lanes=l,n.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},n}var kh=new WeakMap;function Ns(s,n){if(typeof s=="object"&&s!==null){var l=kh.get(s);return l!==void 0?l:(n={value:s,source:n,stack:Ye(n)},kh.set(s,n),n)}return{value:s,source:n,stack:Ye(n)}}var Xn=[],Qn=0,al=null,Kr=0,ks=[],Ms=0,ki=null,qs=1,Xs="";function fi(s,n){Xn[Qn++]=Kr,Xn[Qn++]=al,al=s,Kr=n}function Mh(s,n,l){ks[Ms++]=qs,ks[Ms++]=Xs,ks[Ms++]=ki,ki=s;var u=qs;s=Xs;var p=32-we(u)-1;u&=~(1<<p),l+=1;var y=32-we(n)+p;if(30<y){var T=p-p%5;y=(u&(1<<T)-1).toString(32),u>>=T,p-=T,qs=1<<32-we(n)+p|l<<p|u,Xs=y+s}else qs=1<<y|l<<p|u,Xs=s}function Tc(s){s.return!==null&&(fi(s,1),Mh(s,1,0))}function Ac(s){for(;s===al;)al=Xn[--Qn],Xn[Qn]=null,Kr=Xn[--Qn],Xn[Qn]=null;for(;s===ki;)ki=ks[--Ms],ks[Ms]=null,Xs=ks[--Ms],ks[Ms]=null,qs=ks[--Ms],ks[Ms]=null}function Oh(s,n){ks[Ms++]=qs,ks[Ms++]=Xs,ks[Ms++]=ki,qs=n.id,Xs=n.overflow,ki=s}var Vt=null,ht=null,qe=!1,Mi=null,Os=!1,Lc=Error(i(519));function Oi(s){var n=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Yr(Ns(n,s)),Lc}function Ph(s){var n=s.stateNode,l=s.type,u=s.memoizedProps;switch(n[Ht]=s,n[rs]=u,l){case"dialog":He("cancel",n),He("close",n);break;case"iframe":case"object":case"embed":He("load",n);break;case"video":case"audio":for(l=0;l<ga.length;l++)He(ga[l],n);break;case"source":He("error",n);break;case"img":case"image":case"link":He("error",n),He("load",n);break;case"details":He("toggle",n);break;case"input":He("invalid",n),Xf(n,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":He("invalid",n);break;case"textarea":He("invalid",n),Wf(n,u.value,u.defaultValue,u.children)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||n.textContent===""+l||u.suppressHydrationWarning===!0||Jg(n.textContent,l)?(u.popover!=null&&(He("beforetoggle",n),He("toggle",n)),u.onScroll!=null&&He("scroll",n),u.onScrollEnd!=null&&He("scrollend",n),u.onClick!=null&&(n.onclick=ci),n=!0):n=!1,n||Oi(s,!0)}function jh(s){for(Vt=s.return;Vt;)switch(Vt.tag){case 5:case 31:case 13:Os=!1;return;case 27:case 3:Os=!0;return;default:Vt=Vt.return}}function Wn(s){if(s!==Vt)return!1;if(!qe)return jh(s),qe=!0,!1;var n=s.tag,l;if((l=n!==3&&n!==27)&&((l=n===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||zu(s.type,s.memoizedProps)),l=!l),l&&ht&&Oi(s),jh(s),n===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));ht=o0(s)}else if(n===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));ht=o0(s)}else n===27?(n=ht,Xi(s.type)?(s=qu,qu=null,ht=s):ht=n):ht=Vt?js(s.stateNode.nextSibling):null;return!0}function pn(){ht=Vt=null,qe=!1}function _c(){var s=Mi;return s!==null&&(us===null?us=s:us.push.apply(us,s),Mi=null),s}function Yr(s){Mi===null?Mi=[s]:Mi.push(s)}var Rc=I(null),xn=null,hi=null;function Pi(s,n,l){G(Rc,n._currentValue),n._currentValue=l}function mi(s){s._currentValue=Rc.current,M(Rc)}function wc(s,n,l){for(;s!==null;){var u=s.alternate;if((s.childLanes&n)!==n?(s.childLanes|=n,u!==null&&(u.childLanes|=n)):u!==null&&(u.childLanes&n)!==n&&(u.childLanes|=n),s===l)break;s=s.return}}function Dc(s,n,l,u){var p=s.child;for(p!==null&&(p.return=s);p!==null;){var y=p.dependencies;if(y!==null){var T=p.child;y=y.firstContext;e:for(;y!==null;){var w=y;y=p;for(var U=0;U<n.length;U++)if(w.context===n[U]){y.lanes|=l,w=y.alternate,w!==null&&(w.lanes|=l),wc(y.return,l,s),u||(T=null);break e}y=w.next}}else if(p.tag===18){if(T=p.return,T===null)throw Error(i(341));T.lanes|=l,y=T.alternate,y!==null&&(y.lanes|=l),wc(T,l,s),T=null}else T=p.child;if(T!==null)T.return=p;else for(T=p;T!==null;){if(T===s){T=null;break}if(p=T.sibling,p!==null){p.return=T.return,T=p;break}T=T.return}p=T}}function Zn(s,n,l,u){s=null;for(var p=n,y=!1;p!==null;){if(!y){if((p.flags&524288)!==0)y=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var T=p.alternate;if(T===null)throw Error(i(387));if(T=T.memoizedProps,T!==null){var w=p.type;ms(p.pendingProps.value,T.value)||(s!==null?s.push(w):s=[w])}}else if(p===ge.current){if(T=p.alternate,T===null)throw Error(i(387));T.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(s!==null?s.push(ba):s=[ba])}p=p.return}s!==null&&Dc(n,s,l,u),n.flags|=262144}function ll(s){for(s=s.firstContext;s!==null;){if(!ms(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function yn(s){xn=s,hi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Kt(s){return Uh(xn,s)}function ol(s,n){return xn===null&&yn(s),Uh(s,n)}function Uh(s,n){var l=n._currentValue;if(n={context:n,memoizedValue:l,next:null},hi===null){if(s===null)throw Error(i(308));hi=n,s.dependencies={lanes:0,firstContext:n},s.flags|=524288}else hi=hi.next=n;return l}var db=typeof AbortController<"u"?AbortController:function(){var s=[],n=this.signal={aborted:!1,addEventListener:function(l,u){s.push(u)}};this.abort=function(){n.aborted=!0,s.forEach(function(l){return l()})}},fb=o.unstable_scheduleCallback,hb=o.unstable_NormalPriority,It={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ic(){return{controller:new db,data:new Map,refCount:0}}function qr(s){s.refCount--,s.refCount===0&&fb(hb,function(){s.controller.abort()})}var Xr=null,Cc=0,Jn=0,er=null;function mb(s,n){if(Xr===null){var l=Xr=[];Cc=0,Jn=Mu(),er={status:"pending",value:void 0,then:function(u){l.push(u)}}}return Cc++,n.then(Fh,Fh),n}function Fh(){if(--Cc===0&&Xr!==null){er!==null&&(er.status="fulfilled");var s=Xr;Xr=null,Jn=0,er=null;for(var n=0;n<s.length;n++)(0,s[n])()}}function gb(s,n){var l=[],u={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return s.then(function(){u.status="fulfilled",u.value=n;for(var p=0;p<l.length;p++)(0,l[p])(n)},function(p){for(u.status="rejected",u.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),u}var Bh=j.S;j.S=function(s,n){Tg=Ge(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&mb(s,n),Bh!==null&&Bh(s,n)};var vn=I(null);function Nc(){var s=vn.current;return s!==null?s:ct.pooledCache}function cl(s,n){n===null?G(vn,vn.current):G(vn,n.pool)}function $h(){var s=Nc();return s===null?null:{parent:It._currentValue,pool:s}}var tr=Error(i(460)),kc=Error(i(474)),ul=Error(i(542)),dl={then:function(){}};function Gh(s){return s=s.status,s==="fulfilled"||s==="rejected"}function zh(s,n,l){switch(l=s[l],l===void 0?s.push(n):l!==n&&(n.then(ci,ci),n=l),n.status){case"fulfilled":return n.value;case"rejected":throw s=n.reason,Vh(s),s;default:if(typeof n.status=="string")n.then(ci,ci);else{if(s=ct,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=n,s.status="pending",s.then(function(u){if(n.status==="pending"){var p=n;p.status="fulfilled",p.value=u}},function(u){if(n.status==="pending"){var p=n;p.status="rejected",p.reason=u}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw s=n.reason,Vh(s),s}throw Sn=n,tr}}function bn(s){try{var n=s._init;return n(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Sn=l,tr):l}}var Sn=null;function Hh(){if(Sn===null)throw Error(i(459));var s=Sn;return Sn=null,s}function Vh(s){if(s===tr||s===ul)throw Error(i(483))}var sr=null,Qr=0;function fl(s){var n=Qr;return Qr+=1,sr===null&&(sr=[]),zh(sr,s,n)}function Wr(s,n){n=n.props.ref,s.ref=n!==void 0?n:null}function hl(s,n){throw n.$$typeof===v?Error(i(525)):(s=Object.prototype.toString.call(n),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":s)))}function Kh(s){function n(z,$){if(s){var q=z.deletions;q===null?(z.deletions=[$],z.flags|=16):q.push($)}}function l(z,$){if(!s)return null;for(;$!==null;)n(z,$),$=$.sibling;return null}function u(z){for(var $=new Map;z!==null;)z.key!==null?$.set(z.key,z):$.set(z.index,z),z=z.sibling;return $}function p(z,$){return z=di(z,$),z.index=0,z.sibling=null,z}function y(z,$,q){return z.index=q,s?(q=z.alternate,q!==null?(q=q.index,q<$?(z.flags|=67108866,$):q):(z.flags|=67108866,$)):(z.flags|=1048576,$)}function T(z){return s&&z.alternate===null&&(z.flags|=67108866),z}function w(z,$,q,oe){return $===null||$.tag!==6?($=Sc(q,z.mode,oe),$.return=z,$):($=p($,q),$.return=z,$)}function U(z,$,q,oe){var De=q.type;return De===A?ne(z,$,q.props.children,oe,q.key):$!==null&&($.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===B&&bn(De)===$.type)?($=p($,q.props),Wr($,q),$.return=z,$):($=rl(q.type,q.key,q.props,null,z.mode,oe),Wr($,q),$.return=z,$)}function Q(z,$,q,oe){return $===null||$.tag!==4||$.stateNode.containerInfo!==q.containerInfo||$.stateNode.implementation!==q.implementation?($=Ec(q,z.mode,oe),$.return=z,$):($=p($,q.children||[]),$.return=z,$)}function ne(z,$,q,oe,De){return $===null||$.tag!==7?($=gn(q,z.mode,oe,De),$.return=z,$):($=p($,q),$.return=z,$)}function fe(z,$,q){if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return $=Sc(""+$,z.mode,q),$.return=z,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case b:return q=rl($.type,$.key,$.props,null,z.mode,q),Wr(q,$),q.return=z,q;case S:return $=Ec($,z.mode,q),$.return=z,$;case B:return $=bn($),fe(z,$,q)}if(ce($)||ue($))return $=gn($,z.mode,q,null),$.return=z,$;if(typeof $.then=="function")return fe(z,fl($),q);if($.$$typeof===D)return fe(z,ol(z,$),q);hl(z,$)}return null}function J(z,$,q,oe){var De=$!==null?$.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return De!==null?null:w(z,$,""+q,oe);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case b:return q.key===De?U(z,$,q,oe):null;case S:return q.key===De?Q(z,$,q,oe):null;case B:return q=bn(q),J(z,$,q,oe)}if(ce(q)||ue(q))return De!==null?null:ne(z,$,q,oe,null);if(typeof q.then=="function")return J(z,$,fl(q),oe);if(q.$$typeof===D)return J(z,$,ol(z,q),oe);hl(z,q)}return null}function ie(z,$,q,oe,De){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return z=z.get(q)||null,w($,z,""+oe,De);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case b:return z=z.get(oe.key===null?q:oe.key)||null,U($,z,oe,De);case S:return z=z.get(oe.key===null?q:oe.key)||null,Q($,z,oe,De);case B:return oe=bn(oe),ie(z,$,q,oe,De)}if(ce(oe)||ue(oe))return z=z.get(q)||null,ne($,z,oe,De,null);if(typeof oe.then=="function")return ie(z,$,q,fl(oe),De);if(oe.$$typeof===D)return ie(z,$,q,ol($,oe),De);hl($,oe)}return null}function Ee(z,$,q,oe){for(var De=null,Qe=null,Le=$,Ue=$=0,Ke=null;Le!==null&&Ue<q.length;Ue++){Le.index>Ue?(Ke=Le,Le=null):Ke=Le.sibling;var We=J(z,Le,q[Ue],oe);if(We===null){Le===null&&(Le=Ke);break}s&&Le&&We.alternate===null&&n(z,Le),$=y(We,$,Ue),Qe===null?De=We:Qe.sibling=We,Qe=We,Le=Ke}if(Ue===q.length)return l(z,Le),qe&&fi(z,Ue),De;if(Le===null){for(;Ue<q.length;Ue++)Le=fe(z,q[Ue],oe),Le!==null&&($=y(Le,$,Ue),Qe===null?De=Le:Qe.sibling=Le,Qe=Le);return qe&&fi(z,Ue),De}for(Le=u(Le);Ue<q.length;Ue++)Ke=ie(Le,z,Ue,q[Ue],oe),Ke!==null&&(s&&Ke.alternate!==null&&Le.delete(Ke.key===null?Ue:Ke.key),$=y(Ke,$,Ue),Qe===null?De=Ke:Qe.sibling=Ke,Qe=Ke);return s&&Le.forEach(function(en){return n(z,en)}),qe&&fi(z,Ue),De}function Ie(z,$,q,oe){if(q==null)throw Error(i(151));for(var De=null,Qe=null,Le=$,Ue=$=0,Ke=null,We=q.next();Le!==null&&!We.done;Ue++,We=q.next()){Le.index>Ue?(Ke=Le,Le=null):Ke=Le.sibling;var en=J(z,Le,We.value,oe);if(en===null){Le===null&&(Le=Ke);break}s&&Le&&en.alternate===null&&n(z,Le),$=y(en,$,Ue),Qe===null?De=en:Qe.sibling=en,Qe=en,Le=Ke}if(We.done)return l(z,Le),qe&&fi(z,Ue),De;if(Le===null){for(;!We.done;Ue++,We=q.next())We=fe(z,We.value,oe),We!==null&&($=y(We,$,Ue),Qe===null?De=We:Qe.sibling=We,Qe=We);return qe&&fi(z,Ue),De}for(Le=u(Le);!We.done;Ue++,We=q.next())We=ie(Le,z,Ue,We.value,oe),We!==null&&(s&&We.alternate!==null&&Le.delete(We.key===null?Ue:We.key),$=y(We,$,Ue),Qe===null?De=We:Qe.sibling=We,Qe=We);return s&&Le.forEach(function(_S){return n(z,_S)}),qe&&fi(z,Ue),De}function lt(z,$,q,oe){if(typeof q=="object"&&q!==null&&q.type===A&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case b:e:{for(var De=q.key;$!==null;){if($.key===De){if(De=q.type,De===A){if($.tag===7){l(z,$.sibling),oe=p($,q.props.children),oe.return=z,z=oe;break e}}else if($.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===B&&bn(De)===$.type){l(z,$.sibling),oe=p($,q.props),Wr(oe,q),oe.return=z,z=oe;break e}l(z,$);break}else n(z,$);$=$.sibling}q.type===A?(oe=gn(q.props.children,z.mode,oe,q.key),oe.return=z,z=oe):(oe=rl(q.type,q.key,q.props,null,z.mode,oe),Wr(oe,q),oe.return=z,z=oe)}return T(z);case S:e:{for(De=q.key;$!==null;){if($.key===De)if($.tag===4&&$.stateNode.containerInfo===q.containerInfo&&$.stateNode.implementation===q.implementation){l(z,$.sibling),oe=p($,q.children||[]),oe.return=z,z=oe;break e}else{l(z,$);break}else n(z,$);$=$.sibling}oe=Ec(q,z.mode,oe),oe.return=z,z=oe}return T(z);case B:return q=bn(q),lt(z,$,q,oe)}if(ce(q))return Ee(z,$,q,oe);if(ue(q)){if(De=ue(q),typeof De!="function")throw Error(i(150));return q=De.call(q),Ie(z,$,q,oe)}if(typeof q.then=="function")return lt(z,$,fl(q),oe);if(q.$$typeof===D)return lt(z,$,ol(z,q),oe);hl(z,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,$!==null&&$.tag===6?(l(z,$.sibling),oe=p($,q),oe.return=z,z=oe):(l(z,$),oe=Sc(q,z.mode,oe),oe.return=z,z=oe),T(z)):l(z,$)}return function(z,$,q,oe){try{Qr=0;var De=lt(z,$,q,oe);return sr=null,De}catch(Le){if(Le===tr||Le===ul)throw Le;var Qe=gs(29,Le,null,z.mode);return Qe.lanes=oe,Qe.return=z,Qe}finally{}}}var En=Kh(!0),Yh=Kh(!1),ji=!1;function Mc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Oc(s,n){s=s.updateQueue,n.updateQueue===s&&(n.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ui(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Fi(s,n,l){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(Ze&2)!==0){var p=u.pending;return p===null?n.next=n:(n.next=p.next,p.next=n),u.pending=n,n=nl(s),Ih(s,null,l),n}return il(s,u,n,l),nl(s)}function Zr(s,n,l){if(n=n.updateQueue,n!==null&&(n=n.shared,(l&4194048)!==0)){var u=n.lanes;u&=s.pendingLanes,l|=u,n.lanes=l,Uf(s,l)}}function Pc(s,n){var l=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var p=null,y=null;if(l=l.firstBaseUpdate,l!==null){do{var T={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};y===null?p=y=T:y=y.next=T,l=l.next}while(l!==null);y===null?p=y=n:y=y.next=n}else p=y=n;l={baseState:u.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:u.shared,callbacks:u.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=n:s.next=n,l.lastBaseUpdate=n}var jc=!1;function Jr(){if(jc){var s=er;if(s!==null)throw s}}function ea(s,n,l,u){jc=!1;var p=s.updateQueue;ji=!1;var y=p.firstBaseUpdate,T=p.lastBaseUpdate,w=p.shared.pending;if(w!==null){p.shared.pending=null;var U=w,Q=U.next;U.next=null,T===null?y=Q:T.next=Q,T=U;var ne=s.alternate;ne!==null&&(ne=ne.updateQueue,w=ne.lastBaseUpdate,w!==T&&(w===null?ne.firstBaseUpdate=Q:w.next=Q,ne.lastBaseUpdate=U))}if(y!==null){var fe=p.baseState;T=0,ne=Q=U=null,w=y;do{var J=w.lane&-536870913,ie=J!==w.lane;if(ie?(Ve&J)===J:(u&J)===J){J!==0&&J===Jn&&(jc=!0),ne!==null&&(ne=ne.next={lane:0,tag:w.tag,payload:w.payload,callback:null,next:null});e:{var Ee=s,Ie=w;J=n;var lt=l;switch(Ie.tag){case 1:if(Ee=Ie.payload,typeof Ee=="function"){fe=Ee.call(lt,fe,J);break e}fe=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Ie.payload,J=typeof Ee=="function"?Ee.call(lt,fe,J):Ee,J==null)break e;fe=x({},fe,J);break e;case 2:ji=!0}}J=w.callback,J!==null&&(s.flags|=64,ie&&(s.flags|=8192),ie=p.callbacks,ie===null?p.callbacks=[J]:ie.push(J))}else ie={lane:J,tag:w.tag,payload:w.payload,callback:w.callback,next:null},ne===null?(Q=ne=ie,U=fe):ne=ne.next=ie,T|=J;if(w=w.next,w===null){if(w=p.shared.pending,w===null)break;ie=w,w=ie.next,ie.next=null,p.lastBaseUpdate=ie,p.shared.pending=null}}while(!0);ne===null&&(U=fe),p.baseState=U,p.firstBaseUpdate=Q,p.lastBaseUpdate=ne,y===null&&(p.shared.lanes=0),Hi|=T,s.lanes=T,s.memoizedState=fe}}function qh(s,n){if(typeof s!="function")throw Error(i(191,s));s.call(n)}function Xh(s,n){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)qh(l[s],n)}var ir=I(null),ml=I(0);function Qh(s,n){s=Ti,G(ml,s),G(ir,n),Ti=s|n.baseLanes}function Uc(){G(ml,Ti),G(ir,ir.current)}function Fc(){Ti=ml.current,M(ir),M(ml)}var ps=I(null),Ps=null;function Bi(s){var n=s.alternate;G(_t,_t.current&1),G(ps,s),Ps===null&&(n===null||ir.current!==null||n.memoizedState!==null)&&(Ps=s)}function Bc(s){G(_t,_t.current),G(ps,s),Ps===null&&(Ps=s)}function Wh(s){s.tag===22?(G(_t,_t.current),G(ps,s),Ps===null&&(Ps=s)):$i()}function $i(){G(_t,_t.current),G(ps,ps.current)}function xs(s){M(ps),Ps===s&&(Ps=null),M(_t)}var _t=I(0);function gl(s){for(var n=s;n!==null;){if(n.tag===13){var l=n.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||Ku(l)||Yu(l)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var gi=0,je=null,rt=null,Ct=null,pl=!1,nr=!1,Tn=!1,xl=0,ta=0,rr=null,pb=0;function St(){throw Error(i(321))}function $c(s,n){if(n===null)return!1;for(var l=0;l<n.length&&l<s.length;l++)if(!ms(s[l],n[l]))return!1;return!0}function Gc(s,n,l,u,p,y){return gi=y,je=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,j.H=s===null||s.memoizedState===null?Mm:iu,Tn=!1,y=l(u,p),Tn=!1,nr&&(y=Jh(n,l,u,p)),Zh(s),y}function Zh(s){j.H=na;var n=rt!==null&&rt.next!==null;if(gi=0,Ct=rt=je=null,pl=!1,ta=0,rr=null,n)throw Error(i(300));s===null||Nt||(s=s.dependencies,s!==null&&ll(s)&&(Nt=!0))}function Jh(s,n,l,u){je=s;var p=0;do{if(nr&&(rr=null),ta=0,nr=!1,25<=p)throw Error(i(301));if(p+=1,Ct=rt=null,s.updateQueue!=null){var y=s.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}j.H=Om,y=n(l,u)}while(nr);return y}function xb(){var s=j.H,n=s.useState()[0];return n=typeof n.then=="function"?sa(n):n,s=s.useState()[0],(rt!==null?rt.memoizedState:null)!==s&&(je.flags|=1024),n}function zc(){var s=xl!==0;return xl=0,s}function Hc(s,n,l){n.updateQueue=s.updateQueue,n.flags&=-2053,s.lanes&=~l}function Vc(s){if(pl){for(s=s.memoizedState;s!==null;){var n=s.queue;n!==null&&(n.pending=null),s=s.next}pl=!1}gi=0,Ct=rt=je=null,nr=!1,ta=xl=0,rr=null}function ss(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?je.memoizedState=Ct=s:Ct=Ct.next=s,Ct}function Rt(){if(rt===null){var s=je.alternate;s=s!==null?s.memoizedState:null}else s=rt.next;var n=Ct===null?je.memoizedState:Ct.next;if(n!==null)Ct=n,rt=s;else{if(s===null)throw je.alternate===null?Error(i(467)):Error(i(310));rt=s,s={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},Ct===null?je.memoizedState=Ct=s:Ct=Ct.next=s}return Ct}function yl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sa(s){var n=ta;return ta+=1,rr===null&&(rr=[]),s=zh(rr,s,n),n=je,(Ct===null?n.memoizedState:Ct.next)===null&&(n=n.alternate,j.H=n===null||n.memoizedState===null?Mm:iu),s}function vl(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return sa(s);if(s.$$typeof===D)return Kt(s)}throw Error(i(438,String(s)))}function Kc(s){var n=null,l=je.updateQueue;if(l!==null&&(n=l.memoCache),n==null){var u=je.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(n={data:u.data.map(function(p){return p.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),l===null&&(l=yl(),je.updateQueue=l),l.memoCache=n,l=n.data[n.index],l===void 0)for(l=n.data[n.index]=Array(s),u=0;u<s;u++)l[u]=P;return n.index++,l}function pi(s,n){return typeof n=="function"?n(s):n}function bl(s){var n=Rt();return Yc(n,rt,s)}function Yc(s,n,l){var u=s.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=l;var p=s.baseQueue,y=u.pending;if(y!==null){if(p!==null){var T=p.next;p.next=y.next,y.next=T}n.baseQueue=p=y,u.pending=null}if(y=s.baseState,p===null)s.memoizedState=y;else{n=p.next;var w=T=null,U=null,Q=n,ne=!1;do{var fe=Q.lane&-536870913;if(fe!==Q.lane?(Ve&fe)===fe:(gi&fe)===fe){var J=Q.revertLane;if(J===0)U!==null&&(U=U.next={lane:0,revertLane:0,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),fe===Jn&&(ne=!0);else if((gi&J)===J){Q=Q.next,J===Jn&&(ne=!0);continue}else fe={lane:0,revertLane:Q.revertLane,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},U===null?(w=U=fe,T=y):U=U.next=fe,je.lanes|=J,Hi|=J;fe=Q.action,Tn&&l(y,fe),y=Q.hasEagerState?Q.eagerState:l(y,fe)}else J={lane:fe,revertLane:Q.revertLane,gesture:Q.gesture,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},U===null?(w=U=J,T=y):U=U.next=J,je.lanes|=fe,Hi|=fe;Q=Q.next}while(Q!==null&&Q!==n);if(U===null?T=y:U.next=w,!ms(y,s.memoizedState)&&(Nt=!0,ne&&(l=er,l!==null)))throw l;s.memoizedState=y,s.baseState=T,s.baseQueue=U,u.lastRenderedState=y}return p===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function qc(s){var n=Rt(),l=n.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=s;var u=l.dispatch,p=l.pending,y=n.memoizedState;if(p!==null){l.pending=null;var T=p=p.next;do y=s(y,T.action),T=T.next;while(T!==p);ms(y,n.memoizedState)||(Nt=!0),n.memoizedState=y,n.baseQueue===null&&(n.baseState=y),l.lastRenderedState=y}return[y,u]}function em(s,n,l){var u=je,p=Rt(),y=qe;if(y){if(l===void 0)throw Error(i(407));l=l()}else l=n();var T=!ms((rt||p).memoizedState,l);if(T&&(p.memoizedState=l,Nt=!0),p=p.queue,Wc(im.bind(null,u,p,s),[s]),p.getSnapshot!==n||T||Ct!==null&&Ct.memoizedState.tag&1){if(u.flags|=2048,ar(9,{destroy:void 0},sm.bind(null,u,p,l,n),null),ct===null)throw Error(i(349));y||(gi&127)!==0||tm(u,n,l)}return l}function tm(s,n,l){s.flags|=16384,s={getSnapshot:n,value:l},n=je.updateQueue,n===null?(n=yl(),je.updateQueue=n,n.stores=[s]):(l=n.stores,l===null?n.stores=[s]:l.push(s))}function sm(s,n,l,u){n.value=l,n.getSnapshot=u,nm(n)&&rm(s)}function im(s,n,l){return l(function(){nm(n)&&rm(s)})}function nm(s){var n=s.getSnapshot;s=s.value;try{var l=n();return!ms(s,l)}catch{return!0}}function rm(s){var n=mn(s,2);n!==null&&ds(n,s,2)}function Xc(s){var n=ss();if(typeof s=="function"){var l=s;if(s=l(),Tn){Se(!0);try{l()}finally{Se(!1)}}}return n.memoizedState=n.baseState=s,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:s},n}function am(s,n,l,u){return s.baseState=l,Yc(s,rt,typeof u=="function"?u:pi)}function yb(s,n,l,u,p){if(Tl(s))throw Error(i(485));if(s=n.action,s!==null){var y={payload:p,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){y.listeners.push(T)}};j.T!==null?l(!0):y.isTransition=!1,u(y),l=n.pending,l===null?(y.next=n.pending=y,lm(n,y)):(y.next=l.next,n.pending=l.next=y)}}function lm(s,n){var l=n.action,u=n.payload,p=s.state;if(n.isTransition){var y=j.T,T={};j.T=T;try{var w=l(p,u),U=j.S;U!==null&&U(T,w),om(s,n,w)}catch(Q){Qc(s,n,Q)}finally{y!==null&&T.types!==null&&(y.types=T.types),j.T=y}}else try{y=l(p,u),om(s,n,y)}catch(Q){Qc(s,n,Q)}}function om(s,n,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){cm(s,n,u)},function(u){return Qc(s,n,u)}):cm(s,n,l)}function cm(s,n,l){n.status="fulfilled",n.value=l,um(n),s.state=l,n=s.pending,n!==null&&(l=n.next,l===n?s.pending=null:(l=l.next,n.next=l,lm(s,l)))}function Qc(s,n,l){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do n.status="rejected",n.reason=l,um(n),n=n.next;while(n!==u)}s.action=null}function um(s){s=s.listeners;for(var n=0;n<s.length;n++)(0,s[n])()}function dm(s,n){return n}function fm(s,n){if(qe){var l=ct.formState;if(l!==null){e:{var u=je;if(qe){if(ht){t:{for(var p=ht,y=Os;p.nodeType!==8;){if(!y){p=null;break t}if(p=js(p.nextSibling),p===null){p=null;break t}}y=p.data,p=y==="F!"||y==="F"?p:null}if(p){ht=js(p.nextSibling),u=p.data==="F!";break e}}Oi(u)}u=!1}u&&(n=l[0])}}return l=ss(),l.memoizedState=l.baseState=n,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dm,lastRenderedState:n},l.queue=u,l=Cm.bind(null,je,u),u.dispatch=l,u=Xc(!1),y=su.bind(null,je,!1,u.queue),u=ss(),p={state:n,dispatch:null,action:s,pending:null},u.queue=p,l=yb.bind(null,je,p,y,l),p.dispatch=l,u.memoizedState=s,[n,l,!1]}function hm(s){var n=Rt();return mm(n,rt,s)}function mm(s,n,l){if(n=Yc(s,n,dm)[0],s=bl(pi)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var u=sa(n)}catch(T){throw T===tr?ul:T}else u=n;n=Rt();var p=n.queue,y=p.dispatch;return l!==n.memoizedState&&(je.flags|=2048,ar(9,{destroy:void 0},vb.bind(null,p,l),null)),[u,y,s]}function vb(s,n){s.action=n}function gm(s){var n=Rt(),l=rt;if(l!==null)return mm(n,l,s);Rt(),n=n.memoizedState,l=Rt();var u=l.queue.dispatch;return l.memoizedState=s,[n,u,!1]}function ar(s,n,l,u){return s={tag:s,create:l,deps:u,inst:n,next:null},n=je.updateQueue,n===null&&(n=yl(),je.updateQueue=n),l=n.lastEffect,l===null?n.lastEffect=s.next=s:(u=l.next,l.next=s,s.next=u,n.lastEffect=s),s}function pm(){return Rt().memoizedState}function Sl(s,n,l,u){var p=ss();je.flags|=s,p.memoizedState=ar(1|n,{destroy:void 0},l,u===void 0?null:u)}function El(s,n,l,u){var p=Rt();u=u===void 0?null:u;var y=p.memoizedState.inst;rt!==null&&u!==null&&$c(u,rt.memoizedState.deps)?p.memoizedState=ar(n,y,l,u):(je.flags|=s,p.memoizedState=ar(1|n,y,l,u))}function xm(s,n){Sl(8390656,8,s,n)}function Wc(s,n){El(2048,8,s,n)}function bb(s){je.flags|=4;var n=je.updateQueue;if(n===null)n=yl(),je.updateQueue=n,n.events=[s];else{var l=n.events;l===null?n.events=[s]:l.push(s)}}function ym(s){var n=Rt().memoizedState;return bb({ref:n,nextImpl:s}),function(){if((Ze&2)!==0)throw Error(i(440));return n.impl.apply(void 0,arguments)}}function vm(s,n){return El(4,2,s,n)}function bm(s,n){return El(4,4,s,n)}function Sm(s,n){if(typeof n=="function"){s=s();var l=n(s);return function(){typeof l=="function"?l():n(null)}}if(n!=null)return s=s(),n.current=s,function(){n.current=null}}function Em(s,n,l){l=l!=null?l.concat([s]):null,El(4,4,Sm.bind(null,n,s),l)}function Zc(){}function Tm(s,n){var l=Rt();n=n===void 0?null:n;var u=l.memoizedState;return n!==null&&$c(n,u[1])?u[0]:(l.memoizedState=[s,n],s)}function Am(s,n){var l=Rt();n=n===void 0?null:n;var u=l.memoizedState;if(n!==null&&$c(n,u[1]))return u[0];if(u=s(),Tn){Se(!0);try{s()}finally{Se(!1)}}return l.memoizedState=[u,n],u}function Jc(s,n,l){return l===void 0||(gi&1073741824)!==0&&(Ve&261930)===0?s.memoizedState=n:(s.memoizedState=l,s=Lg(),je.lanes|=s,Hi|=s,l)}function Lm(s,n,l,u){return ms(l,n)?l:ir.current!==null?(s=Jc(s,l,u),ms(s,n)||(Nt=!0),s):(gi&42)===0||(gi&1073741824)!==0&&(Ve&261930)===0?(Nt=!0,s.memoizedState=l):(s=Lg(),je.lanes|=s,Hi|=s,n)}function _m(s,n,l,u,p){var y=X.p;X.p=y!==0&&8>y?y:8;var T=j.T,w={};j.T=w,su(s,!1,n,l);try{var U=p(),Q=j.S;if(Q!==null&&Q(w,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var ne=gb(U,u);ia(s,n,ne,bs(s))}else ia(s,n,u,bs(s))}catch(fe){ia(s,n,{then:function(){},status:"rejected",reason:fe},bs())}finally{X.p=y,T!==null&&w.types!==null&&(T.types=w.types),j.T=T}}function Sb(){}function eu(s,n,l,u){if(s.tag!==5)throw Error(i(476));var p=Rm(s).queue;_m(s,p,n,se,l===null?Sb:function(){return wm(s),l(u)})}function Rm(s){var n=s.memoizedState;if(n!==null)return n;n={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:se},next:null};var l={};return n.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:l},next:null},s.memoizedState=n,s=s.alternate,s!==null&&(s.memoizedState=n),n}function wm(s){var n=Rm(s);n.next===null&&(n=s.alternate.memoizedState),ia(s,n.next.queue,{},bs())}function tu(){return Kt(ba)}function Dm(){return Rt().memoizedState}function Im(){return Rt().memoizedState}function Eb(s){for(var n=s.return;n!==null;){switch(n.tag){case 24:case 3:var l=bs();s=Ui(l);var u=Fi(n,s,l);u!==null&&(ds(u,n,l),Zr(u,n,l)),n={cache:Ic()},s.payload=n;return}n=n.return}}function Tb(s,n,l){var u=bs();l={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Tl(s)?Nm(n,l):(l=vc(s,n,l,u),l!==null&&(ds(l,s,u),km(l,n,u)))}function Cm(s,n,l){var u=bs();ia(s,n,l,u)}function ia(s,n,l,u){var p={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Tl(s))Nm(n,p);else{var y=s.alternate;if(s.lanes===0&&(y===null||y.lanes===0)&&(y=n.lastRenderedReducer,y!==null))try{var T=n.lastRenderedState,w=y(T,l);if(p.hasEagerState=!0,p.eagerState=w,ms(w,T))return il(s,n,p,0),ct===null&&sl(),!1}catch{}finally{}if(l=vc(s,n,p,u),l!==null)return ds(l,s,u),km(l,n,u),!0}return!1}function su(s,n,l,u){if(u={lane:2,revertLane:Mu(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Tl(s)){if(n)throw Error(i(479))}else n=vc(s,l,u,2),n!==null&&ds(n,s,2)}function Tl(s){var n=s.alternate;return s===je||n!==null&&n===je}function Nm(s,n){nr=pl=!0;var l=s.pending;l===null?n.next=n:(n.next=l.next,l.next=n),s.pending=n}function km(s,n,l){if((l&4194048)!==0){var u=n.lanes;u&=s.pendingLanes,l|=u,n.lanes=l,Uf(s,l)}}var na={readContext:Kt,use:vl,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useLayoutEffect:St,useInsertionEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useSyncExternalStore:St,useId:St,useHostTransitionStatus:St,useFormState:St,useActionState:St,useOptimistic:St,useMemoCache:St,useCacheRefresh:St};na.useEffectEvent=St;var Mm={readContext:Kt,use:vl,useCallback:function(s,n){return ss().memoizedState=[s,n===void 0?null:n],s},useContext:Kt,useEffect:xm,useImperativeHandle:function(s,n,l){l=l!=null?l.concat([s]):null,Sl(4194308,4,Sm.bind(null,n,s),l)},useLayoutEffect:function(s,n){return Sl(4194308,4,s,n)},useInsertionEffect:function(s,n){Sl(4,2,s,n)},useMemo:function(s,n){var l=ss();n=n===void 0?null:n;var u=s();if(Tn){Se(!0);try{s()}finally{Se(!1)}}return l.memoizedState=[u,n],u},useReducer:function(s,n,l){var u=ss();if(l!==void 0){var p=l(n);if(Tn){Se(!0);try{l(n)}finally{Se(!1)}}}else p=n;return u.memoizedState=u.baseState=p,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:p},u.queue=s,s=s.dispatch=Tb.bind(null,je,s),[u.memoizedState,s]},useRef:function(s){var n=ss();return s={current:s},n.memoizedState=s},useState:function(s){s=Xc(s);var n=s.queue,l=Cm.bind(null,je,n);return n.dispatch=l,[s.memoizedState,l]},useDebugValue:Zc,useDeferredValue:function(s,n){var l=ss();return Jc(l,s,n)},useTransition:function(){var s=Xc(!1);return s=_m.bind(null,je,s.queue,!0,!1),ss().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,n,l){var u=je,p=ss();if(qe){if(l===void 0)throw Error(i(407));l=l()}else{if(l=n(),ct===null)throw Error(i(349));(Ve&127)!==0||tm(u,n,l)}p.memoizedState=l;var y={value:l,getSnapshot:n};return p.queue=y,xm(im.bind(null,u,y,s),[s]),u.flags|=2048,ar(9,{destroy:void 0},sm.bind(null,u,y,l,n),null),l},useId:function(){var s=ss(),n=ct.identifierPrefix;if(qe){var l=Xs,u=qs;l=(u&~(1<<32-we(u)-1)).toString(32)+l,n="_"+n+"R_"+l,l=xl++,0<l&&(n+="H"+l.toString(32)),n+="_"}else l=pb++,n="_"+n+"r_"+l.toString(32)+"_";return s.memoizedState=n},useHostTransitionStatus:tu,useFormState:fm,useActionState:fm,useOptimistic:function(s){var n=ss();n.memoizedState=n.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=l,n=su.bind(null,je,!0,l),l.dispatch=n,[s,n]},useMemoCache:Kc,useCacheRefresh:function(){return ss().memoizedState=Eb.bind(null,je)},useEffectEvent:function(s){var n=ss(),l={impl:s};return n.memoizedState=l,function(){if((Ze&2)!==0)throw Error(i(440));return l.impl.apply(void 0,arguments)}}},iu={readContext:Kt,use:vl,useCallback:Tm,useContext:Kt,useEffect:Wc,useImperativeHandle:Em,useInsertionEffect:vm,useLayoutEffect:bm,useMemo:Am,useReducer:bl,useRef:pm,useState:function(){return bl(pi)},useDebugValue:Zc,useDeferredValue:function(s,n){var l=Rt();return Lm(l,rt.memoizedState,s,n)},useTransition:function(){var s=bl(pi)[0],n=Rt().memoizedState;return[typeof s=="boolean"?s:sa(s),n]},useSyncExternalStore:em,useId:Dm,useHostTransitionStatus:tu,useFormState:hm,useActionState:hm,useOptimistic:function(s,n){var l=Rt();return am(l,rt,s,n)},useMemoCache:Kc,useCacheRefresh:Im};iu.useEffectEvent=ym;var Om={readContext:Kt,use:vl,useCallback:Tm,useContext:Kt,useEffect:Wc,useImperativeHandle:Em,useInsertionEffect:vm,useLayoutEffect:bm,useMemo:Am,useReducer:qc,useRef:pm,useState:function(){return qc(pi)},useDebugValue:Zc,useDeferredValue:function(s,n){var l=Rt();return rt===null?Jc(l,s,n):Lm(l,rt.memoizedState,s,n)},useTransition:function(){var s=qc(pi)[0],n=Rt().memoizedState;return[typeof s=="boolean"?s:sa(s),n]},useSyncExternalStore:em,useId:Dm,useHostTransitionStatus:tu,useFormState:gm,useActionState:gm,useOptimistic:function(s,n){var l=Rt();return rt!==null?am(l,rt,s,n):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:Kc,useCacheRefresh:Im};Om.useEffectEvent=ym;function nu(s,n,l,u){n=s.memoizedState,l=l(u,n),l=l==null?n:x({},n,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var ru={enqueueSetState:function(s,n,l){s=s._reactInternals;var u=bs(),p=Ui(u);p.payload=n,l!=null&&(p.callback=l),n=Fi(s,p,u),n!==null&&(ds(n,s,u),Zr(n,s,u))},enqueueReplaceState:function(s,n,l){s=s._reactInternals;var u=bs(),p=Ui(u);p.tag=1,p.payload=n,l!=null&&(p.callback=l),n=Fi(s,p,u),n!==null&&(ds(n,s,u),Zr(n,s,u))},enqueueForceUpdate:function(s,n){s=s._reactInternals;var l=bs(),u=Ui(l);u.tag=2,n!=null&&(u.callback=n),n=Fi(s,u,l),n!==null&&(ds(n,s,l),Zr(n,s,l))}};function Pm(s,n,l,u,p,y,T){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,y,T):n.prototype&&n.prototype.isPureReactComponent?!Hr(l,u)||!Hr(p,y):!0}function jm(s,n,l,u){s=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(l,u),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(l,u),n.state!==s&&ru.enqueueReplaceState(n,n.state,null)}function An(s,n){var l=n;if("ref"in n){l={};for(var u in n)u!=="ref"&&(l[u]=n[u])}if(s=s.defaultProps){l===n&&(l=x({},l));for(var p in s)l[p]===void 0&&(l[p]=s[p])}return l}function Um(s){tl(s)}function Fm(s){console.error(s)}function Bm(s){tl(s)}function Al(s,n){try{var l=s.onUncaughtError;l(n.value,{componentStack:n.stack})}catch(u){setTimeout(function(){throw u})}}function $m(s,n,l){try{var u=s.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function au(s,n,l){return l=Ui(l),l.tag=3,l.payload={element:null},l.callback=function(){Al(s,n)},l}function Gm(s){return s=Ui(s),s.tag=3,s}function zm(s,n,l,u){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var y=u.value;s.payload=function(){return p(y)},s.callback=function(){$m(n,l,u)}}var T=l.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(s.callback=function(){$m(n,l,u),typeof p!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var w=u.stack;this.componentDidCatch(u.value,{componentStack:w!==null?w:""})})}function Ab(s,n,l,u,p){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(n=l.alternate,n!==null&&Zn(n,l,p,!0),l=ps.current,l!==null){switch(l.tag){case 31:case 13:return Ps===null?Pl():l.alternate===null&&Et===0&&(Et=3),l.flags&=-257,l.flags|=65536,l.lanes=p,u===dl?l.flags|=16384:(n=l.updateQueue,n===null?l.updateQueue=new Set([u]):n.add(u),Cu(s,u,p)),!1;case 22:return l.flags|=65536,u===dl?l.flags|=16384:(n=l.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=n):(l=n.retryQueue,l===null?n.retryQueue=new Set([u]):l.add(u)),Cu(s,u,p)),!1}throw Error(i(435,l.tag))}return Cu(s,u,p),Pl(),!1}if(qe)return n=ps.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=p,u!==Lc&&(s=Error(i(422),{cause:u}),Yr(Ns(s,l)))):(u!==Lc&&(n=Error(i(423),{cause:u}),Yr(Ns(n,l))),s=s.current.alternate,s.flags|=65536,p&=-p,s.lanes|=p,u=Ns(u,l),p=au(s.stateNode,u,p),Pc(s,p),Et!==4&&(Et=2)),!1;var y=Error(i(520),{cause:u});if(y=Ns(y,l),fa===null?fa=[y]:fa.push(y),Et!==4&&(Et=2),n===null)return!0;u=Ns(u,l),l=n;do{switch(l.tag){case 3:return l.flags|=65536,s=p&-p,l.lanes|=s,s=au(l.stateNode,u,s),Pc(l,s),!1;case 1:if(n=l.type,y=l.stateNode,(l.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Vi===null||!Vi.has(y))))return l.flags|=65536,p&=-p,l.lanes|=p,p=Gm(p),zm(p,s,l,u),Pc(l,p),!1}l=l.return}while(l!==null);return!1}var lu=Error(i(461)),Nt=!1;function Yt(s,n,l,u){n.child=s===null?Yh(n,null,l,u):En(n,s.child,l,u)}function Hm(s,n,l,u,p){l=l.render;var y=n.ref;if("ref"in u){var T={};for(var w in u)w!=="ref"&&(T[w]=u[w])}else T=u;return yn(n),u=Gc(s,n,l,T,y,p),w=zc(),s!==null&&!Nt?(Hc(s,n,p),xi(s,n,p)):(qe&&w&&Tc(n),n.flags|=1,Yt(s,n,u,p),n.child)}function Vm(s,n,l,u,p){if(s===null){var y=l.type;return typeof y=="function"&&!bc(y)&&y.defaultProps===void 0&&l.compare===null?(n.tag=15,n.type=y,Km(s,n,y,u,p)):(s=rl(l.type,null,u,n,n.mode,p),s.ref=n.ref,s.return=n,n.child=s)}if(y=s.child,!gu(s,p)){var T=y.memoizedProps;if(l=l.compare,l=l!==null?l:Hr,l(T,u)&&s.ref===n.ref)return xi(s,n,p)}return n.flags|=1,s=di(y,u),s.ref=n.ref,s.return=n,n.child=s}function Km(s,n,l,u,p){if(s!==null){var y=s.memoizedProps;if(Hr(y,u)&&s.ref===n.ref)if(Nt=!1,n.pendingProps=u=y,gu(s,p))(s.flags&131072)!==0&&(Nt=!0);else return n.lanes=s.lanes,xi(s,n,p)}return ou(s,n,l,u,p)}function Ym(s,n,l,u){var p=u.children,y=s!==null?s.memoizedState:null;if(s===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((n.flags&128)!==0){if(y=y!==null?y.baseLanes|l:l,s!==null){for(u=n.child=s.child,p=0;u!==null;)p=p|u.lanes|u.childLanes,u=u.sibling;u=p&~y}else u=0,n.child=null;return qm(s,n,y,l,u)}if((l&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},s!==null&&cl(n,y!==null?y.cachePool:null),y!==null?Qh(n,y):Uc(),Wh(n);else return u=n.lanes=536870912,qm(s,n,y!==null?y.baseLanes|l:l,l,u)}else y!==null?(cl(n,y.cachePool),Qh(n,y),$i(),n.memoizedState=null):(s!==null&&cl(n,null),Uc(),$i());return Yt(s,n,p,l),n.child}function ra(s,n){return s!==null&&s.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function qm(s,n,l,u,p){var y=Nc();return y=y===null?null:{parent:It._currentValue,pool:y},n.memoizedState={baseLanes:l,cachePool:y},s!==null&&cl(n,null),Uc(),Wh(n),s!==null&&Zn(s,n,u,!0),n.childLanes=p,null}function Ll(s,n){return n=Rl({mode:n.mode,children:n.children},s.mode),n.ref=s.ref,s.child=n,n.return=s,n}function Xm(s,n,l){return En(n,s.child,null,l),s=Ll(n,n.pendingProps),s.flags|=2,xs(n),n.memoizedState=null,s}function Lb(s,n,l){var u=n.pendingProps,p=(n.flags&128)!==0;if(n.flags&=-129,s===null){if(qe){if(u.mode==="hidden")return s=Ll(n,u),n.lanes=536870912,ra(null,s);if(Bc(n),(s=ht)?(s=l0(s,Os),s=s!==null&&s.data==="&"?s:null,s!==null&&(n.memoizedState={dehydrated:s,treeContext:ki!==null?{id:qs,overflow:Xs}:null,retryLane:536870912,hydrationErrors:null},l=Nh(s),l.return=n,n.child=l,Vt=n,ht=null)):s=null,s===null)throw Oi(n);return n.lanes=536870912,null}return Ll(n,u)}var y=s.memoizedState;if(y!==null){var T=y.dehydrated;if(Bc(n),p)if(n.flags&256)n.flags&=-257,n=Xm(s,n,l);else if(n.memoizedState!==null)n.child=s.child,n.flags|=128,n=null;else throw Error(i(558));else if(Nt||Zn(s,n,l,!1),p=(l&s.childLanes)!==0,Nt||p){if(u=ct,u!==null&&(T=Ff(u,l),T!==0&&T!==y.retryLane))throw y.retryLane=T,mn(s,T),ds(u,s,T),lu;Pl(),n=Xm(s,n,l)}else s=y.treeContext,ht=js(T.nextSibling),Vt=n,qe=!0,Mi=null,Os=!1,s!==null&&Oh(n,s),n=Ll(n,u),n.flags|=4096;return n}return s=di(s.child,{mode:u.mode,children:u.children}),s.ref=n.ref,n.child=s,s.return=n,s}function _l(s,n){var l=n.ref;if(l===null)s!==null&&s.ref!==null&&(n.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(s===null||s.ref!==l)&&(n.flags|=4194816)}}function ou(s,n,l,u,p){return yn(n),l=Gc(s,n,l,u,void 0,p),u=zc(),s!==null&&!Nt?(Hc(s,n,p),xi(s,n,p)):(qe&&u&&Tc(n),n.flags|=1,Yt(s,n,l,p),n.child)}function Qm(s,n,l,u,p,y){return yn(n),n.updateQueue=null,l=Jh(n,u,l,p),Zh(s),u=zc(),s!==null&&!Nt?(Hc(s,n,y),xi(s,n,y)):(qe&&u&&Tc(n),n.flags|=1,Yt(s,n,l,y),n.child)}function Wm(s,n,l,u,p){if(yn(n),n.stateNode===null){var y=qn,T=l.contextType;typeof T=="object"&&T!==null&&(y=Kt(T)),y=new l(u,y),n.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=ru,n.stateNode=y,y._reactInternals=n,y=n.stateNode,y.props=u,y.state=n.memoizedState,y.refs={},Mc(n),T=l.contextType,y.context=typeof T=="object"&&T!==null?Kt(T):qn,y.state=n.memoizedState,T=l.getDerivedStateFromProps,typeof T=="function"&&(nu(n,l,T,u),y.state=n.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(T=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),T!==y.state&&ru.enqueueReplaceState(y,y.state,null),ea(n,u,y,p),Jr(),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308),u=!0}else if(s===null){y=n.stateNode;var w=n.memoizedProps,U=An(l,w);y.props=U;var Q=y.context,ne=l.contextType;T=qn,typeof ne=="object"&&ne!==null&&(T=Kt(ne));var fe=l.getDerivedStateFromProps;ne=typeof fe=="function"||typeof y.getSnapshotBeforeUpdate=="function",w=n.pendingProps!==w,ne||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(w||Q!==T)&&jm(n,y,u,T),ji=!1;var J=n.memoizedState;y.state=J,ea(n,u,y,p),Jr(),Q=n.memoizedState,w||J!==Q||ji?(typeof fe=="function"&&(nu(n,l,fe,u),Q=n.memoizedState),(U=ji||Pm(n,l,U,u,J,Q,T))?(ne||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(n.flags|=4194308)):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=u,n.memoizedState=Q),y.props=u,y.state=Q,y.context=T,u=U):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),u=!1)}else{y=n.stateNode,Oc(s,n),T=n.memoizedProps,ne=An(l,T),y.props=ne,fe=n.pendingProps,J=y.context,Q=l.contextType,U=qn,typeof Q=="object"&&Q!==null&&(U=Kt(Q)),w=l.getDerivedStateFromProps,(Q=typeof w=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==fe||J!==U)&&jm(n,y,u,U),ji=!1,J=n.memoizedState,y.state=J,ea(n,u,y,p),Jr();var ie=n.memoizedState;T!==fe||J!==ie||ji||s!==null&&s.dependencies!==null&&ll(s.dependencies)?(typeof w=="function"&&(nu(n,l,w,u),ie=n.memoizedState),(ne=ji||Pm(n,l,ne,u,J,ie,U)||s!==null&&s.dependencies!==null&&ll(s.dependencies))?(Q||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(u,ie,U),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(u,ie,U)),typeof y.componentDidUpdate=="function"&&(n.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===s.memoizedProps&&J===s.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===s.memoizedProps&&J===s.memoizedState||(n.flags|=1024),n.memoizedProps=u,n.memoizedState=ie),y.props=u,y.state=ie,y.context=U,u=ne):(typeof y.componentDidUpdate!="function"||T===s.memoizedProps&&J===s.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===s.memoizedProps&&J===s.memoizedState||(n.flags|=1024),u=!1)}return y=u,_l(s,n),u=(n.flags&128)!==0,y||u?(y=n.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:y.render(),n.flags|=1,s!==null&&u?(n.child=En(n,s.child,null,p),n.child=En(n,null,l,p)):Yt(s,n,l,p),n.memoizedState=y.state,s=n.child):s=xi(s,n,p),s}function Zm(s,n,l,u){return pn(),n.flags|=256,Yt(s,n,l,u),n.child}var cu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function uu(s){return{baseLanes:s,cachePool:$h()}}function du(s,n,l){return s=s!==null?s.childLanes&~l:0,n&&(s|=vs),s}function Jm(s,n,l){var u=n.pendingProps,p=!1,y=(n.flags&128)!==0,T;if((T=y)||(T=s!==null&&s.memoizedState===null?!1:(_t.current&2)!==0),T&&(p=!0,n.flags&=-129),T=(n.flags&32)!==0,n.flags&=-33,s===null){if(qe){if(p?Bi(n):$i(),(s=ht)?(s=l0(s,Os),s=s!==null&&s.data!=="&"?s:null,s!==null&&(n.memoizedState={dehydrated:s,treeContext:ki!==null?{id:qs,overflow:Xs}:null,retryLane:536870912,hydrationErrors:null},l=Nh(s),l.return=n,n.child=l,Vt=n,ht=null)):s=null,s===null)throw Oi(n);return Yu(s)?n.lanes=32:n.lanes=536870912,null}var w=u.children;return u=u.fallback,p?($i(),p=n.mode,w=Rl({mode:"hidden",children:w},p),u=gn(u,p,l,null),w.return=n,u.return=n,w.sibling=u,n.child=w,u=n.child,u.memoizedState=uu(l),u.childLanes=du(s,T,l),n.memoizedState=cu,ra(null,u)):(Bi(n),fu(n,w))}var U=s.memoizedState;if(U!==null&&(w=U.dehydrated,w!==null)){if(y)n.flags&256?(Bi(n),n.flags&=-257,n=hu(s,n,l)):n.memoizedState!==null?($i(),n.child=s.child,n.flags|=128,n=null):($i(),w=u.fallback,p=n.mode,u=Rl({mode:"visible",children:u.children},p),w=gn(w,p,l,null),w.flags|=2,u.return=n,w.return=n,u.sibling=w,n.child=u,En(n,s.child,null,l),u=n.child,u.memoizedState=uu(l),u.childLanes=du(s,T,l),n.memoizedState=cu,n=ra(null,u));else if(Bi(n),Yu(w)){if(T=w.nextSibling&&w.nextSibling.dataset,T)var Q=T.dgst;T=Q,u=Error(i(419)),u.stack="",u.digest=T,Yr({value:u,source:null,stack:null}),n=hu(s,n,l)}else if(Nt||Zn(s,n,l,!1),T=(l&s.childLanes)!==0,Nt||T){if(T=ct,T!==null&&(u=Ff(T,l),u!==0&&u!==U.retryLane))throw U.retryLane=u,mn(s,u),ds(T,s,u),lu;Ku(w)||Pl(),n=hu(s,n,l)}else Ku(w)?(n.flags|=192,n.child=s.child,n=null):(s=U.treeContext,ht=js(w.nextSibling),Vt=n,qe=!0,Mi=null,Os=!1,s!==null&&Oh(n,s),n=fu(n,u.children),n.flags|=4096);return n}return p?($i(),w=u.fallback,p=n.mode,U=s.child,Q=U.sibling,u=di(U,{mode:"hidden",children:u.children}),u.subtreeFlags=U.subtreeFlags&65011712,Q!==null?w=di(Q,w):(w=gn(w,p,l,null),w.flags|=2),w.return=n,u.return=n,u.sibling=w,n.child=u,ra(null,u),u=n.child,w=s.child.memoizedState,w===null?w=uu(l):(p=w.cachePool,p!==null?(U=It._currentValue,p=p.parent!==U?{parent:U,pool:U}:p):p=$h(),w={baseLanes:w.baseLanes|l,cachePool:p}),u.memoizedState=w,u.childLanes=du(s,T,l),n.memoizedState=cu,ra(s.child,u)):(Bi(n),l=s.child,s=l.sibling,l=di(l,{mode:"visible",children:u.children}),l.return=n,l.sibling=null,s!==null&&(T=n.deletions,T===null?(n.deletions=[s],n.flags|=16):T.push(s)),n.child=l,n.memoizedState=null,l)}function fu(s,n){return n=Rl({mode:"visible",children:n},s.mode),n.return=s,s.child=n}function Rl(s,n){return s=gs(22,s,null,n),s.lanes=0,s}function hu(s,n,l){return En(n,s.child,null,l),s=fu(n,n.pendingProps.children),s.flags|=2,n.memoizedState=null,s}function eg(s,n,l){s.lanes|=n;var u=s.alternate;u!==null&&(u.lanes|=n),wc(s.return,n,l)}function mu(s,n,l,u,p,y){var T=s.memoizedState;T===null?s.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:p,treeForkCount:y}:(T.isBackwards=n,T.rendering=null,T.renderingStartTime=0,T.last=u,T.tail=l,T.tailMode=p,T.treeForkCount=y)}function tg(s,n,l){var u=n.pendingProps,p=u.revealOrder,y=u.tail;u=u.children;var T=_t.current,w=(T&2)!==0;if(w?(T=T&1|2,n.flags|=128):T&=1,G(_t,T),Yt(s,n,u,l),u=qe?Kr:0,!w&&s!==null&&(s.flags&128)!==0)e:for(s=n.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&eg(s,l,n);else if(s.tag===19)eg(s,l,n);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(p){case"forwards":for(l=n.child,p=null;l!==null;)s=l.alternate,s!==null&&gl(s)===null&&(p=l),l=l.sibling;l=p,l===null?(p=n.child,n.child=null):(p=l.sibling,l.sibling=null),mu(n,!1,p,l,y,u);break;case"backwards":case"unstable_legacy-backwards":for(l=null,p=n.child,n.child=null;p!==null;){if(s=p.alternate,s!==null&&gl(s)===null){n.child=p;break}s=p.sibling,p.sibling=l,l=p,p=s}mu(n,!0,l,null,y,u);break;case"together":mu(n,!1,null,null,void 0,u);break;default:n.memoizedState=null}return n.child}function xi(s,n,l){if(s!==null&&(n.dependencies=s.dependencies),Hi|=n.lanes,(l&n.childLanes)===0)if(s!==null){if(Zn(s,n,l,!1),(l&n.childLanes)===0)return null}else return null;if(s!==null&&n.child!==s.child)throw Error(i(153));if(n.child!==null){for(s=n.child,l=di(s,s.pendingProps),n.child=l,l.return=n;s.sibling!==null;)s=s.sibling,l=l.sibling=di(s,s.pendingProps),l.return=n;l.sibling=null}return n.child}function gu(s,n){return(s.lanes&n)!==0?!0:(s=s.dependencies,!!(s!==null&&ll(s)))}function _b(s,n,l){switch(n.tag){case 3:Re(n,n.stateNode.containerInfo),Pi(n,It,s.memoizedState.cache),pn();break;case 27:case 5:Ce(n);break;case 4:Re(n,n.stateNode.containerInfo);break;case 10:Pi(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Bc(n),null;break;case 13:var u=n.memoizedState;if(u!==null)return u.dehydrated!==null?(Bi(n),n.flags|=128,null):(l&n.child.childLanes)!==0?Jm(s,n,l):(Bi(n),s=xi(s,n,l),s!==null?s.sibling:null);Bi(n);break;case 19:var p=(s.flags&128)!==0;if(u=(l&n.childLanes)!==0,u||(Zn(s,n,l,!1),u=(l&n.childLanes)!==0),p){if(u)return tg(s,n,l);n.flags|=128}if(p=n.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),G(_t,_t.current),u)break;return null;case 22:return n.lanes=0,Ym(s,n,l,n.pendingProps);case 24:Pi(n,It,s.memoizedState.cache)}return xi(s,n,l)}function sg(s,n,l){if(s!==null)if(s.memoizedProps!==n.pendingProps)Nt=!0;else{if(!gu(s,l)&&(n.flags&128)===0)return Nt=!1,_b(s,n,l);Nt=(s.flags&131072)!==0}else Nt=!1,qe&&(n.flags&1048576)!==0&&Mh(n,Kr,n.index);switch(n.lanes=0,n.tag){case 16:e:{var u=n.pendingProps;if(s=bn(n.elementType),n.type=s,typeof s=="function")bc(s)?(u=An(s,u),n.tag=1,n=Wm(null,n,s,u,l)):(n.tag=0,n=ou(null,n,s,u,l));else{if(s!=null){var p=s.$$typeof;if(p===k){n.tag=11,n=Hm(null,n,s,u,l);break e}else if(p===N){n.tag=14,n=Vm(null,n,s,u,l);break e}}throw n=ee(s)||s,Error(i(306,n,""))}}return n;case 0:return ou(s,n,n.type,n.pendingProps,l);case 1:return u=n.type,p=An(u,n.pendingProps),Wm(s,n,u,p,l);case 3:e:{if(Re(n,n.stateNode.containerInfo),s===null)throw Error(i(387));u=n.pendingProps;var y=n.memoizedState;p=y.element,Oc(s,n),ea(n,u,null,l);var T=n.memoizedState;if(u=T.cache,Pi(n,It,u),u!==y.cache&&Dc(n,[It],l,!0),Jr(),u=T.element,y.isDehydrated)if(y={element:u,isDehydrated:!1,cache:T.cache},n.updateQueue.baseState=y,n.memoizedState=y,n.flags&256){n=Zm(s,n,u,l);break e}else if(u!==p){p=Ns(Error(i(424)),n),Yr(p),n=Zm(s,n,u,l);break e}else{switch(s=n.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(ht=js(s.firstChild),Vt=n,qe=!0,Mi=null,Os=!0,l=Yh(n,null,u,l),n.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(pn(),u===p){n=xi(s,n,l);break e}Yt(s,n,u,l)}n=n.child}return n;case 26:return _l(s,n),s===null?(l=h0(n.type,null,n.pendingProps,null))?n.memoizedState=l:qe||(l=n.type,s=n.pendingProps,u=zl(V.current).createElement(l),u[Ht]=n,u[rs]=s,qt(u,l,s),$t(u),n.stateNode=u):n.memoizedState=h0(n.type,s.memoizedProps,n.pendingProps,s.memoizedState),null;case 27:return Ce(n),s===null&&qe&&(u=n.stateNode=u0(n.type,n.pendingProps,V.current),Vt=n,Os=!0,p=ht,Xi(n.type)?(qu=p,ht=js(u.firstChild)):ht=p),Yt(s,n,n.pendingProps.children,l),_l(s,n),s===null&&(n.flags|=4194304),n.child;case 5:return s===null&&qe&&((p=u=ht)&&(u=sS(u,n.type,n.pendingProps,Os),u!==null?(n.stateNode=u,Vt=n,ht=js(u.firstChild),Os=!1,p=!0):p=!1),p||Oi(n)),Ce(n),p=n.type,y=n.pendingProps,T=s!==null?s.memoizedProps:null,u=y.children,zu(p,y)?u=null:T!==null&&zu(p,T)&&(n.flags|=32),n.memoizedState!==null&&(p=Gc(s,n,xb,null,null,l),ba._currentValue=p),_l(s,n),Yt(s,n,u,l),n.child;case 6:return s===null&&qe&&((s=l=ht)&&(l=iS(l,n.pendingProps,Os),l!==null?(n.stateNode=l,Vt=n,ht=null,s=!0):s=!1),s||Oi(n)),null;case 13:return Jm(s,n,l);case 4:return Re(n,n.stateNode.containerInfo),u=n.pendingProps,s===null?n.child=En(n,null,u,l):Yt(s,n,u,l),n.child;case 11:return Hm(s,n,n.type,n.pendingProps,l);case 7:return Yt(s,n,n.pendingProps,l),n.child;case 8:return Yt(s,n,n.pendingProps.children,l),n.child;case 12:return Yt(s,n,n.pendingProps.children,l),n.child;case 10:return u=n.pendingProps,Pi(n,n.type,u.value),Yt(s,n,u.children,l),n.child;case 9:return p=n.type._context,u=n.pendingProps.children,yn(n),p=Kt(p),u=u(p),n.flags|=1,Yt(s,n,u,l),n.child;case 14:return Vm(s,n,n.type,n.pendingProps,l);case 15:return Km(s,n,n.type,n.pendingProps,l);case 19:return tg(s,n,l);case 31:return Lb(s,n,l);case 22:return Ym(s,n,l,n.pendingProps);case 24:return yn(n),u=Kt(It),s===null?(p=Nc(),p===null&&(p=ct,y=Ic(),p.pooledCache=y,y.refCount++,y!==null&&(p.pooledCacheLanes|=l),p=y),n.memoizedState={parent:u,cache:p},Mc(n),Pi(n,It,p)):((s.lanes&l)!==0&&(Oc(s,n),ea(n,null,null,l),Jr()),p=s.memoizedState,y=n.memoizedState,p.parent!==u?(p={parent:u,cache:u},n.memoizedState=p,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=p),Pi(n,It,u)):(u=y.cache,Pi(n,It,u),u!==p.cache&&Dc(n,[It],l,!0))),Yt(s,n,n.pendingProps.children,l),n.child;case 29:throw n.pendingProps}throw Error(i(156,n.tag))}function yi(s){s.flags|=4}function pu(s,n,l,u,p){if((n=(s.mode&32)!==0)&&(n=!1),n){if(s.flags|=16777216,(p&335544128)===p)if(s.stateNode.complete)s.flags|=8192;else if(Dg())s.flags|=8192;else throw Sn=dl,kc}else s.flags&=-16777217}function ig(s,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!y0(n))if(Dg())s.flags|=8192;else throw Sn=dl,kc}function wl(s,n){n!==null&&(s.flags|=4),s.flags&16384&&(n=s.tag!==22?Pf():536870912,s.lanes|=n,ur|=n)}function aa(s,n){if(!qe)switch(s.tailMode){case"hidden":n=s.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?n||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function mt(s){var n=s.alternate!==null&&s.alternate.child===s.child,l=0,u=0;if(n)for(var p=s.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags&65011712,u|=p.flags&65011712,p.return=s,p=p.sibling;else for(p=s.child;p!==null;)l|=p.lanes|p.childLanes,u|=p.subtreeFlags,u|=p.flags,p.return=s,p=p.sibling;return s.subtreeFlags|=u,s.childLanes=l,n}function Rb(s,n,l){var u=n.pendingProps;switch(Ac(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mt(n),null;case 1:return mt(n),null;case 3:return l=n.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),n.memoizedState.cache!==u&&(n.flags|=2048),mi(It),Ae(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(Wn(n)?yi(n):s===null||s.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,_c())),mt(n),null;case 26:var p=n.type,y=n.memoizedState;return s===null?(yi(n),y!==null?(mt(n),ig(n,y)):(mt(n),pu(n,p,null,u,l))):y?y!==s.memoizedState?(yi(n),mt(n),ig(n,y)):(mt(n),n.flags&=-16777217):(s=s.memoizedProps,s!==u&&yi(n),mt(n),pu(n,p,s,u,l)),null;case 27:if(it(n),l=V.current,p=n.type,s!==null&&n.stateNode!=null)s.memoizedProps!==u&&yi(n);else{if(!u){if(n.stateNode===null)throw Error(i(166));return mt(n),null}s=Z.current,Wn(n)?Ph(n):(s=u0(p,u,l),n.stateNode=s,yi(n))}return mt(n),null;case 5:if(it(n),p=n.type,s!==null&&n.stateNode!=null)s.memoizedProps!==u&&yi(n);else{if(!u){if(n.stateNode===null)throw Error(i(166));return mt(n),null}if(y=Z.current,Wn(n))Ph(n);else{var T=zl(V.current);switch(y){case 1:y=T.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:y=T.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":y=T.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":y=T.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":y=T.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof u.is=="string"?T.createElement("select",{is:u.is}):T.createElement("select"),u.multiple?y.multiple=!0:u.size&&(y.size=u.size);break;default:y=typeof u.is=="string"?T.createElement(p,{is:u.is}):T.createElement(p)}}y[Ht]=n,y[rs]=u;e:for(T=n.child;T!==null;){if(T.tag===5||T.tag===6)y.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===n)break e;for(;T.sibling===null;){if(T.return===null||T.return===n)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}n.stateNode=y;e:switch(qt(y,p,u),p){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&yi(n)}}return mt(n),pu(n,n.type,s===null?null:s.memoizedProps,n.pendingProps,l),null;case 6:if(s&&n.stateNode!=null)s.memoizedProps!==u&&yi(n);else{if(typeof u!="string"&&n.stateNode===null)throw Error(i(166));if(s=V.current,Wn(n)){if(s=n.stateNode,l=n.memoizedProps,u=null,p=Vt,p!==null)switch(p.tag){case 27:case 5:u=p.memoizedProps}s[Ht]=n,s=!!(s.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||Jg(s.nodeValue,l)),s||Oi(n,!0)}else s=zl(s).createTextNode(u),s[Ht]=n,n.stateNode=s}return mt(n),null;case 31:if(l=n.memoizedState,s===null||s.memoizedState!==null){if(u=Wn(n),l!==null){if(s===null){if(!u)throw Error(i(318));if(s=n.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(557));s[Ht]=n}else pn(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;mt(n),s=!1}else l=_c(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return n.flags&256?(xs(n),n):(xs(n),null);if((n.flags&128)!==0)throw Error(i(558))}return mt(n),null;case 13:if(u=n.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(p=Wn(n),u!==null&&u.dehydrated!==null){if(s===null){if(!p)throw Error(i(318));if(p=n.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Ht]=n}else pn(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;mt(n),p=!1}else p=_c(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=p),p=!0;if(!p)return n.flags&256?(xs(n),n):(xs(n),null)}return xs(n),(n.flags&128)!==0?(n.lanes=l,n):(l=u!==null,s=s!==null&&s.memoizedState!==null,l&&(u=n.child,p=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(p=u.alternate.memoizedState.cachePool.pool),y=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),y!==p&&(u.flags|=2048)),l!==s&&l&&(n.child.flags|=8192),wl(n,n.updateQueue),mt(n),null);case 4:return Ae(),s===null&&Uu(n.stateNode.containerInfo),mt(n),null;case 10:return mi(n.type),mt(n),null;case 19:if(M(_t),u=n.memoizedState,u===null)return mt(n),null;if(p=(n.flags&128)!==0,y=u.rendering,y===null)if(p)aa(u,!1);else{if(Et!==0||s!==null&&(s.flags&128)!==0)for(s=n.child;s!==null;){if(y=gl(s),y!==null){for(n.flags|=128,aa(u,!1),s=y.updateQueue,n.updateQueue=s,wl(n,s),n.subtreeFlags=0,s=l,l=n.child;l!==null;)Ch(l,s),l=l.sibling;return G(_t,_t.current&1|2),qe&&fi(n,u.treeForkCount),n.child}s=s.sibling}u.tail!==null&&Ge()>kl&&(n.flags|=128,p=!0,aa(u,!1),n.lanes=4194304)}else{if(!p)if(s=gl(y),s!==null){if(n.flags|=128,p=!0,s=s.updateQueue,n.updateQueue=s,wl(n,s),aa(u,!0),u.tail===null&&u.tailMode==="hidden"&&!y.alternate&&!qe)return mt(n),null}else 2*Ge()-u.renderingStartTime>kl&&l!==536870912&&(n.flags|=128,p=!0,aa(u,!1),n.lanes=4194304);u.isBackwards?(y.sibling=n.child,n.child=y):(s=u.last,s!==null?s.sibling=y:n.child=y,u.last=y)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=Ge(),s.sibling=null,l=_t.current,G(_t,p?l&1|2:l&1),qe&&fi(n,u.treeForkCount),s):(mt(n),null);case 22:case 23:return xs(n),Fc(),u=n.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(n.flags|=8192):u&&(n.flags|=8192),u?(l&536870912)!==0&&(n.flags&128)===0&&(mt(n),n.subtreeFlags&6&&(n.flags|=8192)):mt(n),l=n.updateQueue,l!==null&&wl(n,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),u=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),u!==l&&(n.flags|=2048),s!==null&&M(vn),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),mi(It),mt(n),null;case 25:return null;case 30:return null}throw Error(i(156,n.tag))}function wb(s,n){switch(Ac(n),n.tag){case 1:return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 3:return mi(It),Ae(),s=n.flags,(s&65536)!==0&&(s&128)===0?(n.flags=s&-65537|128,n):null;case 26:case 27:case 5:return it(n),null;case 31:if(n.memoizedState!==null){if(xs(n),n.alternate===null)throw Error(i(340));pn()}return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 13:if(xs(n),s=n.memoizedState,s!==null&&s.dehydrated!==null){if(n.alternate===null)throw Error(i(340));pn()}return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 19:return M(_t),null;case 4:return Ae(),null;case 10:return mi(n.type),null;case 22:case 23:return xs(n),Fc(),s!==null&&M(vn),s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 24:return mi(It),null;case 25:return null;default:return null}}function ng(s,n){switch(Ac(n),n.tag){case 3:mi(It),Ae();break;case 26:case 27:case 5:it(n);break;case 4:Ae();break;case 31:n.memoizedState!==null&&xs(n);break;case 13:xs(n);break;case 19:M(_t);break;case 10:mi(n.type);break;case 22:case 23:xs(n),Fc(),s!==null&&M(vn);break;case 24:mi(It)}}function la(s,n){try{var l=n.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var p=u.next;l=p;do{if((l.tag&s)===s){u=void 0;var y=l.create,T=l.inst;u=y(),T.destroy=u}l=l.next}while(l!==p)}}catch(w){et(n,n.return,w)}}function Gi(s,n,l){try{var u=n.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var y=p.next;u=y;do{if((u.tag&s)===s){var T=u.inst,w=T.destroy;if(w!==void 0){T.destroy=void 0,p=n;var U=l,Q=w;try{Q()}catch(ne){et(p,U,ne)}}}u=u.next}while(u!==y)}}catch(ne){et(n,n.return,ne)}}function rg(s){var n=s.updateQueue;if(n!==null){var l=s.stateNode;try{Xh(n,l)}catch(u){et(s,s.return,u)}}}function ag(s,n,l){l.props=An(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(u){et(s,n,u)}}function oa(s,n){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof l=="function"?s.refCleanup=l(u):l.current=u}}catch(p){et(s,n,p)}}function Qs(s,n){var l=s.ref,u=s.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(p){et(s,n,p)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){et(s,n,p)}else l.current=null}function lg(s){var n=s.type,l=s.memoizedProps,u=s.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(p){et(s,s.return,p)}}function xu(s,n,l){try{var u=s.stateNode;Qb(u,s.type,l,n),u[rs]=n}catch(p){et(s,s.return,p)}}function og(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Xi(s.type)||s.tag===4}function yu(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||og(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Xi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function vu(s,n,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,n?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,n):(n=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,n.appendChild(s),l=l._reactRootContainer,l!=null||n.onclick!==null||(n.onclick=ci));else if(u!==4&&(u===27&&Xi(s.type)&&(l=s.stateNode,n=null),s=s.child,s!==null))for(vu(s,n,l),s=s.sibling;s!==null;)vu(s,n,l),s=s.sibling}function Dl(s,n,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,n?l.insertBefore(s,n):l.appendChild(s);else if(u!==4&&(u===27&&Xi(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(Dl(s,n,l),s=s.sibling;s!==null;)Dl(s,n,l),s=s.sibling}function cg(s){var n=s.stateNode,l=s.memoizedProps;try{for(var u=s.type,p=n.attributes;p.length;)n.removeAttributeNode(p[0]);qt(n,u,l),n[Ht]=s,n[rs]=l}catch(y){et(s,s.return,y)}}var vi=!1,kt=!1,bu=!1,ug=typeof WeakSet=="function"?WeakSet:Set,Gt=null;function Db(s,n){if(s=s.containerInfo,$u=Ql,s=Eh(s),hc(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var p=u.anchorOffset,y=u.focusNode;u=u.focusOffset;try{l.nodeType,y.nodeType}catch{l=null;break e}var T=0,w=-1,U=-1,Q=0,ne=0,fe=s,J=null;t:for(;;){for(var ie;fe!==l||p!==0&&fe.nodeType!==3||(w=T+p),fe!==y||u!==0&&fe.nodeType!==3||(U=T+u),fe.nodeType===3&&(T+=fe.nodeValue.length),(ie=fe.firstChild)!==null;)J=fe,fe=ie;for(;;){if(fe===s)break t;if(J===l&&++Q===p&&(w=T),J===y&&++ne===u&&(U=T),(ie=fe.nextSibling)!==null)break;fe=J,J=fe.parentNode}fe=ie}l=w===-1||U===-1?null:{start:w,end:U}}else l=null}l=l||{start:0,end:0}}else l=null;for(Gu={focusedElem:s,selectionRange:l},Ql=!1,Gt=n;Gt!==null;)if(n=Gt,s=n.child,(n.subtreeFlags&1028)!==0&&s!==null)s.return=n,Gt=s;else for(;Gt!==null;){switch(n=Gt,y=n.alternate,s=n.flags,n.tag){case 0:if((s&4)!==0&&(s=n.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)p=s[l],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&y!==null){s=void 0,l=n,p=y.memoizedProps,y=y.memoizedState,u=l.stateNode;try{var Ee=An(l.type,p);s=u.getSnapshotBeforeUpdate(Ee,y),u.__reactInternalSnapshotBeforeUpdate=s}catch(Ie){et(l,l.return,Ie)}}break;case 3:if((s&1024)!==0){if(s=n.stateNode.containerInfo,l=s.nodeType,l===9)Vu(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Vu(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=n.sibling,s!==null){s.return=n.return,Gt=s;break}Gt=n.return}}function dg(s,n,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:Si(s,l),u&4&&la(5,l);break;case 1:if(Si(s,l),u&4)if(s=l.stateNode,n===null)try{s.componentDidMount()}catch(T){et(l,l.return,T)}else{var p=An(l.type,n.memoizedProps);n=n.memoizedState;try{s.componentDidUpdate(p,n,s.__reactInternalSnapshotBeforeUpdate)}catch(T){et(l,l.return,T)}}u&64&&rg(l),u&512&&oa(l,l.return);break;case 3:if(Si(s,l),u&64&&(s=l.updateQueue,s!==null)){if(n=null,l.child!==null)switch(l.child.tag){case 27:case 5:n=l.child.stateNode;break;case 1:n=l.child.stateNode}try{Xh(s,n)}catch(T){et(l,l.return,T)}}break;case 27:n===null&&u&4&&cg(l);case 26:case 5:Si(s,l),n===null&&u&4&&lg(l),u&512&&oa(l,l.return);break;case 12:Si(s,l);break;case 31:Si(s,l),u&4&&mg(s,l);break;case 13:Si(s,l),u&4&&gg(s,l),u&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=Ub.bind(null,l),nS(s,l))));break;case 22:if(u=l.memoizedState!==null||vi,!u){n=n!==null&&n.memoizedState!==null||kt,p=vi;var y=kt;vi=u,(kt=n)&&!y?Ei(s,l,(l.subtreeFlags&8772)!==0):Si(s,l),vi=p,kt=y}break;case 30:break;default:Si(s,l)}}function fg(s){var n=s.alternate;n!==null&&(s.alternate=null,fg(n)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(n=s.stateNode,n!==null&&Qo(n)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var pt=null,ls=!1;function bi(s,n,l){for(l=l.child;l!==null;)hg(s,n,l),l=l.sibling}function hg(s,n,l){if(he&&typeof he.onCommitFiberUnmount=="function")try{he.onCommitFiberUnmount(ns,l)}catch{}switch(l.tag){case 26:kt||Qs(l,n),bi(s,n,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:kt||Qs(l,n);var u=pt,p=ls;Xi(l.type)&&(pt=l.stateNode,ls=!1),bi(s,n,l),xa(l.stateNode),pt=u,ls=p;break;case 5:kt||Qs(l,n);case 6:if(u=pt,p=ls,pt=null,bi(s,n,l),pt=u,ls=p,pt!==null)if(ls)try{(pt.nodeType===9?pt.body:pt.nodeName==="HTML"?pt.ownerDocument.body:pt).removeChild(l.stateNode)}catch(y){et(l,n,y)}else try{pt.removeChild(l.stateNode)}catch(y){et(l,n,y)}break;case 18:pt!==null&&(ls?(s=pt,r0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),yr(s)):r0(pt,l.stateNode));break;case 4:u=pt,p=ls,pt=l.stateNode.containerInfo,ls=!0,bi(s,n,l),pt=u,ls=p;break;case 0:case 11:case 14:case 15:Gi(2,l,n),kt||Gi(4,l,n),bi(s,n,l);break;case 1:kt||(Qs(l,n),u=l.stateNode,typeof u.componentWillUnmount=="function"&&ag(l,n,u)),bi(s,n,l);break;case 21:bi(s,n,l);break;case 22:kt=(u=kt)||l.memoizedState!==null,bi(s,n,l),kt=u;break;default:bi(s,n,l)}}function mg(s,n){if(n.memoizedState===null&&(s=n.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{yr(s)}catch(l){et(n,n.return,l)}}}function gg(s,n){if(n.memoizedState===null&&(s=n.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{yr(s)}catch(l){et(n,n.return,l)}}function Ib(s){switch(s.tag){case 31:case 13:case 19:var n=s.stateNode;return n===null&&(n=s.stateNode=new ug),n;case 22:return s=s.stateNode,n=s._retryCache,n===null&&(n=s._retryCache=new ug),n;default:throw Error(i(435,s.tag))}}function Il(s,n){var l=Ib(s);n.forEach(function(u){if(!l.has(u)){l.add(u);var p=Fb.bind(null,s,u);u.then(p,p)}})}function os(s,n){var l=n.deletions;if(l!==null)for(var u=0;u<l.length;u++){var p=l[u],y=s,T=n,w=T;e:for(;w!==null;){switch(w.tag){case 27:if(Xi(w.type)){pt=w.stateNode,ls=!1;break e}break;case 5:pt=w.stateNode,ls=!1;break e;case 3:case 4:pt=w.stateNode.containerInfo,ls=!0;break e}w=w.return}if(pt===null)throw Error(i(160));hg(y,T,p),pt=null,ls=!1,y=p.alternate,y!==null&&(y.return=null),p.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)pg(n,s),n=n.sibling}var Hs=null;function pg(s,n){var l=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:os(n,s),cs(s),u&4&&(Gi(3,s,s.return),la(3,s),Gi(5,s,s.return));break;case 1:os(n,s),cs(s),u&512&&(kt||l===null||Qs(l,l.return)),u&64&&vi&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var p=Hs;if(os(n,s),cs(s),u&512&&(kt||l===null||Qs(l,l.return)),u&4){var y=l!==null?l.memoizedState:null;if(u=s.memoizedState,l===null)if(u===null)if(s.stateNode===null){e:{u=s.type,l=s.memoizedProps,p=p.ownerDocument||p;t:switch(u){case"title":y=p.getElementsByTagName("title")[0],(!y||y[Or]||y[Ht]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=p.createElement(u),p.head.insertBefore(y,p.querySelector("head > title"))),qt(y,u,l),y[Ht]=s,$t(y),u=y;break e;case"link":var T=p0("link","href",p).get(u+(l.href||""));if(T){for(var w=0;w<T.length;w++)if(y=T[w],y.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&y.getAttribute("rel")===(l.rel==null?null:l.rel)&&y.getAttribute("title")===(l.title==null?null:l.title)&&y.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){T.splice(w,1);break t}}y=p.createElement(u),qt(y,u,l),p.head.appendChild(y);break;case"meta":if(T=p0("meta","content",p).get(u+(l.content||""))){for(w=0;w<T.length;w++)if(y=T[w],y.getAttribute("content")===(l.content==null?null:""+l.content)&&y.getAttribute("name")===(l.name==null?null:l.name)&&y.getAttribute("property")===(l.property==null?null:l.property)&&y.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&y.getAttribute("charset")===(l.charSet==null?null:l.charSet)){T.splice(w,1);break t}}y=p.createElement(u),qt(y,u,l),p.head.appendChild(y);break;default:throw Error(i(468,u))}y[Ht]=s,$t(y),u=y}s.stateNode=u}else x0(p,s.type,s.stateNode);else s.stateNode=g0(p,u,s.memoizedProps);else y!==u?(y===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):y.count--,u===null?x0(p,s.type,s.stateNode):g0(p,u,s.memoizedProps)):u===null&&s.stateNode!==null&&xu(s,s.memoizedProps,l.memoizedProps)}break;case 27:os(n,s),cs(s),u&512&&(kt||l===null||Qs(l,l.return)),l!==null&&u&4&&xu(s,s.memoizedProps,l.memoizedProps);break;case 5:if(os(n,s),cs(s),u&512&&(kt||l===null||Qs(l,l.return)),s.flags&32){p=s.stateNode;try{$n(p,"")}catch(Ee){et(s,s.return,Ee)}}u&4&&s.stateNode!=null&&(p=s.memoizedProps,xu(s,p,l!==null?l.memoizedProps:p)),u&1024&&(bu=!0);break;case 6:if(os(n,s),cs(s),u&4){if(s.stateNode===null)throw Error(i(162));u=s.memoizedProps,l=s.stateNode;try{l.nodeValue=u}catch(Ee){et(s,s.return,Ee)}}break;case 3:if(Kl=null,p=Hs,Hs=Hl(n.containerInfo),os(n,s),Hs=p,cs(s),u&4&&l!==null&&l.memoizedState.isDehydrated)try{yr(n.containerInfo)}catch(Ee){et(s,s.return,Ee)}bu&&(bu=!1,xg(s));break;case 4:u=Hs,Hs=Hl(s.stateNode.containerInfo),os(n,s),cs(s),Hs=u;break;case 12:os(n,s),cs(s);break;case 31:os(n,s),cs(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Il(s,u)));break;case 13:os(n,s),cs(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Nl=Ge()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Il(s,u)));break;case 22:p=s.memoizedState!==null;var U=l!==null&&l.memoizedState!==null,Q=vi,ne=kt;if(vi=Q||p,kt=ne||U,os(n,s),kt=ne,vi=Q,cs(s),u&8192)e:for(n=s.stateNode,n._visibility=p?n._visibility&-2:n._visibility|1,p&&(l===null||U||vi||kt||Ln(s)),l=null,n=s;;){if(n.tag===5||n.tag===26){if(l===null){U=l=n;try{if(y=U.stateNode,p)T=y.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{w=U.stateNode;var fe=U.memoizedProps.style,J=fe!=null&&fe.hasOwnProperty("display")?fe.display:null;w.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(Ee){et(U,U.return,Ee)}}}else if(n.tag===6){if(l===null){U=n;try{U.stateNode.nodeValue=p?"":U.memoizedProps}catch(Ee){et(U,U.return,Ee)}}}else if(n.tag===18){if(l===null){U=n;try{var ie=U.stateNode;p?a0(ie,!0):a0(U.stateNode,!1)}catch(Ee){et(U,U.return,Ee)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===s)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;l===n&&(l=null),n=n.return}l===n&&(l=null),n.sibling.return=n.return,n=n.sibling}u&4&&(u=s.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,Il(s,l))));break;case 19:os(n,s),cs(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Il(s,u)));break;case 30:break;case 21:break;default:os(n,s),cs(s)}}function cs(s){var n=s.flags;if(n&2){try{for(var l,u=s.return;u!==null;){if(og(u)){l=u;break}u=u.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var p=l.stateNode,y=yu(s);Dl(s,y,p);break;case 5:var T=l.stateNode;l.flags&32&&($n(T,""),l.flags&=-33);var w=yu(s);Dl(s,w,T);break;case 3:case 4:var U=l.stateNode.containerInfo,Q=yu(s);vu(s,Q,U);break;default:throw Error(i(161))}}catch(ne){et(s,s.return,ne)}s.flags&=-3}n&4096&&(s.flags&=-4097)}function xg(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var n=s;xg(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),s=s.sibling}}function Si(s,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)dg(s,n.alternate,n),n=n.sibling}function Ln(s){for(s=s.child;s!==null;){var n=s;switch(n.tag){case 0:case 11:case 14:case 15:Gi(4,n,n.return),Ln(n);break;case 1:Qs(n,n.return);var l=n.stateNode;typeof l.componentWillUnmount=="function"&&ag(n,n.return,l),Ln(n);break;case 27:xa(n.stateNode);case 26:case 5:Qs(n,n.return),Ln(n);break;case 22:n.memoizedState===null&&Ln(n);break;case 30:Ln(n);break;default:Ln(n)}s=s.sibling}}function Ei(s,n,l){for(l=l&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var u=n.alternate,p=s,y=n,T=y.flags;switch(y.tag){case 0:case 11:case 15:Ei(p,y,l),la(4,y);break;case 1:if(Ei(p,y,l),u=y,p=u.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(Q){et(u,u.return,Q)}if(u=y,p=u.updateQueue,p!==null){var w=u.stateNode;try{var U=p.shared.hiddenCallbacks;if(U!==null)for(p.shared.hiddenCallbacks=null,p=0;p<U.length;p++)qh(U[p],w)}catch(Q){et(u,u.return,Q)}}l&&T&64&&rg(y),oa(y,y.return);break;case 27:cg(y);case 26:case 5:Ei(p,y,l),l&&u===null&&T&4&&lg(y),oa(y,y.return);break;case 12:Ei(p,y,l);break;case 31:Ei(p,y,l),l&&T&4&&mg(p,y);break;case 13:Ei(p,y,l),l&&T&4&&gg(p,y);break;case 22:y.memoizedState===null&&Ei(p,y,l),oa(y,y.return);break;case 30:break;default:Ei(p,y,l)}n=n.sibling}}function Su(s,n){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(s=n.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&qr(l))}function Eu(s,n){s=null,n.alternate!==null&&(s=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==s&&(n.refCount++,s!=null&&qr(s))}function Vs(s,n,l,u){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)yg(s,n,l,u),n=n.sibling}function yg(s,n,l,u){var p=n.flags;switch(n.tag){case 0:case 11:case 15:Vs(s,n,l,u),p&2048&&la(9,n);break;case 1:Vs(s,n,l,u);break;case 3:Vs(s,n,l,u),p&2048&&(s=null,n.alternate!==null&&(s=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==s&&(n.refCount++,s!=null&&qr(s)));break;case 12:if(p&2048){Vs(s,n,l,u),s=n.stateNode;try{var y=n.memoizedProps,T=y.id,w=y.onPostCommit;typeof w=="function"&&w(T,n.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(U){et(n,n.return,U)}}else Vs(s,n,l,u);break;case 31:Vs(s,n,l,u);break;case 13:Vs(s,n,l,u);break;case 23:break;case 22:y=n.stateNode,T=n.alternate,n.memoizedState!==null?y._visibility&2?Vs(s,n,l,u):ca(s,n):y._visibility&2?Vs(s,n,l,u):(y._visibility|=2,lr(s,n,l,u,(n.subtreeFlags&10256)!==0||!1)),p&2048&&Su(T,n);break;case 24:Vs(s,n,l,u),p&2048&&Eu(n.alternate,n);break;default:Vs(s,n,l,u)}}function lr(s,n,l,u,p){for(p=p&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var y=s,T=n,w=l,U=u,Q=T.flags;switch(T.tag){case 0:case 11:case 15:lr(y,T,w,U,p),la(8,T);break;case 23:break;case 22:var ne=T.stateNode;T.memoizedState!==null?ne._visibility&2?lr(y,T,w,U,p):ca(y,T):(ne._visibility|=2,lr(y,T,w,U,p)),p&&Q&2048&&Su(T.alternate,T);break;case 24:lr(y,T,w,U,p),p&&Q&2048&&Eu(T.alternate,T);break;default:lr(y,T,w,U,p)}n=n.sibling}}function ca(s,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var l=s,u=n,p=u.flags;switch(u.tag){case 22:ca(l,u),p&2048&&Su(u.alternate,u);break;case 24:ca(l,u),p&2048&&Eu(u.alternate,u);break;default:ca(l,u)}n=n.sibling}}var ua=8192;function or(s,n,l){if(s.subtreeFlags&ua)for(s=s.child;s!==null;)vg(s,n,l),s=s.sibling}function vg(s,n,l){switch(s.tag){case 26:or(s,n,l),s.flags&ua&&s.memoizedState!==null&&pS(l,Hs,s.memoizedState,s.memoizedProps);break;case 5:or(s,n,l);break;case 3:case 4:var u=Hs;Hs=Hl(s.stateNode.containerInfo),or(s,n,l),Hs=u;break;case 22:s.memoizedState===null&&(u=s.alternate,u!==null&&u.memoizedState!==null?(u=ua,ua=16777216,or(s,n,l),ua=u):or(s,n,l));break;default:or(s,n,l)}}function bg(s){var n=s.alternate;if(n!==null&&(s=n.child,s!==null)){n.child=null;do n=s.sibling,s.sibling=null,s=n;while(s!==null)}}function da(s){var n=s.deletions;if((s.flags&16)!==0){if(n!==null)for(var l=0;l<n.length;l++){var u=n[l];Gt=u,Eg(u,s)}bg(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Sg(s),s=s.sibling}function Sg(s){switch(s.tag){case 0:case 11:case 15:da(s),s.flags&2048&&Gi(9,s,s.return);break;case 3:da(s);break;case 12:da(s);break;case 22:var n=s.stateNode;s.memoizedState!==null&&n._visibility&2&&(s.return===null||s.return.tag!==13)?(n._visibility&=-3,Cl(s)):da(s);break;default:da(s)}}function Cl(s){var n=s.deletions;if((s.flags&16)!==0){if(n!==null)for(var l=0;l<n.length;l++){var u=n[l];Gt=u,Eg(u,s)}bg(s)}for(s=s.child;s!==null;){switch(n=s,n.tag){case 0:case 11:case 15:Gi(8,n,n.return),Cl(n);break;case 22:l=n.stateNode,l._visibility&2&&(l._visibility&=-3,Cl(n));break;default:Cl(n)}s=s.sibling}}function Eg(s,n){for(;Gt!==null;){var l=Gt;switch(l.tag){case 0:case 11:case 15:Gi(8,l,n);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:qr(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,Gt=u;else e:for(l=s;Gt!==null;){u=Gt;var p=u.sibling,y=u.return;if(fg(u),u===l){Gt=null;break e}if(p!==null){p.return=y,Gt=p;break e}Gt=y}}}var Cb={getCacheForType:function(s){var n=Kt(It),l=n.data.get(s);return l===void 0&&(l=s(),n.data.set(s,l)),l},cacheSignal:function(){return Kt(It).controller.signal}},Nb=typeof WeakMap=="function"?WeakMap:Map,Ze=0,ct=null,ze=null,Ve=0,Je=0,ys=null,zi=!1,cr=!1,Tu=!1,Ti=0,Et=0,Hi=0,_n=0,Au=0,vs=0,ur=0,fa=null,us=null,Lu=!1,Nl=0,Tg=0,kl=1/0,Ml=null,Vi=null,Pt=0,Ki=null,dr=null,Ai=0,_u=0,Ru=null,Ag=null,ha=0,wu=null;function bs(){return(Ze&2)!==0&&Ve!==0?Ve&-Ve:j.T!==null?Mu():Bf()}function Lg(){if(vs===0)if((Ve&536870912)===0||qe){var s=Mn;Mn<<=1,(Mn&3932160)===0&&(Mn=262144),vs=s}else vs=536870912;return s=ps.current,s!==null&&(s.flags|=32),vs}function ds(s,n,l){(s===ct&&(Je===2||Je===9)||s.cancelPendingCommit!==null)&&(fr(s,0),Yi(s,Ve,vs,!1)),Mr(s,l),((Ze&2)===0||s!==ct)&&(s===ct&&((Ze&2)===0&&(_n|=l),Et===4&&Yi(s,Ve,vs,!1)),Ws(s))}function _g(s,n,l){if((Ze&6)!==0)throw Error(i(327));var u=!l&&(n&127)===0&&(n&s.expiredLanes)===0||kr(s,n),p=u?Ob(s,n):Iu(s,n,!0),y=u;do{if(p===0){cr&&!u&&Yi(s,n,0,!1);break}else{if(l=s.current.alternate,y&&!kb(l)){p=Iu(s,n,!1),y=!1;continue}if(p===2){if(y=n,s.errorRecoveryDisabledLanes&y)var T=0;else T=s.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){n=T;e:{var w=s;p=fa;var U=w.current.memoizedState.isDehydrated;if(U&&(fr(w,T).flags|=256),T=Iu(w,T,!1),T!==2){if(Tu&&!U){w.errorRecoveryDisabledLanes|=y,_n|=y,p=4;break e}y=us,us=p,y!==null&&(us===null?us=y:us.push.apply(us,y))}p=T}if(y=!1,p!==2)continue}}if(p===1){fr(s,0),Yi(s,n,0,!0);break}e:{switch(u=s,y=p,y){case 0:case 1:throw Error(i(345));case 4:if((n&4194048)!==n)break;case 6:Yi(u,n,vs,!zi);break e;case 2:us=null;break;case 3:case 5:break;default:throw Error(i(329))}if((n&62914560)===n&&(p=Nl+300-Ge(),10<p)){if(Yi(u,n,vs,!zi),Ha(u,0,!0)!==0)break e;Ai=n,u.timeoutHandle=i0(Rg.bind(null,u,l,us,Ml,Lu,n,vs,_n,ur,zi,y,"Throttled",-0,0),p);break e}Rg(u,l,us,Ml,Lu,n,vs,_n,ur,zi,y,null,-0,0)}}break}while(!0);Ws(s)}function Rg(s,n,l,u,p,y,T,w,U,Q,ne,fe,J,ie){if(s.timeoutHandle=-1,fe=n.subtreeFlags,fe&8192||(fe&16785408)===16785408){fe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ci},vg(n,y,fe);var Ee=(y&62914560)===y?Nl-Ge():(y&4194048)===y?Tg-Ge():0;if(Ee=xS(fe,Ee),Ee!==null){Ai=y,s.cancelPendingCommit=Ee(Og.bind(null,s,n,y,l,u,p,T,w,U,ne,fe,null,J,ie)),Yi(s,y,T,!Q);return}}Og(s,n,y,l,u,p,T,w,U)}function kb(s){for(var n=s;;){var l=n.tag;if((l===0||l===11||l===15)&&n.flags&16384&&(l=n.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var p=l[u],y=p.getSnapshot;p=p.value;try{if(!ms(y(),p))return!1}catch{return!1}}if(l=n.child,n.subtreeFlags&16384&&l!==null)l.return=n,n=l;else{if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Yi(s,n,l,u){n&=~Au,n&=~_n,s.suspendedLanes|=n,s.pingedLanes&=~n,u&&(s.warmLanes|=n),u=s.expirationTimes;for(var p=n;0<p;){var y=31-we(p),T=1<<y;u[y]=-1,p&=~T}l!==0&&jf(s,l,n)}function Ol(){return(Ze&6)===0?(ma(0),!1):!0}function Du(){if(ze!==null){if(Je===0)var s=ze.return;else s=ze,hi=xn=null,Vc(s),sr=null,Qr=0,s=ze;for(;s!==null;)ng(s.alternate,s),s=s.return;ze=null}}function fr(s,n){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,Jb(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),Ai=0,Du(),ct=s,ze=l=di(s.current,null),Ve=n,Je=0,ys=null,zi=!1,cr=kr(s,n),Tu=!1,ur=vs=Au=_n=Hi=Et=0,us=fa=null,Lu=!1,(n&8)!==0&&(n|=n&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=n;0<u;){var p=31-we(u),y=1<<p;n|=s[p],u&=~y}return Ti=n,sl(),l}function wg(s,n){je=null,j.H=na,n===tr||n===ul?(n=Hh(),Je=3):n===kc?(n=Hh(),Je=4):Je=n===lu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,ys=n,ze===null&&(Et=1,Al(s,Ns(n,s.current)))}function Dg(){var s=ps.current;return s===null?!0:(Ve&4194048)===Ve?Ps===null:(Ve&62914560)===Ve||(Ve&536870912)!==0?s===Ps:!1}function Ig(){var s=j.H;return j.H=na,s===null?na:s}function Cg(){var s=j.A;return j.A=Cb,s}function Pl(){Et=4,zi||(Ve&4194048)!==Ve&&ps.current!==null||(cr=!0),(Hi&134217727)===0&&(_n&134217727)===0||ct===null||Yi(ct,Ve,vs,!1)}function Iu(s,n,l){var u=Ze;Ze|=2;var p=Ig(),y=Cg();(ct!==s||Ve!==n)&&(Ml=null,fr(s,n)),n=!1;var T=Et;e:do try{if(Je!==0&&ze!==null){var w=ze,U=ys;switch(Je){case 8:Du(),T=6;break e;case 3:case 2:case 9:case 6:ps.current===null&&(n=!0);var Q=Je;if(Je=0,ys=null,hr(s,w,U,Q),l&&cr){T=0;break e}break;default:Q=Je,Je=0,ys=null,hr(s,w,U,Q)}}Mb(),T=Et;break}catch(ne){wg(s,ne)}while(!0);return n&&s.shellSuspendCounter++,hi=xn=null,Ze=u,j.H=p,j.A=y,ze===null&&(ct=null,Ve=0,sl()),T}function Mb(){for(;ze!==null;)Ng(ze)}function Ob(s,n){var l=Ze;Ze|=2;var u=Ig(),p=Cg();ct!==s||Ve!==n?(Ml=null,kl=Ge()+500,fr(s,n)):cr=kr(s,n);e:do try{if(Je!==0&&ze!==null){n=ze;var y=ys;t:switch(Je){case 1:Je=0,ys=null,hr(s,n,y,1);break;case 2:case 9:if(Gh(y)){Je=0,ys=null,kg(n);break}n=function(){Je!==2&&Je!==9||ct!==s||(Je=7),Ws(s)},y.then(n,n);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:Gh(y)?(Je=0,ys=null,kg(n)):(Je=0,ys=null,hr(s,n,y,7));break;case 5:var T=null;switch(ze.tag){case 26:T=ze.memoizedState;case 5:case 27:var w=ze;if(T?y0(T):w.stateNode.complete){Je=0,ys=null;var U=w.sibling;if(U!==null)ze=U;else{var Q=w.return;Q!==null?(ze=Q,jl(Q)):ze=null}break t}}Je=0,ys=null,hr(s,n,y,5);break;case 6:Je=0,ys=null,hr(s,n,y,6);break;case 8:Du(),Et=6;break e;default:throw Error(i(462))}}Pb();break}catch(ne){wg(s,ne)}while(!0);return hi=xn=null,j.H=u,j.A=p,Ze=l,ze!==null?0:(ct=null,Ve=0,sl(),Et)}function Pb(){for(;ze!==null&&!be();)Ng(ze)}function Ng(s){var n=sg(s.alternate,s,Ti);s.memoizedProps=s.pendingProps,n===null?jl(s):ze=n}function kg(s){var n=s,l=n.alternate;switch(n.tag){case 15:case 0:n=Qm(l,n,n.pendingProps,n.type,void 0,Ve);break;case 11:n=Qm(l,n,n.pendingProps,n.type.render,n.ref,Ve);break;case 5:Vc(n);default:ng(l,n),n=ze=Ch(n,Ti),n=sg(l,n,Ti)}s.memoizedProps=s.pendingProps,n===null?jl(s):ze=n}function hr(s,n,l,u){hi=xn=null,Vc(n),sr=null,Qr=0;var p=n.return;try{if(Ab(s,p,n,l,Ve)){Et=1,Al(s,Ns(l,s.current)),ze=null;return}}catch(y){if(p!==null)throw ze=p,y;Et=1,Al(s,Ns(l,s.current)),ze=null;return}n.flags&32768?(qe||u===1?s=!0:cr||(Ve&536870912)!==0?s=!1:(zi=s=!0,(u===2||u===9||u===3||u===6)&&(u=ps.current,u!==null&&u.tag===13&&(u.flags|=16384))),Mg(n,s)):jl(n)}function jl(s){var n=s;do{if((n.flags&32768)!==0){Mg(n,zi);return}s=n.return;var l=Rb(n.alternate,n,Ti);if(l!==null){ze=l;return}if(n=n.sibling,n!==null){ze=n;return}ze=n=s}while(n!==null);Et===0&&(Et=5)}function Mg(s,n){do{var l=wb(s.alternate,s);if(l!==null){l.flags&=32767,ze=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!n&&(s=s.sibling,s!==null)){ze=s;return}ze=s=l}while(s!==null);Et=6,ze=null}function Og(s,n,l,u,p,y,T,w,U){s.cancelPendingCommit=null;do Ul();while(Pt!==0);if((Ze&6)!==0)throw Error(i(327));if(n!==null){if(n===s.current)throw Error(i(177));if(y=n.lanes|n.childLanes,y|=yc,gv(s,l,y,T,w,U),s===ct&&(ze=ct=null,Ve=0),dr=n,Ki=s,Ai=l,_u=y,Ru=p,Ag=u,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,Bb(gt,function(){return Bg(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||u){u=j.T,j.T=null,p=X.p,X.p=2,T=Ze,Ze|=4;try{Db(s,n,l)}finally{Ze=T,X.p=p,j.T=u}}Pt=1,Pg(),jg(),Ug()}}function Pg(){if(Pt===1){Pt=0;var s=Ki,n=dr,l=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||l){l=j.T,j.T=null;var u=X.p;X.p=2;var p=Ze;Ze|=4;try{pg(n,s);var y=Gu,T=Eh(s.containerInfo),w=y.focusedElem,U=y.selectionRange;if(T!==w&&w&&w.ownerDocument&&Sh(w.ownerDocument.documentElement,w)){if(U!==null&&hc(w)){var Q=U.start,ne=U.end;if(ne===void 0&&(ne=Q),"selectionStart"in w)w.selectionStart=Q,w.selectionEnd=Math.min(ne,w.value.length);else{var fe=w.ownerDocument||document,J=fe&&fe.defaultView||window;if(J.getSelection){var ie=J.getSelection(),Ee=w.textContent.length,Ie=Math.min(U.start,Ee),lt=U.end===void 0?Ie:Math.min(U.end,Ee);!ie.extend&&Ie>lt&&(T=lt,lt=Ie,Ie=T);var z=bh(w,Ie),$=bh(w,lt);if(z&&$&&(ie.rangeCount!==1||ie.anchorNode!==z.node||ie.anchorOffset!==z.offset||ie.focusNode!==$.node||ie.focusOffset!==$.offset)){var q=fe.createRange();q.setStart(z.node,z.offset),ie.removeAllRanges(),Ie>lt?(ie.addRange(q),ie.extend($.node,$.offset)):(q.setEnd($.node,$.offset),ie.addRange(q))}}}}for(fe=[],ie=w;ie=ie.parentNode;)ie.nodeType===1&&fe.push({element:ie,left:ie.scrollLeft,top:ie.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<fe.length;w++){var oe=fe[w];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}Ql=!!$u,Gu=$u=null}finally{Ze=p,X.p=u,j.T=l}}s.current=n,Pt=2}}function jg(){if(Pt===2){Pt=0;var s=Ki,n=dr,l=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||l){l=j.T,j.T=null;var u=X.p;X.p=2;var p=Ze;Ze|=4;try{dg(s,n.alternate,n)}finally{Ze=p,X.p=u,j.T=l}}Pt=3}}function Ug(){if(Pt===4||Pt===3){Pt=0,Xe();var s=Ki,n=dr,l=Ai,u=Ag;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Pt=5:(Pt=0,dr=Ki=null,Fg(s,s.pendingLanes));var p=s.pendingLanes;if(p===0&&(Vi=null),qo(l),n=n.stateNode,he&&typeof he.onCommitFiberRoot=="function")try{he.onCommitFiberRoot(ns,n,void 0,(n.current.flags&128)===128)}catch{}if(u!==null){n=j.T,p=X.p,X.p=2,j.T=null;try{for(var y=s.onRecoverableError,T=0;T<u.length;T++){var w=u[T];y(w.value,{componentStack:w.stack})}}finally{j.T=n,X.p=p}}(Ai&3)!==0&&Ul(),Ws(s),p=s.pendingLanes,(l&261930)!==0&&(p&42)!==0?s===wu?ha++:(ha=0,wu=s):ha=0,ma(0)}}function Fg(s,n){(s.pooledCacheLanes&=n)===0&&(n=s.pooledCache,n!=null&&(s.pooledCache=null,qr(n)))}function Ul(){return Pg(),jg(),Ug(),Bg()}function Bg(){if(Pt!==5)return!1;var s=Ki,n=_u;_u=0;var l=qo(Ai),u=j.T,p=X.p;try{X.p=32>l?32:l,j.T=null,l=Ru,Ru=null;var y=Ki,T=Ai;if(Pt=0,dr=Ki=null,Ai=0,(Ze&6)!==0)throw Error(i(331));var w=Ze;if(Ze|=4,Sg(y.current),yg(y,y.current,T,l),Ze=w,ma(0,!1),he&&typeof he.onPostCommitFiberRoot=="function")try{he.onPostCommitFiberRoot(ns,y)}catch{}return!0}finally{X.p=p,j.T=u,Fg(s,n)}}function $g(s,n,l){n=Ns(l,n),n=au(s.stateNode,n,2),s=Fi(s,n,2),s!==null&&(Mr(s,2),Ws(s))}function et(s,n,l){if(s.tag===3)$g(s,s,l);else for(;n!==null;){if(n.tag===3){$g(n,s,l);break}else if(n.tag===1){var u=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Vi===null||!Vi.has(u))){s=Ns(l,s),l=Gm(2),u=Fi(n,l,2),u!==null&&(zm(l,u,n,s),Mr(u,2),Ws(u));break}}n=n.return}}function Cu(s,n,l){var u=s.pingCache;if(u===null){u=s.pingCache=new Nb;var p=new Set;u.set(n,p)}else p=u.get(n),p===void 0&&(p=new Set,u.set(n,p));p.has(l)||(Tu=!0,p.add(l),s=jb.bind(null,s,n,l),n.then(s,s))}function jb(s,n,l){var u=s.pingCache;u!==null&&u.delete(n),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,ct===s&&(Ve&l)===l&&(Et===4||Et===3&&(Ve&62914560)===Ve&&300>Ge()-Nl?(Ze&2)===0&&fr(s,0):Au|=l,ur===Ve&&(ur=0)),Ws(s)}function Gg(s,n){n===0&&(n=Pf()),s=mn(s,n),s!==null&&(Mr(s,n),Ws(s))}function Ub(s){var n=s.memoizedState,l=0;n!==null&&(l=n.retryLane),Gg(s,l)}function Fb(s,n){var l=0;switch(s.tag){case 31:case 13:var u=s.stateNode,p=s.memoizedState;p!==null&&(l=p.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(i(314))}u!==null&&u.delete(n),Gg(s,l)}function Bb(s,n){return Fe(s,n)}var Fl=null,mr=null,Nu=!1,Bl=!1,ku=!1,qi=0;function Ws(s){s!==mr&&s.next===null&&(mr===null?Fl=mr=s:mr=mr.next=s),Bl=!0,Nu||(Nu=!0,Gb())}function ma(s,n){if(!ku&&Bl){ku=!0;do for(var l=!1,u=Fl;u!==null;){if(s!==0){var p=u.pendingLanes;if(p===0)var y=0;else{var T=u.suspendedLanes,w=u.pingedLanes;y=(1<<31-we(42|s)+1)-1,y&=p&~(T&~w),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(l=!0,Kg(u,y))}else y=Ve,y=Ha(u,u===ct?y:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(y&3)===0||kr(u,y)||(l=!0,Kg(u,y));u=u.next}while(l);ku=!1}}function $b(){zg()}function zg(){Bl=Nu=!1;var s=0;qi!==0&&Zb()&&(s=qi);for(var n=Ge(),l=null,u=Fl;u!==null;){var p=u.next,y=Hg(u,n);y===0?(u.next=null,l===null?Fl=p:l.next=p,p===null&&(mr=l)):(l=u,(s!==0||(y&3)!==0)&&(Bl=!0)),u=p}Pt!==0&&Pt!==5||ma(s),qi!==0&&(qi=0)}function Hg(s,n){for(var l=s.suspendedLanes,u=s.pingedLanes,p=s.expirationTimes,y=s.pendingLanes&-62914561;0<y;){var T=31-we(y),w=1<<T,U=p[T];U===-1?((w&l)===0||(w&u)!==0)&&(p[T]=mv(w,n)):U<=n&&(s.expiredLanes|=w),y&=~w}if(n=ct,l=Ve,l=Ha(s,s===n?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,l===0||s===n&&(Je===2||Je===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&pe(u),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||kr(s,l)){if(n=l&-l,n===s.callbackPriority)return n;switch(u!==null&&pe(u),qo(l)){case 2:case 8:l=Jt;break;case 32:l=gt;break;case 268435456:l=Ft;break;default:l=gt}return u=Vg.bind(null,s),l=Fe(l,u),s.callbackPriority=n,s.callbackNode=l,n}return u!==null&&u!==null&&pe(u),s.callbackPriority=2,s.callbackNode=null,2}function Vg(s,n){if(Pt!==0&&Pt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Ul()&&s.callbackNode!==l)return null;var u=Ve;return u=Ha(s,s===ct?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:(_g(s,u,n),Hg(s,Ge()),s.callbackNode!=null&&s.callbackNode===l?Vg.bind(null,s):null)}function Kg(s,n){if(Ul())return null;_g(s,n,!0)}function Gb(){eS(function(){(Ze&6)!==0?Fe(nt,$b):zg()})}function Mu(){if(qi===0){var s=Jn;s===0&&(s=Ot,Ot<<=1,(Ot&261888)===0&&(Ot=256)),qi=s}return qi}function Yg(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:qa(""+s)}function qg(s,n){var l=n.ownerDocument.createElement("input");return l.name=n.name,l.value=n.value,s.id&&l.setAttribute("form",s.id),n.parentNode.insertBefore(l,n),s=new FormData(s),l.parentNode.removeChild(l),s}function zb(s,n,l,u,p){if(n==="submit"&&l&&l.stateNode===p){var y=Yg((p[rs]||null).action),T=u.submitter;T&&(n=(n=T[rs]||null)?Yg(n.formAction):T.getAttribute("formAction"),n!==null&&(y=n,T=null));var w=new Za("action","action",null,u,p);s.push({event:w,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(qi!==0){var U=T?qg(p,T):new FormData(p);eu(l,{pending:!0,data:U,method:p.method,action:y},null,U)}}else typeof y=="function"&&(w.preventDefault(),U=T?qg(p,T):new FormData(p),eu(l,{pending:!0,data:U,method:p.method,action:y},y,U))},currentTarget:p}]})}}for(var Ou=0;Ou<xc.length;Ou++){var Pu=xc[Ou],Hb=Pu.toLowerCase(),Vb=Pu[0].toUpperCase()+Pu.slice(1);zs(Hb,"on"+Vb)}zs(Lh,"onAnimationEnd"),zs(_h,"onAnimationIteration"),zs(Rh,"onAnimationStart"),zs("dblclick","onDoubleClick"),zs("focusin","onFocus"),zs("focusout","onBlur"),zs(lb,"onTransitionRun"),zs(ob,"onTransitionStart"),zs(cb,"onTransitionCancel"),zs(wh,"onTransitionEnd"),Fn("onMouseEnter",["mouseout","mouseover"]),Fn("onMouseLeave",["mouseout","mouseover"]),Fn("onPointerEnter",["pointerout","pointerover"]),Fn("onPointerLeave",["pointerout","pointerover"]),un("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),un("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),un("onBeforeInput",["compositionend","keypress","textInput","paste"]),un("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),un("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),un("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ga="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ga));function Xg(s,n){n=(n&4)!==0;for(var l=0;l<s.length;l++){var u=s[l],p=u.event;u=u.listeners;e:{var y=void 0;if(n)for(var T=u.length-1;0<=T;T--){var w=u[T],U=w.instance,Q=w.currentTarget;if(w=w.listener,U!==y&&p.isPropagationStopped())break e;y=w,p.currentTarget=Q;try{y(p)}catch(ne){tl(ne)}p.currentTarget=null,y=U}else for(T=0;T<u.length;T++){if(w=u[T],U=w.instance,Q=w.currentTarget,w=w.listener,U!==y&&p.isPropagationStopped())break e;y=w,p.currentTarget=Q;try{y(p)}catch(ne){tl(ne)}p.currentTarget=null,y=U}}}}function He(s,n){var l=n[Xo];l===void 0&&(l=n[Xo]=new Set);var u=s+"__bubble";l.has(u)||(Qg(n,s,2,!1),l.add(u))}function ju(s,n,l){var u=0;n&&(u|=4),Qg(l,s,u,n)}var $l="_reactListening"+Math.random().toString(36).slice(2);function Uu(s){if(!s[$l]){s[$l]=!0,zf.forEach(function(l){l!=="selectionchange"&&(Kb.has(l)||ju(l,!1,s),ju(l,!0,s))});var n=s.nodeType===9?s:s.ownerDocument;n===null||n[$l]||(n[$l]=!0,ju("selectionchange",!1,n))}}function Qg(s,n,l,u){switch(L0(n)){case 2:var p=bS;break;case 8:p=SS;break;default:p=Ju}l=p.bind(null,n,l,s),p=void 0,!nc||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(p=!0),u?p!==void 0?s.addEventListener(n,l,{capture:!0,passive:p}):s.addEventListener(n,l,!0):p!==void 0?s.addEventListener(n,l,{passive:p}):s.addEventListener(n,l,!1)}function Fu(s,n,l,u,p){var y=u;if((n&1)===0&&(n&2)===0&&u!==null)e:for(;;){if(u===null)return;var T=u.tag;if(T===3||T===4){var w=u.stateNode.containerInfo;if(w===p)break;if(T===4)for(T=u.return;T!==null;){var U=T.tag;if((U===3||U===4)&&T.stateNode.containerInfo===p)return;T=T.return}for(;w!==null;){if(T=Pn(w),T===null)return;if(U=T.tag,U===5||U===6||U===26||U===27){u=y=T;continue e}w=w.parentNode}}u=u.return}th(function(){var Q=y,ne=sc(l),fe=[];e:{var J=Dh.get(s);if(J!==void 0){var ie=Za,Ee=s;switch(s){case"keypress":if(Qa(l)===0)break e;case"keydown":case"keyup":ie=Fv;break;case"focusin":Ee="focus",ie=oc;break;case"focusout":Ee="blur",ie=oc;break;case"beforeblur":case"afterblur":ie=oc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=nh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=Rv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=Gv;break;case Lh:case _h:case Rh:ie=Iv;break;case wh:ie=Hv;break;case"scroll":case"scrollend":ie=Lv;break;case"wheel":ie=Kv;break;case"copy":case"cut":case"paste":ie=Nv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=ah;break;case"toggle":case"beforetoggle":ie=qv}var Ie=(n&4)!==0,lt=!Ie&&(s==="scroll"||s==="scrollend"),z=Ie?J!==null?J+"Capture":null:J;Ie=[];for(var $=Q,q;$!==null;){var oe=$;if(q=oe.stateNode,oe=oe.tag,oe!==5&&oe!==26&&oe!==27||q===null||z===null||(oe=jr($,z),oe!=null&&Ie.push(pa($,oe,q))),lt)break;$=$.return}0<Ie.length&&(J=new ie(J,Ee,null,l,ne),fe.push({event:J,listeners:Ie}))}}if((n&7)===0){e:{if(J=s==="mouseover"||s==="pointerover",ie=s==="mouseout"||s==="pointerout",J&&l!==tc&&(Ee=l.relatedTarget||l.fromElement)&&(Pn(Ee)||Ee[On]))break e;if((ie||J)&&(J=ne.window===ne?ne:(J=ne.ownerDocument)?J.defaultView||J.parentWindow:window,ie?(Ee=l.relatedTarget||l.toElement,ie=Q,Ee=Ee?Pn(Ee):null,Ee!==null&&(lt=a(Ee),Ie=Ee.tag,Ee!==lt||Ie!==5&&Ie!==27&&Ie!==6)&&(Ee=null)):(ie=null,Ee=Q),ie!==Ee)){if(Ie=nh,oe="onMouseLeave",z="onMouseEnter",$="mouse",(s==="pointerout"||s==="pointerover")&&(Ie=ah,oe="onPointerLeave",z="onPointerEnter",$="pointer"),lt=ie==null?J:Pr(ie),q=Ee==null?J:Pr(Ee),J=new Ie(oe,$+"leave",ie,l,ne),J.target=lt,J.relatedTarget=q,oe=null,Pn(ne)===Q&&(Ie=new Ie(z,$+"enter",Ee,l,ne),Ie.target=q,Ie.relatedTarget=lt,oe=Ie),lt=oe,ie&&Ee)t:{for(Ie=Yb,z=ie,$=Ee,q=0,oe=z;oe;oe=Ie(oe))q++;oe=0;for(var De=$;De;De=Ie(De))oe++;for(;0<q-oe;)z=Ie(z),q--;for(;0<oe-q;)$=Ie($),oe--;for(;q--;){if(z===$||$!==null&&z===$.alternate){Ie=z;break t}z=Ie(z),$=Ie($)}Ie=null}else Ie=null;ie!==null&&Wg(fe,J,ie,Ie,!1),Ee!==null&&lt!==null&&Wg(fe,lt,Ee,Ie,!0)}}e:{if(J=Q?Pr(Q):window,ie=J.nodeName&&J.nodeName.toLowerCase(),ie==="select"||ie==="input"&&J.type==="file")var Qe=mh;else if(fh(J))if(gh)Qe=nb;else{Qe=sb;var Le=tb}else ie=J.nodeName,!ie||ie.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?Q&&ec(Q.elementType)&&(Qe=mh):Qe=ib;if(Qe&&(Qe=Qe(s,Q))){hh(fe,Qe,l,ne);break e}Le&&Le(s,J,Q),s==="focusout"&&Q&&J.type==="number"&&Q.memoizedProps.value!=null&&Jo(J,"number",J.value)}switch(Le=Q?Pr(Q):window,s){case"focusin":(fh(Le)||Le.contentEditable==="true")&&(Vn=Le,mc=Q,Vr=null);break;case"focusout":Vr=mc=Vn=null;break;case"mousedown":gc=!0;break;case"contextmenu":case"mouseup":case"dragend":gc=!1,Th(fe,l,ne);break;case"selectionchange":if(ab)break;case"keydown":case"keyup":Th(fe,l,ne)}var Ue;if(uc)e:{switch(s){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else Hn?uh(s,l)&&(Ke="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(Ke="onCompositionStart");Ke&&(lh&&l.locale!=="ko"&&(Hn||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&Hn&&(Ue=sh()):(Ni=ne,rc="value"in Ni?Ni.value:Ni.textContent,Hn=!0)),Le=Gl(Q,Ke),0<Le.length&&(Ke=new rh(Ke,s,null,l,ne),fe.push({event:Ke,listeners:Le}),Ue?Ke.data=Ue:(Ue=dh(l),Ue!==null&&(Ke.data=Ue)))),(Ue=Qv?Wv(s,l):Zv(s,l))&&(Ke=Gl(Q,"onBeforeInput"),0<Ke.length&&(Le=new rh("onBeforeInput","beforeinput",null,l,ne),fe.push({event:Le,listeners:Ke}),Le.data=Ue)),zb(fe,s,Q,l,ne)}Xg(fe,n)})}function pa(s,n,l){return{instance:s,listener:n,currentTarget:l}}function Gl(s,n){for(var l=n+"Capture",u=[];s!==null;){var p=s,y=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||y===null||(p=jr(s,l),p!=null&&u.unshift(pa(s,p,y)),p=jr(s,n),p!=null&&u.push(pa(s,p,y))),s.tag===3)return u;s=s.return}return[]}function Yb(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Wg(s,n,l,u,p){for(var y=n._reactName,T=[];l!==null&&l!==u;){var w=l,U=w.alternate,Q=w.stateNode;if(w=w.tag,U!==null&&U===u)break;w!==5&&w!==26&&w!==27||Q===null||(U=Q,p?(Q=jr(l,y),Q!=null&&T.unshift(pa(l,Q,U))):p||(Q=jr(l,y),Q!=null&&T.push(pa(l,Q,U)))),l=l.return}T.length!==0&&s.push({event:n,listeners:T})}var qb=/\r\n?/g,Xb=/\u0000|\uFFFD/g;function Zg(s){return(typeof s=="string"?s:""+s).replace(qb,`
`).replace(Xb,"")}function Jg(s,n){return n=Zg(n),Zg(s)===n}function at(s,n,l,u,p,y){switch(l){case"children":typeof u=="string"?n==="body"||n==="textarea"&&u===""||$n(s,u):(typeof u=="number"||typeof u=="bigint")&&n!=="body"&&$n(s,""+u);break;case"className":Ka(s,"class",u);break;case"tabIndex":Ka(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Ka(s,l,u);break;case"style":Jf(s,u,y);break;case"data":if(n!=="object"){Ka(s,"data",u);break}case"src":case"href":if(u===""&&(n!=="a"||l!=="href")){s.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=qa(""+u),s.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(l==="formAction"?(n!=="input"&&at(s,n,"name",p.name,p,null),at(s,n,"formEncType",p.formEncType,p,null),at(s,n,"formMethod",p.formMethod,p,null),at(s,n,"formTarget",p.formTarget,p,null)):(at(s,n,"encType",p.encType,p,null),at(s,n,"method",p.method,p,null),at(s,n,"target",p.target,p,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=qa(""+u),s.setAttribute(l,u);break;case"onClick":u!=null&&(s.onclick=ci);break;case"onScroll":u!=null&&He("scroll",s);break;case"onScrollEnd":u!=null&&He("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=l}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}l=qa(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""+u):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":u===!0?s.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,u):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(l,u):s.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(l):s.setAttribute(l,u);break;case"popover":He("beforetoggle",s),He("toggle",s),Va(s,"popover",u);break;case"xlinkActuate":oi(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":oi(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":oi(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":oi(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":oi(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":oi(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":oi(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":oi(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":oi(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Va(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Tv.get(l)||l,Va(s,l,u))}}function Bu(s,n,l,u,p,y){switch(l){case"style":Jf(s,u,y);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=l}}break;case"children":typeof u=="string"?$n(s,u):(typeof u=="number"||typeof u=="bigint")&&$n(s,""+u);break;case"onScroll":u!=null&&He("scroll",s);break;case"onScrollEnd":u!=null&&He("scrollend",s);break;case"onClick":u!=null&&(s.onclick=ci);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hf.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),n=l.slice(2,p?l.length-7:void 0),y=s[rs]||null,y=y!=null?y[l]:null,typeof y=="function"&&s.removeEventListener(n,y,p),typeof u=="function")){typeof y!="function"&&y!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(n,u,p);break e}l in s?s[l]=u:u===!0?s.setAttribute(l,""):Va(s,l,u)}}}function qt(s,n,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",s),He("load",s);var u=!1,p=!1,y;for(y in l)if(l.hasOwnProperty(y)){var T=l[y];if(T!=null)switch(y){case"src":u=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:at(s,n,y,T,l,null)}}p&&at(s,n,"srcSet",l.srcSet,l,null),u&&at(s,n,"src",l.src,l,null);return;case"input":He("invalid",s);var w=y=T=p=null,U=null,Q=null;for(u in l)if(l.hasOwnProperty(u)){var ne=l[u];if(ne!=null)switch(u){case"name":p=ne;break;case"type":T=ne;break;case"checked":U=ne;break;case"defaultChecked":Q=ne;break;case"value":y=ne;break;case"defaultValue":w=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(i(137,n));break;default:at(s,n,u,ne,l,null)}}Xf(s,y,w,U,Q,T,p,!1);return;case"select":He("invalid",s),u=T=y=null;for(p in l)if(l.hasOwnProperty(p)&&(w=l[p],w!=null))switch(p){case"value":y=w;break;case"defaultValue":T=w;break;case"multiple":u=w;default:at(s,n,p,w,l,null)}n=y,l=T,s.multiple=!!u,n!=null?Bn(s,!!u,n,!1):l!=null&&Bn(s,!!u,l,!0);return;case"textarea":He("invalid",s),y=p=u=null;for(T in l)if(l.hasOwnProperty(T)&&(w=l[T],w!=null))switch(T){case"value":u=w;break;case"defaultValue":p=w;break;case"children":y=w;break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(i(91));break;default:at(s,n,T,w,l,null)}Wf(s,u,p,y);return;case"option":for(U in l)if(l.hasOwnProperty(U)&&(u=l[U],u!=null))switch(U){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:at(s,n,U,u,l,null)}return;case"dialog":He("beforetoggle",s),He("toggle",s),He("cancel",s),He("close",s);break;case"iframe":case"object":He("load",s);break;case"video":case"audio":for(u=0;u<ga.length;u++)He(ga[u],s);break;case"image":He("error",s),He("load",s);break;case"details":He("toggle",s);break;case"embed":case"source":case"link":He("error",s),He("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in l)if(l.hasOwnProperty(Q)&&(u=l[Q],u!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:at(s,n,Q,u,l,null)}return;default:if(ec(n)){for(ne in l)l.hasOwnProperty(ne)&&(u=l[ne],u!==void 0&&Bu(s,n,ne,u,l,void 0));return}}for(w in l)l.hasOwnProperty(w)&&(u=l[w],u!=null&&at(s,n,w,u,l,null))}function Qb(s,n,l,u){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,y=null,T=null,w=null,U=null,Q=null,ne=null;for(ie in l){var fe=l[ie];if(l.hasOwnProperty(ie)&&fe!=null)switch(ie){case"checked":break;case"value":break;case"defaultValue":U=fe;default:u.hasOwnProperty(ie)||at(s,n,ie,null,u,fe)}}for(var J in u){var ie=u[J];if(fe=l[J],u.hasOwnProperty(J)&&(ie!=null||fe!=null))switch(J){case"type":y=ie;break;case"name":p=ie;break;case"checked":Q=ie;break;case"defaultChecked":ne=ie;break;case"value":T=ie;break;case"defaultValue":w=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(i(137,n));break;default:ie!==fe&&at(s,n,J,ie,u,fe)}}Zo(s,T,w,U,Q,ne,y,p);return;case"select":ie=T=w=J=null;for(y in l)if(U=l[y],l.hasOwnProperty(y)&&U!=null)switch(y){case"value":break;case"multiple":ie=U;default:u.hasOwnProperty(y)||at(s,n,y,null,u,U)}for(p in u)if(y=u[p],U=l[p],u.hasOwnProperty(p)&&(y!=null||U!=null))switch(p){case"value":J=y;break;case"defaultValue":w=y;break;case"multiple":T=y;default:y!==U&&at(s,n,p,y,u,U)}n=w,l=T,u=ie,J!=null?Bn(s,!!l,J,!1):!!u!=!!l&&(n!=null?Bn(s,!!l,n,!0):Bn(s,!!l,l?[]:"",!1));return;case"textarea":ie=J=null;for(w in l)if(p=l[w],l.hasOwnProperty(w)&&p!=null&&!u.hasOwnProperty(w))switch(w){case"value":break;case"children":break;default:at(s,n,w,null,u,p)}for(T in u)if(p=u[T],y=l[T],u.hasOwnProperty(T)&&(p!=null||y!=null))switch(T){case"value":J=p;break;case"defaultValue":ie=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==y&&at(s,n,T,p,u,y)}Qf(s,J,ie);return;case"option":for(var Ee in l)if(J=l[Ee],l.hasOwnProperty(Ee)&&J!=null&&!u.hasOwnProperty(Ee))switch(Ee){case"selected":s.selected=!1;break;default:at(s,n,Ee,null,u,J)}for(U in u)if(J=u[U],ie=l[U],u.hasOwnProperty(U)&&J!==ie&&(J!=null||ie!=null))switch(U){case"selected":s.selected=J&&typeof J!="function"&&typeof J!="symbol";break;default:at(s,n,U,J,u,ie)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ie in l)J=l[Ie],l.hasOwnProperty(Ie)&&J!=null&&!u.hasOwnProperty(Ie)&&at(s,n,Ie,null,u,J);for(Q in u)if(J=u[Q],ie=l[Q],u.hasOwnProperty(Q)&&J!==ie&&(J!=null||ie!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(137,n));break;default:at(s,n,Q,J,u,ie)}return;default:if(ec(n)){for(var lt in l)J=l[lt],l.hasOwnProperty(lt)&&J!==void 0&&!u.hasOwnProperty(lt)&&Bu(s,n,lt,void 0,u,J);for(ne in u)J=u[ne],ie=l[ne],!u.hasOwnProperty(ne)||J===ie||J===void 0&&ie===void 0||Bu(s,n,ne,J,u,ie);return}}for(var z in l)J=l[z],l.hasOwnProperty(z)&&J!=null&&!u.hasOwnProperty(z)&&at(s,n,z,null,u,J);for(fe in u)J=u[fe],ie=l[fe],!u.hasOwnProperty(fe)||J===ie||J==null&&ie==null||at(s,n,fe,J,u,ie)}function e0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Wb(){if(typeof performance.getEntriesByType=="function"){for(var s=0,n=0,l=performance.getEntriesByType("resource"),u=0;u<l.length;u++){var p=l[u],y=p.transferSize,T=p.initiatorType,w=p.duration;if(y&&w&&e0(T)){for(T=0,w=p.responseEnd,u+=1;u<l.length;u++){var U=l[u],Q=U.startTime;if(Q>w)break;var ne=U.transferSize,fe=U.initiatorType;ne&&e0(fe)&&(U=U.responseEnd,T+=ne*(U<w?1:(w-Q)/(U-Q)))}if(--u,n+=8*(y+T)/(p.duration/1e3),s++,10<s)break}}if(0<s)return n/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var $u=null,Gu=null;function zl(s){return s.nodeType===9?s:s.ownerDocument}function t0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function s0(s,n){if(s===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&n==="foreignObject"?0:s}function zu(s,n){return s==="textarea"||s==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Hu=null;function Zb(){var s=window.event;return s&&s.type==="popstate"?s===Hu?!1:(Hu=s,!0):(Hu=null,!1)}var i0=typeof setTimeout=="function"?setTimeout:void 0,Jb=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,eS=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(s){return n0.resolve(null).then(s).catch(tS)}:i0;function tS(s){setTimeout(function(){throw s})}function Xi(s){return s==="head"}function r0(s,n){var l=n,u=0;do{var p=l.nextSibling;if(s.removeChild(l),p&&p.nodeType===8)if(l=p.data,l==="/$"||l==="/&"){if(u===0){s.removeChild(p),yr(n);return}u--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")u++;else if(l==="html")xa(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,xa(l);for(var y=l.firstChild;y;){var T=y.nextSibling,w=y.nodeName;y[Or]||w==="SCRIPT"||w==="STYLE"||w==="LINK"&&y.rel.toLowerCase()==="stylesheet"||l.removeChild(y),y=T}}else l==="body"&&xa(s.ownerDocument.body);l=p}while(l);yr(n)}function a0(s,n){var l=s;s=0;do{var u=l.nextSibling;if(l.nodeType===1?n?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(n?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),u&&u.nodeType===8)if(l=u.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=u}while(l)}function Vu(s){var n=s.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var l=n;switch(n=n.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Vu(l),Qo(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function sS(s,n,l,u){for(;s.nodeType===1;){var p=l;if(s.nodeName.toLowerCase()!==n.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[Or])switch(n){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(y=s.getAttribute("rel"),y==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(y!==p.rel||s.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||s.getAttribute("title")!==(p.title==null?null:p.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(y=s.getAttribute("src"),(y!==(p.src==null?null:p.src)||s.getAttribute("type")!==(p.type==null?null:p.type)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&y&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(n==="input"&&s.type==="hidden"){var y=p.name==null?null:""+p.name;if(p.type==="hidden"&&s.getAttribute("name")===y)return s}else return s;if(s=js(s.nextSibling),s===null)break}return null}function iS(s,n,l){if(n==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=js(s.nextSibling),s===null))return null;return s}function l0(s,n){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!n||(s=js(s.nextSibling),s===null))return null;return s}function Ku(s){return s.data==="$?"||s.data==="$~"}function Yu(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function nS(s,n){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=n;else if(s.data!=="$?"||l.readyState!=="loading")n();else{var u=function(){n(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function js(s){for(;s!=null;s=s.nextSibling){var n=s.nodeType;if(n===1||n===3)break;if(n===8){if(n=s.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return s}var qu=null;function o0(s){s=s.nextSibling;for(var n=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(n===0)return js(s.nextSibling);n--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||n++}s=s.nextSibling}return null}function c0(s){s=s.previousSibling;for(var n=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(n===0)return s;n--}else l!=="/$"&&l!=="/&"||n++}s=s.previousSibling}return null}function u0(s,n,l){switch(n=zl(l),s){case"html":if(s=n.documentElement,!s)throw Error(i(452));return s;case"head":if(s=n.head,!s)throw Error(i(453));return s;case"body":if(s=n.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function xa(s){for(var n=s.attributes;n.length;)s.removeAttributeNode(n[0]);Qo(s)}var Us=new Map,d0=new Set;function Hl(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Li=X.d;X.d={f:rS,r:aS,D:lS,C:oS,L:cS,m:uS,X:fS,S:dS,M:hS};function rS(){var s=Li.f(),n=Ol();return s||n}function aS(s){var n=jn(s);n!==null&&n.tag===5&&n.type==="form"?wm(n):Li.r(s)}var gr=typeof document>"u"?null:document;function f0(s,n,l){var u=gr;if(u&&typeof n=="string"&&n){var p=Is(n);p='link[rel="'+s+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),d0.has(p)||(d0.add(p),s={rel:s,crossOrigin:l,href:n},u.querySelector(p)===null&&(n=u.createElement("link"),qt(n,"link",s),$t(n),u.head.appendChild(n)))}}function lS(s){Li.D(s),f0("dns-prefetch",s,null)}function oS(s,n){Li.C(s,n),f0("preconnect",s,n)}function cS(s,n,l){Li.L(s,n,l);var u=gr;if(u&&s&&n){var p='link[rel="preload"][as="'+Is(n)+'"]';n==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+Is(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+Is(l.imageSizes)+'"]')):p+='[href="'+Is(s)+'"]';var y=p;switch(n){case"style":y=pr(s);break;case"script":y=xr(s)}Us.has(y)||(s=x({rel:"preload",href:n==="image"&&l&&l.imageSrcSet?void 0:s,as:n},l),Us.set(y,s),u.querySelector(p)!==null||n==="style"&&u.querySelector(ya(y))||n==="script"&&u.querySelector(va(y))||(n=u.createElement("link"),qt(n,"link",s),$t(n),u.head.appendChild(n)))}}function uS(s,n){Li.m(s,n);var l=gr;if(l&&s){var u=n&&typeof n.as=="string"?n.as:"script",p='link[rel="modulepreload"][as="'+Is(u)+'"][href="'+Is(s)+'"]',y=p;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=xr(s)}if(!Us.has(y)&&(s=x({rel:"modulepreload",href:s},n),Us.set(y,s),l.querySelector(p)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(va(y)))return}u=l.createElement("link"),qt(u,"link",s),$t(u),l.head.appendChild(u)}}}function dS(s,n,l){Li.S(s,n,l);var u=gr;if(u&&s){var p=Un(u).hoistableStyles,y=pr(s);n=n||"default";var T=p.get(y);if(!T){var w={loading:0,preload:null};if(T=u.querySelector(ya(y)))w.loading=5;else{s=x({rel:"stylesheet",href:s,"data-precedence":n},l),(l=Us.get(y))&&Xu(s,l);var U=T=u.createElement("link");$t(U),qt(U,"link",s),U._p=new Promise(function(Q,ne){U.onload=Q,U.onerror=ne}),U.addEventListener("load",function(){w.loading|=1}),U.addEventListener("error",function(){w.loading|=2}),w.loading|=4,Vl(T,n,u)}T={type:"stylesheet",instance:T,count:1,state:w},p.set(y,T)}}}function fS(s,n){Li.X(s,n);var l=gr;if(l&&s){var u=Un(l).hoistableScripts,p=xr(s),y=u.get(p);y||(y=l.querySelector(va(p)),y||(s=x({src:s,async:!0},n),(n=Us.get(p))&&Qu(s,n),y=l.createElement("script"),$t(y),qt(y,"link",s),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},u.set(p,y))}}function hS(s,n){Li.M(s,n);var l=gr;if(l&&s){var u=Un(l).hoistableScripts,p=xr(s),y=u.get(p);y||(y=l.querySelector(va(p)),y||(s=x({src:s,async:!0,type:"module"},n),(n=Us.get(p))&&Qu(s,n),y=l.createElement("script"),$t(y),qt(y,"link",s),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},u.set(p,y))}}function h0(s,n,l,u){var p=(p=V.current)?Hl(p):null;if(!p)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(n=pr(l.href),l=Un(p).hoistableStyles,u=l.get(n),u||(u={type:"style",instance:null,count:0,state:null},l.set(n,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=pr(l.href);var y=Un(p).hoistableStyles,T=y.get(s);if(T||(p=p.ownerDocument||p,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(s,T),(y=p.querySelector(ya(s)))&&!y._p&&(T.instance=y,T.state.loading=5),Us.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Us.set(s,l),y||mS(p,s,l,T.state))),n&&u===null)throw Error(i(528,""));return T}if(n&&u!==null)throw Error(i(529,""));return null;case"script":return n=l.async,l=l.src,typeof l=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=xr(l),l=Un(p).hoistableScripts,u=l.get(n),u||(u={type:"script",instance:null,count:0,state:null},l.set(n,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function pr(s){return'href="'+Is(s)+'"'}function ya(s){return'link[rel="stylesheet"]['+s+"]"}function m0(s){return x({},s,{"data-precedence":s.precedence,precedence:null})}function mS(s,n,l,u){s.querySelector('link[rel="preload"][as="style"]['+n+"]")?u.loading=1:(n=s.createElement("link"),u.preload=n,n.addEventListener("load",function(){return u.loading|=1}),n.addEventListener("error",function(){return u.loading|=2}),qt(n,"link",l),$t(n),s.head.appendChild(n))}function xr(s){return'[src="'+Is(s)+'"]'}function va(s){return"script[async]"+s}function g0(s,n,l){if(n.count++,n.instance===null)switch(n.type){case"style":var u=s.querySelector('style[data-href~="'+Is(l.href)+'"]');if(u)return n.instance=u,$t(u),u;var p=x({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),$t(u),qt(u,"style",p),Vl(u,l.precedence,s),n.instance=u;case"stylesheet":p=pr(l.href);var y=s.querySelector(ya(p));if(y)return n.state.loading|=4,n.instance=y,$t(y),y;u=m0(l),(p=Us.get(p))&&Xu(u,p),y=(s.ownerDocument||s).createElement("link"),$t(y);var T=y;return T._p=new Promise(function(w,U){T.onload=w,T.onerror=U}),qt(y,"link",u),n.state.loading|=4,Vl(y,l.precedence,s),n.instance=y;case"script":return y=xr(l.src),(p=s.querySelector(va(y)))?(n.instance=p,$t(p),p):(u=l,(p=Us.get(y))&&(u=x({},l),Qu(u,p)),s=s.ownerDocument||s,p=s.createElement("script"),$t(p),qt(p,"link",u),s.head.appendChild(p),n.instance=p);case"void":return null;default:throw Error(i(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(u=n.instance,n.state.loading|=4,Vl(u,l.precedence,s));return n.instance}function Vl(s,n,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=u.length?u[u.length-1]:null,y=p,T=0;T<u.length;T++){var w=u[T];if(w.dataset.precedence===n)y=w;else if(y!==p)break}y?y.parentNode.insertBefore(s,y.nextSibling):(n=l.nodeType===9?l.head:l,n.insertBefore(s,n.firstChild))}function Xu(s,n){s.crossOrigin==null&&(s.crossOrigin=n.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=n.referrerPolicy),s.title==null&&(s.title=n.title)}function Qu(s,n){s.crossOrigin==null&&(s.crossOrigin=n.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=n.referrerPolicy),s.integrity==null&&(s.integrity=n.integrity)}var Kl=null;function p0(s,n,l){if(Kl===null){var u=new Map,p=Kl=new Map;p.set(l,u)}else p=Kl,u=p.get(l),u||(u=new Map,p.set(l,u));if(u.has(s))return u;for(u.set(s,null),l=l.getElementsByTagName(s),p=0;p<l.length;p++){var y=l[p];if(!(y[Or]||y[Ht]||s==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var T=y.getAttribute(n)||"";T=s+T;var w=u.get(T);w?w.push(y):u.set(T,[y])}}return u}function x0(s,n,l){s=s.ownerDocument||s,s.head.insertBefore(l,n==="title"?s.querySelector("head > title"):null)}function gS(s,n,l){if(l===1||n.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return s=n.disabled,typeof n.precedence=="string"&&s==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function y0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function pS(s,n,l,u){if(l.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var p=pr(u.href),y=n.querySelector(ya(p));if(y){n=y._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(s.count++,s=Yl.bind(s),n.then(s,s)),l.state.loading|=4,l.instance=y,$t(y);return}y=n.ownerDocument||n,u=m0(u),(p=Us.get(p))&&Xu(u,p),y=y.createElement("link"),$t(y);var T=y;T._p=new Promise(function(w,U){T.onload=w,T.onerror=U}),qt(y,"link",u),l.instance=y}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,n),(n=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=Yl.bind(s),n.addEventListener("load",l),n.addEventListener("error",l))}}var Wu=0;function xS(s,n){return s.stylesheets&&s.count===0&&Xl(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var u=setTimeout(function(){if(s.stylesheets&&Xl(s,s.stylesheets),s.unsuspend){var y=s.unsuspend;s.unsuspend=null,y()}},6e4+n);0<s.imgBytes&&Wu===0&&(Wu=62500*Wb());var p=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Xl(s,s.stylesheets),s.unsuspend)){var y=s.unsuspend;s.unsuspend=null,y()}},(s.imgBytes>Wu?50:800)+n);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(u),clearTimeout(p)}}:null}function Yl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Xl(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var ql=null;function Xl(s,n){s.stylesheets=null,s.unsuspend!==null&&(s.count++,ql=new Map,n.forEach(yS,s),ql=null,Yl.call(s))}function yS(s,n){if(!(n.state.loading&4)){var l=ql.get(s);if(l)var u=l.get(null);else{l=new Map,ql.set(s,l);for(var p=s.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<p.length;y++){var T=p[y];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(l.set(T.dataset.precedence,T),u=T)}u&&l.set(null,u)}p=n.instance,T=p.getAttribute("data-precedence"),y=l.get(T)||u,y===u&&l.set(null,p),l.set(T,p),this.count++,u=Yl.bind(this),p.addEventListener("load",u),p.addEventListener("error",u),y?y.parentNode.insertBefore(p,y.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(p,s.firstChild)),n.state.loading|=4}}var ba={$$typeof:D,Provider:null,Consumer:null,_currentValue:se,_currentValue2:se,_threadCount:0};function vS(s,n,l,u,p,y,T,w,U){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ko(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ko(0),this.hiddenUpdates=Ko(null),this.identifierPrefix=u,this.onUncaughtError=p,this.onCaughtError=y,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function v0(s,n,l,u,p,y,T,w,U,Q,ne,fe){return s=new vS(s,n,l,T,U,Q,ne,fe,w),n=1,y===!0&&(n|=24),y=gs(3,null,null,n),s.current=y,y.stateNode=s,n=Ic(),n.refCount++,s.pooledCache=n,n.refCount++,y.memoizedState={element:u,isDehydrated:l,cache:n},Mc(y),s}function b0(s){return s?(s=qn,s):qn}function S0(s,n,l,u,p,y){p=b0(p),u.context===null?u.context=p:u.pendingContext=p,u=Ui(n),u.payload={element:l},y=y===void 0?null:y,y!==null&&(u.callback=y),l=Fi(s,u,n),l!==null&&(ds(l,s,n),Zr(l,s,n))}function E0(s,n){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<n?l:n}}function Zu(s,n){E0(s,n),(s=s.alternate)&&E0(s,n)}function T0(s){if(s.tag===13||s.tag===31){var n=mn(s,67108864);n!==null&&ds(n,s,67108864),Zu(s,67108864)}}function A0(s){if(s.tag===13||s.tag===31){var n=bs();n=Yo(n);var l=mn(s,n);l!==null&&ds(l,s,n),Zu(s,n)}}var Ql=!0;function bS(s,n,l,u){var p=j.T;j.T=null;var y=X.p;try{X.p=2,Ju(s,n,l,u)}finally{X.p=y,j.T=p}}function SS(s,n,l,u){var p=j.T;j.T=null;var y=X.p;try{X.p=8,Ju(s,n,l,u)}finally{X.p=y,j.T=p}}function Ju(s,n,l,u){if(Ql){var p=ed(u);if(p===null)Fu(s,n,u,Wl,l),_0(s,u);else if(TS(p,s,n,l,u))u.stopPropagation();else if(_0(s,u),n&4&&-1<ES.indexOf(s)){for(;p!==null;){var y=jn(p);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var T=cn(y.pendingLanes);if(T!==0){var w=y;for(w.pendingLanes|=2,w.entangledLanes|=2;T;){var U=1<<31-we(T);w.entanglements[1]|=U,T&=~U}Ws(y),(Ze&6)===0&&(kl=Ge()+500,ma(0))}}break;case 31:case 13:w=mn(y,2),w!==null&&ds(w,y,2),Ol(),Zu(y,2)}if(y=ed(u),y===null&&Fu(s,n,u,Wl,l),y===p)break;p=y}p!==null&&u.stopPropagation()}else Fu(s,n,u,null,l)}}function ed(s){return s=sc(s),td(s)}var Wl=null;function td(s){if(Wl=null,s=Pn(s),s!==null){var n=a(s);if(n===null)s=null;else{var l=n.tag;if(l===13){if(s=c(n),s!==null)return s;s=null}else if(l===31){if(s=d(n),s!==null)return s;s=null}else if(l===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;s=null}else n!==s&&(s=null)}}return Wl=s,null}function L0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Zt()){case nt:return 2;case Jt:return 8;case gt:case xt:return 32;case Ft:return 268435456;default:return 32}default:return 32}}var sd=!1,Qi=null,Wi=null,Zi=null,Sa=new Map,Ea=new Map,Ji=[],ES="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _0(s,n){switch(s){case"focusin":case"focusout":Qi=null;break;case"dragenter":case"dragleave":Wi=null;break;case"mouseover":case"mouseout":Zi=null;break;case"pointerover":case"pointerout":Sa.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ea.delete(n.pointerId)}}function Ta(s,n,l,u,p,y){return s===null||s.nativeEvent!==y?(s={blockedOn:n,domEventName:l,eventSystemFlags:u,nativeEvent:y,targetContainers:[p]},n!==null&&(n=jn(n),n!==null&&T0(n)),s):(s.eventSystemFlags|=u,n=s.targetContainers,p!==null&&n.indexOf(p)===-1&&n.push(p),s)}function TS(s,n,l,u,p){switch(n){case"focusin":return Qi=Ta(Qi,s,n,l,u,p),!0;case"dragenter":return Wi=Ta(Wi,s,n,l,u,p),!0;case"mouseover":return Zi=Ta(Zi,s,n,l,u,p),!0;case"pointerover":var y=p.pointerId;return Sa.set(y,Ta(Sa.get(y)||null,s,n,l,u,p)),!0;case"gotpointercapture":return y=p.pointerId,Ea.set(y,Ta(Ea.get(y)||null,s,n,l,u,p)),!0}return!1}function R0(s){var n=Pn(s.target);if(n!==null){var l=a(n);if(l!==null){if(n=l.tag,n===13){if(n=c(l),n!==null){s.blockedOn=n,$f(s.priority,function(){A0(l)});return}}else if(n===31){if(n=d(l),n!==null){s.blockedOn=n,$f(s.priority,function(){A0(l)});return}}else if(n===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Zl(s){if(s.blockedOn!==null)return!1;for(var n=s.targetContainers;0<n.length;){var l=ed(s.nativeEvent);if(l===null){l=s.nativeEvent;var u=new l.constructor(l.type,l);tc=u,l.target.dispatchEvent(u),tc=null}else return n=jn(l),n!==null&&T0(n),s.blockedOn=l,!1;n.shift()}return!0}function w0(s,n,l){Zl(s)&&l.delete(n)}function AS(){sd=!1,Qi!==null&&Zl(Qi)&&(Qi=null),Wi!==null&&Zl(Wi)&&(Wi=null),Zi!==null&&Zl(Zi)&&(Zi=null),Sa.forEach(w0),Ea.forEach(w0)}function Jl(s,n){s.blockedOn===n&&(s.blockedOn=null,sd||(sd=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,AS)))}var eo=null;function D0(s){eo!==s&&(eo=s,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){eo===s&&(eo=null);for(var n=0;n<s.length;n+=3){var l=s[n],u=s[n+1],p=s[n+2];if(typeof u!="function"){if(td(u||l)===null)continue;break}var y=jn(l);y!==null&&(s.splice(n,3),n-=3,eu(y,{pending:!0,data:p,method:l.method,action:u},u,p))}}))}function yr(s){function n(U){return Jl(U,s)}Qi!==null&&Jl(Qi,s),Wi!==null&&Jl(Wi,s),Zi!==null&&Jl(Zi,s),Sa.forEach(n),Ea.forEach(n);for(var l=0;l<Ji.length;l++){var u=Ji[l];u.blockedOn===s&&(u.blockedOn=null)}for(;0<Ji.length&&(l=Ji[0],l.blockedOn===null);)R0(l),l.blockedOn===null&&Ji.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var p=l[u],y=l[u+1],T=p[rs]||null;if(typeof y=="function")T||D0(l);else if(T){var w=null;if(y&&y.hasAttribute("formAction")){if(p=y,T=y[rs]||null)w=T.formAction;else if(td(p)!==null)continue}else w=T.action;typeof w=="function"?l[u+1]=w:(l.splice(u,3),u-=3),D0(l)}}}function I0(){function s(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(T){return p=T})},focusReset:"manual",scroll:"manual"})}function n(){p!==null&&(p(),p=null),u||setTimeout(l,20)}function l(){if(!u&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,p=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(l,100),function(){u=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),p!==null&&(p(),p=null)}}}function id(s){this._internalRoot=s}to.prototype.render=id.prototype.render=function(s){var n=this._internalRoot;if(n===null)throw Error(i(409));var l=n.current,u=bs();S0(l,u,s,n,null,null)},to.prototype.unmount=id.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var n=s.containerInfo;S0(s.current,2,null,s,null,null),Ol(),n[On]=null}};function to(s){this._internalRoot=s}to.prototype.unstable_scheduleHydration=function(s){if(s){var n=Bf();s={blockedOn:null,target:s,priority:n};for(var l=0;l<Ji.length&&n!==0&&n<Ji[l].priority;l++);Ji.splice(l,0,s),l===0&&R0(s)}};var C0=e.version;if(C0!=="19.2.4")throw Error(i(527,C0,"19.2.4"));X.findDOMNode=function(s){var n=s._reactInternals;if(n===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=f(n),s=s!==null?m(s):null,s=s===null?null:s.stateNode,s};var LS={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:j,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var so=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!so.isDisabled&&so.supportsFiber)try{ns=so.inject(LS),he=so}catch{}}return La.createRoot=function(s,n){if(!r(s))throw Error(i(299));var l=!1,u="",p=Um,y=Fm,T=Bm;return n!=null&&(n.unstable_strictMode===!0&&(l=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onUncaughtError!==void 0&&(p=n.onUncaughtError),n.onCaughtError!==void 0&&(y=n.onCaughtError),n.onRecoverableError!==void 0&&(T=n.onRecoverableError)),n=v0(s,1,!1,null,null,l,u,null,p,y,T,I0),s[On]=n.current,Uu(s),new id(n)},La.hydrateRoot=function(s,n,l){if(!r(s))throw Error(i(299));var u=!1,p="",y=Um,T=Fm,w=Bm,U=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(y=l.onUncaughtError),l.onCaughtError!==void 0&&(T=l.onCaughtError),l.onRecoverableError!==void 0&&(w=l.onRecoverableError),l.formState!==void 0&&(U=l.formState)),n=v0(s,1,!0,n,l??null,u,p,U,y,T,w,I0),n.context=b0(null),l=n.current,u=bs(),u=Yo(u),p=Ui(u),p.callback=null,Fi(l,p,u),l=u,n.current.lanes=l,Mr(n,l),Ws(n),s[On]=n.current,Uu(s),new to(n)},La.version="19.2.4",La}var $0;function PS(){if($0)return ad.exports;$0=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(e){console.error(e)}}return o(),ad.exports=OS(),ad.exports}var jS=PS();const US=vx(jS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=(...o)=>o.filter((e,t,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FS=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BS=o=>o.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,i)=>i?i.toUpperCase():t.toLowerCase());/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=o=>{const e=BS(o);return e.charAt(0).toUpperCase()+e.slice(1)};/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var $S={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GS=o=>{for(const e in o)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zS=Y.forwardRef(({color:o="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:i,className:r="",children:a,iconNode:c,...d},h)=>Y.createElement("svg",{ref:h,...$S,width:e,height:e,stroke:o,strokeWidth:i?Number(t)*24/Number(e):t,className:bx("lucide",r),...!a&&!GS(d)&&{"aria-hidden":"true"},...d},[...c.map(([f,m])=>Y.createElement(f,m)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=(o,e)=>{const t=Y.forwardRef(({className:i,...r},a)=>Y.createElement(zS,{ref:a,iconNode:e,className:bx(`lucide-${FS(G0(o))}`,`lucide-${o}`,i),...r}));return t.displayName=G0(o),t};/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HS=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ro=xe("activity",HS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VS=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Sx=xe("arrow-left",VS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KS=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Pd=xe("calendar",KS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YS=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],qS=xe("chart-column",YS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XS=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],QS=xe("chevron-down",XS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WS=[["path",{d:"m7 18 6-6-6-6",key:"lwmzdw"}],["path",{d:"M17 6v12",key:"1o0aio"}]],ZS=xe("chevron-last",WS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JS=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ca=xe("chevron-left",JS);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eE=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],jd=xe("chevron-right",eE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Na=xe("circle-alert",tE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],$a=xe("circle-check",sE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iE=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],nE=xe("circle-play",iE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],aE=xe("circle-plus",rE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],oE=xe("circle-question-mark",lE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],uE=xe("circle-x",cE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dE=[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]],of=xe("clapperboard",dE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fE=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],z0=xe("clock",fE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hE=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],mE=xe("columns-2",hE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gE=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],pE=xe("copy",gE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xE=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ga=xe("database",xE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yE=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ud=xe("download",yE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vE=[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]],H0=xe("expand",vE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bE=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],Cn=xe("film",bE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SE=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Ex=xe("folder",SE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EE=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],TE=xe("funnel",EE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AE=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],LE=xe("gauge",AE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _E=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],RE=xe("globe",_E);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wE=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Tx=xe("image",wE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],$o=xe("info",DE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IE=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ax=xe("layers",IE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CE=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],NE=xe("layout-dashboard",CE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kE=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Lx=xe("layout-grid",kE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ME=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],OE=xe("layout-list",ME);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PE=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],jE=xe("link",PE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UE=[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]],FE=xe("list-filter",UE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BE=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],_x=xe("list",BE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $E=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],cf=xe("loader-circle",$E);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GE=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],zE=xe("maximize",GE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HE=[["path",{d:"M5 12h14",key:"1ays0h"}]],VE=xe("minus",HE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KE=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],YE=xe("minimize",KE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qE=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],Rx=xe("panel-left-close",qE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XE=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],uf=xe("panel-left-open",XE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QE=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],WE=xe("pause",QE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZE=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],JE=xe("pen-line",ZE);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],t1=xe("pencil",e1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ii=xe("play",s1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i1=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],wo=xe("plus",i1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Fd=xe("refresh-cw",n1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],a1=xe("save",r1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Bd=xe("search",l1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],_r=xe("server",o1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c1=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Go=xe("settings",c1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],d1=xe("shield-check",u1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f1=[["path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8",key:"17vawe"}],["path",{d:"M9 19.8V15m0 0H4.2M9 15l-6 6",key:"chjx8e"}],["path",{d:"M15 4.2V9m0 0h4.8M15 9l6-6",key:"lav6yq"}],["path",{d:"M9 4.2V9m0 0H4.2M9 9 3 3",key:"1pxi2q"}]],V0=xe("shrink",f1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],K0=xe("skip-back",h1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m1=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Y0=xe("skip-forward",m1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g1=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],p1=xe("sliders-horizontal",g1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x1=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],wx=xe("sparkles",x1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y1=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Dx=xe("square",y1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v1=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Bs=xe("star",v1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ka=xe("tag",b1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],E1=xe("terminal",S1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T1=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],A1=xe("text-align-start",T1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L1=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],df=xe("trash-2",L1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],R1=xe("triangle-alert",_1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w1=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],za=xe("tv",w1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D1=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],I1=xe("upload",D1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C1=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],N1=xe("user-plus",C1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k1=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],q0=xe("user",k1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M1=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],X0=xe("users",M1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O1=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ix=xe("volume-2",O1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P1=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Cx=xe("volume-x",P1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j1=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],U1=xe("wifi-off",j1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F1=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Nx=xe("wifi",F1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B1=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],$1=xe("wrench",B1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G1=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Rs=xe("x",G1);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z1=[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]],H1=xe("youtube",z1),As=({children:o,className:e="",onClick:t})=>g.jsx("div",{onClick:t,className:`bg-fluent-layer border border-fluent-border rounded-window p-5 shadow-sm transition-all duration-200 ${t?"hover:bg-fluent-layerHover cursor-pointer active:scale-[0.99]":""} ${e}`,children:o}),Me=({children:o,variant:e="primary",className:t="",isLoading:i=!1,...r})=>{const a="px-4 h-[32px] rounded-control font-normal text-[13px] transition-all flex items-center justify-center gap-2 select-none focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 focus:ring-offset-white/20",c={primary:"bg-fluent-accent text-black hover:bg-fluent-accentHover active:bg-fluent-accent/90 shadow-[inset_0_1px_0_rgba(255,255,255,0.3)]",secondary:"bg-white/5 text-white border border-white/5 hover:bg-white/10 active:bg-white/5",ghost:"bg-transparent text-white hover:bg-white/5 active:bg-white/10 active:text-white/80",danger:"bg-red-500/20 text-red-200 border border-red-500/30 hover:bg-red-500/30"};return g.jsxs("button",{className:`${a} ${c[e]} ${i?"opacity-70 cursor-wait":""} ${t}`,disabled:i||r.disabled,...r,children:[i&&g.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-3 w-3 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o]})},ti=({label:o,error:e,className:t="",...i})=>g.jsxs("div",{className:"flex flex-col gap-1.5 mb-4",children:[o&&g.jsx("label",{className:"text-[13px] text-fluent-text font-normal",children:o}),g.jsx("div",{className:"relative group",children:g.jsx("input",{className:`w-full bg-white/5 border border-white/10 border-b-white/30
            rounded-control px-3 h-[32px] text-sm text-white placeholder-white/40 
            hover:bg-white/10 hover:border-b-white/50
            focus:outline-none focus:bg-[#1e1e1e] focus:border-b-fluent-accent focus:border-b-2
            transition-all disabled:opacity-50
            ${e?"border-red-500 border-b-red-500":""}
            ${t}`,...i})}),e&&g.jsx("span",{className:"text-xs text-red-300 ml-0.5",children:e})]}),V1=({children:o})=>g.jsxs("div",{className:"h-screen w-full bg-fluent-mica/95 backdrop-blur-[60px] flex flex-col overflow-hidden text-white relative",children:[g.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/[0.03] to-transparent pointer-events-none"}),g.jsx("div",{className:"relative z-10 flex flex-col h-full",children:o})]}),K1=({isOpen:o,type:e,title:t,children:i,onConfirm:r,onCancel:a,confirmLabel:c="Confirm",cancelLabel:d="Cancel"})=>{if(!o)return null;const h={success:g.jsx($a,{size:24,className:"text-green-400"}),error:g.jsx(uE,{size:24,className:"text-red-400"}),warning:g.jsx(R1,{size:24,className:"text-yellow-400"}),confirm:g.jsx(oE,{size:24,className:"text-fluent-accent"}),info:g.jsx($o,{size:24,className:"text-blue-400"})};return g.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-[4px] animate-in fade-in duration-200",children:g.jsx("div",{className:"bg-fluent-layer border border-fluent-border rounded-window shadow-flyout max-w-sm w-full p-6 animate-in zoom-in-95 duration-200 scale-100 ring-1 ring-white/5",children:g.jsxs("div",{className:"flex flex-col gap-4",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[h[e],g.jsx("h3",{className:"text-lg font-semibold text-white",children:t})]}),g.jsx("div",{className:"text-fluent-subtext text-sm leading-relaxed",children:i}),g.jsx("div",{className:"flex justify-end gap-2 mt-4 pt-4 border-t border-white/5",children:e==="confirm"?g.jsxs(g.Fragment,{children:[g.jsx(Me,{variant:"secondary",onClick:a,className:"min-w-[80px]",children:d}),g.jsx(Me,{variant:"primary",onClick:r,className:"min-w-[80px]",children:c})]}):g.jsx(Me,{variant:"primary",onClick:a,className:"min-w-[80px]",children:"Close"})})]})})})},Do=()=>Math.random().toString(36).substr(2,9),Fs=o=>`https://proxygo.princetrueface.workers.dev/?url=${encodeURIComponent(o)}`,Y1=o=>{if(!o||typeof o!="string")return null;try{const e=new URL(o),t=new URLSearchParams(e.search),i=t.get("username"),r=t.get("password");return!i||!r?null:{protocol:e.protocol.replace(":",""),host:e.hostname,port:e.port||(e.protocol==="https:"?"443":"80"),username:i,password:r}}catch{return null}},Q0=o=>o?new Date(Number(o)*1e3).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"Never",q1=o=>{if(!o)return 0;const e=Number(o)*1e3,t=Date.now(),i=e-t;return Math.ceil(i/(1e3*60*60*24))},kx=async o=>{if(!o.host||!o.username||!o.password)return{success:!1,message:"Missing credentials"};const e=o.port||"80",i=`${o.protocol||"http"}://${o.host}:${e}/player_api.php?username=${o.username}&password=${o.password}`,r=Fs(i);try{const a=await fetch(r);if(!a.ok)throw new Error("Network error");const c=await a.json();return c&&c.user_info&&c.user_info.auth===1?{success:!0}:{success:!1,message:"Invalid credentials or expired"}}catch(a){return{success:!1,message:a.message||"Connection failed"}}},Mx=o=>{const e=new Blob([o],{type:"text/javascript"}),t=URL.createObjectURL(e);return new Worker(t)},Ox=({isActive:o,onClick:e,icon:t,label:i,isCollapsed:r})=>g.jsxs("button",{onClick:e,title:r?i:void 0,className:`w-full flex items-center gap-3 px-3 py-2 rounded-control text-[13px] transition-all duration-200 mb-1 group relative
      ${o?"bg-white/10 text-white font-medium":"text-fluent-subtext hover:bg-white/5 hover:text-white"} ${r?"justify-center":""}`,children:[o&&g.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-[16px] bg-fluent-accent rounded-r-full"}),g.jsx(t,{size:18,className:o?"text-fluent-accent":"text-current"}),g.jsx("span",{className:`truncate transition-all duration-200 ${r?"w-0 opacity-0 pointer-events-none absolute":"w-auto opacity-100"}`,children:i})]}),X1=({activeView:o,setView:e,isCollapsed:t,onToggle:i})=>{const r=[{id:"dashboard",label:"Dashboard",icon:NE},{id:"add-account",label:"Add Account",icon:wo},{id:"manage-accounts",label:"Manage Accounts",icon:Ga},{id:"server-library",label:"Server Library",icon:_r},{id:"settings",label:"Settings",icon:Go}];return g.jsxs("div",{className:`bg-fluent-micaAlt/50 border-r border-fluent-border flex flex-col pt-2 pb-2 px-2 backdrop-blur-xl transition-all duration-300 ease-in-out
        ${t?"w-[68px]":"w-[260px]"}`,children:[g.jsxs("div",{className:`flex items-center mb-4 mt-2 px-1 ${t?"justify-center":"justify-between"}`,children:[!t&&g.jsxs("div",{className:"flex items-center gap-2 px-2",children:[g.jsx("div",{className:"w-5 h-5 rounded-sm bg-fluent-accent flex items-center justify-center",children:g.jsx(za,{size:12,className:"text-black"})}),g.jsx("span",{className:"font-bold text-xs tracking-tight text-white uppercase opacity-80",children:"XtreamFlow"})]}),g.jsx("button",{onClick:i,className:"p-2 rounded-control text-fluent-subtext hover:bg-white/5 hover:text-white transition-colors",title:t?"Expand Sidebar":"Collapse Sidebar",children:t?g.jsx(uf,{size:18}):g.jsx(Rx,{size:18})})]}),g.jsx("nav",{className:"flex-1 overflow-y-auto custom-scrollbar",children:r.map(a=>g.jsx(Ox,{isActive:o===a.id,onClick:()=>e(a.id),icon:a.icon,label:a.label,isCollapsed:t},a.id))}),!t&&g.jsx("div",{className:"px-4 py-4 mt-auto animate-in fade-in duration-300",children:g.jsxs("div",{className:"p-3 rounded-lg bg-gradient-to-br from-fluent-accent/10 to-transparent border border-fluent-accent/5",children:[g.jsx("p",{className:"text-[10px] font-bold text-fluent-accent uppercase tracking-widest mb-1",children:"Version"}),g.jsx("p",{className:"text-[11px] text-fluent-subtext",children:"v1.2.0 Preview"})]})})]})},Q1=({activeTab:o,setTab:e,onBack:t,accountName:i,isCollapsed:r,onToggle:a})=>{const c=[{id:"info",label:"Information",icon:$o},{id:"live",label:"Live TV",icon:za},{id:"vod",label:"Movies",icon:Cn},{id:"series",label:"Series",icon:of},{id:"tools",label:"Tools",icon:$1}];return g.jsxs("div",{className:`bg-fluent-micaAlt/50 border-r border-fluent-border flex flex-col pt-2 px-2 backdrop-blur-xl transition-all duration-300 ease-in-out
        ${r?"w-[68px]":"w-[260px]"}`,children:[g.jsxs("div",{className:`mb-2 mt-2 flex flex-col ${r?"items-center":"px-2"}`,children:[g.jsxs("div",{className:`flex items-center w-full mb-4 ${r?"justify-center":"justify-between"}`,children:[!r&&g.jsxs("button",{onClick:t,className:"flex items-center gap-2 text-[11px] font-bold text-fluent-accent uppercase tracking-widest hover:text-white transition-colors",children:[g.jsx(Ca,{size:14})," Back"]}),g.jsx("button",{onClick:a,className:"p-2 rounded-control text-fluent-subtext hover:bg-white/5 hover:text-white transition-colors",title:r?"Expand Sidebar":"Collapse Sidebar",children:r?g.jsx(uf,{size:18}):g.jsx(Rx,{size:18})})]}),!r&&g.jsxs("div",{className:"px-2 mb-4 animate-in slide-in-from-left-2 duration-300",children:[g.jsx("h2",{className:"font-bold text-lg truncate text-white leading-tight",title:i,children:i}),g.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[g.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 shadow-[0_0_8px_rgba(74,222,128,0.5)]"}),g.jsx("span",{className:"text-[10px] font-bold text-green-400/80 uppercase tracking-widest",children:"Active Session"})]})]}),r&&g.jsx("button",{onClick:t,title:"Back to Dashboard",className:"p-2 mb-4 rounded-control text-fluent-accent hover:bg-white/5 hover:text-white transition-colors",children:g.jsx(Ca,{size:18})})]}),g.jsx("div",{className:"h-[1px] bg-white/5 mx-2 mb-4"}),g.jsx("nav",{className:"flex-1 space-y-1",children:c.map(d=>g.jsx(Ox,{isActive:o===d.id,onClick:()=>e(d.id),icon:d.icon,label:d.label,isCollapsed:r},d.id))})]})},W1=({accounts:o,setView:e})=>g.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[g.jsxs("div",{className:"flex items-end justify-between",children:[g.jsxs("div",{children:[g.jsx("h1",{className:"text-3xl font-light mb-1",children:"Welcome back"}),g.jsx("p",{className:"text-win-subtext",children:"Here's an overview of your streaming connections."})]}),g.jsxs(Me,{onClick:()=>e("add-account"),children:[g.jsx(wo,{size:16})," Add Connection"]})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[g.jsxs(As,{className:"bg-gradient-to-br from-win-card to-white/5 border-win-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h3",{className:"text-sm font-medium text-win-subtext",children:"Total Accounts"}),g.jsx(Ga,{size:16,className:"text-win-primary"})]}),g.jsx("p",{className:"text-4xl font-semibold",children:o.length})]}),g.jsxs(As,{className:"bg-gradient-to-br from-win-card to-white/5 border-win-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h3",{className:"text-sm font-medium text-win-subtext",children:"Favorites"}),g.jsx(Bs,{size:16,className:"text-yellow-400"})]}),g.jsx("p",{className:"text-4xl font-semibold",children:o.filter(t=>t.isFavorite).length})]}),g.jsxs(As,{className:"bg-gradient-to-br from-win-card to-white/5 border-win-border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h3",{className:"text-sm font-medium text-win-subtext",children:"Server Status"}),g.jsx(E1,{size:16,className:"text-green-400"})]}),g.jsx("p",{className:"text-4xl font-semibold",children:o.length>0?"Online":"Idle"})]})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-medium mb-4",children:"Quick Actions"}),g.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[g.jsxs("button",{onClick:()=>e("add-account"),className:"h-24 rounded-lg bg-win-card border border-win-border hover:bg-win-cardHover transition-all flex flex-col items-center justify-center gap-2 text-win-subtext hover:text-white",children:[g.jsx(wo,{size:24}),g.jsx("span",{className:"text-sm",children:"New Account"})]}),g.jsxs("button",{onClick:()=>e("manage-accounts"),className:"h-24 rounded-lg bg-win-card border border-win-border hover:bg-win-cardHover transition-all flex flex-col items-center justify-center gap-2 text-win-subtext hover:text-white",children:[g.jsx(Go,{size:24}),g.jsx("span",{className:"text-sm",children:"Manage"})]})]})]})]}),W0=({onSave:o,initialData:e,onCancel:t,onDelete:i,savedServers:r=[],prefillServer:a=null})=>{const[c,d]=Y.useState("url"),[h,f]=Y.useState(""),[m,x]=Y.useState(""),[v,b]=Y.useState(""),[S,A]=Y.useState(""),[E,_]=Y.useState("80"),[R,D]=Y.useState("http"),[k,O]=Y.useState(""),[F,N]=Y.useState(!1),[B,C]=Y.useState("untested"),[P,W]=Y.useState([]),[ue,me]=Y.useState(""),[ee,ce]=Y.useState(null),[j,X]=Y.useState(!1),[se,de]=Y.useState(null);Y.useEffect(()=>{e?(d("manual"),x(e.host),b(e.username),A(e.password),_(e.port),D(e.protocol),O(e.name),N(e.isFavorite||!1),W(e.tags||[]),C(e.status)):a&&(d("manual"),x(a.host),_(a.port),D(a.protocol),W(a.tags||[]),b(""),A(""),O(""),C("untested"))},[e,a]);const te=()=>{if(ce(null),!h.trim()){ce("Please paste a valid Xtream URL.");return}const V=Y1(h);V&&V.host&&V.username&&V.password?(x(V.host),b(V.username),A(V.password),_(V.port||"80"),D(V.protocol||"http"),d("manual")):ce("Could not extract credentials automatically. Try entering details manually.")},I=V=>{const ge=r.find(Re=>Re.id===V);ge&&(x(ge.host),_(ge.port),D(ge.protocol))},M=()=>{const V=ue.trim();V&&!P.includes(V)&&(W([...P,V]),me(""))},G=V=>{W(P.filter(ge=>ge!==V))},Z=async()=>{if(!m||!v||!S){ce("Please enter Host, Username and Password before testing.");return}ce(null),X(!0),de(null);const ge=await kx({host:m,port:E,username:v,password:S,protocol:R});X(!1),ge.success?(C("active"),de({success:!0,message:"Connection successful! Account is active."})):(C("error"),de({success:!1,message:ge.message||"Connection failed."}))},re=()=>{if(!m||!v||!S){ce("Host, Username, and Password are required.");return}const V={id:e?e.id:Do(),name:k||`${m} (${v})`,host:m,port:E,username:v,password:S,protocol:R,status:B,addedAt:e?e.addedAt:Date.now(),isFavorite:F,tags:P};o(V),e||(f(""),x(""),b(""),A(""),O(""),N(!1),W([]),C("untested"),de(null))};return g.jsxs("div",{className:"max-w-2xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-500 pb-10",children:[g.jsxs("div",{className:"mb-8",children:[g.jsx("h2",{className:"text-2xl font-semibold mb-2",children:e?"Edit Account":"Connect New Account"}),g.jsx("p",{className:"text-win-subtext",children:e?"Update your subscription details below.":"Add your IPTV subscription via Xtream Codes API."})]}),!e&&g.jsxs("div",{className:"flex gap-2 mb-6 bg-black/20 p-1 rounded-lg w-fit",children:[g.jsx("button",{onClick:()=>d("url"),className:`px-4 py-1.5 rounded-md text-sm transition-all ${c==="url"?"bg-win-card shadow-sm text-white":"text-win-subtext hover:text-white"}`,children:"From URL"}),g.jsx("button",{onClick:()=>d("manual"),className:`px-4 py-1.5 rounded-md text-sm transition-all ${c==="manual"?"bg-win-card shadow-sm text-white":"text-win-subtext hover:text-white"}`,children:"Manual Entry"})]}),g.jsxs(As,{children:[c==="url"?g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 p-4 rounded-lg flex gap-3 text-blue-200 mb-4",children:[g.jsx(jE,{size:20,className:"shrink-0 mt-0.5"}),g.jsxs("div",{className:"text-sm",children:[g.jsx("p",{className:"font-semibold mb-1",children:"Paste your M3U or Xtream API link"}),g.jsx("p",{className:"opacity-80",children:"We'll try to extract the host, username, and password automatically."})]})]}),g.jsx(ti,{label:"Xtream / M3U URL",placeholder:"http://domain.com:8080/get.php?username=user&password=pass",value:h,onChange:V=>f(V.target.value)}),g.jsx("div",{className:"flex justify-end mt-4",children:g.jsx(Me,{onClick:te,children:"Analyze Link"})})]}):g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex justify-between items-start mb-2",children:[g.jsx("div",{className:"text-sm text-win-subtext",children:"Account Details"}),g.jsxs("button",{onClick:()=>N(!F),className:`flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium transition-all
                     ${F?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30":"bg-white/5 text-win-subtext border border-white/10 hover:bg-white/10"}`,children:[g.jsx(Bs,{size:12,fill:F?"currentColor":"none"}),F?"Favorited":"Add to Favorites"]})]}),r.length>0&&!e&&!a&&g.jsxs("div",{className:"col-span-2 mb-4",children:[g.jsxs("label",{className:"text-xs text-fluent-accent font-medium mb-1.5 block flex items-center gap-1",children:[g.jsx(_r,{size:12})," Quick Load from Library"]}),g.jsxs("div",{className:"relative",children:[g.jsxs("select",{className:"w-full bg-fluent-accent/5 border border-fluent-accent/20 rounded-control h-[36px] px-3 text-sm text-white appearance-none focus:border-fluent-accent outline-none",onChange:V=>I(V.target.value),defaultValue:"",children:[g.jsx("option",{value:"",disabled:!0,children:"Select a saved server to auto-fill..."}),r.map(V=>g.jsxs("option",{value:V.id,children:[V.alias," (",V.host,")"]},V.id))]}),g.jsx(QS,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-fluent-subtext pointer-events-none"})]})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[g.jsx(ti,{label:"Friendly Name (Optional)",placeholder:"e.g., Living Room TV",value:k,onChange:V=>O(V.target.value),className:"col-span-2"}),g.jsxs("div",{className:"col-span-2",children:[g.jsx("label",{className:"text-sm text-win-subtext ml-0.5 mb-2 block",children:"Tags"}),g.jsxs("div",{className:"flex gap-2 mb-3",children:[g.jsxs("div",{className:"relative group flex-1",children:[g.jsx("input",{className:"w-full bg-black/20 border border-win-border group-hover:border-white/20 rounded-[6px] px-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none focus:border-win-primary focus:bg-black/30 transition-all",value:ue,onChange:V=>me(V.target.value),onKeyDown:V=>V.key==="Enter"&&M(),placeholder:"Type a tag (e.g. Cinema, Fast) and press Enter..."}),g.jsx("div",{className:"absolute bottom-0 left-0 h-[1px] w-full bg-transparent group-focus-within:bg-win-primary transition-colors rounded-b-[6px]"})]}),g.jsx(Me,{variant:"secondary",onClick:M,disabled:!ue.trim(),children:"Add"})]}),P.length>0&&g.jsx("div",{className:"flex flex-wrap gap-2 p-3 bg-black/20 rounded-lg border border-win-border",children:P.map(V=>g.jsxs("span",{className:"bg-win-primary/10 text-win-primary border border-win-primary/20 px-2.5 py-1 rounded-[6px] text-xs flex items-center gap-1.5 select-none animate-in zoom-in duration-200",children:[g.jsx(ka,{size:10}),V,g.jsx("button",{onClick:()=>G(V),className:"hover:text-white transition-colors ml-1 p-0.5 hover:bg-white/10 rounded",children:g.jsx(Rs,{size:12})})]},V))})]}),g.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[g.jsx("label",{className:"text-sm text-win-subtext ml-0.5 mb-2 block",children:"Protocol"}),g.jsx("div",{className:"flex bg-black/20 rounded-[6px] p-1 border border-win-border",children:["http","https"].map(V=>g.jsx("button",{onClick:()=>D(V),className:`flex-1 py-1 rounded-[4px] text-sm uppercase ${R===V?"bg-white/10 text-white":"text-win-subtext"}`,children:V},V))})]}),g.jsx(ti,{label:"Host / Server URL",placeholder:"domain.com",value:m,onChange:V=>x(V.target.value),className:"col-span-2 sm:col-span-1"}),g.jsx(ti,{label:"Port",placeholder:"8080",value:E,onChange:V=>_(V.target.value)}),g.jsx(ti,{label:"Username",value:v,onChange:V=>b(V.target.value)}),g.jsx(ti,{label:"Password",type:"password",value:S,onChange:V=>A(V.target.value)})]}),se&&g.jsxs("div",{className:`mt-2 p-3 rounded-lg border text-sm flex items-start gap-2 animate-in fade-in
                    ${se.success?"bg-green-500/10 border-green-500/20 text-green-200":"bg-red-500/10 border-red-500/20 text-red-200"}`,children:[se.success?g.jsx($a,{size:18,className:"shrink-0"}):g.jsx(Na,{size:18,className:"shrink-0"}),g.jsx("span",{children:se.message})]}),g.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-win-border",children:[g.jsx("div",{children:e&&i&&g.jsxs(Me,{variant:"ghost",className:"text-red-400 hover:bg-red-500/10 hover:text-red-300 px-2",onClick:()=>i(e.id),children:[g.jsx(df,{size:16})," Delete"]})}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx(Me,{variant:"ghost",onClick:e?t:()=>d("url"),children:e?"Cancel":"Back"}),g.jsxs(Me,{variant:"secondary",onClick:Z,disabled:j,children:[j?g.jsx(cf,{size:16,className:"animate-spin"}):g.jsx(Ro,{size:16}),"Test Connection"]}),g.jsx(Me,{onClick:re,children:e?"Update Account":"Save Account"})]})]})]}),ee&&g.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/20 rounded-md flex items-center gap-2 text-red-200 text-sm animate-in fade-in",children:[g.jsx(Na,{size:16})," ",ee]})]})]})},Z1=({isOpen:o,onClose:e,onApply:t,currentCriteria:i,availableTags:r})=>{const[a,c]=Y.useState(i);if(Y.useEffect(()=>{o&&c(i)},[o,i]),!o)return null;const d=m=>{c(x=>{const v=x.tags.includes(m);return{...x,tags:v?x.tags.filter(b=>b!==m):[...x.tags,m]}})},h=()=>{t(a),e()},f=()=>{c({query:"",onlyFavorites:!1,tags:[]})};return g.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:g.jsxs("div",{className:"bg-[#202020] border border-win-border rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in zoom-in-95 duration-200",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-win-border flex justify-between items-center bg-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(p1,{size:18,className:"text-win-primary"}),g.jsx("h3",{className:"font-semibold text-white",children:"Advanced Search"})]}),g.jsx("button",{onClick:e,className:"text-white/50 hover:text-white transition-colors",children:g.jsx(Rs,{size:18})})]}),g.jsxs("div",{className:"p-6 space-y-6",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs text-win-subtext uppercase tracking-wider font-semibold",children:"Keywords"}),g.jsx(ti,{placeholder:"Search Name, Host, or Username...",value:a.query,onChange:m=>c(x=>({...x,query:m.target.value})),autoFocus:!0})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs text-win-subtext uppercase tracking-wider font-semibold",children:"Status"}),g.jsxs("div",{onClick:()=>c(m=>({...m,onlyFavorites:!m.onlyFavorites})),className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all ${a.onlyFavorites?"bg-yellow-500/10 border-yellow-500/30":"bg-black/20 border-white/10 hover:border-white/20"}`,children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:`p-1.5 rounded-full ${a.onlyFavorites?"bg-yellow-500 text-black":"bg-white/10 text-white/50"}`,children:g.jsx(Bs,{size:16,fill:a.onlyFavorites?"currentColor":"none"})}),g.jsx("span",{className:a.onlyFavorites?"text-yellow-100":"text-white",children:"Favorites Only"})]}),g.jsx("div",{className:`w-10 h-5 rounded-full relative transition-colors ${a.onlyFavorites?"bg-win-primary":"bg-white/20"}`,children:g.jsx("div",{className:`absolute top-1 w-3 h-3 bg-white rounded-full transition-all ${a.onlyFavorites?"left-6":"left-1"}`})})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs text-win-subtext uppercase tracking-wider font-semibold",children:"Filter by Tags"}),r.length===0?g.jsx("div",{className:"text-sm text-win-subtext italic p-2",children:"No tags available in your accounts."}):g.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto pr-2 custom-scrollbar",children:r.map(m=>{const x=a.tags.includes(m);return g.jsxs("button",{onClick:()=>d(m),className:`px-3 py-1.5 rounded-md text-xs border transition-all flex items-center gap-1.5
                        ${x?"bg-win-primary/20 border-win-primary text-win-primary":"bg-white/5 border-white/10 text-win-subtext hover:bg-white/10"}`,children:[g.jsx(ka,{size:12,className:x?"fill-current":""}),m]},m)})})]})]}),g.jsxs("div",{className:"px-6 py-4 bg-black/20 border-t border-win-border flex justify-between items-center",children:[g.jsx(Me,{variant:"ghost",onClick:f,className:"text-win-subtext hover:text-white",children:"Clear Filters"}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx(Me,{variant:"secondary",onClick:e,children:"Cancel"}),g.jsx(Me,{variant:"primary",onClick:h,children:"Show Results"})]})]})]})})},J1=({accounts:o,onDelete:e,onEdit:t,onToggleFavorite:i,showToast:r,onSelect:a,onUpdate:c,initialQuery:d=""})=>{const[h,f]=Y.useState(null),[m,x]=Y.useState(null),[v,b]=Y.useState({query:d,onlyFavorites:!1,tags:[]}),[S,A]=Y.useState(!1),[E,_]=Y.useState(()=>localStorage.getItem("account_view_mode")||"list"),R=C=>{_(C),localStorage.setItem("account_view_mode",C)};Y.useEffect(()=>{d&&b(C=>({...C,query:d}))},[d]);const D=Array.from(new Set(o.flatMap(C=>C.tags||[]))).sort(),k=(C,P)=>{navigator.clipboard.writeText(C),f(P),r("URL copied to clipboard"),setTimeout(()=>f(null),2e3)},O=async C=>{x(C.id);const P=await kx(C),W={...C,status:P.success?"active":"error"};c(W),x(null),P.success?r(`Success: ${C.name} is online.`):r(`Failed: ${C.name} is unreachable.`)},N=[...o.filter(C=>{const P=v.query.toLowerCase(),W=!P||C.name.toLowerCase().includes(P)||C.host.toLowerCase().includes(P)||C.username.toLowerCase().includes(P),ue=v.onlyFavorites?C.isFavorite:!0,me=v.tags.length===0||v.tags.every(ee=>{var ce;return(ce=C.tags)==null?void 0:ce.includes(ee)});return W&&ue&&me})].sort((C,P)=>C.isFavorite!==P.isFavorite?C.isFavorite?-1:1:C.name.localeCompare(P.name)),B=(v.onlyFavorites?1:0)+v.tags.length;return g.jsxs("div",{className:"space-y-4 max-w-6xl mx-auto animate-in fade-in h-full flex flex-col",children:[g.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-2",children:[g.jsx("h2",{className:"text-2xl font-semibold",children:"Manage Accounts"}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsxs("div",{className:"flex bg-black/20 p-1 rounded-lg border border-win-border",children:[g.jsx("button",{onClick:()=>R("list"),className:`p-1.5 rounded-md transition-all ${E==="list"?"bg-white/10 text-white shadow-sm":"text-win-subtext hover:text-white"}`,title:"List View",children:g.jsx(OE,{size:16})}),g.jsx("button",{onClick:()=>R("grid"),className:`p-1.5 rounded-md transition-all ${E==="grid"?"bg-white/10 text-white shadow-sm":"text-win-subtext hover:text-white"}`,title:"Grid View",children:g.jsx(Lx,{size:16})})]}),g.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1 hidden md:block"}),g.jsxs("div",{className:"flex gap-2 flex-1 md:flex-none",children:[g.jsxs("div",{className:"relative group w-full md:w-64",children:[g.jsx("input",{className:"w-full bg-black/20 border border-win-border rounded-[6px] pl-9 pr-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none focus:border-win-primary focus:bg-black/30 transition-all",placeholder:"Search accounts...",value:v.query,onChange:C=>b(P=>({...P,query:C.target.value}))}),g.jsx(Bd,{size:16,className:"absolute left-3 top-2.5 text-win-subtext group-focus-within:text-win-primary transition-colors"}),v.query&&g.jsx("button",{onClick:()=>b(C=>({...C,query:""})),className:"absolute right-2 top-2 text-win-subtext hover:text-white",children:g.jsx(Rs,{size:14})})]}),g.jsxs(Me,{variant:"secondary",onClick:()=>A(!0),className:B>0?"border-win-primary text-win-primary bg-win-primary/10":"",children:[g.jsx(TE,{size:16}),B>0&&g.jsx("span",{className:"bg-win-primary text-black text-[10px] font-bold px-1.5 rounded-full",children:B})]})]})]})]}),B>0&&g.jsxs("div",{className:"flex flex-wrap gap-2 mb-2 animate-in slide-in-from-top-2",children:[v.onlyFavorites&&g.jsxs("span",{className:"bg-yellow-500/20 text-yellow-200 border border-yellow-500/30 px-2 py-1 rounded-md text-xs flex items-center gap-1",children:[g.jsx(Bs,{size:10,fill:"currentColor"})," Favorites Only",g.jsx("button",{onClick:()=>b(C=>({...C,onlyFavorites:!1})),className:"ml-1 hover:text-white",children:g.jsx(Rs,{size:12})})]}),v.tags.map(C=>g.jsxs("span",{className:"bg-win-primary/10 text-win-primary border border-win-primary/20 px-2 py-1 rounded-md text-xs flex items-center gap-1",children:[g.jsx(ka,{size:10})," ",C,g.jsx("button",{onClick:()=>b(P=>({...P,tags:P.tags.filter(W=>W!==C)})),className:"ml-1 hover:text-white",children:g.jsx(Rs,{size:12})})]},C)),g.jsx("button",{onClick:()=>b({query:"",onlyFavorites:!1,tags:[]}),className:"text-xs text-win-subtext hover:text-white underline ml-2",children:"Clear all"})]}),g.jsx("div",{className:"flex-1 overflow-y-auto pb-4 custom-scrollbar",children:N.length===0?g.jsx("div",{className:"flex flex-col items-center justify-center h-48 text-win-subtext opacity-60 border border-dashed border-white/10 rounded-xl shrink-0",children:o.length===0?g.jsxs(g.Fragment,{children:[g.jsx(Ga,{size:48,strokeWidth:1,className:"mb-4"}),g.jsx("p",{children:"No accounts connected yet."})]}):g.jsxs(g.Fragment,{children:[g.jsx(Bd,{size:48,strokeWidth:1,className:"mb-4"}),g.jsx("p",{children:"No matches found."})]})}):g.jsx("div",{className:E==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4":"flex flex-col gap-3",children:N.map(C=>g.jsxs("div",{className:`group bg-win-card hover:bg-win-cardHover border border-win-border rounded-lg transition-all relative shrink-0
                        ${E==="grid"?"p-5 flex flex-col h-full hover:shadow-lg hover:-translate-y-1":"p-4 flex items-center justify-between"}`,children:[g.jsxs("div",{className:`flex ${E==="grid"?"flex-col items-start gap-4 mb-4":"items-center gap-4"}`,children:[g.jsxs("div",{className:"relative shrink-0",children:[g.jsxs("div",{className:`rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold shadow-inner
                            ${E==="grid"?"w-14 h-14 text-xl":"w-10 h-10 text-sm"}`,children:[C.name.substring(0,2).toUpperCase(),C.isFavorite&&g.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-400 text-black p-0.5 rounded-full border border-black shadow-sm",children:g.jsx(Bs,{size:10,fill:"currentColor"})})]}),g.jsxs("div",{className:`absolute -bottom-1 -right-1 rounded-full border-2 border-[#202020] flex items-center justify-center shadow-sm
                            ${E==="grid"?"w-5 h-5":"w-4 h-4"}
                            ${C.status==="active"?"bg-green-500":C.status==="error"?"bg-red-500":"bg-gray-500"}`,title:C.status==="active"?"Active":C.status==="error"?"Error":"Untested",children:[C.status==="active"&&g.jsx(Nx,{size:E==="grid"?10:8,className:"text-black"}),C.status==="error"&&g.jsx(U1,{size:E==="grid"?10:8,className:"text-white"})]})]}),g.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[g.jsx("h3",{className:`font-medium text-white truncate ${E==="grid"?"text-lg":"text-base"}`,children:C.name}),g.jsxs("div",{className:"flex items-center gap-2 text-xs text-win-subtext truncate",children:[g.jsx("span",{className:"bg-white/10 px-1.5 py-0.5 rounded text-[10px] uppercase tracking-wider",children:C.protocol}),g.jsxs("span",{className:"truncate",children:[C.host,":",C.port]})]}),C.tags&&C.tags.length>0&&g.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-1",children:[C.tags.slice(0,E==="grid"?5:3).map(P=>g.jsxs("span",{className:"bg-white/5 text-win-subtext px-2 py-0.5 rounded-md text-[10px] border border-white/5 flex items-center gap-1",children:[g.jsx(ka,{size:8,className:"opacity-70"})," ",P]},P)),C.tags.length>(E==="grid"?5:3)&&g.jsxs("span",{className:"text-[10px] text-win-subtext px-1",children:["+",C.tags.length-(E==="grid"?5:3)]})]})]})]}),g.jsxs("div",{className:`flex items-center gap-2 transition-opacity
                      ${E==="grid"?"mt-auto pt-4 border-t border-white/5 w-full justify-between":"opacity-0 group-hover:opacity-100"}`,children:[g.jsxs(Me,{onClick:()=>a(C),className:`!px-3 !py-1.5 text-xs bg-green-500/20 text-green-400 border border-green-500/30 hover:bg-green-500/30 font-semibold shadow-sm
                          ${E==="grid"?"flex-1 h-9":""}`,children:[g.jsx(nE,{size:14})," Open"]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Me,{variant:"secondary",className:"!px-2 !py-1.5 text-xs",onClick:()=>O(C),disabled:m===C.id,title:"Test Connection",children:m===C.id?g.jsx(cf,{size:14,className:"animate-spin"}):g.jsx(Ro,{size:14})}),g.jsx(Me,{variant:"secondary",className:`!px-2 !py-1.5 text-xs ${C.isFavorite?"text-yellow-400 hover:text-yellow-300":"text-win-subtext hover:text-yellow-200"}`,onClick:()=>i(C.id),title:C.isFavorite?"Remove from Favorites":"Add to Favorites",children:g.jsx(Bs,{size:14,fill:C.isFavorite?"currentColor":"none"})}),g.jsx(Me,{variant:"secondary",className:"!px-2 !py-1.5 text-xs",onClick:()=>t(C),children:g.jsx(t1,{size:14})}),g.jsx(Me,{variant:"secondary",className:"!px-2 !py-1.5 text-xs",onClick:()=>k(`${C.protocol}://${C.host}:${C.port}/get.php?username=${C.username}&password=${C.password}`,C.id),children:h===C.id?g.jsx($a,{size:14}):g.jsx(pE,{size:14})}),g.jsx(Me,{variant:"ghost",className:"!px-2 text-red-400 hover:bg-red-500/10 hover:text-red-300",onClick:()=>e(C.id),children:g.jsx(df,{size:16})})]})]})]},C.id))})}),g.jsx(Z1,{isOpen:S,onClose:()=>A(!1),onApply:b,currentCriteria:v,availableTags:D})]})},eT=`
self.onmessage = async (e) => {
  const { file } = e.data;

  try {
    const text = await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject(reader.error);
      reader.readAsText(file);
    });

    const json = JSON.parse(text);

    if (Array.isArray(json) || (typeof json === 'object' && json !== null)) {
       self.postMessage({ type: 'SUCCESS', data: json });
    } else {
       throw new Error("Format invalid: Expected a JSON array or backup object.");
    }

  } catch (err) {
    self.postMessage({ type: 'ERROR', error: err.message || "Failed to parse file" });
  }
};
`,tT=({accounts:o,onImport:e,onExport:t})=>{const i=Y.useRef(null),[r,a]=Y.useState(!1),c=Y.useRef(null);Y.useEffect(()=>{try{c.current=Mx(eT),c.current.onmessage=f=>{const{type:m,data:x,error:v}=f.data;m==="SUCCESS"?(e(x),a(!1),i.current&&(i.current.value="")):m==="ERROR"&&(console.error("Worker Import Error:",v),alert(`Import Failed: ${v}`),a(!1),i.current&&(i.current.value=""))}}catch(f){console.error("Failed to initialize worker",f)}return()=>{var f;(f=c.current)==null||f.terminate()}},[e]);const d=()=>{var f;r||(f=i.current)==null||f.click()},h=f=>{const m=f.target.files&&f.target.files[0];if(m)if(a(!0),c.current)c.current.postMessage({file:m});else{const x=new FileReader;x.onload=v=>{var b;try{const S=JSON.parse((b=v.target)==null?void 0:b.result);e(S)}catch{alert("Invalid JSON")}finally{a(!1)}},x.readAsText(m)}};return g.jsxs("div",{className:"max-w-4xl mx-auto animate-in fade-in",children:[g.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Settings"}),g.jsxs("div",{className:"space-y-6",children:[g.jsx(As,{children:g.jsxs("div",{className:"flex items-start gap-4",children:[g.jsx("div",{className:"p-3 bg-blue-500/10 rounded-lg text-blue-400",children:g.jsx(Ga,{size:24})}),g.jsxs("div",{className:"flex-1",children:[g.jsx("h3",{className:"text-lg font-medium mb-1",children:"Data Management"}),g.jsx("p",{className:"text-fluent-subtext text-sm mb-4",children:"Backup your connected accounts and server library to a JSON file, or restore them."}),g.jsxs("div",{className:"flex gap-3",children:[g.jsxs(Me,{onClick:t,variant:"secondary",disabled:r,children:[g.jsx(Ud,{size:16})," Export Full Backup"]}),g.jsxs(Me,{onClick:d,variant:"secondary",disabled:r,children:[r?g.jsx(cf,{size:16,className:"animate-spin"}):g.jsx(I1,{size:16}),r?"Processing...":"Import Backup"]}),g.jsx("input",{type:"file",ref:i,onChange:h,accept:".json",className:"hidden"})]})]})]})}),g.jsx(As,{children:g.jsxs("div",{className:"flex items-start gap-4",children:[g.jsx("div",{className:"p-3 bg-purple-500/10 rounded-lg text-purple-400",children:g.jsx(Go,{size:24})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-medium mb-1",children:"Application"}),g.jsx("p",{className:"text-fluent-subtext text-sm",children:"Version 1.0.0 Alpha (Sync Core)"})]})]})})]})]})},ye=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},sT=Number.isSafeInteger||function(o){return typeof o=="number"&&Math.abs(o)<=iT},iT=Number.MAX_SAFE_INTEGER||9007199254740991;let _e=(function(o){return o.NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",o})({}),K=(function(o){return o.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",o.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",o.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",o.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",o.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_PARSING_ERROR="levelParsingError",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.FRAG_GAP="fragGap",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.ASSET_LIST_LOAD_ERROR="assetListLoadError",o.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",o.ASSET_LIST_PARSING_ERROR="assetListParsingError",o.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.ATTACH_MEDIA_ERROR="attachMediaError",o.UNKNOWN="unknown",o})({}),L=(function(o){return o.MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.MEDIA_ENDED="hlsMediaEnded",o.STALL_RESOLVED="hlsStallResolved",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFERED_TO_END="hlsBufferedToEnd",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached",o.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",o.ASSET_LIST_LOADING="hlsAssetListLoading",o.ASSET_LIST_LOADED="hlsAssetListLoaded",o.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",o.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",o.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",o.INTERSTITIAL_STARTED="hlsInterstitialStarted",o.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",o.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",o.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",o.INTERSTITIAL_ENDED="hlsInterstitialEnded",o.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",o.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",o.EVENT_CUE_ENTER="hlsEventCueEnter",o})({});var $e={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ve={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class vr{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class nT{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new vr(e),this.fast_=new vr(t),this.defaultTTFB_=r,this.ttfb_=new vr(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:a}=this;i.halfLife!==e&&(this.slow_=new vr(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new vr(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new vr(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,a=i/r;this.fast_.sample(r,a),this.slow_.sample(r,a)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function rT(o,e,t){return(e=lT(e))in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}function ot(){return ot=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},ot.apply(null,arguments)}function Z0(o,e){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),t.push.apply(t,i)}return t}function tt(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Z0(Object(t),!0).forEach(function(i){rT(o,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):Z0(Object(t)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(t,i))})}return o}function aT(o,e){if(typeof o!="object"||!o)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var i=t.call(o,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(o)}function lT(o){var e=aT(o,"string");return typeof e=="symbol"?e:e+""}class Gs{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=nn,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const nn=function(){},oT={trace:nn,debug:nn,log:nn,warn:nn,info:nn,error:nn};function $d(){return ot({},oT)}function cT(o,e){const t=self.console[o];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${o}] >`):nn}function J0(o,e,t){return e[o]?e[o].bind(e):cT(o,t)}const Gd=$d();function uT(o,e,t){const i=$d();if(typeof console=="object"&&o===!0||typeof o=="object"){const r=["debug","log","info","warn","error"];r.forEach(a=>{i[a]=J0(a,o,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return $d()}r.forEach(a=>{Gd[a]=J0(a,o)})}else ot(Gd,i);return i}const st=Gd;function ln(o=!0){return typeof self>"u"?void 0:(o||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function dT(o){return typeof self<"u"&&o===self.ManagedMediaSource}function Px(o,e){const t=Object.keys(o),i=Object.keys(e),r=t.length,a=i.length;return!r||!a||r===a&&!t.some(c=>i.indexOf(c)===-1)}function ws(o,e=!1){if(typeof TextDecoder<"u"){const f=new TextDecoder("utf-8").decode(o);if(e){const m=f.indexOf("\0");return m!==-1?f.substring(0,m):f}return f.replace(/\0/g,"")}const t=o.length;let i,r,a,c="",d=0;for(;d<t;){if(i=o[d++],i===0&&e)return c;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(i);break;case 12:case 13:r=o[d++],c+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=o[d++],a=o[d++],c+=String.fromCharCode((i&15)<<12|(r&63)<<6|(a&63)<<0);break}}return c}function Qt(o){let e="";for(let t=0;t<o.length;t++){let i=o[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function jx(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function fT(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ud={exports:{}},ep;function hT(){return ep||(ep=1,(function(o,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,c=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,d={buildAbsoluteURL:function(h,f,m){if(m=m||{},h=h.trim(),f=f.trim(),!f){if(!m.alwaysNormalize)return h;var x=d.parseURL(h);if(!x)throw new Error("Error trying to parse base URL.");return x.path=d.normalizePath(x.path),d.buildURLFromParts(x)}var v=d.parseURL(f);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return m.alwaysNormalize?(v.path=d.normalizePath(v.path),d.buildURLFromParts(v)):f;var b=d.parseURL(h);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var S=r.exec(b.path);b.netLoc=S[1],b.path=S[2]}b.netLoc&&!b.path&&(b.path="/");var A={scheme:b.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(A.netLoc=b.netLoc,v.path[0]!=="/"))if(!v.path)A.path=b.path,v.params||(A.params=b.params,v.query||(A.query=b.query));else{var E=b.path,_=E.substring(0,E.lastIndexOf("/")+1)+v.path;A.path=d.normalizePath(_)}return A.path===null&&(A.path=m.alwaysNormalize?d.normalizePath(v.path):v.path),d.buildURLFromParts(A)},parseURL:function(h){var f=i.exec(h);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(a,"");h.length!==(h=h.replace(c,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};o.exports=d})()})(ud)),ud.exports}var ff=hT();class hf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ut={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Ux{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,gT(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ut.AUDIO]:null,[ut.VIDEO]:null,[ut.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new hf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ff.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ut.AUDIO]=null,e[ut.VIDEO]=null,e[ut.AUDIOVIDEO]=null}}function wt(o){return o.sn!=="initSegment"}class dd extends Ux{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ye(e)&&ye(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const r=this._decryptdata=t[i[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ye(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ye(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return wt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const r=t[e];r&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,a,c=!1){const{elementaryStreams:d}=this,h=d[e];if(!h){d[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:a,partial:c};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,i),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,a)}}class mT extends Ux{constructor(e,t,i,r,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const c=e.enumeratedString("BYTERANGE");c&&this.setByteRange(c,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Fx(o,e){const t=Object.getPrototypeOf(o);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||Fx(t,e)}}function gT(o,e){const t=Fx(o,e);t&&(t.enumerable=!0,Object.defineProperty(o,e,t))}const tp=Math.pow(2,32)-1,pT=[].push,Bx={video:1,audio:2,id3:3,text:4};function jt(o){return String.fromCharCode.apply(null,o)}function $x(o,e){const t=o[e]<<8|o[e+1];return t<0?65536+t:t}function Ne(o,e){const t=Gx(o,e);return t<0?4294967296+t:t}function sp(o,e){let t=Ne(o,e);return t*=Math.pow(2,32),t+=Ne(o,e+4),t}function Gx(o,e){return o[e]<<24|o[e+1]<<16|o[e+2]<<8|o[e+3]}function xT(o){const e=o.byteLength;for(let t=0;t<e;){const i=Ne(o,t);if(i>8&&o[t+4]===109&&o[t+5]===111&&o[t+6]===111&&o[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Be(o,e){const t=[];if(!e.length)return t;const i=o.byteLength;for(let r=0;r<i;){const a=Ne(o,r),c=jt(o.subarray(r+4,r+8)),d=a>1?r+a:i;if(c===e[0])if(e.length===1)t.push(o.subarray(r+8,d));else{const h=Be(o.subarray(r+8,d),e.slice(1));h.length&&pT.apply(t,h)}r=d}return t}function yT(o){const e=[],t=o[0];let i=8;const r=Ne(o,i);i+=4;let a=0,c=0;t===0?(a=Ne(o,i),c=Ne(o,i+4),i+=8):(a=sp(o,i),c=sp(o,i+8),i+=16),i+=2;let d=o.length+c;const h=$x(o,i);i+=2;for(let f=0;f<h;f++){let m=i;const x=Ne(o,m);m+=4;const v=x&2147483647;if((x&2147483648)>>>31===1)return st.warn("SIDX has hierarchical references (not supported)"),null;const S=Ne(o,m);m+=4,e.push({referenceSize:v,subsegmentDuration:S,info:{duration:S/r,start:d,end:d+v-1}}),d+=v,m+=4,i=m}return{earliestPresentationTime:a,timescale:r,version:t,referencesCount:h,references:e}}function zx(o){const e=[],t=Be(o,["moov","trak"]);for(let r=0;r<t.length;r++){const a=t[r],c=Be(a,["tkhd"])[0];if(c){let d=c[0];const h=Ne(c,d===0?12:20),f=Be(a,["mdia","mdhd"])[0];if(f){d=f[0];const m=Ne(f,d===0?12:20),x=Be(a,["mdia","hdlr"])[0];if(x){const v=jt(x.subarray(8,12)),b={soun:ut.AUDIO,vide:ut.VIDEO}[v],S=Be(a,["mdia","minf","stbl","stsd"])[0],A=vT(S);b?(e[h]={timescale:m,type:b,stsd:A},e[b]=tt({timescale:m,id:h},A)):e[h]={timescale:m,type:v,stsd:A}}}}}return Be(o,["moov","mvex","trex"]).forEach(r=>{const a=Ne(r,4),c=e[a];c&&(c.default={duration:Ne(r,12),flags:Ne(r,20)})}),e}function vT(o){const e=o.subarray(8),t=e.subarray(86),i=jt(e.subarray(4,8));let r=i,a;const c=i==="enca"||i==="encv";if(c){const f=Be(e,[i])[0].subarray(i==="enca"?28:78);Be(f,["sinf"]).forEach(x=>{const v=Be(x,["schm"])[0];if(v){const b=jt(v.subarray(4,8));if(b==="cbcs"||b==="cenc"){const S=Be(x,["frma"])[0];S&&(r=jt(S))}}})}const d=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Be(t,["avcC"])[0];h&&h.length>3&&(r+="."+no(h[1])+no(h[2])+no(h[3]),a=io(d==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=Be(e,[i])[0],f=Be(h.subarray(28),["esds"])[0];if(f&&f.length>7){let m=4;if(f[m++]!==3)break;m=fd(f,m),m+=2;const x=f[m++];if(x&128&&(m+=2),x&64&&(m+=f[m++]),f[m++]!==4)break;m=fd(f,m);const v=f[m++];if(v===64)r+="."+no(v);else break;if(m+=12,f[m++]!==5)break;m=fd(f,m);const b=f[m++];let S=(b&248)>>3;S===31&&(S+=1+((b&7)<<3)+((f[m]&224)>>5)),r+="."+S}break}case"hvc1":case"hev1":{const h=Be(t,["hvcC"])[0];if(h&&h.length>12){const f=h[1],m=["","A","B","C"][f>>6],x=f&31,v=Ne(h,2),b=(f&32)>>5?"H":"L",S=h[12],A=h.subarray(6,12);r+="."+m+x,r+="."+bT(v).toString(16).toUpperCase(),r+="."+b+S;let E="";for(let _=A.length;_--;){const R=A[_];(R||E)&&(E="."+R.toString(16).toUpperCase()+E)}r+=E}a=io(d=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=io(r,t)||r;break}case"vp09":{const h=Be(t,["vpcC"])[0];if(h&&h.length>6){const f=h[4],m=h[5],x=h[6]>>4&15;r+="."+ei(f)+"."+ei(m)+"."+ei(x)}break}case"av01":{const h=Be(t,["av1C"])[0];if(h&&h.length>2){const f=h[1]>>>5,m=h[1]&31,x=h[2]>>>7?"H":"M",v=(h[2]&64)>>6,b=(h[2]&32)>>5,S=f===2&&v?b?12:10:v?10:8,A=(h[2]&16)>>4,E=(h[2]&8)>>3,_=(h[2]&4)>>2,R=h[2]&3;r+="."+f+"."+ei(m)+x+"."+ei(S)+"."+A+"."+E+_+R+"."+ei(1)+"."+ei(1)+"."+ei(1)+"."+0,a=io("dav1",t)}break}}return{codec:r,encrypted:c,supplemental:a}}function io(o,e){const t=Be(e,["dvvC"]),i=t.length?t[0]:Be(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,a=i[2]<<5&32|i[3]>>3&31;return o+"."+ei(r)+"."+ei(a)}}function bT(o){let e=0;for(let t=0;t<32;t++)e|=(o>>t&1)<<31-t;return e>>>0}function fd(o,e){const t=e+5;for(;o[e++]&128&&e<t;);return e}function no(o){return("0"+o.toString(16).toUpperCase()).slice(-2)}function ei(o){return(o<10?"0":"")+o}function ST(o,e){if(!o||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Hx(o,(i,r)=>{const a=i.subarray(8,24);a.some(c=>c!==0)||(st.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Qt(a)} -> ${Qt(t)}`),i.set(t,8))})}function ET(o){const e=[];return Hx(o,t=>e.push(t.subarray(8,24))),e}function Hx(o,e){Be(o,["moov","trak"]).forEach(i=>{const r=Be(i,["mdia","minf","stbl","stsd"])[0];if(!r)return;const a=r.subarray(8);let c=Be(a,["enca"]);const d=c.length>0;d||(c=Be(a,["encv"])),c.forEach(h=>{const f=d?h.subarray(28):h.subarray(78);Be(f,["sinf"]).forEach(x=>{const v=Vx(x);v&&e(v,d)})})})}function Vx(o){const e=Be(o,["schm"])[0];if(e){const t=jt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=Be(o,["schi","tenc"])[0];if(i)return i}}}function TT(o,e,t){const i={},r=Be(o,["moof","traf"]);for(let a=0;a<r.length;a++){const c=r[a],d=Be(c,["tfhd"])[0],h=Ne(d,4),f=e[h];if(!f)continue;i[h]||(i[h]={start:NaN,duration:0,sampleCount:0,timescale:f.timescale,type:f.type});const m=i[h],x=Be(c,["tfdt"])[0];if(x){const D=x[0];let k=Ne(x,4);D===1&&(k===tp?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(k*=tp+1,k+=Ne(x,8))),ye(k)&&(!ye(m.start)||k<m.start)&&(m.start=k)}const v=f.default,b=Ne(d,0)|(v==null?void 0:v.flags);let S=(v==null?void 0:v.duration)||0;b&8&&(b&2?S=Ne(d,12):S=Ne(d,8));const A=Be(c,["trun"]);let E=m.start||0,_=0,R=S;for(let D=0;D<A.length;D++){const k=A[D],O=Ne(k,4),F=m.sampleCount;m.sampleCount+=O;const N=k[3]&1,B=k[3]&4,C=k[2]&1,P=k[2]&2,W=k[2]&4,ue=k[2]&8;let me=8,ee=O;for(N&&(me+=4),B&&O&&(!(k[me+1]&1)&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=F),me+=4,C?(R=Ne(k,me),me+=4):R=S,P&&(me+=4),ue&&(me+=4),E+=R,_+=R,ee--);ee--;)C?(R=Ne(k,me),me+=4):R=S,P&&(me+=4),W&&(k[me+1]&1||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(ee+1),m.keyFrameStart=E),me+=4),ue&&(me+=4),E+=R,_+=R;!_&&S&&(_+=S*O)}m.duration+=_}if(!Object.keys(i).some(a=>i[a].duration)){let a=1/0,c=0;const d=Be(o,["sidx"]);for(let h=0;h<d.length;h++){const f=yT(d[h]);if(f!=null&&f.references){a=Math.min(a,f.earliestPresentationTime/f.timescale);const m=f.references.reduce((x,v)=>x+v.info.duration||0,0);c=Math.max(c,m+f.earliestPresentationTime/f.timescale)}}c&&ye(c)&&Object.keys(i).forEach(h=>{i[h].duration||(i[h].duration=c*i[h].timescale-i[h].start)})}return i}function AT(o){const e={valid:null,remainder:null},t=Be(o,["moof"]);if(t.length<2)return e.remainder=o,e;const i=t[t.length-1];return e.valid=o.slice(0,i.byteOffset-8),e.remainder=o.slice(i.byteOffset-8),e}function $s(o,e){const t=new Uint8Array(o.length+e.length);return t.set(o),t.set(e,o.length),t}function ip(o,e){const t=[],i=e.samples,r=e.timescale,a=e.id;let c=!1;return Be(i,["moof"]).map(h=>{const f=h.byteOffset-8;Be(h,["traf"]).map(x=>{const v=Be(x,["tfdt"]).map(b=>{const S=b[0];let A=Ne(b,4);return S===1&&(A*=Math.pow(2,32),A+=Ne(b,8)),A/r})[0];return v!==void 0&&(o=v),Be(x,["tfhd"]).map(b=>{const S=Ne(b,4),A=Ne(b,0)&16777215,E=(A&1)!==0,_=(A&2)!==0,R=(A&8)!==0;let D=0;const k=(A&16)!==0;let O=0;const F=(A&32)!==0;let N=8;S===a&&(E&&(N+=8),_&&(N+=4),R&&(D=Ne(b,N),N+=4),k&&(O=Ne(b,N),N+=4),F&&(N+=4),e.type==="video"&&(c=zo(e.codec)),Be(x,["trun"]).map(B=>{const C=B[0],P=Ne(B,0)&16777215,W=(P&1)!==0;let ue=0;const me=(P&4)!==0,ee=(P&256)!==0;let ce=0;const j=(P&512)!==0;let X=0;const se=(P&1024)!==0,de=(P&2048)!==0;let te=0;const I=Ne(B,4);let M=8;W&&(ue=Ne(B,M),M+=4),me&&(M+=4);let G=ue+f;for(let Z=0;Z<I;Z++){if(ee?(ce=Ne(B,M),M+=4):ce=D,j?(X=Ne(B,M),M+=4):X=O,se&&(M+=4),de&&(C===0?te=Ne(B,M):te=Gx(B,M),M+=4),e.type===ut.VIDEO){let re=0;for(;re<X;){const V=Ne(i,G);if(G+=4,LT(c,i[G])){const ge=i.subarray(G,G+V);mf(ge,c?2:1,o+te/r,t)}G+=V,re+=V+4}}o+=ce/r}}))})})}),t}function zo(o){if(!o)return!1;const e=o.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function LT(o,e){if(o){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function mf(o,e,t,i){const r=Kx(o);let a=0;a+=e;let c=0,d=0,h=0;for(;a<r.length;){c=0;do{if(a>=r.length)break;h=r[a++],c+=h}while(h===255);d=0;do{if(a>=r.length)break;h=r[a++],d+=h}while(h===255);const f=r.length-a;let m=a;if(d<f)a+=d;else if(d>f){st.error(`Malformed SEI payload. ${d} is too small, only ${f} bytes left to parse.`);break}if(c===4){if(r[m++]===181){const v=$x(r,m);if(m+=2,v===49){const b=Ne(r,m);if(m+=4,b===1195456820){const S=r[m++];if(S===3){const A=r[m++],E=31&A,_=64&A,R=_?2+E*3:0,D=new Uint8Array(R);if(_){D[0]=A;for(let k=1;k<R;k++)D[k]=r[m++]}i.push({type:S,payloadType:c,pts:t,bytes:D})}}}}}else if(c===5&&d>16){const x=[];for(let S=0;S<16;S++){const A=r[m++].toString(16);x.push(A.length==1?"0"+A:A),(S===3||S===5||S===7||S===9)&&x.push("-")}const v=d-16,b=new Uint8Array(v);for(let S=0;S<v;S++)b[S]=r[m++];i.push({payloadType:c,pts:t,uuid:x.join(""),userData:ws(b),userDataBytes:b})}}}function Kx(o){const e=o.byteLength,t=[];let i=1;for(;i<e-2;)o[i]===0&&o[i+1]===0&&o[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return o;const r=e-t.length,a=new Uint8Array(r);let c=0;for(i=0;i<r;c++,i++)c===t[0]&&(c++,t.shift()),a[i]=o[c];return a}function _T(o){const e=o[0];let t="",i="",r=0,a=0,c=0,d=0,h=0,f=0;if(e===0){for(;jt(o.subarray(f,f+1))!=="\0";)t+=jt(o.subarray(f,f+1)),f+=1;for(t+=jt(o.subarray(f,f+1)),f+=1;jt(o.subarray(f,f+1))!=="\0";)i+=jt(o.subarray(f,f+1)),f+=1;i+=jt(o.subarray(f,f+1)),f+=1,r=Ne(o,12),a=Ne(o,16),d=Ne(o,20),h=Ne(o,24),f=28}else if(e===1){f+=4,r=Ne(o,f),f+=4;const x=Ne(o,f);f+=4;const v=Ne(o,f);for(f+=4,c=2**32*x+v,sT(c)||(c=Number.MAX_SAFE_INTEGER,st.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),d=Ne(o,f),f+=4,h=Ne(o,f),f+=4;jt(o.subarray(f,f+1))!=="\0";)t+=jt(o.subarray(f,f+1)),f+=1;for(t+=jt(o.subarray(f,f+1)),f+=1;jt(o.subarray(f,f+1))!=="\0";)i+=jt(o.subarray(f,f+1)),f+=1;i+=jt(o.subarray(f,f+1)),f+=1}const m=o.subarray(f,o.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:c,presentationTimeDelta:a,eventDuration:d,id:h,payload:m}}function RT(o,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(o,4),r=0,i=8;r<t;r++)a.set(e[r],i),i+=e[r].byteLength;return a}function wT(o,e,t){if(o.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let a;i>0?(a=new Uint8Array(4),e.length>0&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;const c=new Uint8Array(4);return t.byteLength>0&&new DataView(c.buffer).setUint32(0,t.byteLength,!1),RT([112,115,115,104],new Uint8Array([i,0,0,0]),o,a,r,c,t)}function DT(o){const e=[];if(o instanceof ArrayBuffer){const t=o.byteLength;let i=0;for(;i+32<t;){const r=new DataView(o,i),a=IT(r);e.push(a),i+=a.size}}return e}function IT(o){const e=o.getUint32(0),t=o.byteOffset,i=o.byteLength;if(i<e)return{offset:t,size:i};if(o.getUint32(4)!==1886614376)return{offset:t,size:e};const a=o.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:t,size:e};const c=o.buffer,d=Qt(new Uint8Array(c,t+12,16));let h=null,f=null,m=0;if(a===0)m=28;else{const v=o.getUint32(28);if(!v||i<32+v*16)return{offset:t,size:e};h=[];for(let b=0;b<v;b++)h.push(new Uint8Array(c,t+32+b*16,16));m=32+v*16}if(!m)return{offset:t,size:e};const x=o.getUint32(m);return e-32<x?{offset:t,size:e}:(f=new Uint8Array(c,t+m+4,x),{version:a,systemId:d,kids:h,data:f,offset:t,size:e})}const Yx=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Cr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function gf(o,e){const t=Cr[e];return!!t&&!!t[o.slice(0,4)]}function Ma(o,e,t=!0){return!o.split(",").some(i=>!pf(i,e,t))}function pf(o,e,t=!0){var i;const r=ln(t);return(i=r==null?void 0:r.isTypeSupported(Oa(o,e)))!=null?i:!1}function Oa(o,e){return`${e}/mp4;codecs=${o}`}function np(o){if(o){const e=o.substring(0,4);return Cr.video[e]}return 2}function Io(o){const e=Yx();return o.split(",").reduce((t,i)=>{const a=e&&zo(i)?9:Cr.video[i];return a?(a*2+t)/(t?3:2):(Cr.audio[i]+t)/(t?2:1)},0)}const hd={};function CT(o,e=!0){if(hd[o])return hd[o];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[o];for(let r=0;r<t.length;r++){var i;if(pf(t[r],"audio",e))return hd[o]=t[r],t[r];if(t[r]==="mp3"&&(i=ln(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return o}const NT=/flac|opus|mp4a\.40\.34/i;function Co(o,e=!0){return o.replace(NT,t=>CT(t.toLowerCase(),e))}function kT(o,e){const t=[];if(o){const i=o.split(",");for(let r=0;r<i.length;r++)gf(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function vo(o,e){if(o&&(o.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(o)!==-1)&&(rp(o,"audio")||rp(o,"video")))return o;if(e){const t=e.split(",");if(t.length>1){if(o){for(let i=t.length;i--;)if(t[i].substring(0,4)===o.substring(0,4))return t[i]}return t[0]}}return e||o}function rp(o,e){return gf(o,e)&&pf(o,e)}function MT(o){const e=o.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function OT(o){if(o.startsWith("av01.")){const e=o.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return o}function ap(o){const e=ln(o)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function zd(o){return o.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const PT={supported:!0,powerEfficient:!0,smooth:!0},jT={supported:!1,smooth:!1,powerEfficient:!1},qx={supported:!0,configurations:[],decodingInfoResults:[PT]};function Xx(o,e){return{supported:!1,configurations:e,decodingInfoResults:[jT],error:o}}function UT(o,e,t,i,r,a){const c=o.videoCodec,d=o.audioCodec?o.audioGroups:null,h=a==null?void 0:a.audioCodec,f=a==null?void 0:a.channels,m=f?parseInt(f):h?1/0:2;let x=null;if(d!=null&&d.length)try{d.length===1&&d[0]?x=e.groups[d[0]].channels:x=d.reduce((v,b)=>{if(b){const S=e.groups[b];if(!S)throw new Error(`Audio track group ${b} not found`);Object.keys(S.channels).forEach(A=>{v[A]=(v[A]||0)+S.channels[A]})}return v},{2:0})}catch{return!0}return c!==void 0&&(c.split(",").some(v=>zo(v))||o.width>1920&&o.height>1088||o.height>1920&&o.width>1088||o.frameRate>Math.max(i,30)||o.videoRange!=="SDR"&&o.videoRange!==t||o.bitrate>Math.max(r,8e6))||!!x&&ye(m)&&Object.keys(x).some(v=>parseInt(v)>m)}function Qx(o,e,t,i={}){const r=o.videoCodec;if(!r&&!o.audioCodec||!t)return Promise.resolve(qx);const a=[],c=FT(o),d=c.length,h=BT(o,e,d>0),f=h.length;for(let m=d||1*f||1;m--;){const x={type:"media-source"};if(d&&(x.video=c[m%d]),f){x.audio=h[m%f];const v=x.audio.bitrate;x.video&&v&&(x.video.bitrate-=v)}a.push(x)}if(r){const m=navigator.userAgent;if(r.split(",").some(x=>zo(x))&&Yx())return Promise.resolve(Xx(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${m})`),a))}return Promise.all(a.map(m=>{const x=GT(m);return i[x]||(i[x]=t.decodingInfo(m))})).then(m=>({supported:!m.some(x=>!x.supported),configurations:a,decodingInfoResults:m})).catch(m=>({supported:!1,configurations:a,decodingInfoResults:[],error:m}))}function FT(o){var e;const t=(e=o.videoCodec)==null?void 0:e.split(","),i=Wx(o),r=o.width||640,a=o.height||480,c=o.frameRate||30,d=o.videoRange.toLowerCase();return t?t.map(h=>{const f={contentType:Oa(OT(h),"video"),width:r,height:a,bitrate:i,framerate:c};return d!=="sdr"&&(f.transferFunction=d),f}):[]}function BT(o,e,t){var i;const r=(i=o.audioCodec)==null?void 0:i.split(","),a=Wx(o);return r&&o.audioGroups?o.audioGroups.reduce((c,d)=>{var h;const f=d?(h=e.groups[d])==null?void 0:h.tracks:null;return f?f.reduce((m,x)=>{if(x.groupId===d){const v=parseFloat(x.channels||"");r.forEach(b=>{const S={contentType:Oa(b,"audio"),bitrate:t?$T(b,a):a};v&&(S.channels=""+v),m.push(S)})}return m},c):c},[]):[]}function $T(o,e){if(e<=1)return 1;let t=128e3;return o==="ec-3"?t=768e3:o==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Wx(o){return Math.ceil(Math.max(o.bitrate*.9,o.averageBitrate)/1e3)*1e3||1}function GT(o){let e="";const{audio:t,video:i}=o;if(i){const r=zd(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const r=zd(t.contentType);e+=`${i?"_":""}${r}_c${t.channels}`}return e}const Hd=["NONE","TYPE-0","TYPE-1",null];function zT(o){return Hd.indexOf(o)>-1}const No=["SDR","PQ","HLG"];function HT(o){return!!o&&No.indexOf(o)>-1}var bo={No:"",Yes:"YES",v2:"v2"};function lp(o){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=o,r=i<e/2;return e&&r?t?bo.v2:bo.Yes:bo.No}class op{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Pa{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return cp(this._audioGroups,e)}hasSubtitleGroup(e){return cp(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function cp(o,e){return!e||!o?!1:o.indexOf(e)!==-1}function VT(){if(typeof matchMedia=="function"){const o=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(o.media!==e.media)return o.matches===!0}return!1}function KT(o,e){let t=!1,i=[];if(o&&(t=o!=="SDR",i=[o]),e){i=e.allowedVideoRanges||No.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&VT(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const YT=o=>{const e=new WeakSet;return(t,i)=>{if(o&&(i=o(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},dt=(o,e)=>JSON.stringify(o,YT(e));function qT(o,e,t,i,r){const a=Object.keys(o),c=i==null?void 0:i.channels,d=i==null?void 0:i.audioCodec,h=r==null?void 0:r.videoCodec,f=c&&parseInt(c)===2;let m=!1,x=!1,v=1/0,b=1/0,S=1/0,A=1/0,E=0,_=[];const{preferHDR:R,allowedVideoRanges:D}=KT(e,r);for(let B=a.length;B--;){const C=o[a[B]];m||(m=C.channels[2]>0),v=Math.min(v,C.minHeight),b=Math.min(b,C.minFramerate),S=Math.min(S,C.minBitrate),D.filter(W=>C.videoRanges[W]>0).length>0&&(x=!0)}v=ye(v)?v:0,b=ye(b)?b:0;const k=Math.max(1080,v),O=Math.max(30,b);S=ye(S)?S:t,t=Math.max(S,t),x||(e=void 0);const F=a.length>1;return{codecSet:a.reduce((B,C)=>{const P=o[C];if(C===B)return B;if(_=x?D.filter(W=>P.videoRanges[W]>0):[],F){if(P.minBitrate>t)return Zs(C,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),B;if(!P.hasDefaultAudio)return Zs(C,"no renditions with default or auto-select sound found"),B;if(d&&C.indexOf(d.substring(0,4))%5!==0)return Zs(C,`audio codec preference "${d}" not found`),B;if(c&&!f){if(!P.channels[c])return Zs(C,`no renditions with ${c} channel sound found (channels options: ${Object.keys(P.channels)})`),B}else if((!d||f)&&m&&P.channels[2]===0)return Zs(C,"no renditions with stereo sound found"),B;if(P.minHeight>k)return Zs(C,`min resolution of ${P.minHeight} > maximum of ${k}`),B;if(P.minFramerate>O)return Zs(C,`min framerate of ${P.minFramerate} > maximum of ${O}`),B;if(!_.some(W=>P.videoRanges[W]>0))return Zs(C,`no variants with VIDEO-RANGE of ${dt(_)} found`),B;if(h&&C.indexOf(h.substring(0,4))%5!==0)return Zs(C,`video codec preference "${h}" not found`),B;if(P.maxScore<E)return Zs(C,`max score of ${P.maxScore} < selected max of ${E}`),B}return B&&(Io(C)>=Io(B)||P.fragmentError>o[B].fragmentError)?B:(A=P.minIndex,E=P.maxScore,C)},void 0),videoRanges:_,preferHDR:R,minFramerate:b,minBitrate:S,minIndex:A}}function Zs(o,e){st.log(`[abr] start candidates with "${o}" ignored because ${e}`)}function Zx(o){return o.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function XT(o,e,t,i){return o.slice(t,i+1).reduce((r,a,c)=>{if(!a.codecSet)return r;const d=a.audioGroups;let h=r[a.codecSet];h||(r[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:c,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!d,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);const f=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,f),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.minIndex=Math.min(h.minIndex,c),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,d&&d.forEach(m=>{if(!m)return;const x=e.groups[m];x&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?x.hasDefault:x.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(x.channels).forEach(v=>{h.channels[v]=(h.channels[v]||0)+x.channels[v]}))}),r},{})}function up(o){if(!o)return o;const{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:a}=o;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:a}}function ni(o,e,t){if("attrs"in o){const i=e.indexOf(o);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(In(o,r,t))return i}return-1}function In(o,e,t){const{groupId:i,name:r,lang:a,assocLang:c,default:d}=o,h=o.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(a===void 0||QT(a,e.lang))&&(a===void 0||e.assocLang===c)&&(d===void 0||e.default===d)&&(h===void 0||e.forced===h)&&(!("characteristics"in o)||WT(o.characteristics||"",e.characteristics))&&(t===void 0||t(o,e))}function QT(o,e="--"){return o.length===e.length?o===e:o.startsWith(e)||e.startsWith(o)}function WT(o,e=""){const t=o.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function Dn(o,e){const{audioCodec:t,channels:i}=o;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function ZT(o,e,t,i,r){const a=e[i],d=e.reduce((v,b,S)=>{const A=b.uri;return(v[A]||(v[A]=[])).push(S),v},{})[a.uri];d.length>1&&(i=Math.max.apply(Math,d));const h=a.videoRange,f=a.frameRate,m=a.codecSet.substring(0,4),x=dp(e,i,v=>{if(v.videoRange!==h||v.frameRate!==f||v.codecSet.substring(0,4)!==m)return!1;const b=v.audioGroups,S=t.filter(A=>!b||b.indexOf(A.groupId)!==-1);return ni(o,S,r)>-1});return x>-1?x:dp(e,i,v=>{const b=v.audioGroups,S=t.filter(A=>!b||b.indexOf(A.groupId)!==-1);return ni(o,S,r)>-1})}function dp(o,e,t){for(let i=e;i>-1;i--)if(t(o[i]))return i;for(let i=e+1;i<o.length;i++)if(t(o[i]))return i;return-1}function ko(o,e){var t;return!!o&&o!==((t=e.loadLevelObj)==null?void 0:t.uri)}class JT extends Gs{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:r,partCurrent:a,hls:c}=this,{autoLevelEnabled:d,media:h}=c;if(!r||!h)return;const f=performance.now(),m=a?a.stats:r.stats,x=a?a.duration:r.duration,v=f-m.loading.start,b=c.minAutoLevel,S=r.level,A=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||S<=b){this.clearTimer(),this._nextAutoLevel=-1;return}if(!d)return;const E=A>-1&&A!==S,_=!!t||E;if(!_&&(h.paused||!h.playbackRate||!h.readyState))return;const R=c.mainForwardBufferInfo;if(!_&&R===null)return;const D=this.bwEstimator.getEstimateTTFB(),k=Math.abs(h.playbackRate);if(v<=Math.max(D,1e3*(x/(k*2))))return;const O=R?R.len/k:0,F=m.loading.first?m.loading.first-m.loading.start:-1,N=m.loaded&&F>-1,B=this.getBwEstimate(),C=c.levels,P=C[S],W=Math.max(m.loaded,Math.round(x*(r.bitrate||P.averageBitrate)/8));let ue=N?v-F:v;ue<1&&N&&(ue=Math.min(v,m.loaded*8/B));const me=N?m.loaded*1e3/ue:0,ee=D/1e3,ce=me?(W-m.loaded)/me:W*8/B+ee;if(ce<=O)return;const j=me?me*8:B,X=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,se=this.hls.config.abrBandWidthUpFactor;let de=Number.POSITIVE_INFINITY,te;for(te=S-1;te>b;te--){const Z=C[te].maxBitrate,re=!C[te].details||X;if(de=this.getTimeToLoadFrag(ee,j,x*Z,re),de<Math.min(O,x+ee))break}if(de>=ce||de>x*10)return;N?this.bwEstimator.sample(v-Math.min(D,F),m.loaded):this.bwEstimator.sampleTTFB(v);const I=C[te].maxBitrate;this.getBwEstimate()*se>I&&this.resetEstimator(I);const M=this.findBestLevel(I,b,te,0,O,1,1);M>-1&&(te=M),this.warn(`Fragment ${r.sn}${a?" part "+a.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${O.toFixed(3)} s
      Estimated load time for current fragment: ${ce.toFixed(3)} s
      Estimated load time for down switch fragment: ${de.toFixed(3)} s
      TTFB estimate: ${F|0} ms
      Current BW estimate: ${ye(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${te} @ ${I|0} bps`),c.nextLoadLevel=c.nextAutoLevel=te,this.clearTimer();const G=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===te&&te>0){const Z=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${te>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${Z.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,te>b){let re=this.findBestLevel(this.hls.levels[b].bitrate,b,te,0,Z,1,1);re===-1&&(re=b),this.hls.nextLoadLevel=this.hls.nextAutoLevel=re,this.resetEstimator(this.hls.levels[re].bitrate)}}};E||ce>de*2?G():this.timer=self.setInterval(G,de*1e3),c.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new nT(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case K.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:a}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const c=performance.now(),d=a?a.stats:i.stats,h=c-d.loading.start,f=d.loading.first?d.loading.first-d.loading.start:-1;if(d.loaded&&f>-1){const x=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(x,f),d.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,i,r){const a=e+i/t,c=r?e+this.lastLevelLoadSec:0;return a+c}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,a=r.end-r.first;ye(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===ve.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=i?i.duration:t.duration,c=this.hls.levels[t.level],d=(c.loaded?c.loaded.bytes:0)+r.loaded,h=(c.loaded?c.loaded.duration:0)+a;c.loaded={bytes:d,duration:h},c.realBitrate=Math.round(8*d/h)}if(t.bitrateTest){const a={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,a),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,a=r!=null&&r.stats.loaded?r.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;const c=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(c,a.loaded),a.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=c/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ve.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(i,t,e,0,r,1,1);if(a>-1)return a;const c=this.hls.firstLevel,d=Math.min(Math.max(c,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${c} clamped to ${d}`),d}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const a=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const c=this.hls.levels;if(c.length>Math.max(e,a)&&c[e].loadError<=c[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:a,minAutoLevel:c}=i,d=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),f=this.getStarvationDelay();let m=a.abrBandWidthFactor,x=a.abrBandWidthUpFactor;if(f){const E=this.findBestLevel(h,c,r,f,0,m,x);if(E>=0)return this.rebufferNotice=-1,E}let v=d?Math.min(d,a.maxStarvationDelay):a.maxStarvationDelay;if(!f){const E=this.bitrateTestDelay;E&&(v=(d?Math.min(d,a.maxLoadingDelay):a.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),m=x=1)}const b=this.findBestLevel(h,c,r,f,v,m,x);if(this.rebufferNotice!==b&&(this.rebufferNotice=b,this.info(`${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${b}`)),b>-1)return b;const S=i.levels[c],A=i.loadLevelObj;return A&&(S==null?void 0:S.bitrate)<A.bitrate?c:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,a,c,d){var h;const f=r+a,m=this.lastLoadedFragLevel,x=m===-1?this.hls.firstLevel:m,{fragCurrent:v,partCurrent:b}=this,{levels:S,allAudioTracks:A,loadLevel:E,config:_}=this.hls;if(S.length===1)return 0;const R=S[x],D=!!((h=this.hls.latestLevelDetails)!=null&&h.live),k=E===-1||m===-1;let O,F="SDR",N=(R==null?void 0:R.frameRate)||0;const{audioPreference:B,videoPreference:C}=_,P=this.audioTracksByGroup||(this.audioTracksByGroup=Zx(A));let W=-1;if(k){if(this.firstSelection!==-1)return this.firstSelection;const j=this.codecTiers||(this.codecTiers=XT(S,P,t,i)),X=qT(j,F,e,B,C),{codecSet:se,videoRanges:de,minFramerate:te,minBitrate:I,minIndex:M,preferHDR:G}=X;W=M,O=se,F=G?de[de.length-1]:de[0],N=te,e=Math.max(e,I),this.log(`picked start tier ${dt(X)}`)}else O=R==null?void 0:R.codecSet,F=R==null?void 0:R.videoRange;const ue=b?b.duration:v?v.duration:0,me=this.bwEstimator.getEstimateTTFB()/1e3,ee=[];for(let j=i;j>=t;j--){var ce;const X=S[j],se=j>x;if(!X)continue;if(_.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const re=navigator.mediaCapabilities;typeof(re==null?void 0:re.decodingInfo)=="function"&&UT(X,P,F,N,e,B)?(X.supportedPromise=Qx(X,P,re,this.supportedCache),X.supportedPromise.then(V=>{if(!this.hls)return;X.supportedResult=V;const ge=this.hls.levels,Re=ge.indexOf(X);V.error?this.warn(`MediaCapabilities decodingInfo error: "${V.error}" for level ${Re} ${dt(V)}`):V.supported?V.decodingInfoResults.some(Ae=>Ae.smooth===!1||Ae.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Re} not smooth or powerEfficient: ${dt(V)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Re} ${dt(V)}`),Re>-1&&ge.length>1&&(this.log(`Removing unsupported level ${Re}`),this.hls.removeLevel(Re),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(V=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${V}`)})):X.supportedResult=qx}if((O&&X.codecSet!==O||F&&X.videoRange!==F||se&&N>X.frameRate||!se&&N>0&&N<X.frameRate||(ce=X.supportedResult)!=null&&(ce=ce.decodingInfoResults)!=null&&ce.some(re=>re.smooth===!1))&&(!k||j!==W)){ee.push(j);continue}const de=X.details,te=(b?de==null?void 0:de.partTarget:de==null?void 0:de.averagetargetduration)||ue;let I;se?I=d*e:I=c*e;const M=ue&&r>=ue*2&&a===0?X.averageBitrate:X.maxBitrate,G=this.getTimeToLoadFrag(me,I,M*te,de===void 0);if(I>=M&&(j===m||X.loadError===0&&X.fragmentError===0)&&(G<=me||!ye(G)||D&&!this.bitrateTestDelay||G<f)){const re=this.forcedAutoLevel;return j!==E&&(re===-1||re!==E)&&(ee.length&&this.trace(`Skipped level(s) ${ee.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${S[ee[0]].codecs}" ${S[ee[0]].videoRange}; not compatible with "${O}" ${F}`),this.info(`switch candidate:${x}->${j} adjustedbw(${Math.round(I)})-bitrate=${Math.round(I-M)} ttfb:${me.toFixed(1)} avgDuration:${te.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${G.toFixed(1)} firstSelection:${k} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${E}`)),k&&(this.firstSelection=j),j}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Jx={search:function(o,e){let t=0,i=o.length-1,r=null,a=null;for(;t<=i;){r=(t+i)/2|0,a=o[r];const c=e(a);if(c>0)t=r+1;else if(c<0)i=r-1;else return a}return null}};function eA(o,e,t){if(e===null||!Array.isArray(o)||!o.length||!ye(e))return null;const i=o[0].programDateTime;if(e<(i||0))return null;const r=o[o.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let a=0;a<o.length;++a){const c=o[a];if(sA(e,t,c))return c}return null}function Nn(o,e,t=0,i=0,r=.005){let a=null;if(o){a=e[1+o.sn-e[0].sn]||null;const d=o.endDTS-t;d>0&&d<15e-7&&(t+=15e-7),a&&o.level!==a.level&&a.end<=o.end&&(a=e[2+o.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(a=e[0]);if(a&&((!o||o.level===a.level)&&fp(t,i,a)===0||tA(a,o,Math.min(r,i))))return a;const c=Jx.search(e,fp.bind(null,t,i));return c&&(c!==o||!a)?c:a}function tA(o,e,t){if(e&&e.start===0&&e.level<o.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,a)=>(a[0]==="INF"&&(r+=parseFloat(a[1])),r),t);return o.start<=i}return!1}function fp(o=0,e=0,t){if(t.start<=o&&t.start+t.duration>o)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=o?1:t.start-i>o&&t.start?-1:0}function sA(o,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>o}function ey(o,e,t){if(o&&o.startCC<=e&&o.endCC>=e){let i=o.fragments;const{fragmentHint:r}=o;r&&(i=i.concat(r));let a;return Jx.search(i,c=>c.cc<e?1:c.cc>e?-1:(a=c,c.end<=t?1:c.start>t?-1:0)),a||null}return null}function Mo(o){switch(o.details){case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_TIMEOUT:case K.LEVEL_LOAD_TIMEOUT:case K.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ty(o){return o.details.startsWith("key")}function sy(o){return ty(o)&&!!o.frag&&!o.frag.decryptdata}function hp(o,e){const t=Mo(e);return o.default[`${t?"timeout":"error"}Retry`]}function xf(o,e){const t=o.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*o.retryDelayMs,o.maxRetryDelayMs)}function mp(o){return tt(tt({},o),{errorRetry:null,timeoutRetry:null})}function Oo(o,e,t,i){if(!o)return!1;const r=i==null?void 0:i.code,a=e<o.maxNumRetry&&(iA(r)||!!t);return o.shouldRetry?o.shouldRetry(o,e,t,i,a):a}function iA(o){return Vd(o)||!!o&&(o<400||o>499)}function Vd(o){return o===0&&navigator.onLine===!1}var Xt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Es={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class nA extends Gs{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ve.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(c=>r.indexOf(c.groupId)>=0).some(c=>{var d;return(d=c.details)==null?void 0:d.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,a=t.context;switch(t.details){case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case K.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Rr();return}case K.FRAG_GAP:case K.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Xt.SendAlternateToPenaltyBox;return}case K.LEVEL_EMPTY_ERROR:case K.LEVEL_PARSING_ERROR:{var c;const h=t.parent===ve.MAIN?t.level:r.loadLevel;t.details===K.LEVEL_EMPTY_ERROR&&((c=t.context)!=null&&(c=c.levelDetails)!=null&&c.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.SUBTITLE_LOAD_ERROR:case K.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=r.loadLevelObj;if(h&&(a.type===$e.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===$e.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Xt.SendAlternateToPenaltyBox,t.errorAction.flags=Es.MoveAllAlternatesMatchingHost;return}}return;case K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Xt.SendAlternateToPenaltyBox,flags:Es.MoveAllAlternatesMatchingHDCP};return;case K.KEY_SYSTEM_SESSION_UPDATE_FAILED:case K.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case K.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Xt.SendAlternateToPenaltyBox,flags:Es.MoveAllAlternatesMatchingKey};return;case K.BUFFER_ADD_CODEC_ERROR:case K.REMUX_ALLOC_ERROR:case K.BUFFER_APPEND_ERROR:if(!t.errorAction){var d;t.errorAction=this.getLevelSwitchAction(t,(d=t.level)!=null?d:r.loadLevel)}return;case K.INTERNAL_EXCEPTION:case K.BUFFER_APPENDING_ERROR:case K.BUFFER_FULL_ERROR:case K.LEVEL_SWITCH_ERROR:case K.BUFFER_STALLED_ERROR:case K.BUFFER_SEEK_OVER_HOLE:case K.BUFFER_NUDGE_ON_STALL:t.errorAction=Rr();return}t.type===_e.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Rr())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=hp(i.config.playlistLoadPolicy,e),a=this.playlistError++;if(Oo(r,a,Mo(e),e.response))return{action:Xt.RetryRequest,flags:Es.None,retryConfig:r,retryCount:a};const d=this.getLevelSwitchAction(e,t);return r&&(d.retryConfig=r,d.retryCount=a),d}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:a,keyLoadPolicy:c}=t.config,d=hp(ty(e)?c:a,e),h=t.levels.reduce((m,x)=>m+x.fragmentError,0);if(r&&(e.details!==K.FRAG_GAP&&r.fragmentError++,!sy(e)&&Oo(d,h,Mo(e),e.response)))return{action:Xt.RetryRequest,flags:Es.None,retryConfig:d,retryCount:h};const f=this.getLevelSwitchAction(e,i);return d&&(f.retryConfig=d,f.retryCount=h),f}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var a,c;const f=e.details;r.loadError++,f===K.BUFFER_APPEND_ERROR&&r.fragmentError++;let m=-1;const{levels:x,loadLevel:v,minAutoLevel:b,maxAutoLevel:S}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const A=(a=e.frag)==null?void 0:a.type,_=(A===ve.AUDIO&&f===K.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR))&&x.some(({audioCodec:F})=>r.audioCodec!==F),D=e.sourceBufferName==="video"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR)&&x.some(({codecSet:F,audioCodec:N})=>r.codecSet!==F&&r.audioCodec===N),{type:k,groupId:O}=(c=e.context)!=null?c:{};for(let F=x.length;F--;){const N=(F+v)%x.length;if(N!==v&&N>=b&&N<=S&&x[N].loadError===0){var d,h;const B=x[N];if(f===K.FRAG_GAP&&A===ve.MAIN&&e.frag){const C=x[N].details;if(C){const P=Nn(e.frag,C.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(k===$e.AUDIO_TRACK&&B.hasAudioGroup(O)||k===$e.SUBTITLE_TRACK&&B.hasSubtitleGroup(O))continue;if(A===ve.AUDIO&&(d=r.audioGroups)!=null&&d.some(C=>B.hasAudioGroup(C))||A===ve.SUBTITLE&&(h=r.subtitleGroups)!=null&&h.some(C=>B.hasSubtitleGroup(C))||_&&r.audioCodec===B.audioCodec||D&&r.codecSet===B.codecSet||!_&&r.codecSet!==B.codecSet)continue}m=N;break}}if(m>-1&&i.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:Xt.SendAlternateToPenaltyBox,flags:Es.None,nextAutoLevel:m}}return{action:Xt.SendAlternateToPenaltyBox,flags:Es.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Xt.DoNothing:break;case Xt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==K.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r}=i,a=i.nextAutoLevel;switch(r){case Es.None:this.switchLevel(e,a);break;case Es.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),f=t.levels[h],m=f==null?void 0:f.attrs["HDCP-LEVEL"];if(i.hdcpLevel=m,m==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(m){t.maxHdcpLevel=Hd[Hd.indexOf(m)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Es.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const f=this.hls.levels,m=f.length;for(let v=m;v--;)if(this.variantHasKey(f[v],h)){var c,d;this.log(`Banned key found in level ${v} (${f[v].bitrate}bps) or audio group "${(c=f[v].audioGroups)==null?void 0:c.join(",")}" (${(d=e.frag)==null?void 0:d.type} fragment) ${Qt(h.keyId||[])}`),f[v].fragmentError++,f[v].loadError++,this.log(`Removing level ${v} with key error (${e.error})`),this.hls.removeLevel(v)}const x=e.frag;if(this.hls.levels.length<m)i.resolved=!0;else if(x&&x.type!==ve.MAIN){const v=x.decryptdata;v&&!h.matches(v)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===K.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=zd(e.mimeType),r=this.hls.levels;for(let a=r.length;a--;)r[a][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${a} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(a))}}}function Rr(o){const e={action:Xt.DoNothing,flags:Es.None};return o&&(e.resolved=!0),e}var Ut={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class rA{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const a=i[r];if(!a)break;if(a.start<=e&&e<=a.end&&a.loaded)return a}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:r}=this,a=Object.keys(r);for(let c=a.length;c--;){const d=r[a[c]];if((d==null?void 0:d.body.type)===t&&(!i||d.buffered)){const h=d.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,i,r,a){this.timeRanges&&(this.timeRanges[e]=t);const c=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(d=>{const h=this.fragments[d];if(!h||c>=h.body.sn)return;if(!h.buffered&&(!h.loaded||a)){h.body.type===i&&this.removeFragment(h.body);return}const f=h.range[e];if(f){if(f.time.length===0){this.removeFragment(h.body);return}f.time.some(m=>{const x=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return x&&this.removeFragment(h.body),x})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,r=br(i),a=this.fragments[r];if(!a||a.buffered&&i.gap)return;const c=!i.relurl;Object.keys(t).forEach(d=>{const h=i.elementaryStreams[d];if(!h)return;const f=t[d],m=c||h.partial===!0;a.range[d]=this.getBufferedTimes(i,e.part,m,f)}),a.loaded=null,Object.keys(a.range).length?(this.bufferedEnd(a,i),ro(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=gp(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=br(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,i,r){const a={time:[],partial:i},c=e.start,d=e.end,h=e.minEndPTS||d,f=e.maxStartPTS||c;for(let m=0;m<r.length;m++){const x=r.start(m)-this.bufferPadding,v=r.end(m)+this.bufferPadding;if(f>=x&&h<=v){a.time.push({startPTS:Math.max(c,r.start(m)),endPTS:Math.min(d,r.end(m))});break}else if(c<v&&d>x){const b=Math.max(c,r.start(m)),S=Math.min(d,r.end(m));S>b&&(a.partial=!0,a.time.push({startPTS:b,endPTS:S}))}else if(d<=x)break}return a}getPartialFragment(e){let t=null,i,r,a,c=0;const{bufferPadding:d,fragments:h}=this;return Object.keys(h).forEach(f=>{const m=h[f];m&&ro(m)&&(r=m.body.start-d,a=m.body.end+d,e>=r&&e<=a&&(i=Math.min(e-r,a-e),c<=i&&(t=m.body,c=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ro(t))}getState(e){const t=br(e),i=this.fragments[t];return i?i.buffered?ro(i)?Ut.PARTIAL:Ut.OK:Ut.APPENDING:Ut.NOT_LOADED}isTimeBuffered(e,t,i){let r,a;for(let c=0;c<i.length;c++){if(r=i.start(c)-this.bufferPadding,a=i.end(c)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,r=t.part?null:t,a=br(i);this.fragments[a]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:a,type:c}=t;if(i.sn==="initSegment")return;const d=i.type;if(r){let f=this.activePartLists[d];f||(this.activePartLists[d]=f=[]),f.push(r)}this.timeRanges=a;const h=a[c];this.detectEvictedFragments(c,h,d,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=br(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){const a=t[i[r]];if((a==null?void 0:a.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,a){r&&!this.hasGaps||Object.keys(this.fragments).forEach(c=>{const d=this.fragments[c];if(!d)return;const h=d.body;h.type!==i||r&&!h.gap||h.start<t&&h.end>e&&(d.buffered||a)&&this.removeFragment(h)})}removeFragment(e){const t=br(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=gp(i,a=>a.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function ro(o){var e,t,i;return o.buffered&&!!(o.body.gap||(e=o.range.video)!=null&&e.partial||(t=o.range.audio)!=null&&t.partial||(i=o.range.audiovideo)!=null&&i.partial)}function br(o){return`${o.type}_${o.level}_${o.sn}`}function gp(o,e){return o.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var on={cbc:0,ctr:1};class aA{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case on.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case on.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function lA(o){const e=o.byteLength,t=e&&new DataView(o.buffer).getUint8(e-1);return t?o.slice(0,e-t):o}class oA{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],a=i[1],c=i[2],d=i[3],h=this.invSubMix,f=h[0],m=h[1],x=h[2],v=h[3],b=new Uint32Array(256);let S=0,A=0,E=0;for(E=0;E<256;E++)E<128?b[E]=E<<1:b[E]=E<<1^283;for(E=0;E<256;E++){let _=A^A<<1^A<<2^A<<3^A<<4;_=_>>>8^_&255^99,e[S]=_,t[_]=S;const R=b[S],D=b[R],k=b[D];let O=b[_]*257^_*16843008;r[S]=O<<24|O>>>8,a[S]=O<<16|O>>>16,c[S]=O<<8|O>>>24,d[S]=O,O=k*16843009^D*65537^R*257^S*16843008,f[_]=O<<24|O>>>8,m[_]=O<<16|O>>>16,x[_]=O<<8|O>>>24,v[_]=O,S?(S=R^b[b[b[k^R]]],A^=b[b[A]]):S=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const c=this.ksRows=(a+6+1)*4;let d,h;const f=this.keySchedule=new Uint32Array(c),m=this.invKeySchedule=new Uint32Array(c),x=this.sBox,v=this.rcon,b=this.invSubMix,S=b[0],A=b[1],E=b[2],_=b[3];let R,D;for(d=0;d<c;d++){if(d<a){R=f[d]=t[d];continue}D=R,d%a===0?(D=D<<8|D>>>24,D=x[D>>>24]<<24|x[D>>>16&255]<<16|x[D>>>8&255]<<8|x[D&255],D^=v[d/a|0]<<24):a>6&&d%a===4&&(D=x[D>>>24]<<24|x[D>>>16&255]<<16|x[D>>>8&255]<<8|x[D&255]),f[d]=R=(f[d-a]^D)>>>0}for(h=0;h<c;h++)d=c-h,h&3?D=f[d]:D=f[d-4],h<4||d<=4?m[h]=D:m[h]=S[x[D>>>24]]^A[x[D>>>16&255]]^E[x[D>>>8&255]]^_[x[D&255]],m[h]=m[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,a=this.invKeySchedule,c=this.invSBox,d=this.invSubMix,h=d[0],f=d[1],m=d[2],x=d[3],v=this.uint8ArrayToUint32Array_(i);let b=v[0],S=v[1],A=v[2],E=v[3];const _=new Int32Array(e),R=new Int32Array(_.length);let D,k,O,F,N,B,C,P,W,ue,me,ee,ce,j;const X=this.networkToHostOrderSwap;for(;t<_.length;){for(W=X(_[t]),ue=X(_[t+1]),me=X(_[t+2]),ee=X(_[t+3]),N=W^a[0],B=ee^a[1],C=me^a[2],P=ue^a[3],ce=4,j=1;j<r;j++)D=h[N>>>24]^f[B>>16&255]^m[C>>8&255]^x[P&255]^a[ce],k=h[B>>>24]^f[C>>16&255]^m[P>>8&255]^x[N&255]^a[ce+1],O=h[C>>>24]^f[P>>16&255]^m[N>>8&255]^x[B&255]^a[ce+2],F=h[P>>>24]^f[N>>16&255]^m[B>>8&255]^x[C&255]^a[ce+3],N=D,B=k,C=O,P=F,ce=ce+4;D=c[N>>>24]<<24^c[B>>16&255]<<16^c[C>>8&255]<<8^c[P&255]^a[ce],k=c[B>>>24]<<24^c[C>>16&255]<<16^c[P>>8&255]<<8^c[N&255]^a[ce+1],O=c[C>>>24]<<24^c[P>>16&255]<<16^c[N>>8&255]<<8^c[B&255]^a[ce+2],F=c[P>>>24]<<24^c[N>>16&255]<<16^c[B>>8&255]<<8^c[C&255]^a[ce+3],R[t]=X(D^b),R[t+1]=X(F^S),R[t+2]=X(O^A),R[t+3]=X(k^E),b=W,S=ue,A=me,E=ee,t=t+4}return R.buffer}}class cA{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=uA(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function uA(o){switch(o){case on.cbc:return"AES-CBC";case on.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${o}`)}}const dA=16;class yf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?lA(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((a,c)=>{const d=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(d,t,i,r);const h=this.flush();h?a(h.buffer):c(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){const{currentIV:a,currentResult:c,remainderData:d}=this;if(r!==on.cbc||t.byteLength!==16)return st.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),d&&(e=$s(d,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;a&&(i=a);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new oA),f.expandKey(t);const m=c;return this.currentResult=f.decrypt(h.buffer,0,i),this.currentIV=h.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new cA(this.subtle,t,r)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new aA(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(st.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);const c=this.flush();if(c)return c.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%dA;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(st.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const pp=Math.pow(2,17);class fA{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new wi({type:_e.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,a=r.fLoader,c=r.loader;return new Promise((d,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){h(yp(e));return}else e.gap=!1;const f=this.loader=a?new a(r):new c(r),m=xp(e);e.loader=f;const x=mp(r.fragLoadPolicy.default),v={loadPolicy:x,timeout:x.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:pp};e.stats=f.stats;const b={onSuccess:(S,A,E,_)=>{this.resetLoader(e,f);let R=S.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),d({frag:e,part:null,payload:R,networkDetails:_})},onError:(S,A,E,_)=>{this.resetLoader(e,f),h(new wi({type:_e.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:tt({url:i,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:E,stats:_}))},onAbort:(S,A,E)=>{this.resetLoader(e,f),h(new wi({type:_e.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:S}))},onTimeout:(S,A,E)=>{this.resetLoader(e,f),h(new wi({type:_e.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:E,stats:S}))}};t&&(b.onProgress=(S,A,E,_)=>t({frag:e,part:null,payload:E,networkDetails:_})),f.load(m,v,b)})}loadPart(e,t,i){this.abort();const r=this.config,a=r.fLoader,c=r.loader;return new Promise((d,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(yp(e,t));return}const f=this.loader=a?new a(r):new c(r),m=xp(e,t);e.loader=f;const x=mp(r.fragLoadPolicy.default),v={loadPolicy:x,timeout:x.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:pp};t.stats=f.stats,f.load(m,v,{onSuccess:(b,S,A,E)=>{this.resetLoader(e,f),this.updateStatsFromPart(e,t);const _={frag:e,part:t,payload:b.data,networkDetails:E};i(_),d(_)},onError:(b,S,A,E)=>{this.resetLoader(e,f),h(new wi({type:_e.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:tt({url:m.url,data:void 0},b),error:new Error(`HTTP Error ${b.code} ${b.text}`),networkDetails:A,stats:E}))},onAbort:(b,S,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,f),h(new wi({type:_e.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:b}))},onTimeout:(b,S,A)=>{this.resetLoader(e,f),h(new wi({type:_e.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:A,stats:b}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,a=r.total;if(i.loaded+=r.loaded,a){const h=Math.round(e.duration/t.duration),f=Math.min(Math.round(i.loaded/a),h),x=(h-f)*Math.round(i.loaded/f);i.total=i.loaded+x}else i.total=Math.max(i.loaded,i.total);const c=i.loading,d=r.loading;c.start?c.first+=d.first-d.start:(c.start=d.start,c.first=d.first),c.end=d.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function xp(o,e=null){const t=e||o,i={frag:o,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,a=t.byteRangeEndOffset;if(ye(r)&&ye(a)){var c;let d=r,h=a;if(o.sn==="initSegment"&&hA((c=o.decryptdata)==null?void 0:c.method)){const f=a-r;f%16&&(h=a+(16-f%16)),r!==0&&(i.resetIV=!0,d=r-16)}i.rangeStart=d,i.rangeEnd=h}return i}function yp(o,e){const t=new Error(`GAP ${o.gap?"tag":"attribute"} found`),i={type:_e.MEDIA_ERROR,details:K.FRAG_GAP,fatal:!1,frag:o,error:t,networkDetails:null};return e&&(i.part=e),(e||o).stats.aborted=!0,new wi(i)}function hA(o){return o==="AES-128"||o==="AES-256"}class wi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class iy extends Gs{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class vf{constructor(e,t,i,r=0,a=-1,c=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ao(),this.buffering={audio:ao(),video:ao(),audiovideo:ao()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=a,this.partial=c}}function ao(){return{start:0,executeStart:0,executeEnd:0,end:0}}const vp={length:0,start:()=>0,end:()=>0};class Oe{static isBuffered(e,t){if(e){const i=Oe.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Oe.getBuffered(e);return Oe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const r=Oe.bufferedRanges(e);if(r.length)return Oe.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((m,x)=>m.start-x.start||x.end-m.end);let r=-1,a=[];if(i)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(r=m);const x=a.length;if(x){const v=a[x-1].end;e[m].start-v<i?e[m].end>v&&(a[x-1].end=e[m].end):a.push(e[m])}else a.push(e[m])}else a=e;let c=0,d,h=t,f=t;for(let m=0;m<a.length;m++){const x=a[m].start,v=a[m].end;if(r===-1&&t>=x&&t<=v&&(r=m),t+i>=x&&t<v)h=x,f=v,c=f-t;else if(t+i<x){d=x;break}}return{len:c,start:h||0,end:f||0,nextStart:d,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||vp}catch(t){return st.log("failed to get media.buffered",t),vp}}}const ny=/\{\$([a-zA-Z0-9-_]+)\}/g;function bp(o){return ny.test(o)}function Kd(o,e){if(o.variableList!==null||o.hasVariableRefs){const t=o.variableList;return e.replace(ny,i=>{const r=i.substring(2,i.length-1),a=t==null?void 0:t[r];return a===void 0?(o.playlistParsingError||(o.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):a})}return e}function Sp(o,e,t){let i=o.variableList;i||(o.variableList=i={});let r,a;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const c=new self.URL(t).searchParams;if(c.has(r))a=c.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(c){o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${c.message}`))}}else r=e.NAME,a=e.VALUE;r in i?o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=a||""}function mA(o,e,t){const i=e.IMPORT;if(t&&i in t){let r=o.variableList;r||(o.variableList=r={}),r[i]=t[i]}else o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const gA=/^(\d+)x(\d+)$/,Ep=/(.+?)=(".*?"|.*?)(?:,|$)/g;class yt{constructor(e,t){typeof e=="string"&&(e=yt.parseAttrList(e,t)),ot(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,a)=>(r[a.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=gA.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const r={};for(Ep.lastIndex=0;(i=Ep.exec(e))!==null;){const c=i[1].trim();let d=i[2];const h=d.indexOf('"')===0&&d.lastIndexOf('"')===d.length-1;let f=!1;if(h)d=d.slice(1,-1);else switch(c){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":f=!0}if(t&&(h||f))d=Kd(t,d);else if(!f&&!h)switch(c){case"CLOSED-CAPTIONS":if(d==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":st.warn(`${e}: attribute ${c} is missing quotes`)}r[c]=d}return r}}const pA="com.apple.hls.interstitial";function xA(o){return o!=="ID"&&o!=="CLASS"&&o!=="CUE"&&o!=="START-DATE"&&o!=="DURATION"&&o!=="END-DATE"&&o!=="END-ON-NEXT"}function yA(o){return o==="SCTE35-OUT"||o==="SCTE35-IN"||o==="SCTE35-CMD"}class ry{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:i,t){const a=t.attr;for(const c in a)if(Object.prototype.hasOwnProperty.call(e,c)&&e[c]!==a[c]){st.warn(`DATERANGE tag attribute: "${c}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=c;break}e=ot(new yt({}),a,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const a=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ye(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(st.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ye(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===pA}get isValid(){return!!this.id&&!this._badValueForSameId&&ye(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const vA=10;class bA{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?ye(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||vA}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Po(o,e){return o.length===e.length?!o.some((t,i)=>t!==e[i]):!1}function Tp(o,e){return!o&&!e?!0:!o||!e?!1:Po(o,e)}function wr(o){return o==="AES-128"||o==="AES-256"||o==="AES-256-CTR"}function bf(o){switch(o){case"AES-128":case"AES-256":return on.cbc;case"AES-256-CTR":return on.ctr;default:throw new Error(`invalid full segment method ${o}`)}}function Sf(o){return Uint8Array.from(atob(o),e=>e.charCodeAt(0))}function Yd(o){return Uint8Array.from(unescape(encodeURIComponent(o)),e=>e.charCodeAt(0))}function SA(o){const e=Yd(o).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function ay(o){const e=function(i,r,a){const c=i[r];i[r]=i[a],i[a]=c};e(o,0,3),e(o,1,2),e(o,4,5),e(o,6,7)}function ly(o){const e=o.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const a=r[0]==="base64",c=r[1];a?(i.splice(-1,1),t=Sf(c)):t=SA(c)}}return t}const jo=typeof self<"u"?self:void 0;var vt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Wt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function So(o){switch(o){case Wt.FAIRPLAY:return vt.FAIRPLAY;case Wt.PLAYREADY:return vt.PLAYREADY;case Wt.WIDEVINE:return vt.WIDEVINE;case Wt.CLEARKEY:return vt.CLEARKEY}}function md(o){switch(o){case vt.FAIRPLAY:return Wt.FAIRPLAY;case vt.PLAYREADY:return Wt.PLAYREADY;case vt.WIDEVINE:return Wt.WIDEVINE;case vt.CLEARKEY:return Wt.CLEARKEY}}function Ra(o){const{drmSystems:e,widevineLicenseUrl:t}=o,i=e?[vt.FAIRPLAY,vt.WIDEVINE,vt.PLAYREADY,vt.CLEARKEY].filter(r=>!!e[r]):[];return!i[vt.WIDEVINE]&&t&&i.push(vt.WIDEVINE),i}const oy=(function(o){return jo!=null&&(o=jo.navigator)!=null&&o.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function EA(o,e,t,i){let r;switch(o){case vt.FAIRPLAY:r=["cenc","sinf"];break;case vt.WIDEVINE:case vt.PLAYREADY:r=["cenc"];break;case vt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${o}`)}return TA(r,e,t,i)}function TA(o,e,t,i){return[{initDataTypes:o,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function AA(o){var e;return!!o&&(o.sessionType==="persistent-license"||!!((e=o.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function cy(o){const e=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),c=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(c){const d=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(d){const h=Sf(d).subarray(0,16);return ay(h),h}}return null}let Sr={};class an{static clearKeyUriToKeyIdMap(){Sr={}}static setKeyIdForUri(e,t){Sr[e]=t}static addKeyIdForUri(e){const t=Object.keys(Sr).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),Sr[e]=i,i}constructor(e,t,i,r=[1],a=null,c){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=a,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!wr(e),c!=null&&c.startsWith("0x")&&(this.keyId=new Uint8Array(jx(c)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Po(e.keyFormatVersions,this.keyFormatVersions)&&Tp(e.iv,this.iv)&&Tp(e.keyId,this.keyId)}isSupported(){if(this.method){if(wr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Wt.FAIRPLAY:case Wt.WIDEVINE:case Wt.PLAYREADY:case Wt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(wr(this.method)){let a=this.iv;return a||(typeof e!="number"&&(st.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),a=_A(e)),new an(this.method,this.uri,"identity",this.keyFormatVersions,a)}if(this.keyId){const a=Sr[this.uri];if(a&&!Po(this.keyId,a)&&an.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=ly(this.uri);if(i)switch(this.keyFormat){case Wt.WIDEVINE:if(this.pssh=i,!this.keyId){const a=DT(i.buffer);if(a.length){var r;const c=a[0];this.keyId=(r=c.kids)!=null&&r.length?c.kids[0]:null}}this.keyId||(this.keyId=Ap(t));break;case Wt.PLAYREADY:{const a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=wT(a,null,i),this.keyId=cy(i);break}default:{let a=i.subarray(0,16);if(a.length!==16){const c=new Uint8Array(16);c.set(a,16-a.length),a=c}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){let a;a=LA(t),a||(a=Ap(t),a||(a=Sr[this.uri])),a&&(this.keyId=a,an.setKeyIdForUri(this.uri,a))}return this}}function LA(o){const e=o==null?void 0:o[Wt.WIDEVINE];return e?e.keyId:null}function Ap(o){const e=o==null?void 0:o[Wt.PLAYREADY];if(e){const t=ly(e.uri);if(t)return cy(t)}return null}function _A(o){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=o>>8*(15-t)&255;return e}const Lp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,_p=/#EXT-X-MEDIA:(.*)/g,RA=/^#EXT(?:INF|-X-TARGETDURATION):/m,gd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),wA=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ri{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return ff.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return RA.test(e)}static parseMasterPlaylist(e,t){const i=bp(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},a=[];if(Lp.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let c;for(;(c=Lp.exec(e))!=null;)if(c[1]){var d;const f=new yt(c[1],r),m=Kd(r,c[2]),x={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:ri.resolve(m,t)},v=f.decimalResolution("RESOLUTION");v&&(x.width=v.width,x.height=v.height),Dp(f.CODECS,x);const b=f["SUPPLEMENTAL-CODECS"];b&&(x.supplemental={},Dp(b,x.supplemental)),(d=x.unknownCodecs)!=null&&d.length||a.push(x),r.levels.push(x)}else if(c[3]){const f=c[3],m=c[4];switch(f){case"SESSION-DATA":{const x=new yt(m,r),v=x["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=x);break}case"SESSION-KEY":{const x=Rp(m,t,r);x.encrypted&&x.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(x)):st.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const x=new yt(m,r);Sp(r,x,t)}break}case"CONTENT-STEERING":{const x=new yt(m,r);r.contentSteering={uri:ri.resolve(x["SERVER-URI"],t),pathwayId:x["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=wp(m);break}}}const h=a.length>0&&a.length<r.levels.length;return r.levels=h?a:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const a={},c=i.levels,d={AUDIO:c.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:c.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(_p.lastIndex=0;(r=_p.exec(e))!==null;){const f=new yt(r[1],i),m=f.TYPE;if(m){const x=d[m],v=a[m]||[];a[m]=v;const b=f.LANGUAGE,S=f["ASSOC-LANGUAGE"],A=f.CHANNELS,E=f.CHARACTERISTICS,_=f["INSTREAM-ID"],R={attrs:f,bitrate:0,id:h++,groupId:f["GROUP-ID"]||"",name:f.NAME||b||"",type:m,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:b,url:f.URI?ri.resolve(f.URI,t):""};if(S&&(R.assocLang=S),A&&(R.channels=A),E&&(R.characteristics=E),_&&(R.instreamId=_),x!=null&&x.length){const D=ri.findGroup(x,R.groupId)||x[0];Ip(R,D,"audioCodec"),Ip(R,D,"textCodec")}v.push(R)}}return a}static parseLevelPlaylist(e,t,i,r,a,c){var d;const h={url:t},f=new bA(t),m=f.fragments,x=[];let v=null,b=0,S=0,A=0,E=0,_=0,R=null,D=new dd(r,h),k,O,F,N=-1,B=!1,C=null,P;if(gd.lastIndex=0,f.m3u8=e,f.hasVariableRefs=bp(e),((d=gd.exec(e))==null?void 0:d[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(k=gd.exec(e))!==null;){B&&(B=!1,D=new dd(r,h),D.playlistOffset=A,D.setStart(A),D.sn=b,D.cc=E,_&&(D.bitrate=_),D.level=i,v&&(D.initSegment=v,v.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),C&&(D.setByteRange(C),C=null)));const ee=k[1];if(ee){D.duration=parseFloat(ee);const ce=(" "+k[2]).slice(1);D.title=ce||null,D.tagList.push(ce?["INF",ee,ce]:["INF",ee])}else if(k[3]){if(ye(D.duration)){D.playlistOffset=A,D.setStart(A),F&&Np(D,F,f),D.sn=b,D.level=i,D.cc=E,m.push(D);const ce=(" "+k[3]).slice(1);D.relurl=Kd(f,ce),qd(D,R,x),R=D,A+=D.duration,b++,S=0,B=!0}}else{if(k=k[0].match(wA),!k){st.warn("No matches on slow regex match for level playlist!");continue}for(O=1;O<k.length&&k[O]===void 0;O++);const ce=(" "+k[O]).slice(1),j=(" "+k[O+1]).slice(1),X=k[O+2]?(" "+k[O+2]).slice(1):null;switch(ce){case"BYTERANGE":R?D.setByteRange(j,R):D.setByteRange(j);break;case"PROGRAM-DATE-TIME":D.rawProgramDateTime=j,D.tagList.push(["PROGRAM-DATE-TIME",j]),N===-1&&(N=m.length);break;case"PLAYLIST-TYPE":f.type&&_i(f,ce,k),f.type=j.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?_i(f,ce,k):m.length>0&&kp(f,ce,k),b=f.startSN=parseInt(j);break;case"SKIP":{f.skippedSegments&&_i(f,ce,k);const se=new yt(j,f),de=se.decimalInteger("SKIPPED-SEGMENTS");if(ye(de)){f.skippedSegments+=de;for(let I=de;I--;)m.push(null);b+=de}const te=se.enumeratedString("RECENTLY-REMOVED-DATERANGES");te&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(te.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&_i(f,ce,k),f.targetduration=Math.max(parseInt(j),1);break;case"VERSION":f.version!==null&&_i(f,ce,k),f.version=parseInt(j);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||_i(f,ce,k),f.live=!1;break;case"#":(j||X)&&D.tagList.push(X?[j,X]:[j]);break;case"DISCONTINUITY":E++,D.tagList.push(["DIS"]);break;case"GAP":D.gap=!0,D.tagList.push([ce]);break;case"BITRATE":D.tagList.push([ce,j]),_=parseInt(j)*1e3,ye(_)?D.bitrate=_:_=0;break;case"DATERANGE":{const se=new yt(j,f),de=new ry(se,f.dateRanges[se.ID],f.dateRangeTagCount);f.dateRangeTagCount++,de.isValid||f.skippedSegments?f.dateRanges[de.id]=de:st.warn(`Ignoring invalid DATERANGE tag: "${j}"`),D.tagList.push(["EXT-X-DATERANGE",j]);break}case"DEFINE":{{const se=new yt(j,f);"IMPORT"in se?mA(f,se,c):Sp(f,se,t)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?_i(f,ce,k):m.length>0&&kp(f,ce,k),f.startCC=E=parseInt(j);break;case"KEY":{const se=Rp(j,t,f);if(se.isSupported()){if(se.method==="NONE"){F=void 0;break}F||(F={});const de=F[se.keyFormat];de!=null&&de.matches(se)||(de&&(F=ot({},F)),F[se.keyFormat]=se)}else st.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${j}"`);break}case"START":f.startTimeOffset=wp(j);break;case"MAP":{const se=new yt(j,f);if(D.duration){const de=new dd(r,h);Cp(de,se,i,F),v=de,D.initSegment=v,v.rawProgramDateTime&&!D.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime)}else{const de=D.byteRangeEndOffset;if(de){const te=D.byteRangeStartOffset;C=`${de-te}@${te}`}else C=null;Cp(D,se,i,F),v=D,B=!0}v.cc=E;break}case"SERVER-CONTROL":{P&&_i(f,ce,k),P=new yt(j),f.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),f.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&_i(f,ce,k);const se=new yt(j);f.partTarget=se.decimalFloatingPoint("PART-TARGET");break}case"PART":{let se=f.partList;se||(se=f.partList=[]);const de=S>0?se[se.length-1]:void 0,te=S++,I=new yt(j,f),M=new mT(I,D,h,te,de);se.push(M),D.duration+=M.duration;break}case"PRELOAD-HINT":{const se=new yt(j,f);f.preloadHint=se;break}case"RENDITION-REPORT":{const se=new yt(j,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(se);break}default:st.warn(`line parsed but not handled: ${k}`);break}}}R&&!R.relurl?(m.pop(),A-=R.duration,f.partList&&(f.fragmentHint=R)):f.partList&&(qd(D,R,x),D.cc=E,f.fragmentHint=D,F&&Np(D,F,f)),f.targetduration||(f.playlistParsingError=new Error("Missing Target Duration"));const W=m.length,ue=m[0],me=m[W-1];if(A+=f.skippedSegments*f.targetduration,A>0&&W&&me){f.averagetargetduration=A/W;const ee=me.sn;f.endSN=ee!=="initSegment"?ee:0,f.live||(me.endList=!0),N>0&&(IA(m,N),ue&&x.unshift(ue))}return f.fragmentHint&&(A+=f.fragmentHint.duration),f.totalduration=A,x.length&&f.dateRangeTagCount&&ue&&uy(x,f),f.endCC=E,f}}function uy(o,e){let t=o.length;if(!t)if(e.hasProgramDateTime){const d=e.fragments[e.fragments.length-1];o.push(d),t++}else return;const i=o[t-1],r=e.live?1/0:e.totalduration,a=Object.keys(e.dateRanges);for(let d=a.length;d--;){const h=e.dateRanges[a[d]],f=h.startDate.getTime();h.tagAnchor=i.ref;for(let m=t;m--;){var c;if(((c=o[m])==null?void 0:c.sn)<e.startSN)break;const x=DA(e,f,o,m,r);if(x!==-1){h.tagAnchor=e.fragments[x].ref;break}}}}function DA(o,e,t,i,r){const a=t[i];if(a){const d=a.programDateTime;if(e>=d||i===0){var c;const h=(((c=t[i+1])==null?void 0:c.start)||r)-a.start;if(e<=d+h*1e3){const f=t[i].sn-o.startSN;if(f<0)return-1;const m=o.fragments;if(m.length>t.length){const v=(t[i+1]||m[m.length-1]).sn-o.startSN;for(let b=v;b>f;b--){const S=m[b].programDateTime;if(e>=S&&e<S+m[b].duration*1e3)return b}}return f}}}return-1}function Rp(o,e,t){var i,r;const a=new yt(o,t),c=(i=a.METHOD)!=null?i:"",d=a.URI,h=a.hexadecimalInteger("IV"),f=a.KEYFORMATVERSIONS,m=(r=a.KEYFORMAT)!=null?r:"identity";d&&a.IV&&!h&&st.error(`Invalid IV: ${a.IV}`);const x=d?ri.resolve(d,e):"",v=(f||"1").split("/").map(Number).filter(Number.isFinite);return new an(c,x,m,v,h,a.KEYID)}function wp(o){const t=new yt(o).decimalFloatingPoint("TIME-OFFSET");return ye(t)?t:null}function Dp(o,e){let t=(o||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(a=>gf(a,i));r.length&&(e[`${i}Codec`]=r.map(a=>a.split("/")[0]).join(","),t=t.filter(a=>r.indexOf(a)===-1))}),e.unknownCodecs=t}function Ip(o,e,t){const i=e[t];i&&(o[t]=i)}function IA(o,e){let t=o[e];for(let i=e;i--;){const r=o[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function qd(o,e,t){o.rawProgramDateTime?t.push(o):e!=null&&e.programDateTime&&(o.programDateTime=e.endProgramDateTime)}function Cp(o,e,t,i){o.relurl=e.URI,e.BYTERANGE&&o.setByteRange(e.BYTERANGE),o.level=t,o.sn="initSegment",i&&(o.levelkeys=i),o.initSegment=null}function Np(o,e,t){o.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(o)}function _i(o,e,t){o.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function kp(o,e,t){o.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function pd(o,e){const t=e.startPTS;if(ye(t)){let i=0,r;e.sn>o.sn?(i=t-o.start,r=o):(i=o.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>o.sn?o.cc===e.cc&&o.minEndPTS?e.setStart(o.start+(o.minEndPTS-o.start)):e.setStart(o.start+o.duration):e.setStart(Math.max(o.start-e.duration,0))}function dy(o,e,t,i,r,a,c){i-t<=0&&(c.warn("Fragment should have a positive duration",e),i=t+e.duration,a=r+e.duration);let h=t,f=i;const m=e.startPTS,x=e.endPTS;if(ye(m)){const _=Math.abs(m-t);o&&_>o.totalduration?c.warn(`media timestamps and playlist times differ by ${_}s for level ${e.level} ${o.url}`):ye(e.deltaPTS)?e.deltaPTS=Math.max(_,e.deltaPTS):e.deltaPTS=_,h=Math.max(t,m),t=Math.min(t,m),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,f=Math.min(i,x),i=Math.max(i,x),a=e.endDTS!==void 0?Math.max(a,e.endDTS):a}const v=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=r,e.endPTS=i,e.minEndPTS=f,e.endDTS=a;const b=e.sn;if(!o||b<o.startSN||b>o.endSN)return 0;let S;const A=b-o.startSN,E=o.fragments;for(E[A]=e,S=A;S>0;S--)pd(E[S],E[S-1]);for(S=A;S<E.length-1;S++)pd(E[S],E[S+1]);return o.fragmentHint&&pd(E[E.length-1],o.fragmentHint),o.PTSKnown=o.alignedSliding=!0,v}function CA(o,e,t){if(o===e)return;let i=null;const r=o.fragments;for(let m=r.length-1;m>=0;m--){const x=r[m].initSegment;if(x){i=x;break}}o.fragmentHint&&delete o.fragmentHint.endPTS;let a;MA(o,e,(m,x,v,b)=>{if((!e.startCC||e.skippedSegments)&&x.cc!==m.cc){const S=m.cc-x.cc;for(let A=v;A<b.length;A++)b[A].cc+=S;e.endCC=b[b.length-1].cc}ye(m.startPTS)&&ye(m.endPTS)&&(x.setStart(x.startPTS=m.startPTS),x.startDTS=m.startDTS,x.maxStartPTS=m.maxStartPTS,x.endPTS=m.endPTS,x.endDTS=m.endDTS,x.minEndPTS=m.minEndPTS,x.setDuration(m.endPTS-m.startPTS),x.duration&&(a=x),e.PTSKnown=e.alignedSliding=!0),m.hasStreams&&(x.elementaryStreams=m.elementaryStreams),x.loader=m.loader,m.hasStats&&(x.stats=m.stats),m.initSegment&&(x.initSegment=m.initSegment,i=m.initSegment)});const c=e.fragments,d=e.fragmentHint?c.concat(e.fragmentHint):c;if(i&&d.forEach(m=>{var x;m&&(!m.initSegment||m.initSegment.relurl===((x=i)==null?void 0:x.relurl))&&(m.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=c.some(m=>!m),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let m=e.skippedSegments;m--;)c.shift();e.startSN=c[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=NA(o.dateRanges,e,t));const m=o.fragments.filter(x=>x.rawProgramDateTime);if(o.hasProgramDateTime&&!e.hasProgramDateTime)for(let x=1;x<d.length;x++)d[x].programDateTime===null&&qd(d[x],d[x-1],m);uy(m,e)}e.endCC=c[c.length-1].cc}if(!e.startCC){var h;const m=my(o,e.startSN-1);e.startCC=(h=m==null?void 0:m.cc)!=null?h:c[0].cc}kA(o.partList,e.partList,(m,x)=>{x.elementaryStreams=m.elementaryStreams,x.stats=m.stats}),a?dy(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,t):fy(o,e),c.length&&(e.totalduration=e.edge-c[0].start),e.driftStartTime=o.driftStartTime,e.driftStart=o.driftStart;const f=e.advancedDateTime;if(e.advanced&&f){const m=e.edge;e.driftStart||(e.driftStartTime=f,e.driftStart=m),e.driftEndTime=f,e.driftEnd=m}else e.driftEndTime=o.driftEndTime,e.driftEnd=o.driftEnd,e.advancedDateTime=o.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=o.requestScheduled)}function NA(o,e,t){const{dateRanges:i,recentlyRemovedDateranges:r}=e,a=ot({},o);r&&r.forEach(h=>{delete a[h]});const d=Object.keys(a).length;return d?(Object.keys(i).forEach(h=>{const f=a[h],m=new ry(i[h].attr,f);m.isValid?(a[h]=m,f||(m.tagOrder+=d)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${dt(i[h].attr)}"`)}),a):i}function kA(o,e,t){if(o&&e){let i=0;for(let r=0,a=o.length;r<=a;r++){const c=o[r],d=e[r+i];c&&d&&c.index===d.index&&c.fragment.sn===d.fragment.sn?t(c,d):i--}}}function MA(o,e,t){const i=e.skippedSegments,r=Math.max(o.startSN,e.startSN)-e.startSN,a=(o.fragmentHint?1:0)+(i?e.endSN:Math.min(o.endSN,e.endSN))-e.startSN,c=e.startSN-o.startSN,d=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;for(let f=r;f<=a;f++){const m=h[c+f];let x=d[f];if(i&&!x&&m&&(x=e.fragments[f]=m),m&&x){t(m,x,f,d);const v=m.relurl,b=x.relurl;if(v&&OA(v,b)){e.playlistParsingError=Mp(`media sequence mismatch ${x.sn}:`,o,e,m,x);return}else if(m.cc!==x.cc){e.playlistParsingError=Mp(`discontinuity sequence mismatch (${m.cc}!=${x.cc})`,o,e,m,x);return}}}}function Mp(o,e,t,i,r){return new Error(`${o} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function fy(o,e,t=!0){const i=e.startSN+e.skippedSegments-o.startSN,r=o.fragments,a=i>=0;let c=0;if(a&&i<r.length)c=r[i].start;else if(a&&e.startSN===o.endSN+1)c=o.fragmentEnd;else if(a&&t)c=o.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)c=o.fragmentStart;else return;Xd(e,c)}function Xd(o,e){if(e){const t=o.fragments;for(let i=o.skippedSegments;i<t.length;i++)t[i].addStart(e);o.fragmentHint&&o.fragmentHint.addStart(e)}}function hy(o,e=1/0){let t=1e3*o.targetduration;if(o.updated){const i=o.fragments;if(i.length&&t*4>e){const a=i[i.length-1].duration*1e3;a<t&&(t=a)}}else t/=2;return Math.round(t)}function my(o,e,t){if(!o)return null;let i=o.fragments[e-o.startSN];return i||(i=o.fragmentHint,i&&i.sn===e)?i:e<o.startSN&&t&&t.sn===e?t:null}function Op(o,e,t){return o?gy(o.partList,e,t):null}function gy(o,e,t){if(o)for(let i=o.length;i--;){const r=o[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function py(o){o.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function OA(o,e){return o!==e&&e?Pp(o)!==Pp(e):!1}function Pp(o){return o.replace(/\?[^?]*$/,"")}function wa(o,e){for(let i=0,r=o.length;i<r;i++){var t;if(((t=o[i])==null?void 0:t.cc)===e)return o[i]}return null}function PA(o,e){return!!(o&&e.startCC<o.endCC&&e.endCC>o.startCC)}function jp(o,e){const t=o.start+e;o.startPTS=t,o.setStart(t),o.endPTS=t+o.duration}function xy(o,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)jp(t[i],o);e.fragmentHint&&jp(e.fragmentHint,o),e.alignedSliding=!0}function jA(o,e){o&&(yy(e,o),e.alignedSliding||Uo(e,o),!e.alignedSliding&&!e.skippedSegments&&fy(o,e,!1))}function yy(o,e){if(!PA(e,o))return;const t=Math.min(e.endCC,o.endCC),i=wa(e.fragments,t),r=wa(o.fragments,t);if(!i||!r)return;st.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const a=i.start-r.start;xy(a,o)}function Uo(o,e){if(!o.hasProgramDateTime||!e.hasProgramDateTime)return;const t=o.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,a;const c=Math.min(e.endCC,o.endCC);e.startCC<c&&o.startCC<c&&(r=wa(i,c),a=wa(t,c)),(!r||!a)&&(r=i[Math.floor(i.length/2)],a=wa(t,r.cc)||t[Math.floor(t.length/2)]);const d=r.programDateTime,h=a.programDateTime;if(!d||!h)return;const f=(h-d)/1e3-(a.start-r.start);xy(f,o)}function is(o,e,t){hs(o,e,t),o.addEventListener(e,t)}function hs(o,e,t){o.removeEventListener(e,t)}const UA={toString:function(o){let e="";const t=o.length;for(let i=0;i<t;i++)e+=`[${o.start(i).toFixed(3)}-${o.end(i).toFixed(3)}]`;return e}},ae={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Ef extends iy{constructor(e,t,i,r,a){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ae.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:c,fragCurrent:d,media:h,mediaBuffer:f,state:m}=this,x=h?h.currentTime:0,v=Oe.bufferInfo(f||h,x,c.maxBufferHole),b=!v.len;if(this.log(`Media seeking to ${ye(x)?x.toFixed(3):x}, state: ${m}, ${b?"out of":"in"} buffer`),this.state===ae.ENDED)this.resetLoadingState();else if(d){const S=c.maxFragLookUpTolerance,A=d.start-S,E=d.start+d.duration+S;if(b||E<v.start||A>v.end){const _=x>E;(x<A||_)&&(_&&d.loader&&(this.log(`Cancelling fragment load for seek (sn: ${d.sn})`),d.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(x,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(x>S&&(this.lastCurrentTime=x),!this.loadingParts){const A=Math.max(v.end,x),E=this.shouldLoadParts(this.getLevelDetails(),A);E&&(this.log(`LL-Part loading ON after seeking to ${x.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${b?"startPosition":"nextLoadPosition"} to ${x} for seek without enough to start`),this.nextLoadPosition=x,b&&(this.startPosition=x)),b&&this.state===ae.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new fA(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new yf(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ae.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ae.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=Oe.bufferedInfo(a,e.start,0));const c=e.nextStart;if(c&&c>r&&c<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const m=h[h.length-1];return Oe.isBuffered(this.media,m.start+m.duration/2)}const f=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(f)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;is(i,"seeking",this.onMediaSeeking),is(i,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===ae.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),hs(r,"seeking",this.onMediaSeeking),hs(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ae.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=a=>{const c=a.frag;if(this.fragContextChanged(c)){this.warn(`${c.type} sn: ${c.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(c,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(e,t,i,r).then(a=>{if(!a)return;const c=this.state,d=a.frag;if(this.fragContextChanged(d)){(c===ae.FRAG_LOADING||!this.fragCurrent&&c===ae.PARSING)&&(this.fragmentTracker.removeFragment(d),this.state=ae.IDLE);return}"payload"in a&&(this.log(`Loaded ${d.type} sn: ${d.sn} of ${this.playlistLabel()} ${d.level}`),this.hls.trigger(L.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===ae.STOPPED||this.state===ae.ERROR||(this.warn(`Frag error: ${(a==null?void 0:a.message)||a}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===Ut.APPENDING){const a=e.type,c=this.getFwdBufferInfo(this.mediaBuffer,a),d=Math.max(e.duration,c?c.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(d,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Ut.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(L.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:a,payload:c}=i,d=a.decryptdata;if(c&&c.byteLength>0&&d!=null&&d.key&&d.iv&&wr(d.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(c),d.key.buffer,d.iv.buffer,bf(d.method)).catch(f=>{throw r.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:a}),f}).then(f=>{const m=self.performance.now();return r.trigger(L.FRAG_DECRYPTED,{frag:a,payload:f,stats:{tstart:h,tdecrypt:m}}),i.payload=f,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ae.STOPPED||this.state===ae.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ae.STOPPED&&(this.state=ae.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,r;const a=e.tracks;if(a&&!t.encrypted&&((i=a.audio)!=null&&i.encrypted||(r=a.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const c=this.media,d=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${c?"attached mediaKeys: "+c.mediaKeys:"detached"})`);return this.warn(d.message),!c||c.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,fatal:!1,error:d,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?UA.toString(Oe.getBuffered(i)):"(detached)"})`),wt(e)){var r;if(e.type!==ve.SUBTITLE){const c=e.elementaryStreams;if(!Object.keys(c).some(d=>!!c[d])){this.state=ae.IDLE;return}}const a=(r=this.levels)==null?void 0:r[e.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=ae.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:a}=e,c=!a||a.length===0||a.some(h=>!h),d=new vf(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!c);t.flush(d)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var a;this.fragCurrent=e;const c=t.details;if(!this.levels||!c)throw new Error(`frag load aborted, missing level${c?"":" detail"}s`);let d=null;if(e.encrypted&&!((a=e.decryptdata)!=null&&a.key)){if(this.log(`Loading key for ${e.sn} of [${c.startSN}-${c.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ae.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(L.KEY_LOADED,v),this.state===ae.KEY_LOADING&&(this.state=ae.IDLE),v}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(d=this.keyLoader.loadClear(e,c.encryptedFragments,this.startFragRequested),d&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(wt(e)&&(!h||e.sn!==h.sn)){const v=this.shouldLoadParts(t.details,e.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${h==null?void 0:h.sn}->${e.sn}`),this.loadingParts=v)}if(i=Math.max(e.start,i||0),this.loadingParts&&wt(e)){const v=c.partList;if(v&&r){i>c.fragmentEnd&&c.fragmentHint&&(e=c.fragmentHint);const b=this.getNextPart(v,e,i);if(b>-1){const S=v[b];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${b}/${v.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${c.startSN}-${c.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=ae.FRAG_LOADING;let A;return d?A=d.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,S,t,r)).catch(E=>this.handleFragLoadError(E)):A=this.doFragPartsLoad(e,S,t,r).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:S,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!e.url||this.loadedEndOfParts(v,i))return Promise.resolve(null)}}if(wt(e)&&this.loadingParts){var f;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(f=c.partList)==null?void 0:f.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+c.startSN+"-"+c.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),ye(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ae.FRAG_LOADING;const m=this.config.progressive&&e.type!==ve.SUBTITLE;let x;return m&&d?x=d.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(e,r)).catch(v=>this.handleFragLoadError(v)):x=Promise.all([this.fragmentLoader.load(e,m?r:void 0),d]).then(([v])=>(!m&&r&&r(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):x}doFragPartsLoad(e,t,i,r){return new Promise((a,c)=>{var d;const h=[],f=(d=i.details)==null?void 0:d.partList,m=x=>{this.fragmentLoader.loadPart(e,x,r).then(v=>{h[x.index]=v;const b=v.part;this.hls.trigger(L.FRAG_LOADED,v);const S=Op(i.details,e.sn,x.index+1)||gy(f,e.sn,x.index+1);if(S)m(S);else return a({frag:e,part:b,partsLoaded:h})}).catch(c)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===K.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===_e.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ae.PARSING){!this.fragCurrent&&this.state!==ae.STOPPED&&this.state!==ae.ERROR&&(this.state=ae.IDLE);return}const{frag:i,part:r,level:a}=t,c=self.performance.now();i.stats.parsing.end=c,r&&(r.stats.parsing.end=c);const d=this.getLevelDetails(),f=d&&i.sn>d.endSN||this.shouldLoadParts(d,i.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=f),this.updateLevelTiming(i,r,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const a=e.partList[0];if(a.fragment.type===ve.SUBTITLE)return!1;const c=a.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=c){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:a,part:c}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const d=t[r],h=d.details,f=c>-1?Op(h,a,c):null,m=f?f.fragment:my(h,a,i);return m?(i&&i!==m&&(m.stats=i.stats),{frag:m,part:f,level:d}):null}bufferFragmentData(e,t,i,r,a){if(this.state!==ae.PARSING)return;const{data1:c,data2:d}=e;let h=c;if(d&&(h=$s(c,d)),!h.length)return;const f=this.initPTS[t.cc],m=f?-f.baseTime/f.timescale:void 0,x={type:e.type,frag:t,part:i,chunkMeta:r,offset:m,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,x),e.dropped&&e.independent&&!i){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Oe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=Oe.bufferInfo(t,i,0),a=e.duration,c=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),d=Math.max(Math.min(e.start-c,r.end-c),i+c);e.start-d>c&&this.flushMainBuffer(d,e.start)}getFwdBufferInfo(e,t){var i;const r=this.getLoadPosition();if(!ye(r))return null;const c=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,c)}getFwdBufferInfoAtPos(e,t,i,r){const a=Oe.bufferInfo(e,t,r);if(a.len===0&&a.nextStart!==void 0){const c=this.fragmentTracker.getBufferedFrag(t,i);if(c&&(a.nextStart<=c.end||c.gap)){const d=Math.max(Math.min(a.nextStart,c.end)-t,r);return Oe.bufferInfo(e,t,d)}}return a}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),a=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return a>=r?(i.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(e,t=ve.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:a}=this,c=i[0].start,d=a.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const x=a.initialLiveManifestSize;if(r<x)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${x})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<c){var f;d&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const v=this.hls.startPosition,b=this.hls.liveSyncPosition,S=h?(v!==-1&&v>=c?v:b)||h.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${b} frag.start: ${(f=h)==null?void 0:f.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=c&&(h=i[0]);if(!h){const x=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,x,t)}let m=this.filterReplacedPrimary(h,t);if(!m&&h){const x=h.sn-t.startSN;m=this.filterReplacedPrimary(i[x+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===Ut.OK||i===Ut.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,a){let c=null;if(e.gap&&(c=this.getNextFragment(this.nextLoadPosition,t),c&&!c.gap&&i.nextStart)){const d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(d!==null&&i.len+d.len>=a){const h=c.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,c}get primaryPrefetch(){if(Up(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Up(this.config)&&e.type!==ve.SUBTITLE){const i=this.hls.interstitialsManager,r=i==null?void 0:i.bufferingItem;if(r){const c=r.event;if(c){if(c.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const a=i==null?void 0:i.playerQueue;if(a)for(let c=a.length;c--;){const d=a[c].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,a=!1,c=!0;for(let d=0,h=e.length;d<h;d++){const f=e[d];if(c=c&&!f.independent,r>-1&&i<f.start)break;const m=f.loaded;m?r=-1:(a||(f.independent||c)&&f.fragment===t)&&(f.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${f.start}`),r=d),a=m}return r}loadedEndOfParts(e,t){let i;for(let r=e.length;r--;){if(i=e[r],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=eA(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const a=i.sn+1;if(a>=e.startSN&&a<=e.endSN){const c=t[a-e.startSN];i.cc===c.cc&&(r=c,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=ey(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(r=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:a}=this,{fragments:c,endSN:d}=i;const{fragmentHint:h}=i,{maxFragLookUpTolerance:f}=r,m=i.partList,x=!!(this.loadingParts&&m!=null&&m.length&&h);x&&!this.bitrateTest&&m[m.length-1].fragment.sn===h.sn&&(c=c.concat(h),d=h.sn);let v;if(e<t){var b;const A=e<this.lastCurrentTime||e>t-f||(b=this.media)!=null&&b.paused||!this.startFragRequested?0:f;v=Nn(a,c,e,A)}else v=c[c.length-1];if(v){const S=v.sn-i.startSN,A=this.fragmentTracker.getState(v);if((A===Ut.OK||A===Ut.PARTIAL&&v.gap)&&(a=v),a&&v.sn===a.sn&&(!x||m[0].fragment.sn>v.sn||!i.live)&&v.level===a.level){const _=c[S+1];v.sn<d&&this.fragmentTracker.getState(_)!==Ut.OK?v=_:v=null}}return v}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const a=e.fragmentStart,c=!t,d=e.alignedSliding&&ye(a);if(c||!d&&!a){jA(i,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),h}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const r=this.timelineOffset;if(i===-1){const a=this.startTimeOffset!==null,c=a?this.startTimeOffset:e.startTimeOffset;c!==null&&ye(c)?(i=t+c,c<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${c} found in ${a?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&wt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ae.FRAG_LOADING_WAITING_RETRY)&&(this.state=ae.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const _=this.getCurrentContext(t.chunkMeta);_&&(t.frag=_.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var a;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}const c=t.details===K.FRAG_GAP;c&&this.fragmentTracker.fragBuffered(r,!0);const d=t.errorAction;if(!d){this.state=ae.ERROR;return}const{action:h,flags:f,retryCount:m=0,retryConfig:x}=d,v=!!x,b=v&&h===Xt.RetryRequest,S=v&&!d.resolved&&f===Es.MoveAllAlternatesMatchingHost,A=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!b&&S&&wt(r)&&!r.endList&&A&&!sy(t))this.resetFragmentErrors(e),this.treatAsGap(r),d.resolved=!0;else if((b||S)&&m<x.maxNumRetry){var E;const _=Vd((E=t.response)==null?void 0:E.code),R=xf(x,m);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+R,this.state=ae.FRAG_LOADING_WAITING_RETRY,d.resolved=!0,_){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${m+1}/${x.maxNumRetry} in ${R}ms`)}else if(x)if(this.resetFragmentErrors(e),m<x.maxNumRetry)!c&&h!==Xt.RemoveAlternatePermanently&&(d.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${m})`);return}else h===Xt.SendAlternateToPenaltyBox?this.state=ae.WAITING_LEVEL:this.state=ae.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!Vd(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ae.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ae.PARSING||this.state===ae.PARSED){const t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const c=!a;return c&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),c}return!1}resetFragmentErrors(e){e===ve.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ae.STOPPED&&(this.state=ae.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=Oe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===ae.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ae.STOPPED&&(this.state=ae.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){const a=i.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,f)=>{const m=e.elementaryStreams[f];if(m){const x=m.endPTS-m.startPTS;if(x<=0)return this.warn(`Could not parse fragment ${e.sn} ${f} duration reliably (${x})`),h||!1;const v=r?0:dy(a,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:a,level:i,drift:v,type:f,frag:e,start:m.startPTS,end:m.endPTS}),!0}return h},!1)){var d;const h=((d=this.transmuxer)==null?void 0:d.error)===null;if((i.fragmentError===0||h&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),h){const f=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ae.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ve.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,a;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((a=t&&!i?e.endPTS:(i||e).end)!=null?a:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Up(o){return!!o.interstitialsController&&o.enableInterstitialPlayback!==!1}class vy{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=FA(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function FA(o,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<o.length;r++){const a=o[r];t.set(a,i),i+=a.length}return t}var xd={exports:{}},Fp;function BA(){return Fp||(Fp=1,(function(o){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(h,f,m){this.fn=h,this.context=f,this.once=m||!1}function a(h,f,m,x,v){if(typeof m!="function")throw new TypeError("The listener must be a function");var b=new r(m,x||h,v),S=t?t+f:f;return h._events[S]?h._events[S].fn?h._events[S]=[h._events[S],b]:h._events[S].push(b):(h._events[S]=b,h._eventsCount++),h}function c(h,f){--h._eventsCount===0?h._events=new i:delete h._events[f]}function d(){this._events=new i,this._eventsCount=0}d.prototype.eventNames=function(){var f=[],m,x;if(this._eventsCount===0)return f;for(x in m=this._events)e.call(m,x)&&f.push(t?x.slice(1):x);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(m)):f},d.prototype.listeners=function(f){var m=t?t+f:f,x=this._events[m];if(!x)return[];if(x.fn)return[x.fn];for(var v=0,b=x.length,S=new Array(b);v<b;v++)S[v]=x[v].fn;return S},d.prototype.listenerCount=function(f){var m=t?t+f:f,x=this._events[m];return x?x.fn?1:x.length:0},d.prototype.emit=function(f,m,x,v,b,S){var A=t?t+f:f;if(!this._events[A])return!1;var E=this._events[A],_=arguments.length,R,D;if(E.fn){switch(E.once&&this.removeListener(f,E.fn,void 0,!0),_){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,m),!0;case 3:return E.fn.call(E.context,m,x),!0;case 4:return E.fn.call(E.context,m,x,v),!0;case 5:return E.fn.call(E.context,m,x,v,b),!0;case 6:return E.fn.call(E.context,m,x,v,b,S),!0}for(D=1,R=new Array(_-1);D<_;D++)R[D-1]=arguments[D];E.fn.apply(E.context,R)}else{var k=E.length,O;for(D=0;D<k;D++)switch(E[D].once&&this.removeListener(f,E[D].fn,void 0,!0),_){case 1:E[D].fn.call(E[D].context);break;case 2:E[D].fn.call(E[D].context,m);break;case 3:E[D].fn.call(E[D].context,m,x);break;case 4:E[D].fn.call(E[D].context,m,x,v);break;default:if(!R)for(O=1,R=new Array(_-1);O<_;O++)R[O-1]=arguments[O];E[D].fn.apply(E[D].context,R)}}return!0},d.prototype.on=function(f,m,x){return a(this,f,m,x,!1)},d.prototype.once=function(f,m,x){return a(this,f,m,x,!0)},d.prototype.removeListener=function(f,m,x,v){var b=t?t+f:f;if(!this._events[b])return this;if(!m)return c(this,b),this;var S=this._events[b];if(S.fn)S.fn===m&&(!v||S.once)&&(!x||S.context===x)&&c(this,b);else{for(var A=0,E=[],_=S.length;A<_;A++)(S[A].fn!==m||v&&!S[A].once||x&&S[A].context!==x)&&E.push(S[A]);E.length?this._events[b]=E.length===1?E[0]:E:c(this,b)}return this},d.prototype.removeAllListeners=function(f){var m;return f?(m=t?t+f:f,this._events[m]&&c(this,m)):(this._events=new i,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=t,d.EventEmitter=d,o.exports=d})(xd)),xd.exports}var $A=BA(),Tf=fT($A);const ja="1.6.15",Nr={};function GA(){return typeof __HLS_WORKER_BUNDLE__=="function"}function zA(){const o=Nr[ja];if(o)return o.clientCount++,o;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Nr[ja]=r,r}function HA(o){const e=Nr[o];if(e)return e.clientCount++,e;const t=new self.URL(o,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Nr[o]=r,r}function VA(o){const e=Nr[o||ja];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete Nr[o||ja],r&&self.URL.revokeObjectURL(r),i.terminate()}}function by(o,e){return e+10<=o.length&&o[e]===51&&o[e+1]===68&&o[e+2]===73&&o[e+3]<255&&o[e+4]<255&&o[e+6]<128&&o[e+7]<128&&o[e+8]<128&&o[e+9]<128}function Af(o,e){return e+10<=o.length&&o[e]===73&&o[e+1]===68&&o[e+2]===51&&o[e+3]<255&&o[e+4]<255&&o[e+6]<128&&o[e+7]<128&&o[e+8]<128&&o[e+9]<128}function Ho(o,e){let t=0;return t=(o[e]&127)<<21,t|=(o[e+1]&127)<<14,t|=(o[e+2]&127)<<7,t|=o[e+3]&127,t}function Ua(o,e){const t=e;let i=0;for(;Af(o,e);){i+=10;const r=Ho(o,e+6);i+=r,by(o,e+10)&&(i+=10),e+=i}if(i>0)return o.subarray(t,t+i)}function KA(o,e,t,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=e[t+2],c=a>>2&15;if(c>12){const b=new Error(`invalid ADTS sampling index:${c}`);o.emit(L.ERROR,L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!0,error:b,reason:b.message});return}const d=(a>>6&3)+1,h=e[t+3]>>6&3|(a&1)<<2,f="mp4a.40."+d,m=r[c];let x=c;(d===5||d===29)&&(x-=3);const v=[d<<3|(x&14)>>1,(x&1)<<7|h<<3];return st.log(`manifest codec:${i}, parsed codec:${f}, channels:${h}, rate:${m} (ADTS object type:${d} sampling index:${c})`),{config:v,samplerate:m,channelCount:h,codec:f,parsedCodec:f,manifestCodec:i}}function Sy(o,e){return o[e]===255&&(o[e+1]&246)===240}function Ey(o,e){return o[e+1]&1?7:9}function Lf(o,e){return(o[e+3]&3)<<11|o[e+4]<<3|(o[e+5]&224)>>>5}function YA(o,e){return e+5<o.length}function Fo(o,e){return e+1<o.length&&Sy(o,e)}function qA(o,e){return YA(o,e)&&Sy(o,e)&&Lf(o,e)<=o.length-e}function XA(o,e){if(Fo(o,e)){const t=Ey(o,e);if(e+t>=o.length)return!1;const i=Lf(o,e);if(i<=t)return!1;const r=e+i;return r===o.length||Fo(o,r)}return!1}function Ty(o,e,t,i,r){if(!o.samplerate){const a=KA(e,t,i,r);if(!a)return;ot(o,a)}}function Ay(o){return 1024*9e4/o}function QA(o,e){const t=Ey(o,e);if(e+t<=o.length){const i=Lf(o,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function Ly(o,e,t,i,r){const a=Ay(o.samplerate),c=i+r*a,d=QA(e,t);let h;if(d){const{frameLength:x,headerLength:v}=d,b=v+x,S=Math.max(0,t+b-e.length);S?(h=new Uint8Array(b-v),h.set(e.subarray(t+v,e.length),0)):h=e.subarray(t+v,t+b);const A={unit:h,pts:c};return S||o.samples.push(A),{sample:A,length:b,missing:S}}const f=e.length-t;return h=new Uint8Array(f),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:c},length:f,missing:-1}}function WA(o,e){return Af(o,e)&&Ho(o,e+6)+10<=o.length-e}function ZA(o){return o instanceof ArrayBuffer?o:o.byteOffset==0&&o.byteLength==o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer}function yd(o,e=0,t=1/0){return JA(o,e,t,Uint8Array)}function JA(o,e,t,i){const r=eL(o);let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const c=tL(o)?o.byteOffset:0,d=(c+o.byteLength)/a,h=(c+e)/a,f=Math.floor(Math.max(0,Math.min(h,d))),m=Math.floor(Math.min(f+Math.max(t,0),d));return new i(r,f,m-f)}function eL(o){return o instanceof ArrayBuffer?o:o.buffer}function tL(o){return o&&o.buffer instanceof ArrayBuffer&&o.byteLength!==void 0&&o.byteOffset!==void 0}function sL(o){const e={key:o.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(o.size<2)return;if(o.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=o.data.subarray(1).indexOf(0);if(i===-1)return;const r=ws(yd(o.data,1,i)),a=o.data[2+i],c=o.data.subarray(3+i).indexOf(0);if(c===-1)return;const d=ws(yd(o.data,3+i,c));let h;return r==="-->"?h=ws(yd(o.data,4+i+c)):h=ZA(o.data.subarray(4+i+c)),e.mimeType=r,e.pictureType=a,e.description=d,e.data=h,e}function iL(o){if(o.size<2)return;const e=ws(o.data,!0),t=new Uint8Array(o.data.subarray(e.length+1));return{key:o.type,info:e,data:t.buffer}}function nL(o){if(o.size<2)return;if(o.type==="TXXX"){let t=1;const i=ws(o.data.subarray(t),!0);t+=i.length+1;const r=ws(o.data.subarray(t));return{key:o.type,info:i,data:r}}const e=ws(o.data.subarray(1));return{key:o.type,info:"",data:e}}function rL(o){if(o.type==="WXXX"){if(o.size<2)return;let t=1;const i=ws(o.data.subarray(t),!0);t+=i.length+1;const r=ws(o.data.subarray(t));return{key:o.type,info:i,data:r}}const e=ws(o.data);return{key:o.type,info:"",data:e}}function aL(o){return o.type==="PRIV"?iL(o):o.type[0]==="W"?rL(o):o.type==="APIC"?sL(o):nL(o)}function lL(o){const e=String.fromCharCode(o[0],o[1],o[2],o[3]),t=Ho(o,4),i=10;return{type:e,size:t,data:o.subarray(i,i+t)}}const lo=10,oL=10;function _y(o){let e=0;const t=[];for(;Af(o,e);){const i=Ho(o,e+6);o[e+5]>>6&1&&(e+=lo),e+=lo;const r=e+i;for(;e+oL<r;){const a=lL(o.subarray(e)),c=aL(a);c&&t.push(c),e+=a.size+lo}by(o,e)&&(e+=lo)}return t}function Ry(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"}function cL(o){if(o.data.byteLength===8){const e=new Uint8Array(o.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function _f(o){const e=_y(o);for(let t=0;t<e.length;t++){const i=e[t];if(Ry(i))return cL(i)}}let Ls=(function(o){return o.audioId3="org.id3",o.dateRange="com.apple.quicktime.HLS",o.emsg="https://aomedia.org/emsg/ID3",o.misbklv="urn:misb:KLV:bin:1910.1",o})({});function si(o="",e=9e4){return{type:o,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Rf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=$s(this.cachedData,e),this.cachedData=null);let i=Ua(e,0),r=i?i.length:0,a;const c=this._audioTrack,d=this._id3Track,h=i?_f(i):void 0,f=e.length;for((this.basePTS===null||this.frameIndex===0&&ye(h))&&(this.basePTS=uL(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ls.audioId3,duration:Number.POSITIVE_INFINITY});r<f;){if(this.canParse(e,r)){const m=this.appendFrame(c,e,r);m?(this.frameIndex++,this.lastPTS=m.sample.pts,r+=m.length,a=r):r=f}else WA(e,r)?(i=Ua(e,r),d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ls.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,a=r):r++;if(r===f&&a!==f){const m=e.slice(a);this.cachedData?this.cachedData=$s(this.cachedData,m):this.cachedData=m}}return{audioTrack:c,videoTrack:si(),id3Track:d,textTrack:si()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:si(),id3Track:this._id3Track,textTrack:si()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const uL=(o,e,t)=>{if(ye(o))return o*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let oo=null;const dL=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],fL=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],hL=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],mL=[0,1,1,4];function wy(o,e,t,i,r){if(t+24>e.length)return;const a=Dy(e,t);if(a&&t+a.frameLength<=e.length){const c=a.samplesPerFrame*9e4/a.sampleRate,d=i+r*c,h={unit:e.subarray(t,t+a.frameLength),pts:d,dts:d};return o.config=[],o.channelCount=a.channelCount,o.samplerate=a.sampleRate,o.samples.push(h),{sample:h,length:a.frameLength,missing:0}}}function Dy(o,e){const t=o[e+1]>>3&3,i=o[e+1]>>1&3,r=o[e+2]>>4&15,a=o[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&a!==3){const c=o[e+2]>>1&1,d=o[e+3]>>6,h=t===3?3-i:i===3?3:4,f=dL[h*14+r-1]*1e3,x=fL[(t===3?0:t===2?1:2)*3+a],v=d===3?1:2,b=hL[t][i],S=mL[i],A=b*8*S,E=Math.floor(b*f/x+c)*S;if(oo===null){const D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);oo=D?parseInt(D[1]):0}return!!oo&&oo<=87&&i===2&&f>=224e3&&d===0&&(o[e+3]=o[e+3]|128),{sampleRate:x,channelCount:v,frameLength:E,samplesPerFrame:A}}}function wf(o,e){return o[e]===255&&(o[e+1]&224)===224&&(o[e+1]&6)!==0}function Iy(o,e){return e+1<o.length&&wf(o,e)}function gL(o,e){return wf(o,e)&&4<=o.length-e}function Cy(o,e){if(e+1<o.length&&wf(o,e)){const i=Dy(o,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const a=e+r;return a===o.length||Iy(o,a)}return!1}class pL extends Rf{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Ua(e,0);let r=(i==null?void 0:i.length)||0;if(Cy(e,r))return!1;for(let a=e.length;r<a;r++)if(XA(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return qA(e,t)}appendFrame(e,t,i){Ty(e,this.observer,t,i,e.manifestCodec);const r=Ly(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Ny=(o,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),a=new Uint32Array(1),c=new Uint8Array(1);for(;i>0;){c[0]=o[e];const d=Math.min(i,8),h=8-d;a[0]=4278190080>>>24+h<<h,r[0]=(c[0]&a[0])>>h,t=t?t<<d|r[0]:r[0],e+=1,i-=d}return t};class xL extends Rf{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=ky(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Ua(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&_f(t)!==void 0&&Ny(e,i)<16}}function ky(o,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const a=e[t+4]>>6;if(a>=3)return-1;const d=[48e3,44100,32e3][a],h=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+a]*2;if(t+m>e.length)return-1;const x=e[t+6]>>5;let v=0;x===2?v+=2:(x&1&&x!==1&&(v+=2),x&4&&(v+=2));const b=(e[t+6]<<8|e[t+7])>>12-v&1,A=[2,1,2,3,3,4,4,5][x]+b,E=e[t+5]>>3,_=e[t+5]&7,R=new Uint8Array([a<<6|E<<1|_>>2,(_&3)<<6|x<<3|b<<2|h>>4,h<<4&224]),D=1536/d*9e4,k=i+r*D,O=e.subarray(t,t+m);return o.config=R,o.channelCount=A,o.samplerate=d,o.samples.push({unit:O,pts:k}),m}class yL extends Rf{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ua(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&_f(t)!==void 0&&Ny(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(Cy(e,i))return st.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return gL(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return wy(e,t,i,this.basePTS,this.frameIndex)}}const vL=/\/emsg[-/]ID3/i;class bL{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const a=this.videoTrack=si("video",1),c=this.audioTrack=si("audio",1),d=this.txtTrack=si("text",1);if(this.id3Track=si("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=zx(e);if(h.video){const{id:f,timescale:m,codec:x,supplemental:v}=h.video;a.id=f,a.timescale=d.timescale=m,a.codec=x,a.supplemental=v}if(h.audio){const{id:f,timescale:m,codec:x}=h.audio;c.id=f,c.timescale=m,c.codec=x}d.id=Bx.text,a.sampleDuration=0,a.duration=c.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return xT(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=$s(this.remainderData,e));const d=AT(i);this.remainderData=d.remainder,r.samples=d.valid||new Uint8Array}else r.samples=i;const c=this.extractID3Track(r,t);return a.samples=ip(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=ip(e,t),{videoTrack:t,audioTrack:si(),id3Track:r,textTrack:si()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=Be(e.samples,["emsg"]);r&&r.forEach(a=>{const c=_T(a);if(vL.test(c.schemeIdUri)){const d=Bp(c,t);let h=c.eventDuration===4294967295?Number.POSITIVE_INFINITY:c.eventDuration/c.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const f=c.payload;i.samples.push({data:f,len:f.byteLength,dts:d,pts:d,type:Ls.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&c.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const d=Bp(c,t);i.samples.push({data:c.payload,len:c.payload.byteLength,dts:d,pts:d,type:Ls.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Bp(o,e){return ye(o.presentationTime)?o.presentationTime/o.timeScale:e+o.presentationTimeDelta/o.timeScale}class SL{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new yf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,on.cbc)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const a=r.subarray(16,r.length-r.length%16),c=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(c).then(d=>{const h=new Uint8Array(d);r.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)i.set(e.subarray(a,a+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)e.set(i.subarray(r,r+16),a);return e}decryptAvcSample(e,t,i,r,a){const c=Kx(a.data),d=this.getAvcEncryptedData(c);this.decryptBuffer(d.buffer).then(h=>{a.data=this.getAvcDecryptedUnit(c,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}).catch(r)}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const a=e[t].units;for(;!(i>=a.length);i++){const c=a[i];if(!(c.data.length<=48||c.type!==1&&c.type!==5)&&(this.decryptAvcSample(e,t,i,r,c),!this.decrypter.isSync()))return}}}}class My{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const a=i.units;r=a[a.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const a=i[r-1];e.pts=a.pts,e.dts=a.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const r=t.byteLength;let a=e.naluState||0;const c=a,d=[];let h=0,f,m,x,v=-1,b=0;for(a===-1&&(v=0,b=this.getNALuType(t,0),a=0,h=1);h<r;){if(f=t[h++],!a){a=f?0:1;continue}if(a===1){a=f?0:2;continue}if(!f)a=3;else if(f===1){if(m=h-a-1,v>=0){const S={data:t.subarray(v,m),type:b};d.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(c&&h<=4-c&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-c)),m>0&&(S.data=$s(S.data,t.subarray(0,m)),S.state=0))}h<r?(x=this.getNALuType(t,h),v=h,b=x,a=0):a=-1}else a=0}if(v>=0&&a>=0){const S={data:t.subarray(v,r),type:b,state:a};d.push(S)}if(d.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=$s(S.data,t))}return e.naluState=a,d}}class Da{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");r.set(e.subarray(i,i+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&st.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class EL extends My{parsePES(e,t,i,r){const a=this.parseNALu(e,i.data,r);let c=this.VideoSample,d,h=!1;i.data=null,c&&a.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.forEach(f=>{var m,x;switch(f.type){case 1:{let A=!1;d=!0;const E=f.data;if(h&&E.length>4){const _=this.readSliceType(E);(_===2||_===4||_===7||_===9)&&(A=!0)}if(A){var v;(v=c)!=null&&v.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),c.frame=!0,c.key=A;break}case 5:d=!0,(m=c)!=null&&m.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),c.key=!0,c.frame=!0;break;case 6:{d=!0,mf(f.data,1,i.pts,t.samples);break}case 7:{var b,S;d=!0,h=!0;const A=f.data,E=this.readSPS(A);if(!e.sps||e.width!==E.width||e.height!==E.height||((b=e.pixelRatio)==null?void 0:b[0])!==E.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[A];const _=A.subarray(1,4);let R="avc1.";for(let D=0;D<3;D++){let k=_[D].toString(16);k.length<2&&(k="0"+k),R+=k}e.codec=R}break}case 8:d=!0,e.pps=[f.data];break;case 9:d=!0,e.audFound=!0,(x=c)!=null&&x.frame&&(this.pushAccessUnit(c,e),c=null),c||(c=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:d=!0;break;default:d=!1;break}c&&d&&c.units.push(f)}),r&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Da(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,a;for(let c=0;c<e;c++)r!==0&&(a=t.readEG(),r=(i+a+256)%256),i=r===0?i:r}readSPS(e){const t=new Da(e);let i=0,r=0,a=0,c=0,d,h,f;const m=t.readUByte.bind(t),x=t.readBits.bind(t),v=t.readUEG.bind(t),b=t.readBoolean.bind(t),S=t.skipBits.bind(t),A=t.skipEG.bind(t),E=t.skipUEG.bind(t),_=this.skipScalingList.bind(this);m();const R=m();if(x(5),S(3),m(),E(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const B=v();if(B===3&&S(1),E(),E(),S(1),b())for(h=B!==3?8:12,f=0;f<h;f++)b()&&(f<6?_(16,t):_(64,t))}E();const D=v();if(D===0)v();else if(D===1)for(S(1),A(),A(),d=v(),f=0;f<d;f++)A();E(),S(1);const k=v(),O=v(),F=x(1);F===0&&S(1),S(1),b()&&(i=v(),r=v(),a=v(),c=v());let N=[1,1];if(b()&&b())switch(m()){case 1:N=[1,1];break;case 2:N=[12,11];break;case 3:N=[10,11];break;case 4:N=[16,11];break;case 5:N=[40,33];break;case 6:N=[24,11];break;case 7:N=[20,11];break;case 8:N=[32,11];break;case 9:N=[80,33];break;case 10:N=[18,11];break;case 11:N=[15,11];break;case 12:N=[64,33];break;case 13:N=[160,99];break;case 14:N=[4,3];break;case 15:N=[3,2];break;case 16:N=[2,1];break;case 255:{N=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((k+1)*16-i*2-r*2),height:(2-F)*(O+1)*16-(F?2:4)*(a+c),pixelRatio:N}}}class TL extends My{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){const a=this.parseNALu(e,i.data,r);let c=this.VideoSample,d,h=!1;i.data=null,c&&a.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.forEach(f=>{var m,x;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:c||(c=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),c.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,h){var v;(v=c)!=null&&v.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),c.key=!0,c.frame=!0;break;case 19:case 20:d=!0,(m=c)!=null&&m.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),c.key=!0,c.frame=!0;break;case 39:d=!0,mf(f.data,2,i.pts,t.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ot(e.params,this.readVPS(f.data)),this.initVPS=f.data),e.vps=[f.data];break;case 33:if(d=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],f.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const b=this.readSPS(f.data);e.width=b.width,e.height=b.height,e.pixelRatio=b.pixelRatio,e.codec=b.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in b.params)e.params[S]=b.params[S]}this.pushParameterSet(e.sps,f.data,e.vps),c||(c=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),c.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const b=this.readPPS(f.data);for(const S in b)e.params[S]=b[S]}this.pushParameterSet(e.pps,f.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(x=c)!=null&&x.frame&&(this.pushAccessUnit(c,e),c=null),c||(c=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:d=!1;break}c&&d&&c.units.push(f)}),r&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Da(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const t=new Da(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const r=t.readBits(2),a=t.readBoolean(),c=t.readBits(5),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),m=t.readUByte(),x=t.readUByte(),v=t.readUByte(),b=t.readUByte(),S=t.readUByte(),A=t.readUByte(),E=t.readUByte(),_=t.readUByte(),R=[],D=[];for(let le=0;le<i;le++)R.push(t.readBoolean()),D.push(t.readBoolean());if(i>0)for(let le=i;le<8;le++)t.readBits(2);for(let le=0;le<i;le++)R[le]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),D[le]&&t.readUByte();t.readUEG();const k=t.readUEG();k==3&&t.skipBits(1);const O=t.readUEG(),F=t.readUEG(),N=t.readBoolean();let B=0,C=0,P=0,W=0;N&&(B+=t.readUEG(),C+=t.readUEG(),P+=t.readUEG(),W+=t.readUEG());const ue=t.readUEG(),me=t.readUEG(),ee=t.readUEG(),ce=t.readBoolean();for(let le=ce?0:i;le<=i;le++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Te=0;Te<4;Te++)for(let Ye=0;Ye<(Te===3?2:6);Ye++)if(!t.readBoolean())t.readUEG();else{const Fe=Math.min(64,1<<4+(Te<<1));Te>1&&t.readEG();for(let pe=0;pe<Fe;pe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const se=t.readUEG();let de=0;for(let le=0;le<se;le++){let Te=!1;if(le!==0&&(Te=t.readBoolean()),Te){le===se&&t.readUEG(),t.readBoolean(),t.readUEG();let Ye=0;for(let ke=0;ke<=de;ke++){const Fe=t.readBoolean();let pe=!1;Fe||(pe=t.readBoolean()),(Fe||pe)&&Ye++}de=Ye}else{const Ye=t.readUEG(),ke=t.readUEG();de=Ye+ke;for(let Fe=0;Fe<Ye;Fe++)t.readUEG(),t.readBoolean();for(let Fe=0;Fe<ke;Fe++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const le=t.readUEG();for(let Te=0;Te<le;Te++){for(let Ye=0;Ye<ee+4;Ye++)t.readBits(1);t.readBits(1)}}let I=0,M=1,G=1,Z=!0,re=1,V=0;t.readBoolean(),t.readBoolean();let ge=!1;if(t.readBoolean()){if(t.readBoolean()){const be=t.readUByte(),Xe=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ge=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];be>0&&be<16?(M=Xe[be-1],G=Ge[be-1]):be===255&&(M=t.readBits(16),G=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ge=t.readBoolean(),ge&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(re=t.readBits(32),V=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ge=t.readBoolean(),Zt=t.readBoolean();let nt=!1;(Ge||Zt)&&(nt=t.readBoolean(),nt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),nt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Jt=0;Jt<=i;Jt++){Z=t.readBoolean();const gt=Z||t.readBoolean();let xt=!1;gt?t.readEG():xt=t.readBoolean();const Ft=xt?1:t.readUEG()+1;if(Ge)for(let Lt=0;Lt<Ft;Lt++)t.readUEG(),t.readUEG(),nt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Zt)for(let Lt=0;Lt<Ft;Lt++)t.readUEG(),t.readUEG(),nt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),I=t.readUEG())}let Ae=O,Ce=F;if(N){let le=1,Te=1;k===1?le=Te=2:k==2&&(le=2),Ae=O-le*C-le*B,Ce=F-Te*W-Te*P}const it=r?["A","B","C"][r]:"",Mt=d<<24|h<<16|f<<8|m;let bt=0;for(let le=0;le<32;le++)bt=(bt|(Mt>>le&1)<<31-le)>>>0;let ft=bt.toString(16);return c===1&&ft==="2"&&(ft="6"),{codecString:`hvc1.${it}${c}.${ft}.${a?"H":"L"}${_}.B0`,params:{general_tier_flag:a,general_profile_idc:c,general_profile_space:r,general_profile_compatibility_flags:[d,h,f,m],general_constraint_indicator_flags:[x,v,b,S,A,E],general_level_idc:_,bit_depth:ue+8,bit_depth_luma_minus8:ue,bit_depth_chroma_minus8:me,min_spatial_segmentation_idc:I,chroma_format_idc:k,frame_rate:{fixed:Z,fps:V/re}},width:Ae,height:Ce,pixelRatio:[M,G]}}readPPS(e){const t=new Da(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),a=t.readBoolean();let c=1;return a&&r?c=0:a?c=3:r&&(c=2),{parallelismType:c}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const zt=188;class rn{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){const i=rn.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(zt*5,t-zt)+1,r=0;for(;r<i;){let a=!1,c=-1,d=0;for(let h=r;h<t;h+=zt)if(e[h]===71&&(t-h===zt||e[h+zt]===71)){if(d++,c===-1&&(c=h,c!==0&&(i=Math.min(c+zt*99,e.length-zt)+1)),a||(a=Qd(e,h)===0),a&&d>1&&(c===0&&d>2||h+zt>i))return c}else{if(d)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Bx[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=rn.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=rn.createTrack("audio",r),this._id3Track=rn.createTrack("id3"),this._txtTrack=rn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let a;const c=this._videoTrack,d=this._audioTrack,h=this._id3Track,f=this._txtTrack;let m=c.pid,x=c.pesData,v=d.pid,b=h.pid,S=d.pesData,A=h.pesData,E=null,_=this.pmtParsed,R=this._pmtId,D=e.length;if(this.remainderData&&(e=$s(this.remainderData,e),D=e.length,this.remainderData=null),D<zt&&!r)return this.remainderData=e,{audioTrack:d,videoTrack:c,id3Track:h,textTrack:f};const k=Math.max(0,rn.syncOffset(e));D-=(D-k)%zt,D<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,D,e.buffer.byteLength-D));let O=0;for(let N=k;N<D;N+=zt)if(e[N]===71){const B=!!(e[N+1]&64),C=Qd(e,N),P=(e[N+3]&48)>>4;let W;if(P>1){if(W=N+5+e[N+4],W===N+zt)continue}else W=N+4;switch(C){case m:B&&(x&&(a=Er(x,this.logger))&&(this.readyVideoParser(c.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(c,f,a,!1)),x={data:[],size:0}),x&&(x.data.push(e.subarray(W,N+zt)),x.size+=N+zt-W);break;case v:if(B){if(S&&(a=Er(S,this.logger)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,a);break;case"mp3":this.parseMPEGPES(d,a);break;case"ac3":this.parseAC3PES(d,a);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(W,N+zt)),S.size+=N+zt-W);break;case b:B&&(A&&(a=Er(A,this.logger))&&this.parseID3PES(h,a),A={data:[],size:0}),A&&(A.data.push(e.subarray(W,N+zt)),A.size+=N+zt-W);break;case 0:B&&(W+=e[W]+1),R=this._pmtId=AL(e,W);break;case R:{B&&(W+=e[W]+1);const ue=LL(e,W,this.typeSupported,i,this.observer,this.logger);m=ue.videoPid,m>0&&(c.pid=m,c.segmentCodec=ue.segmentVideoCodec),v=ue.audioPid,v>0&&(d.pid=v,d.segmentCodec=ue.segmentAudioCodec),b=ue.id3Pid,b>0&&(h.pid=b),E!==null&&!_&&(this.logger.warn(`MPEG-TS PMT found at ${N} after unknown PID '${E}'. Backtracking to sync byte @${k} to parse all TS packets.`),E=null,N=k-188),_=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=C;break}}else O++;O>0&&Wd(this.observer,new Error(`Found ${O} TS packet/s that do not start with 0x47`),void 0,this.logger),c.pesData=x,d.pesData=S,h.pesData=A;const F={audioTrack:d,videoTrack:c,id3Track:h,textTrack:f};return r&&this.extractRemainingSamples(F),F}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:a}=e,c=i.pesData,d=t.pesData,h=r.pesData;let f;if(c&&(f=Er(c,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,a,f,!0),i.pesData=null)):i.pesData=c,d&&(f=Er(d,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,f);break;case"mp3":this.parseMPEGPES(t,f);break;case"ac3":this.parseAC3PES(t,f);break}t.pesData=null}else d!=null&&d.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=d;h&&(f=Er(h,this.logger))?(this.parseID3PES(r,f),r.pesData=null):r.pesData=h}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),a=this.sampleAes=new SL(this.observer,this.config,t);return this.decrypt(r,a)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new EL:e==="hevc"&&(this.videoParser=new TL))}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:a}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{i(e)}):i(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let a=t.data;if(r){this.aacOverFlow=null;const x=r.missing,v=r.sample.unit.byteLength;if(x===-1)a=$s(r.sample.unit,a);else{const b=v-x;r.sample.unit.set(a.subarray(0,x),b),e.samples.push(r.sample),i=r.missing}}let c,d;for(c=i,d=a.length;c<d-1&&!Fo(a,c);c++);if(c!==i){let x;const v=c<d-1;if(v?x=`AAC PES did not start with ADTS header,offset:${c}`:x="No ADTS header found in AAC PES",Wd(this.observer,new Error(x),v,this.logger),!v)return}Ty(e,this.observer,a,c,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(r){const x=Ay(e.samplerate);h=r.sample.pts+x}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,m;for(;c<d;)if(m=Ly(e,a,c,h,f),c+=m.length,m.missing){this.aacOverFlow=m;break}else for(f++;c<d-1&&!Fo(a,c);c++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let a=0,c=0;const d=t.pts;if(d===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;c<r;)if(Iy(i,c)){const h=wy(e,i,c,d,a);if(h)c+=h.length,a++;else break}else c++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=i.length;let c=0,d=0,h;for(;d<a&&(h=ky(e,i,d,r,c++))>0;)d+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=ot({},t,{type:this._videoTrack?Ls.emsg:Ls.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function Qd(o,e){return((o[e+1]&31)<<8)+o[e+2]}function AL(o,e){return(o[e+10]&31)<<8|o[e+11]}function LL(o,e,t,i,r,a){const c={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},d=(o[e+1]&15)<<8|o[e+2],h=e+3+d-4,f=(o[e+10]&15)<<8|o[e+11];for(e+=12+f;e<h;){const m=Qd(o,e),x=(o[e+3]&15)<<8|o[e+4];switch(o[e]){case 207:if(!i){vd("ADTS AAC",a);break}case 15:c.audioPid===-1&&(c.audioPid=m);break;case 21:c.id3Pid===-1&&(c.id3Pid=m);break;case 219:if(!i){vd("H.264",a);break}case 27:c.videoPid===-1&&(c.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?a.log("MPEG audio found, not supported in this browser"):c.audioPid===-1&&(c.audioPid=m,c.segmentAudioCodec="mp3");break;case 193:if(!i){vd("AC-3",a);break}case 129:t.ac3?c.audioPid===-1&&(c.audioPid=m,c.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(c.audioPid===-1&&x>0){let v=e+5,b=x;for(;b>2;){switch(o[v]){case 106:t.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(c.audioPid=m,c.segmentAudioCodec="ac3");break}const A=o[v+1]+2;v+=A,b-=A}}break;case 194:case 135:return Wd(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),c;case 36:c.videoPid===-1&&(c.videoPid=m,c.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}e+=x+5}return c}function Wd(o,e,t,i){i.warn(`parsing error: ${e.message}`),o.emit(L.ERROR,L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function vd(o,e){e.log(`${o} with AES-128-CBC encryption found in unencrypted stream`)}function Er(o,e){let t=0,i,r,a,c,d;const h=o.data;if(!o||o.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=$s(h[0],h[1]),h.splice(1,1);if(i=h[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>o.size-6)return null;const m=i[7];m&192&&(c=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,m&64?(d=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,c-d>60*9e4&&(e.warn(`${Math.round((c-d)/9e4)}s delta between PTS and DTS, align them`),c=d)):d=c),a=i[8];let x=a+9;if(o.size<=x)return null;o.size-=x;const v=new Uint8Array(o.size);for(let b=0,S=h.length;b<S;b++){i=h[b];let A=i.byteLength;if(x)if(x>A){x-=A;continue}else i=i.subarray(x),A-=x,x=0;v.set(i,t),t+=A}return r&&(r-=a+3),{data:v,pts:c,dts:d,len:r}}return null}class _L{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const tn=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in H.types)H.types.hasOwnProperty(e)&&(H.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=a,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const c=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,c,h,c,d),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,r))}static box(e,...t){let i=8,r=t.length;const a=r;for(;r--;)i+=t[r].byteLength;const c=new Uint8Array(i);for(c[0]=i>>24&255,c[1]=i>>16&255,c[2]=i>>8&255,c[3]=i&255,c.set(e,4),r=0,i=8;r<a;r++)c.set(t[r],i),i+=t[r].byteLength;return c}static hdlr(e){return H.box(H.types.hdlr,H.HDLR_TYPES[e])}static mdat(e){return H.box(H.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(tn+1)),r=Math.floor(t%(tn+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return H.box(H.types.mdia,H.mdhd(e.timescale||0,e.duration||0),H.hdlr(e.type),H.minf(e))}static mfhd(e){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(e)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(e))}static moof(e,t,i){return H.box(H.types.moof,H.mfhd(e),H.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=H.trak(e[t]);return H.box.apply(null,[H.types.moov,H.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(H.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=H.trex(e[t]);return H.box.apply(null,[H.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(tn+1)),r=Math.floor(t%(tn+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,a)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,a;for(r=0;r<t.length;r++)a=t[r].flags,i[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return H.box(H.types.sdtp,i)}static stbl(e){return H.box(H.types.stbl,H.stsd(e),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(e){let t=[],i=[],r,a,c;for(r=0;r<e.sps.length;r++)a=e.sps[r],c=a.byteLength,t.push(c>>>8&255),t.push(c&255),t=t.concat(Array.prototype.slice.call(a));for(r=0;r<e.pps.length;r++)a=e.pps[r],c=a.byteLength,i.push(c>>>8&255),i.push(c&255),i=i.concat(Array.prototype.slice.call(a));const d=H.box(H.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),h=e.width,f=e.height,m=e.pixelRatio[0],x=e.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,x>>24,x>>16&255,x>>8&255,x&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return H.box(H.types.mp4a,H.audioStsd(e),H.box(H.types.esds,H.esds(e)))}static mp3(e){return H.box(H.types[".mp3"],H.audioStsd(e))}static ac3(e){return H.box(H.types["ac-3"],H.audioStsd(e),H.box(H.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return H.box(H.types.stsd,H.STSD,H.mp4a(e));if(t==="ac3"&&e.config)return H.box(H.types.stsd,H.STSD,H.ac3(e));if(t==="mp3"&&e.codec==="mp3")return H.box(H.types.stsd,H.STSD,H.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return H.box(H.types.stsd,H.STSD,H.avc1(e));if(t==="hevc"&&e.vps)return H.box(H.types.stsd,H.STSD,H.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,a=e.height||0,c=Math.floor(i/(tn+1)),d=Math.floor(i%(tn+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,a>>8&255,a&255,0,0]))}static traf(e,t){const i=H.sdtp(e),r=e.id,a=Math.floor(t/(tn+1)),c=Math.floor(t%(tn+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,c>>24,c>>16&255,c>>8&255,c&255])),H.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,H.box(H.types.trak,H.tkhd(e),H.mdia(e))}static trex(e){const t=e.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,a=12+16*r,c=new Uint8Array(a);let d,h,f,m,x,v;for(t+=8+a,c.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),d=0;d<r;d++)h=i[d],f=h.duration,m=h.size,x=h.flags,v=h.cts,c.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,x.isLeading<<2|x.dependsOn,x.isDependedOn<<6|x.hasRedundancy<<4|x.paddingValue<<1|x.isNonSync,x.degradPrio&61440,x.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*d);return H.box(H.types.trun,c)}static initSegment(e){H.types||H.init();const t=H.moov(e);return $s(H.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],r=4,a=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let c=a.length;for(let S=0;S<i.length;S+=1){c+=3;for(let A=0;A<i[S].length;A+=1)c+=2+i[S][A].length}const d=new Uint8Array(c);d.set(a,0),c=a.length;const h=i.length-1;for(let S=0;S<i.length;S+=1){d.set(new Uint8Array([32+S|(S===h?128:0),0,i[S].length]),c),c+=3;for(let A=0;A<i[S].length;A+=1)d.set(new Uint8Array([i[S][A].length>>8,i[S][A].length&255]),c),c+=2,d.set(i[S][A],c),c+=i[S][A].length}const f=H.box(H.types.hvcC,d),m=e.width,x=e.height,v=e.pixelRatio[0],b=e.pixelRatio[1];return H.box(H.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,x>>8&255,x&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,b>>24,b>>16&255,b>>8&255,b&255])))}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const Oy=9e4;function Df(o,e,t=1,i=!1){const r=o*e*t;return i?Math.round(r):r}function RL(o,e,t=1,i=!1){return Df(o,e,1/t,i)}function _a(o,e=!1){return Df(o,1e3,1/Oy,e)}function wL(o,e=1){return Df(o,Oy,1/e)}function $p(o){const{baseTime:e,timescale:t,trackId:i}=o;return`${e/t} (${e}/${t}) trackId: ${i}`}const DL=10*1e3,IL=1024,CL=1152,NL=1536;let Tr=null,bd=null;function Gp(o,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:o?2:1,isNonSync:o?0:1}}}class Eo extends Gs{constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Tr===null){const c=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Tr=c?parseInt(c[1]):0}if(bd===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);bd=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&$p(t)} > ${e&&$p(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,r=e.reduce((a,c)=>{let d=c.pts,h=d-a;return h<-4294967296&&(t=!0,d=Ts(d,i),h=d-a),h>0?a:d},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,a,c,d,h){let f,m,x,v,b,S,A=a,E=a;const _=e.pid>-1,R=t.pid>-1,D=t.samples.length,k=e.samples.length>0,O=d&&D>0||D>1;if((!_||k)&&(!R||O)||this.ISGenerated||d){if(this.ISGenerated){var N,B,C,P;const ee=this.videoTrackConfig;(ee&&(t.width!==ee.width||t.height!==ee.height||((N=t.pixelRatio)==null?void 0:N[0])!==((B=ee.pixelRatio)==null?void 0:B[0])||((C=t.pixelRatio)==null?void 0:C[1])!==((P=ee.pixelRatio)==null?void 0:P[1]))||!ee&&O||this.nextAudioTs===null&&k)&&this.resetInitSegment()}this.ISGenerated||(x=this.generateIS(e,t,a,c));const W=this.isVideoContiguous;let ue=-1,me;if(O&&(ue=kL(t.samples),!W&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,ue>0){this.warn(`Dropped ${ue} out of ${D} video samples due to a missing keyframe`);const ee=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ue),t.dropped+=ue,E+=(t.samples[0].pts-ee)/t.inputTimeScale,me=E}else ue===-1&&(this.warn(`No keyframe found out of ${D} video samples`),S=!1);if(this.ISGenerated){if(k&&O){const ee=this.getVideoStartPts(t.samples),j=(Ts(e.samples[0].pts,ee)-ee)/t.inputTimeScale;A+=Math.max(0,j),E+=Math.max(0,-j)}if(k){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),x=this.generateIS(e,t,a,c)),m=this.remuxAudio(e,A,this.isAudioContiguous,c,R||O||h===ve.AUDIO?E:void 0),O){const ee=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),x=this.generateIS(e,t,a,c)),f=this.remuxVideo(t,E,W,ee)}}else O&&(f=this.remuxVideo(t,E,W,0));f&&(f.firstKeyFrame=ue,f.independent=ue!==-1,f.firstKeyFramePTS=me)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(b=Py(i,a,this._initPTS,this._initDTS)),r.samples.length&&(v=jy(r,a,this._initPTS))),{audio:m,video:f,initSegment:x,independent:S,text:v,id3:b}}computeInitPts(e,t,i,r){const a=Math.round(i*t);let c=Ts(e,a);if(c<a+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(a-c)/t} ${r}`);c<a+t;)c+=8589934592;return c-a}generateIS(e,t,i,r){const a=e.samples,c=t.samples,d=this.typeSupported,h={},f=this._initPTS;let m=!f||r,x="audio/mp4",v,b,S,A=-1;if(m&&(v=b=1/0),e.config&&a.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":d.mpeg?(x="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:x,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&d.mpeg?new Uint8Array(0):H.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(A=e.id,S=e.inputTimeScale,!f||S!==f.timescale?v=b=this.computeInitPts(a[0].pts,S,i,"audio"):m=!1)}if(t.sps&&t.pps&&c.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:H.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(A=t.id,S=t.inputTimeScale,!f||S!==f.timescale){const E=this.getVideoStartPts(c),_=Ts(c[0].dts,E),R=this.computeInitPts(_,S,i,"video"),D=this.computeInitPts(E,S,i,"video");b=Math.min(b,R),v=Math.min(v,D)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,m?(f&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${v/S} != initPTS: ${f.baseTime/f.timescale} (${f.baseTime}/${f.timescale}) trackId: ${f.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${v/S} (${v}/${S}) trackId: ${A}`),this._initPTS={baseTime:v,timescale:S,trackId:A},this._initDTS={baseTime:b,timescale:S,trackId:A}):v=S=void 0,{tracks:h,initPTS:v,timescale:S,trackId:A}}remuxVideo(e,t,i,r){const a=e.inputTimeScale,c=e.samples,d=[],h=c.length,f=this._initPTS,m=f.baseTime*a/f.timescale;let x=this.nextVideoTs,v=8,b=this.videoSampleDuration,S,A,E=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,R=!1;if(!i||x===null){const I=m+t*a,M=c[0].pts-Ts(c[0].dts,c[0].pts);Tr&&x!==null&&Math.abs(I-M-(x+m))<15e3?i=!0:x=I-M-m}const D=x+m;for(let I=0;I<h;I++){const M=c[I];M.pts=Ts(M.pts,D),M.dts=Ts(M.dts,D),M.dts<c[I>0?I-1:I].dts&&(R=!0)}R&&c.sort(function(I,M){const G=I.dts-M.dts,Z=I.pts-M.pts;return G||Z}),S=c[0].dts,A=c[c.length-1].dts;const k=A-S,O=k?Math.round(k/(h-1)):b||e.inputTimeScale/30;if(i){const I=S-D,M=I>O,G=I<-1;if((M||G)&&(M?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_a(I,!0)} ms (${I}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_a(-I,!0)} ms (${I}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!G||D>=c[0].pts||Tr)){S=D;const Z=c[0].pts-I;if(M)c[0].dts=S,c[0].pts=Z;else{let re=!0;for(let V=0;V<c.length&&!(c[V].dts>Z&&re);V++){const ge=c[V].pts;if(c[V].dts-=I,c[V].pts-=I,V<c.length-1){const Re=c[V+1].pts,Ae=c[V].pts,Ce=Re<=Ae,it=Re<=ge;re=Ce==it}}}this.log(`Video: Initial PTS/DTS adjusted: ${_a(Z,!0)}/${_a(S,!0)}, delta: ${_a(I,!0)} ms`)}}S=Math.max(0,S);let F=0,N=0,B=S;for(let I=0;I<h;I++){const M=c[I],G=M.units,Z=G.length;let re=0;for(let V=0;V<Z;V++)re+=G[V].data.length;N+=re,F+=Z,M.length=re,M.dts<B?(M.dts=B,B+=O/4|0||1):B=M.dts,E=Math.min(M.pts,E),_=Math.max(M.pts,_)}A=c[h-1].dts;const C=N+4*F+8;let P;try{P=new Uint8Array(C)}catch(I){this.observer.emit(L.ERROR,L.ERROR,{type:_e.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:I,bytes:C,reason:`fail allocating video mdat ${C}`});return}const W=new DataView(P.buffer);W.setUint32(0,C),P.set(H.types.mdat,4);let ue=!1,me=Number.POSITIVE_INFINITY,ee=Number.POSITIVE_INFINITY,ce=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY;for(let I=0;I<h;I++){const M=c[I],G=M.units;let Z=0;for(let ge=0,Re=G.length;ge<Re;ge++){const Ae=G[ge],Ce=Ae.data,it=Ae.data.byteLength;W.setUint32(v,it),v+=4,P.set(Ce,v),v+=it,Z+=4+it}let re;if(I<h-1)b=c[I+1].dts-M.dts,re=c[I+1].pts-M.pts;else{const ge=this.config,Re=I>0?M.dts-c[I-1].dts:O;if(re=I>0?M.pts-c[I-1].pts:O,ge.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ae=Math.floor(ge.maxBufferHole*a),Ce=(r?E+r*a:this.nextAudioTs+m)-M.pts;Ce>Ae?(b=Ce-Re,b<0?b=Re:ue=!0,this.log(`It is approximately ${Ce/90} ms to the next segment; using duration ${b/90} ms for the last video frame.`)):b=Re}else b=Re}const V=Math.round(M.pts-M.dts);me=Math.min(me,b),ce=Math.max(ce,b),ee=Math.min(ee,re),j=Math.max(j,re),d.push(Gp(M.key,b,Z,V))}if(d.length){if(Tr){if(Tr<70){const I=d[0].flags;I.dependsOn=2,I.isNonSync=0}}else if(bd&&j-ee<ce-me&&O/ce<.025&&d[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let I=S;for(let M=0,G=d.length;M<G;M++){const Z=I+d[M].duration,re=I+d[M].cts;if(M<G-1){const V=Z+d[M+1].cts;d[M].duration=V-re}else d[M].duration=M?d[M-1].duration:O;d[M].cts=0,I=Z}}}b=ue||!b?O:b;const X=A+b;this.nextVideoTs=x=X-m,this.videoSampleDuration=b,this.isVideoContiguous=!0;const te={data1:H.moof(e.sequenceNumber++,S,ot(e,{samples:d})),data2:P,startPTS:(E-m)/a,endPTS:(_+b-m)/a,startDTS:(S-m)/a,endDTS:x/a,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,te}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return CL;case"ac3":return NL;default:return IL}}remuxAudio(e,t,i,r,a){const c=e.inputTimeScale,d=e.samplerate?e.samplerate:c,h=c/d,f=this.getSamplesPerFrame(e),m=f*h,x=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,b=[],S=a!==void 0;let A=e.samples,E=v?0:8,_=this.nextAudioTs||-1;const R=x.baseTime*c/x.timescale,D=R+t*c;if(this.isAudioContiguous=i=i||A.length&&_>0&&(r&&Math.abs(D-(_+R))<9e3||Math.abs(Ts(A[0].pts,D)-(_+R))<20*m),A.forEach(function(j){j.pts=Ts(j.pts,D)}),!i||_<0){const j=A.length;if(A=A.filter(X=>X.pts>=0),j!==A.length&&this.warn(`Removed ${A.length-j} of ${j} samples (initPTS ${R} / ${c})`),!A.length)return;a===0?_=0:r&&!S?_=Math.max(0,D-R):_=A[0].pts-R}if(e.segmentCodec==="aac"){const j=this.config.maxAudioFramesDrift;for(let X=0,se=_+R;X<A.length;X++){const de=A[X],te=de.pts,I=te-se,M=Math.abs(1e3*I/c);if(I<=-j*m&&S)X===0&&(this.warn(`Audio frame @ ${(te/c).toFixed(3)}s overlaps marker by ${Math.round(1e3*I/c)} ms.`),this.nextAudioTs=_=te-R,se=te);else if(I>=j*m&&M<DL&&S){let G=Math.round(I/m);for(se=te-G*m;se<0&&G&&m;)G--,se+=m;X===0&&(this.nextAudioTs=_=se-R),this.warn(`Injecting ${G} audio frames @ ${((se-R)/c).toFixed(3)}s due to ${Math.round(1e3*I/c)} ms gap.`);for(let Z=0;Z<G;Z++){let re=_L.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);re||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),re=de.unit.subarray()),A.splice(X,0,{unit:re,pts:se}),se+=m,X++}}de.pts=se,se+=m}}let k=null,O=null,F,N=0,B=A.length;for(;B--;)N+=A[B].unit.byteLength;for(let j=0,X=A.length;j<X;j++){const se=A[j],de=se.unit;let te=se.pts;if(O!==null){const M=b[j-1];M.duration=Math.round((te-O)/h)}else if(i&&e.segmentCodec==="aac"&&(te=_+R),k=te,N>0){N+=E;try{F=new Uint8Array(N)}catch(M){this.observer.emit(L.ERROR,L.ERROR,{type:_e.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:M,bytes:N,reason:`fail allocating audio mdat ${N}`});return}v||(new DataView(F.buffer).setUint32(0,N),F.set(H.types.mdat,4))}else return;F.set(de,E);const I=de.byteLength;E+=I,b.push(Gp(!0,f,I,0)),O=te}const C=b.length;if(!C)return;const P=b[b.length-1];_=O-R,this.nextAudioTs=_+h*P.duration;const W=v?new Uint8Array(0):H.moof(e.sequenceNumber++,k/h,ot({},e,{samples:b}));e.samples=[];const ue=(k-R)/c,me=this.nextAudioTs/c,ce={data1:W,data2:F,startPTS:ue,endPTS:me,startDTS:ue,endDTS:me,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,ce}}function Ts(o,e){let t;if(e===null)return o;for(e<o?t=-8589934592:t=8589934592;Math.abs(o-e)>4294967296;)o+=t;return o}function kL(o){for(let e=0;e<o.length;e++)if(o[e].key)return e;return-1}function Py(o,e,t,i){const r=o.samples.length;if(!r)return;const a=o.inputTimeScale;for(let d=0;d<r;d++){const h=o.samples[d];h.pts=Ts(h.pts-t.baseTime*a/t.timescale,e*a)/a,h.dts=Ts(h.dts-i.baseTime*a/i.timescale,e*a)/a}const c=o.samples;return o.samples=[],{samples:c}}function jy(o,e,t){const i=o.samples.length;if(!i)return;const r=o.inputTimeScale;for(let c=0;c<i;c++){const d=o.samples[c];d.pts=Ts(d.pts-t.baseTime*r/t.timescale,e*r)/r}o.samples.sort((c,d)=>c.pts-d.pts);const a=o.samples;return o.samples=[],{samples:a}}class ML extends Gs{constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:a,video:c}=this.initData=zx(e);if(t)ST(e,t);else{const h=a||c;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}a&&(i=zp(a,ut.AUDIO,this)),c&&(r=zp(c,ut.VIDEO,this));const d={};a&&c?d.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:c.supplemental,encrypted:c.encrypted,initSegment:e,id:"main"}:a?d.audio={container:"audio/mp4",codec:i,encrypted:a.encrypted,initSegment:e,id:"audio"}:c?d.video={container:"video/mp4",codec:r,supplemental:c.supplemental,encrypted:c.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=d}remux(e,t,i,r,a,c){var d,h;let{initPTS:f,lastEndTime:m}=this;const x={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};ye(m)||(m=this.lastEndTime=a||0);const v=t.samples;if(!v.length)return x;const b={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((d=S)!=null&&d.length||(this.generateInitSegment(v),S=this.initData),!((h=S)!=null&&h.length))return this.warn("Failed to generate initSegment."),x;this.emitInitSegment&&(b.tracks=this.initTracks,this.emitInitSegment=!1);const A=TT(v,S,this),E=S.audio?A[S.audio.id]:null,_=S.video?A[S.video.id]:null,R=co(_,1/0),D=co(E,1/0),k=co(_,0,!0),O=co(E,0,!0);let F=a,N=0;const B=E&&(!_||!f&&D<R||f&&f.trackId===S.audio.id),C=B?E:_;if(C){const se=C.timescale,de=C.start-a*se,te=B?S.audio.id:S.video.id;F=C.start/se,N=B?O-D:k-R,(c||!f)&&(OL(f,F,a,N)||se!==f.timescale)&&(f&&this.warn(`Timestamps at playlist time: ${c?"":"~"}${a} ${de/se} != initPTS: ${f.baseTime/f.timescale} (${f.baseTime}/${f.timescale}) trackId: ${f.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${F-a} (${de}/${se}) trackId: ${te}`),f=null,b.initPTS=de,b.timescale=se,b.trackId=te)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);f?(b.initPTS=f.baseTime,b.timescale=f.timescale,b.trackId=f.trackId):((!b.timescale||b.trackId===void 0||b.initPTS===void 0)&&(this.warn("Could not set initPTS"),b.initPTS=F,b.timescale=1,b.trackId=-1),this.initPTS=f={baseTime:b.initPTS,timescale:b.timescale,trackId:b.trackId});const P=F-f.baseTime/f.timescale,W=P+N;N>0?this.lastEndTime=W:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ue=!!S.audio,me=!!S.video;let ee="";ue&&(ee+="audio"),me&&(ee+="video");const ce=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),j={data1:v,startPTS:P,startDTS:P,endPTS:W,endDTS:W,type:ee,hasAudio:ue,hasVideo:me,nb:1,dropped:0,encrypted:ce};x.audio=ue&&!me?j:void 0,x.video=me?j:void 0;const X=_==null?void 0:_.sampleCount;if(X){const se=_.keyFrameIndex,de=se!==-1;j.nb=X,j.dropped=se===0||this.isVideoContiguous?0:de?se:X,j.independent=de,j.firstKeyFrame=se,de&&_.keyFrameStart&&(j.firstKeyFramePTS=(_.keyFrameStart-f.baseTime)/f.timescale),this.isVideoContiguous||(x.independent=de),this.isVideoContiguous||(this.isVideoContiguous=de),j.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${se}/${X} dropped: ${j.dropped} start: ${j.firstKeyFramePTS||"NA"}`)}return x.initSegment=b,x.id3=Py(i,a,f,f),r.samples.length&&(x.text=jy(r,a,f)),x}}function co(o,e,t=!1){return(o==null?void 0:o.start)!==void 0?(o.start+(t?o.duration:0))/o.timescale:e}function OL(o,e,t,i){if(o===null)return!0;const r=Math.max(i,1),a=e-o.baseTime/o.timescale;return Math.abs(a-t)>r}function zp(o,e,t){const i=o.codec;return i&&i.length>4?i:e===ut.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Co(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Di;try{Di=self.performance.now.bind(self.performance)}catch{Di=Date.now}const To=[{demux:bL,remux:ML},{demux:rn,remux:Eo},{demux:pL,remux:Eo},{demux:yL,remux:Eo}];To.splice(2,0,{demux:xL,remux:Eo});class Hp{constructor(e,t,i,r,a,c){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=a,this.logger=c}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const a=i.transmuxing;a.executeStart=Di();let c=new Uint8Array(e);const{currentTransmuxState:d,transmuxConfig:h}=this;r&&(this.currentTransmuxState=r);const{contiguous:f,discontinuity:m,trackSwitch:x,accurateTimeOffset:v,timeOffset:b,initSegmentChange:S}=r||d,{audioCodec:A,videoCodec:E,defaultInitPts:_,duration:R,initSegmentData:D}=h,k=PL(c,t);if(k&&wr(k.method)){const B=this.getDecrypter(),C=bf(k.method);if(B.isSync()){let P=B.softwareDecrypt(c,k.key.buffer,k.iv.buffer,C);if(i.part>-1){const ue=B.flush();P=ue&&ue.buffer}if(!P)return a.executeEnd=Di(),Sd(i);c=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(c,k.key.buffer,k.iv.buffer,C).then(P=>{const W=this.push(P,null,i);return this.decryptionPromise=null,W}),this.decryptionPromise}const O=this.needsProbing(m,x);if(O){const B=this.configureTransmuxer(c);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),a.executeEnd=Di(),Sd(i)}(m||x||S||O)&&this.resetInitSegment(D,A,E,R,t),(m||S||O)&&this.resetInitialTimestamp(_),f||this.resetContiguity();const F=this.transmux(c,k,b,v,i);this.asyncResult=Fa(F);const N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,a.executeEnd=Di(),F}flush(e){const t=e.transmuxing;t.executeStart=Di();const{decrypter:i,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));const c=[],{timeOffset:d}=r;if(i){const x=i.flush();x&&c.push(this.push(x.buffer,null,e))}const{demuxer:h,remuxer:f}=this;if(!h||!f){t.executeEnd=Di();const x=[Sd(e)];return this.asyncResult?Promise.resolve(x):x}const m=h.flush(d);return Fa(m)?(this.asyncResult=!0,m.then(x=>(this.flushRemux(c,x,e),c))):(this.flushRemux(c,m,e),this.asyncResult?Promise.resolve(c):c)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:a,id3Track:c,textTrack:d}=t,{accurateTimeOffset:h,timeOffset:f}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ve.MAIN?"level":"track"} ${i.level}`);const m=this.remuxer.remux(r,a,c,d,f,h,!0,this.id);e.push({remuxResult:m,chunkMeta:i}),i.transmuxing.executeEnd=Di()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,a){const{demuxer:c,remuxer:d}=this;!c||!d||(c.resetInitSegment(e,t,i,r),d.resetInitSegment(e,t,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,a){let c;return t&&t.method==="SAMPLE-AES"?c=this.transmuxSampleAes(e,t,i,r,a):c=this.transmuxUnencrypted(e,i,r,a),c}transmuxUnencrypted(e,t,i,r){const{audioTrack:a,videoTrack:c,id3Track:d,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,c,d,h,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,a){return this.demuxer.demuxSampleAes(e,t,i).then(c=>({remuxResult:this.remuxer.remux(c.audioTrack,c.videoTrack,c.id3Track,c.textTrack,i,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r}=this;let a;for(let x=0,v=To.length;x<v;x++){var c;if((c=To[x].demux)!=null&&c.probe(e,this.logger)){a=To[x];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const d=this.demuxer,h=this.remuxer,f=a.remux,m=a.demux;(!h||!(h instanceof f))&&(this.remuxer=new f(i,t,r,this.logger)),(!d||!(d instanceof m))&&(this.demuxer=new m(i,t,r,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new yf(this.config)),e}}function PL(o,e){let t=null;return o.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Sd=o=>({remuxResult:{},chunkMeta:o});function Fa(o){return"then"in o&&o.then instanceof Function}class jL{constructor(e,t,i,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=a||null}}class UL{constructor(e,t,i,r,a,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=c}}let Vp=0;class Uy{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Vp++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const f=h.data,m=this.hls;if(!(!m||!(f!=null&&f.event)||f.instanceNo!==this.instanceNo))switch(f.event){case"init":{var x;const v=(x=this.workerContext)==null?void 0:x.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":{m.logger[f.data.logType]&&m.logger[f.data.logType](f.data.message);break}default:{f.data=f.data||{},f.data.frag=this.frag,f.data.part=this.part,f.data.id=this.id,m.trigger(f.event,f.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const f=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})};const a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const c=(h,f)=>{f=f||{},f.frag=this.frag||void 0,h===L.ERROR&&(f=f,f.parent=this.id,f.part=this.part,this.error=f.error),this.hls.trigger(h,f)};this.observer=new Tf,this.observer.on(L.FRAG_DECRYPTED,c),this.observer.on(L.ERROR,c);const d=ap(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(a.workerPath||GA()){try{a.workerPath?(h.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=HA(a.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=zA());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:d,id:t,config:dt(a)})}catch(m){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new Hp(this.observer,d,a,"",t,e.logger)}return}}this.transmuxer=new Hp(this.observer,d,a,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Vp++;const t=this.hls.config,i=ap(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:dt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),VA(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,a,c,d,h,f,m){var x,v;f.transmuxing.start=self.performance.now();const{instanceNo:b,transmuxer:S}=this,A=c?c.start:a.start,E=a.decryptdata,_=this.frag,R=!(_&&a.cc===_.cc),D=!(_&&f.level===_.level),k=_?f.sn-_.sn:-1,O=this.part?f.part-this.part.index:-1,F=k===0&&f.id>1&&f.id===(_==null?void 0:_.stats.chunkCount),N=!D&&(k===1||k===0&&(O===1||F&&O<=0)),B=self.performance.now();(D||k||a.stats.parsing.start===0)&&(a.stats.parsing.start=B),c&&(O||!N)&&(c.stats.parsing.start=B);const C=!(_&&((x=a.initSegment)==null?void 0:x.url)===((v=_.initSegment)==null?void 0:v.url)),P=new UL(R,N,h,D,A,C);if(!N||R||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${f.sn}${f.part>-1?" part: "+f.part:""} ${this.id===ve.MAIN?"level":"track"}: ${f.level} id: ${f.id}
        discontinuity: ${R}
        trackSwitch: ${D}
        contiguous: ${N}
        accurateTimeOffset: ${h}
        timeOffset: ${A}
        initSegmentChange: ${C}`);const W=new jL(i,r,t,d,m);this.configureTransmuxer(W)}if(this.frag=a,this.part=c,this.workerContext)this.workerContext.worker.postMessage({instanceNo:b,cmd:"demux",data:e,decryptdata:E,chunkMeta:f,state:P},e instanceof ArrayBuffer?[e]:[]);else if(S){const W=S.push(e,E,f,P);Fa(W)?W.then(ue=>{this.handleTransmuxComplete(ue)}).catch(ue=>{this.transmuxerError(ue,f,"transmuxer-interface push error")}):this.handleTransmuxComplete(W)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);Fa(r)?r.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Kp=100;class FL extends Ef{constructor(e,t,i){super(e,t,i,"audio-stream-controller",ve.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:a,trackId:c}){if(i===ve.MAIN){const d=t.cc,h=this.fragCurrent;if(this.initPTS[d]={baseTime:r,timescale:a,trackId:c},this.log(`InitPTS for cc: ${d} found from main: ${r/a} (${r}/${a}) trackId: ${c}`),this.mainAnchor=t,this.state===ae.WAITING_INIT_PTS){const f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==d)&&this.syncWithAnchor(t,f==null?void 0:f.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==d?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===ae.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const a=(r||e).cc,c=this.getLevelDetails(),d=this.getLoadPosition(),h=ey(c,a,d);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===ae.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ae.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Kp),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ae.IDLE):this.state=ae.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ae.IDLE:this.doTickIdle();break;case ae.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e==null?void 0:e[t],r=i==null?void 0:i.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=ae.WAITING_INIT_PTS}break}case ae.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ae.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:r,complete:a}=e,c=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ae.FRAG_LOADING;const d=r.flush().buffer,h={frag:t,part:i,payload:d,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else c&&c.cc!==e.frag.cc&&this.syncWithAnchor(c,e.frag)}else this.state=ae.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:r,trackId:a}=this,c=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!c.startFragPrefetch)||!(i!=null&&i[a]))return;const d=i[a],h=d.details;if(!h||this.waitForLive(d)||this.waitForCdnTuneIn(h)){this.state=ae.WAITING_TRACK,this.startFragRequested=!1;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,ut.AUDIO,ve.AUDIO));const m=this.getFwdBufferInfo(f,ve.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,h)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=ae.ENDED;return}const x=m.len,v=t.maxBufferLength,b=h.fragments,S=b[0].start,A=this.getLoadPosition(),E=this.flushing?A:m.end;if(this.switchingTrack&&r){const D=A;h.PTSKnown&&D<S&&(m.end>S||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=S+.05)}if(x>=v&&!this.switchingTrack&&E<b[b.length-1].start)return;let _=this.getNextFragment(E,h);if(_&&this.isLoopLoading(_,E)&&(_=this.getNextFragmentLoopLoading(_,h,m,ve.MAIN,v)),!_){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&wt(_)&&!_.endList&&(!h.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Ut.OK&&(this.mainFragLoading=R=null),R&&wt(R))){if(_.start>R.end){const k=this.fragmentTracker.getFragAtPos(E,ve.MAIN);k&&k.end>R.end&&(R=k,this.mainFragLoading={frag:k,targetBufferTime:null})}if(_.start>R.end)return}this.loadFragment(_,d,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Pa(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ae.STOPPED&&(this.setInterval(Kp),this.state=ae.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:r}=this,{details:a,id:c,groupId:d,track:h}=t;if(!r){this.warn(`Audio tracks reset while loading track ${c} "${h.name}" of "${d}"`);return}const f=this.mainDetails;if(!f||a.endCC>f.endCC||f.expired){this.cachedTrackLoadedData=t,this.state!==ae.STOPPED&&(this.state=ae.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${c} "${h.name}" of "${d}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const m=r[c];let x=0;if(a.live||(i=m.details)!=null&&i.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(m.details){var v;x=this.alignPlaylists(a,m.details,(v=this.levelLastLoaded)==null?void 0:v.details)}a.alignedSliding||(yy(a,f),a.alignedSliding||Uo(a,f),x=a.fragmentStart)}m.details=a,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(f,x),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:a,id:c,groupId:t.groupId}),this.state===ae.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=ae.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:a}=e,{config:c,trackId:d,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const f=h[d];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const m=f.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const x=c.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new Uy(this.hls,ve.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const b=this.initPTS[i.cc],S=(t=i.initSegment)==null?void 0:t.data;if(b!==void 0){const E=r?r.index:-1,_=E!==-1,R=new vf(i.level,i.sn,i.stats.chunkCount,a.byteLength,E,_);v.push(a,S,x,"",i,r,m.totalduration,!1,R,b)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${m.startSN} ,${m.endSN}],track ${d}`);const{cache:A}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new vy,complete:!1};A.push(new Uint8Array(a)),this.state!==ae.STOPPED&&(this.state=ae.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ve.MAIN&&wt(t.frag)&&(this.mainFragLoading=t,this.state===ae.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==ve.AUDIO){!this.audioOnly&&i.type===ve.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(wt(i)){this.fragPrevious=i;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,tt({},a)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ae.ERROR;return}switch(t.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ve.AUDIO,t);break;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ae.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===$e.AUDIO_TRACK&&(this.state=ae.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ut.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ut.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ae.ENDED&&(this.state=ae.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,ve.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:a,chunkMeta:c}=e,d=this.getCurrentContext(c);if(!d){this.resetWhenMissingContext(c);return}const{frag:h,part:f,level:m}=d,{details:x}=m,{audio:v,text:b,id3:S,initSegment:A}=a;if(this.fragContextChanged(h)||!x){this.fragmentTracker.removeFragment(h);return}if(this.state=ae.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const E=h.initSegment||h;if(this.unhandledEncryptionError(A,h))return;this._bufferInitSegment(m,A.tracks,E,c),r.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:A.tracks})}if(v){const{startPTS:E,endPTS:_,startDTS:R,endDTS:D}=v;f&&(f.elementaryStreams[ut.AUDIO]={startPTS:E,endPTS:_,startDTS:R,endDTS:D}),h.setElementaryStreamInfo(ut.AUDIO,E,_,R,D),this.bufferFragmentData(v,h,f,c)}if(S!=null&&(t=S.samples)!=null&&t.length){const E=ot({id:i,frag:h,details:x},S);r.trigger(L.FRAG_PARSING_METADATA,E)}if(b){const E=ot({id:i,frag:h,details:x},b);r.trigger(L.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,i,r){if(this.state!==ae.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const a=t.audio;a.id=ve.AUDIO;const c=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${c}/${a.codec}]`),c&&c.split(",").length===1&&(a.levelCodec=c),this.hls.trigger(L.BUFFER_CODECS,t);const d=a.initSegment;if(d!=null&&d.byteLength){const h={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:d};this.hls.trigger(L.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Ut.NOT_LOADED||r===Ut.PARTIAL){var a;if(!wt(e))this._loadInitSegment(e,t);else if((a=t.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ae.WAITING_INIT_PTS;const c=this.mainDetails;c&&c.fragmentStart!==t.details.fragmentStart&&Uo(t.details,c)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:r,characteristics:a,audioCodec:c,channels:d}=this.bufferedTrack;In({name:t,lang:i,assocLang:r,characteristics:a,audioCodec:c,channels:d},e,Dn)||(ko(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,tt({},e))}}class If extends Gs{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t==null?void 0:t.renditionReports;if(r){let a=-1;for(let c=0;c<r.length;c++){const d=r[c];let h;try{h=new self.URL(d.URI,t.url).href}catch(f){this.warn(`Could not construct new URL for Rendition Report: ${f}`),h=d.URI||""}if(h===e){a=c;break}else h===e.substring(0,h.length)&&(a=c)}if(a!==-1){const c=r[a],d=parseInt(c["LAST-MSN"])||t.lastPartSn;let h=parseInt(c["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&m>t.partTarget&&(h+=1)}const f=i&&lp(i);return new op(d,h>=0?h:void 0,f)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:r,stats:a}=t,c=self.performance.now(),d=a.loading.first?Math.max(0,c-a.loading.first):0;r.advancedDateTime=Date.now()-d;const h=this.hls.config.timelineOffset;if(h!==r.appliedTimelineOffset){const m=Math.max(h||0,0);r.appliedTimelineOffset=m,r.fragments.forEach(x=>{x.setStart(x.playlistOffset+m)})}if(r.live||i!=null&&i.live){const m="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){CA(i,r,this);const R=r.playlistParsingError;if(R){this.warn(R);const D=this.hls;if(!D.config.ignorePlaylistParsingErrors){var f;const{networkDetails:k}=t;D.trigger(L.ERROR,{type:_e.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:R,reason:R.message,level:t.level||void 0,parent:(f=r.fragments[0])==null?void 0:f.type,networkDetails:k,stats:a});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=a.loading.start);const x=this.hls.mainForwardBufferInfo,v=x?x.end-x.len:0,b=(r.edge-v)*1e3,S=hy(r,b);if(r.requestScheduled+S<c?r.requestScheduled=c:r.requestScheduled+=S,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let A,E,_;if(r.canBlockReload&&r.endSN&&r.advanced){const R=this.hls.config.lowLatencyMode,D=r.lastPartSn,k=r.endSN,O=r.lastPartIndex,F=O!==-1,N=D===k;F?N?(E=k+1,_=R?0:O):(E=D,_=R?O+1:r.maxPartIndex):E=k+1;const B=r.age,C=B+r.ageHeader;let P=Math.min(C-r.partTarget,r.targetduration*1.5);if(P>0){if(C>r.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,_=void 0;else if(i!=null&&i.tuneInGoal&&C-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${P} with playlist age: ${r.age}`),P=0;else{const W=Math.floor(P/r.targetduration);if(E+=W,_!==void 0){const ue=Math.round(P%r.targetduration/r.partTarget);_+=ue}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${P} skip sn ${W} to part ${_}`)}r.tuneInGoal=P}if(A=this.getDeliveryDirectives(r,t.deliveryDirectives,E,_),R||!N){r.requestScheduled=c,this.loadingPlaylist(m,A);return}}else(r.canBlockReload||r.canSkipUntil)&&(A=this.getDeliveryDirectives(r,t.deliveryDirectives,E,_));A&&E!==void 0&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(S-d*2,S/2)),this.scheduleLoading(m,A,r)}else this.clearTimer()}scheduleLoading(e,t,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}const a=self.performance.now(),c=r.requestScheduled;if(a>=c){this.loadingPlaylist(e,t);return}const d=c-a;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(d)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),d)}getDeliveryDirectives(e,t,i,r){let a=lp(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,a=bo.No),new op(i,r,a)}checkRetry(e){const t=e.details,i=Mo(e),r=e.errorAction,{action:a,retryCount:c=0,retryConfig:d}=r||{},h=!!r&&!!d&&(a===Xt.RetryRequest||!r.resolved&&a===Xt.SendAlternateToPenaltyBox);if(h){var f;if(c>=d.maxNumRetry)return!1;if(i&&(f=e.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${c+1}/${d.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=xf(d,c);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${c+1}/${d.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,r.resolved=!0}return h}}function Fy(o,e){if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!Ba(o[t].attrs,e[t].attrs))return!1;return!0}function Ba(o,e,t){const i=o["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>o[r]!==e[r])}function Zd(o,e){return e.label.toLowerCase()===o.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(o.lang||"").toLowerCase())}class BL extends If{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:a}=t,c=this.tracksInGroup[i];if(!c||c.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${c==null?void 0:c.groupId}`);return}const d=c.details;c.details=t.details,this.log(`Audio track ${i} "${c.name}" lang:${c.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,d)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let a=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(d=>(r==null?void 0:r.indexOf(d))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const d=this.tracks.filter(v=>!i||i.indexOf(v.groupId)!==-1);if(d.length)this.selectDefaultTrack&&!d.some(v=>v.default)&&(this.selectDefaultTrack=!1),d.forEach((v,b)=>{v.id=b});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=d;const h=this.hls.config.audioPreference;if(!a&&h){const v=ni(h,d,Dn);if(v>-1)a=d[v];else{const b=ni(h,this.tracks);a=this.tracks[b]}}let f=this.findTrackId(a);f===-1&&a&&(f=this.findTrackId(null));const m={audioTracks:d};this.log(`Updating audio tracks, ${d.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,m);const x=this.trackId;if(f!==-1&&x===-1)this.setAudioTrack(f);else if(d.length&&x===-1){var c;const v=new Error(`No audio track selected for current audio group-ID(s): ${(c=this.groupIds)==null?void 0:c.join(",")} track count: ${d.length}`);this.warn(v.message),this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===$e.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&In(e,r,Dn))return r;const a=ni(e,this.tracksInGroup,Dn);if(a>-1){const c=this.tracksInGroup[a];return this.setAudioTrack(a),c}else if(r){let c=t.loadLevel;c===-1&&(c=t.firstAutoLevel);const d=ZT(e,t.levels,i,c,Dn);if(d===-1)return null;t.nextLoadLevel=d}if(e.channels||e.audioCodec){const c=ni(e,i);if(c>-1)return i[c]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===i&&a||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,tt({},r)),a))return;const c=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(c)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||In(e,r,Dn)))return i}if(e){const{name:i,lang:r,assocLang:a,characteristics:c,audioCodec:d,channels:h}=e;for(let f=0;f<t.length;f++){const m=t[f];if(In({name:i,lang:r,assocLang:a,characteristics:c,audioCodec:d,channels:h},m,Dn))return f}for(let f=0;f<t.length;f++){const m=t[f];if(Ba(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<t.length;f++){const m=t[f];if(Ba(e.attrs,m.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&ko(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),c=e.details,d=c==null?void 0:c.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${d&&c.live?" age "+d.toFixed(1)+(c.type&&" "+c.type||""):""} ${a}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:t||null,track:e})}}class $L{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(a){var i;if(r.onError(a),this.queues===null||this.tracks===null)return;const c=(i=this.tracks[e])==null?void 0:i.buffer;c!=null&&c.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],r=i==null?void 0:i.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const Yp=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,By="HlsJsTrackRemovedError";class GL extends Error{constructor(e){super(e),this.name=By}}class zL extends Gs{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:a}=this;i&&this.log("Media source opened"),!(!r||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:r,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=dT(ln(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const c=this.isQueued();(a||c)&&this.warn(`Transfering MediaSource with${c?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?ot(i,r.tracks):this.sourceBuffers.forEach(a=>{const[c]=a;c&&(i[c]=ot({},this.tracks[c]),this.removeBuffer(c)),a[0]=a[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const r=ln(this.appendSource);if(r){const a=!!t.mediaSource;(a||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const c=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(c),a)this._objectUrl=i.src,this.attachTransferred();else{const d=this._objectUrl=self.URL.createObjectURL(c);if(this.appendSource)try{i.removeAttribute("src");const h=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||h&&c instanceof h,qp(i),HL(i,d),i.load()}catch{i.src=d}else i.src=d}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,r=t.tracks,a=r?Object.keys(r):null,c=a?a.length:0,d=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&a&&c){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${dt(i,(h,f)=>h==="initSegment"?void 0:f)};
transfer tracks: ${dt(r,(h,f)=>h==="initSegment"?void 0:f)}}`),!Px(r,i)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,f=this.details,m=Math.max(h,(f==null?void 0:f.fragments[0].start)||0);if(m-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${m} currentTime: ${h}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,a.forEach(h=>{const f=h,m=r[f];if(m){const x=m.buffer;if(x){const v=this.fragmentTracker,b=m.id;if(v.hasFragments(b)||v.hasParts(b)){const E=Oe.getBuffered(x);v.detectEvictedFragments(f,E,b,null,!0)}const S=Ed(f),A=[f,x];this.sourceBuffers[S]=A,x.updating&&this.operationQueue&&this.operationQueue.prependBlocker(f),this.trackSourceBuffer(f,m)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:a,_objectUrl:c}=this;if(a){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([d])=>{d&&this.removeBuffer(d)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const d=a.readyState==="open";try{const h=a.sourceBuffers;for(let f=h.length;f--;)d&&h[f].abort(),a.removeSourceBuffer(h[f]);d&&a.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(c&&self.URL.revokeObjectURL(c),this.mediaSrc===c?(r.removeAttribute("src"),this.appendSource&&qp(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(a){this.warn(`onBufferReset ${e}`,a)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ed(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new $L(this.tracks)}onBufferCodecs(e,t){var i;const r=this.tracks,a=Object.keys(t);this.log(`BUFFER_CODECS: "${a}" (current SB count ${this.sourceBufferCount})`);const c="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),d=!c&&this.sourceBufferCount&&this.media&&a.some(h=>!r[h]);if(c||d){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${a}" SourceBuffers`);return}a.forEach(h=>{var f,m;const x=t[h],{id:v,codec:b,levelCodec:S,container:A,metadata:E,supplemental:_}=x;let R=r[h];const D=(f=this.transferData)==null||(f=f.tracks)==null?void 0:f[h],k=D!=null&&D.buffer?D:R,O=(k==null?void 0:k.pendingCodec)||(k==null?void 0:k.codec),F=k==null?void 0:k.levelCodec;R||(R=r[h]={buffer:void 0,listeners:[],codec:b,supplemental:_,container:A,levelCodec:S,metadata:E,id:v});const N=vo(O,F),B=N==null?void 0:N.replace(Yp,"$1");let C=vo(b,S);const P=(m=C)==null?void 0:m.replace(Yp,"$1");C&&N&&B!==P&&(h.slice(0,5)==="audio"&&(C=Co(C,this.appendSource)),this.log(`switching codec ${O} to ${C}`),C!==(R.pendingCodec||R.codec)&&(R.pendingCodec=C),R.container=A,this.appendChangeType(h,A,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const r=`${t};codecs=${i}`,a={label:`change-type=${r}`,execute:()=>{const c=this.tracks[e];if(c){const d=c.buffer;d!=null&&d.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),d.changeType(r),c.codec=i,c.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn(`Failed to change ${e} SourceBuffer type`,c)}};this.append(a,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,ve.MAIN))==null?void 0:t.gap)===!0)return;const c={label:"block-audio",execute:()=>{var d;const h=this.tracks.video;(this.lastVideoAppendEnd>r||h!=null&&h.buffer&&Oe.isBuffered(h.buffer,r)||((d=this.fragmentTracker.getAppendedFrag(r,ve.MAIN))==null?void 0:d.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:d=>{this.warn("Error executing block-audio operation",d)}};this.blockedAudioAppend={op:c,frag:e},this.append(c,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:r,type:a,parent:c,frag:d,part:h,chunkMeta:f,offset:m}=t,x=f.buffering[a],{sn:v,cc:b}=d,S=self.performance.now();x.start=S;const A=d.stats.buffering,E=h?h.stats.buffering:null;A.start===0&&(A.start=S),E&&E.start===0&&(E.start=S);const _=i.audio;let R=!1;a==="audio"&&(_==null?void 0:_.container)==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const D=i.video,k=D==null?void 0:D.buffer;if(k&&v!=="initSegment"){const N=h||d,B=this.blockedAudioAppend;if(a==="audio"&&c!=="main"&&!this.blockedAudioAppend&&!(D.ending||D.ended)){const P=N.start+N.duration*.05,W=k.buffered,ue=this.currentOp("video");!W.length&&!ue?this.blockAudio(N):!ue&&!Oe.isBuffered(k,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(N)}else if(a==="video"){const C=N.end;if(B){const P=B.frag.start;(C>P||C<this.lastVideoAppendEnd||Oe.isBuffered(k,P))&&this.unblockAudio()}this.lastVideoAppendEnd=C}}const O=(h||d).start,F={label:`append-${a}`,execute:()=>{var N;x.executeStart=self.performance.now();const B=(N=this.tracks[a])==null?void 0:N.buffer;B&&(R?this.updateTimestampOffset(B,O,.1,a,v,b):m!==void 0&&ye(m)&&this.updateTimestampOffset(B,m,1e-6,a,v,b)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{const N=self.performance.now();x.executeEnd=x.end=N,A.first===0&&(A.first=N),E&&E.first===0&&(E.first=N);const B={};this.sourceBuffers.forEach(([C,P])=>{C&&(B[C]=Oe.getBuffered(P))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:a,frag:d,part:h,chunkMeta:f,parent:d.type,timeRanges:B})},onError:N=>{var B;const C={type:_e.MEDIA_ERROR,parent:d.type,details:K.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:d,part:h,chunkMeta:f,error:N,err:N,fatal:!1},P=(B=this.media)==null?void 0:B.error;if(N.code===DOMException.QUOTA_EXCEEDED_ERR||N.name=="QuotaExceededError"||"quota"in N)C.details=K.BUFFER_FULL_ERROR;else if(N.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)C.errorAction=Rr(!0);else if(N.name===By&&this.sourceBufferCount===0)C.errorAction=Rr(!0);else{const W=++this.appendErrors[a];this.warn(`Failed ${W}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${P||"no media error"})`),(W>=this.hls.config.appendErrorMaxRetry||P)&&(C.fatal=!0)}this.hls.trigger(L.ERROR,C)}};this.log(`queuing "${a}" append sn: ${v}${h?" p: "+h.index:""} of ${d.type===ve.MAIN?"level":"track"} ${d.level} cc: ${b}`),this.append(F,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:i,startOffset:r,endOffset:a}=t;i?this.append(this.getFlushOp(i,r,a),i):this.sourceBuffers.forEach(([c])=>{c&&this.append(this.getFlushOp(c,r,a),c)})}onFragParsed(e,t){const{frag:i,part:r}=t,a=[],c=r?r.elementaryStreams:i.elementaryStreams;c[ut.AUDIOVIDEO]?a.push("audiovideo"):(c[ut.AUDIO]&&a.push("audio"),c[ut.VIDEO]&&a.push("video"));const d=()=>{const h=self.performance.now();i.stats.buffering.end=h,r&&(r.stats.buffering.end=h);const f=r?r.stats:i.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:i,part:r,stats:f,id:i.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(d,a).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([c])=>{if(c){const d=this.tracks[c];(!t.type||t.type===c)&&(d.ending=!0,d.ended||(d.ended=!0,this.log(`${c} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([c])=>{var d;return c&&!((d=this.tracks[c])!=null&&d.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:c}=this;if(!c||c.readyState!=="open"){c&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${c.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),c.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===K.BUFFER_APPEND_ERROR&&t.frag){var i;const r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;ye(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const r=e.config,a=i.currentTime,c=t.levelTargetDuration,d=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ye(d)&&d>=0){const f=Math.max(d,c),m=Math.floor(a/c)*c-f;this.flushBackBuffer(a,c,m)}const h=r.frontBufferFlushThreshold;if(ye(h)&&h>0){const f=Math.max(r.maxBufferLength,h),m=Math.max(f,c),x=Math.floor(a/c)*c+m;this.flushFrontBuffer(a,c,x)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,a])=>{if(a){const d=Oe.getBuffered(a);if(d.length>0&&i>d.start(0)){var c;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:i});const h=this.tracks[r];if((c=this.details)!=null&&c.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(h!=null&&h.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,a])=>{if(a){const c=Oe.getBuffered(a),d=c.length;if(d<2)return;const h=c.start(d-1),f=c.end(d-1);if(i>h||e>=h&&e<=f)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const f=Math.max(0,t.fragmentStart),m=Math.max(f,r);return{duration:1/0,start:f,end:m}}return{duration:1/0}}const a=(e=this.overrides)==null?void 0:e.duration;if(a)return ye(a)?{duration:a}:null;const c=this.media.duration,d=ye(i.duration)?i.duration:0;return r>d&&r>c||!ye(c)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(ye(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${dt(i)}`),this.tracksReady){var r;const a=(r=this.transferData)==null?void 0:r.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const c=a,d=e[c];if(this.isPending(d)){const h=this.getTrackCodec(d,c),f=`${d.container};codecs=${h}`;d.codec=h,this.log(`creating sourceBuffer(${f})${this.currentOp(c)?" Queued":""} ${dt(d)}`);try{const m=i.addSourceBuffer(f),x=Ed(c),v=[c,m];t[x]=v,d.buffer=m}catch(m){var r;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(c),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[c],this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:c,mimeType:f,parent:d.id});return}this.trackSourceBuffer(c,d)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let r=e.codec;i&&(t==="video"||t==="audiovideo")&&Ma(i,"video")&&(r=kT(r,i));const a=vo(r,e.levelCodec);return a?t.slice(0,5)==="audio"?Co(a,this.appendSource):a:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(a,c)=>{const d=c.removedRanges;d!=null&&d.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const a=this.currentOp(e);a&&a.onError(r)}updateTimestampOffset(e,t,i,r,a,c){const d=t-e.timestampOffset;Math.abs(d)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${a} cc: ${c})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:r,mediaSource:a}=this,c=this.tracks[e],d=c==null?void 0:c.buffer;if(!r||!a||!d){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=ye(r.duration)?r.duration:1/0,f=ye(a.duration)?a.duration:1/0,m=Math.max(0,t),x=Math.min(i,h,f);x>m&&(!c.ending||c.ended)?(c.ended=!1,this.log(`Removing [${m},${x}] from the ${e} SourceBuffer`),d.remove(m,x)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],r=i==null?void 0:i.buffer;if(!r)throw new GL(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map(c=>this.appendBlocker(c));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(c=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const r=this.tracks[e];if(!r)return;const a=r.buffer;if(!a)return;const c=i.bind(this,e);r.listeners.push({event:t,listener:c}),a.addEventListener(t,c)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function qp(o){const e=o.querySelectorAll("source");[].slice.call(e).forEach(t=>{o.removeChild(t)})}function HL(o,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,o.appendChild(t)}function Ed(o){return o==="audio"?1:0}class Cf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ye(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,a)=>this.isLevelAllowed(r)&&a<=e);return this.clientRect=null,Cf.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(d,h)=>h?d.width!==h.width||d.height!==h.height:!0;let a=e.length-1;const c=Math.max(t,i);for(let d=0;d<e.length;d+=1){const h=e[d];if((h.width>=c||h.height>=c)&&r(h,e[d+1])){a=d;break}}return a}}const VL={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},fs=VL,KL={HLS:"h"},YL=KL;class ai{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof ai?i:new ai(i))),this.value=e,this.params=t}}const qL="Dict";function XL(o){return Array.isArray(o)?JSON.stringify(o):o instanceof Map?"Map{}":o instanceof Set?"Set{}":typeof o=="object"?JSON.stringify(o):String(o)}function QL(o,e,t,i){return new Error(`failed to ${o} "${XL(e)}" as ${t}`,{cause:i})}function li(o,e,t){return QL("serialize",o,e,t)}class $y{constructor(e){this.description=e}}const Xp="Bare Item",WL="Boolean";function ZL(o){if(typeof o!="boolean")throw li(o,WL);return o?"?1":"?0"}function JL(o){return btoa(String.fromCharCode(...o))}const e_="Byte Sequence";function t_(o){if(ArrayBuffer.isView(o)===!1)throw li(o,e_);return`:${JL(o)}:`}const s_="Integer";function i_(o){return o<-999999999999999||999999999999999<o}function Gy(o){if(i_(o))throw li(o,s_);return o.toString()}function n_(o){return`@${Gy(o.getTime()/1e3)}`}function zy(o,e){if(o<0)return-zy(-o,e);const t=Math.pow(10,e);if(Math.abs(o*t%1-.5)<Number.EPSILON){const r=Math.floor(o*t);return(r%2===0?r:r+1)/t}else return Math.round(o*t)/t}const r_="Decimal";function a_(o){const e=zy(o,3);if(Math.floor(Math.abs(e)).toString().length>12)throw li(o,r_);const t=e.toString();return t.includes(".")?t:`${t}.0`}const l_="String",o_=/[\x00-\x1f\x7f]+/;function c_(o){if(o_.test(o))throw li(o,l_);return`"${o.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function u_(o){return o.description||o.toString().slice(7,-1)}const d_="Token";function Qp(o){const e=u_(o);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw li(e,d_);return e}function Jd(o){switch(typeof o){case"number":if(!ye(o))throw li(o,Xp);return Number.isInteger(o)?Gy(o):a_(o);case"string":return c_(o);case"symbol":return Qp(o);case"boolean":return ZL(o);case"object":if(o instanceof Date)return n_(o);if(o instanceof Uint8Array)return t_(o);if(o instanceof $y)return Qp(o);default:throw li(o,Xp)}}const f_="Key";function ef(o){if(/^[a-z*][a-z0-9\-_.*]*$/.test(o)===!1)throw li(o,f_);return o}function Nf(o){return o==null?"":Object.entries(o).map(([e,t])=>t===!0?`;${ef(e)}`:`;${ef(e)}=${Jd(t)}`).join("")}function Hy(o){return o instanceof ai?`${Jd(o.value)}${Nf(o.params)}`:Jd(o)}function h_(o){return`(${o.value.map(Hy).join(" ")})${Nf(o.params)}`}function m_(o,e={whitespace:!0}){if(typeof o!="object"||o==null)throw li(o,qL);const t=o instanceof Map?o.entries():Object.entries(o),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,a])=>{a instanceof ai||(a=new ai(a));let c=ef(r);return a.value===!0?c+=Nf(a.params):(c+="=",Array.isArray(a.value)?c+=h_(a):c+=Hy(a)),c}).join(`,${i}`)}function Vy(o,e){return m_(o,e)}const Js="CMCD-Object",Tt="CMCD-Request",Rn="CMCD-Session",sn="CMCD-Status",g_={br:Js,ab:Js,d:Js,ot:Js,tb:Js,tpb:Js,lb:Js,tab:Js,lab:Js,url:Js,pb:Tt,bl:Tt,tbl:Tt,dl:Tt,ltc:Tt,mtp:Tt,nor:Tt,nrr:Tt,rc:Tt,sn:Tt,sta:Tt,su:Tt,ttfb:Tt,ttfbb:Tt,ttlb:Tt,cmsdd:Tt,cmsds:Tt,smrt:Tt,df:Tt,cs:Tt,ts:Tt,cid:Rn,pr:Rn,sf:Rn,sid:Rn,st:Rn,v:Rn,msd:Rn,bs:sn,bsd:sn,cdn:sn,rtp:sn,bg:sn,pt:sn,ec:sn,e:sn},p_={REQUEST:Tt};function x_(o){return Object.keys(o).reduce((e,t)=>{var i;return(i=o[t])===null||i===void 0||i.forEach(r=>e[r]=t),e},{})}function y_(o,e){const t={};if(!o)return t;const i=Object.keys(o),r=e?x_(e):{};return i.reduce((a,c)=>{var d;const h=g_[c]||r[c]||p_.REQUEST,f=(d=a[h])!==null&&d!==void 0?d:a[h]={};return f[c]=o[c],a},t)}function v_(o){return["ot","sf","st","e","sta"].includes(o)}function b_(o){return typeof o=="number"?ye(o):o!=null&&o!==""&&o!==!1}const Ky="event";function S_(o,e){const t=new URL(o),i=new URL(e);if(t.origin!==i.origin)return o;const r=t.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const Ao=o=>Math.round(o),tf=(o,e)=>Array.isArray(o)?o.map(t=>tf(t,e)):o instanceof ai&&typeof o.value=="string"?new ai(tf(o.value,e),o.params):(e.baseUrl&&(o=S_(o,e.baseUrl)),e.version===1?encodeURIComponent(o):o),uo=o=>Ao(o/100)*100,E_=(o,e)=>{let t=o;return e.version>=2&&(o instanceof ai&&typeof o.value=="string"?t=new ai([o]):typeof o=="string"&&(t=[o])),tf(t,e)},T_={br:Ao,d:Ao,bl:uo,dl:uo,mtp:uo,nor:E_,rtp:uo,tb:Ao},Yy="request",qy="response",kf=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],A_=["e"],L_=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Vo(o){return L_.test(o)}function __(o){return kf.includes(o)||A_.includes(o)||Vo(o)}const Xy=["d","dl","nor","ot","rtp","su"];function R_(o){return kf.includes(o)||Xy.includes(o)||Vo(o)}const w_=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function D_(o){return kf.includes(o)||Xy.includes(o)||w_.includes(o)||Vo(o)}const I_=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function C_(o){return I_.includes(o)||Vo(o)}const N_={[qy]:D_,[Ky]:__,[Yy]:R_};function Qy(o,e={}){const t={};if(o==null||typeof o!="object")return t;const i=e.version||o.v||1,r=e.reportingMode||Yy,a=i===1?C_:N_[r];let c=Object.keys(o).filter(a);const d=e.filter;typeof d=="function"&&(c=c.filter(d));const h=r===qy||r===Ky;h&&!c.includes("ts")&&c.push("ts"),i>1&&!c.includes("v")&&c.push("v");const f=ot({},T_,e.formatters),m={version:i,reportingMode:r,baseUrl:e.baseUrl};return c.sort().forEach(x=>{let v=o[x];const b=f[x];if(typeof b=="function"&&(v=b(v,m)),x==="v"){if(i===1)return;v=i}x=="pr"&&v===1||(h&&x==="ts"&&!ye(v)&&(v=Date.now()),b_(v)&&(v_(x)&&typeof v=="string"&&(v=new $y(v)),t[x]=v))}),t}function k_(o,e={}){const t={};if(!o)return t;const i=Qy(o,e),r=y_(i,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((a,[c,d])=>{const h=Vy(d,{whitespace:!1});return h&&(a[c]=h),a},t)}function M_(o,e,t){return ot(o,k_(e,t))}const O_="CMCD";function P_(o,e={}){return o?Vy(Qy(o,e),{whitespace:!1}):""}function j_(o,e={}){if(!o)return"";const t=P_(o,e);return encodeURIComponent(t)}function U_(o,e={}){if(!o)return"";const t=j_(o,e);return`${O_}=${t}`}const Wp=/CMCD=[^&#]+/;function F_(o,e,t){const i=U_(e,t);if(!i)return o;if(Wp.test(o))return o.replace(Wp,i);const r=o.includes("?")?"&":"?";return`${o}${r}${i}`}class B_{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:fs.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=r=>{try{const{frag:a,part:c}=r,d=this.hls.levels[a.level],h=this.getObjectType(a),f={d:(c||a).duration*1e3,ot:h};(h===fs.VIDEO||h===fs.AUDIO||h==fs.MUXED)&&(f.br=d.bitrate/1e3,f.tb=this.getTopBandwidth(h)/1e3,f.bl=this.getBufferLength(h));const m=c?this.getNextPart(c):this.getNextFrag(a);m!=null&&m.url&&m.url!==a.url&&(f.nor=m.url),this.apply(r,f)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:YL.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ot(t,this.createData());const i=t.ot===fs.INIT||t.ot===fs.VIDEO||t.ot===fs.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((c,d)=>(r.includes(d)&&(c[d]=t[d]),c),{}));const a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),M_(e.headers,t,a)):e.url=F_(e.url,t,a)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t;const{index:i,fragment:r}=e,a=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(a){const{sn:c}=r;for(let d=a.length-1;d>=0;d--){const h=a[d];if(h.index===i&&h.fragment.sn===c)return a[d+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return fs.TIMED_TEXT;if(e.sn==="initSegment")return fs.INIT;if(t==="audio")return fs.AUDIO;if(t==="main")return this.hls.audioTracks.length?fs.VIDEO:fs.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===fs.AUDIO)i=r.audioTracks;else{const a=r.maxAutoLevel,c=a>-1?a+1:r.levels.length;i=r.levels.slice(0,c)}return i.forEach(a=>{a.bitrate>t&&(t=a.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===fs.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Oe.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new i(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,c,d){t(a),this.loader.load(a,c,d)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new i(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,c,d){t(a),this.loader.load(a,c,d)}}}}const $_=3e5;class G_ extends Gs{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===Xt.SendAlternateToPenaltyBox&&i.flags===Es.MoveAllAlternatesMatchingHost){const r=this.levels;let a=this._pathwayPriority,c=this.pathwayId;if(t.context){const{groupId:d,pathwayId:h,type:f}=t.context;d&&r?c=this.getPathwayForGroupId(d,f,c):h&&(c=h)}c in this.penalizedPathways||(this.penalizedPathways[c]=performance.now()),!a&&r&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),i.resolved=this.pathwayId!==c),t.details===K.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${c} levels: ${r&&r.length} priorities: ${dt(a)} penalized: ${dt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(a=>{r-i[a]>$_&&delete i[a]});for(let a=0;a<e.length;a++){const c=e[a];if(c in i)continue;if(c===this.pathwayId)return;const d=this.hls.nextLoadLevel,h=this.hls.levels[d];if(t=this.getLevelsForPathway(c),t.length>0){this.log(`Setting Pathway to "${c}"`),this.pathwayId=c,py(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const f=this.hls.levels[d];h&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=d);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let a=0;a<r.length;a++)if(t===$e.AUDIO_TRACK&&r[a].hasAudioGroup(e)||t===$e.SUBTITLE_TRACK&&r[a].hasSubtitleGroup(e))return r[a].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(a=>{const{ID:c,"BASE-ID":d,"URI-REPLACEMENT":h}=a;if(t.some(m=>m.pathwayId===c))return;const f=this.getLevelsForPathway(d).map(m=>{const x=new yt(m.attrs);x["PATHWAY-ID"]=c;const v=x.AUDIO&&`${x.AUDIO}_clone_${c}`,b=x.SUBTITLES&&`${x.SUBTITLES}_clone_${c}`;v&&(i[x.AUDIO]=v,x.AUDIO=v),b&&(r[x.SUBTITLES]=b,x.SUBTITLES=b);const S=Wy(m.uri,x["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),A=new Pa({attrs:x,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:S,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let E=1;E<m.audioGroups.length;E++)A.addGroupId("audio",`${m.audioGroups[E]}_clone_${c}`);if(m.subtitleGroups)for(let E=1;E<m.subtitleGroups.length;E++)A.addGroupId("text",`${m.subtitleGroups[E]}_clone_${c}`);return A});t.push(...f),Zp(this.audioTracks,i,h,c),Zp(this.subtitleTracks,r,h,c)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+m)}const a={responseType:"json",url:r.href},c=t.steeringManifestLoadPolicy.default,d=c.errorRetry||c.timeoutRetry||{},h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},f={onSuccess:(m,x,v,b)=>{this.log(`Loaded steering manifest: "${r}"`);const S=m.data;if((S==null?void 0:S.VERSION)!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":_}=S;if(A)try{this.uri=new self.URL(A,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||v.url),E&&this.clonePathways(E);const R={steeringManifest:S,url:r.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,R),_&&this.updatePathwayPriority(_)},onError:(m,x,v,b)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${x.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${x.url} no longer available`);return}let S=this.timeToLoad*1e3;if(m.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const E=A.getResponseHeader("Retry-After");E&&(S=parseFloat(E)*1e3)}this.log(`Steering manifest ${x.url} rate limited`);return}this.scheduleRefresh(this.uri||x.url,S)},onTimeout:(m,x,v)=>{this.log(`Timeout loading steering manifest (${x.url})`),this.scheduleRefresh(this.uri||x.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(a,h,f)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Zp(o,e,t,i){o&&Object.keys(e).forEach(r=>{const a=o.filter(c=>c.groupId===r).map(c=>{const d=ot({},c);return d.details=void 0,d.attrs=new yt(d.attrs),d.url=d.attrs.URI=Wy(c.url,c.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),d.groupId=d.attrs["GROUP-ID"]=e[r],d.attrs["PATHWAY-ID"]=i,d});o.push(...a)})}function Wy(o,e,t,i){const{HOST:r,PARAMS:a,[t]:c}=i;let d;e&&(d=c==null?void 0:c[e],d&&(o=d));const h=new self.URL(o);return r&&!d&&(h.host=r),a&&Object.keys(a).sort().forEach(f=>{f&&h.searchParams.set(f,a[f])}),h.href}class Dr extends Gs{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Dr.CDMCleanupPromise?[Dr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:r}=t,a=`"${t.type}" event: init data type: "${i}"`;if(this.debug(a),r!==null){if(!this.keyFormatPromise){let c=Object.keys(this.keySystemAccessPromises);c.length||(c=Ra(this.config));const d=c.map(md).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(d)}this.keyFormatPromise.then(c=>{const d=So(c);if(i!=="sinf"||d!==vt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${d}`);return}let h;try{const b=jt(new Uint8Array(r)),S=Sf(JSON.parse(b).sinf),A=Vx(S);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(A.subarray(8,24))}catch(b){this.warn(`${a} Failed to parse sinf: ${b}`);return}const f=Qt(h),{keyIdToKeySessionPromise:m,mediaKeySessions:x}=this;let v=m[f];for(let b=0;b<x.length;b++){const S=x[b],A=S.decryptdata;if(!A.keyId)continue;const E=Qt(A.keyId);if(Po(h,A.keyId)||A.uri.replace(/-/g,"").indexOf(f)!==-1){if(v=m[E],!v)continue;if(A.pssh)break;delete m[E],A.pssh=new Uint8Array(r),A.keyId=h,v=m[f]=v.then(()=>this.generateRequestWithPreferredKeySession(S,i,r,"encrypted-event-key-match")),v.catch(_=>this.handleError(_));break}}v||this.handleError(new Error(`Key ID ${f} not encountered in playlist. Key-system sessions ${x.length}.`))}).catch(c=>this.handleError(c))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===vt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t==null?void 0:t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(c,d,h)=>!!c&&h.indexOf(c)===d,r=t.map(c=>c.audioCodec).filter(i),a=t.map(c=>c.videoCodec).filter(i);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((c,d)=>{const h=f=>{const m=f.shift();this.getMediaKeysPromise(m,r,a).then(x=>c({keySystem:m,mediaKeys:x})).catch(x=>{f.length?h(f):x instanceof Ss?d(x):d(new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_ACCESS,error:x,fatal:!0},x.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return oy===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){var r;const a=EA(e,t,i,this.config.drmSystemOptions||{});let c=this.keySystemAccessPromises[e],d=(r=c)==null?void 0:r.keySystemAccess;if(!d){this.log(`Requesting encrypted media "${e}" key-system access with config: ${dt(a)}`),d=this.requestMediaKeySystemAccess(e,a);const h=c=this.keySystemAccessPromises[e]={keySystemAccess:d};return d.catch(f=>{this.log(`Failed to obtain access to key-system "${e}": ${f}`)}),d.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const m=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const x=h.mediaKeys=f.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,m.then(b=>b?this.setMediaKeysServerCertificate(v,e,b):v)));return x.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),x})}return d.then(()=>c.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Qt(e.keyId||[])} keyUri: ${e.uri}`);const r=i.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=fo(t),a="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,a,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${Qt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>md(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const a=md(r);a?t(a):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ra(this.config),i=e.map(So).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const r=z_(e,t[i]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,i=fo(t),r=this.bannedKeyIds[i];if(r||this.getKeyStatus(t)==="internal-error"){const d=Jp(r||"internal-error",t);return this.handleError(d,e.frag),Promise.reject(d)}const a=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${a}`);const c=this.keyIdToKeySessionPromise[i];if(!c){const d=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:f})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${a}`),this.attemptSetMediaKeys(h,f).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:f,decryptdata:t}))))).then(h=>{const f="cenc",m=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,f,m,"playlist-key")});return d.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[i]=d,d}return c.catch(d=>{if(d instanceof Ss){const h=tt({},d.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const f=new Ss(h,d.message);this.handleError(f,e.frag)}}),c}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ss){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${Qt(i.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=fo(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=So(e.keyFormat),a=r?[r]:Ra(this.config);return this.attemptKeySystemAccess(a)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=Ra(this.config)),e.length===0)throw new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${dt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(t):new Promise((a,c)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return c(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(a).catch(c)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>i.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var a;const c=(a=this.config.drmSystems)==null||(a=a[e.keySystem])==null?void 0:a.generateRequest;if(c)try{const S=c.call(this.hls,t,i,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,i=S.initData?S.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const d=fo(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${d} URI: ${h} (init data type: ${t} length: ${i.byteLength})`);const f=new Tf,m=e._onmessage=S=>{const A=e.mediaKeysSession;if(!A){f.emit("error",new Error("invalid state"));return}const{messageType:E,message:_}=S;this.log(`"${E}" message event for session "${A.sessionId}" message size: ${_.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,_).catch(R=>{f.eventNames().length?f.emit("error",R):this.handleError(R)}):E==="license-release"?e.keySystem===vt.FAIRPLAY&&this.updateKeySession(e,Yd("acknowledged")).then(()=>this.removeSession(e)).catch(R=>this.handleError(R)):this.warn(`unhandled media key message type "${E}"`)},x=(S,A)=>{A.keyStatus=S;let E;S.startsWith("usable")?f.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?E=Jp(S,A.decryptdata):S==="expired"?E=new Error(`key expired (keyId: ${d})`):S==="released"?E=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${d})`),E&&(f.eventNames().length?f.emit("error",E):this.handleError(E))},v=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){f.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(k=>E[k]!=="status-pending"))return;if(E[d]==="expired"){this.log(`Expired key ${dt(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let R=E[d];if(R)x(R,e);else{var D;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(D=e.keyStatusTimeouts)[d]||(D[d]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const O=this.getKeyStatus(e.decryptdata);if(O&&O!=="status-pending")return this.log(`No status for keyId ${d} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${O} from other session.`),x(O,e);this.log(`key status for ${d} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),R="internal-error",x(R,e)},1e3)),this.log(`No status for keyId ${d} (${dt(E)}).`)}};is(e.mediaKeysSession,"message",m),is(e.mediaKeysSession,"keystatuseschange",v);const b=new Promise((S,A)=>{f.on("error",A),f.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${d} URI: ${h}`)}).catch(S=>{throw new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>b).catch(S=>(f.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(f.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,r)=>{if(typeof r=="string"&&typeof i=="object"){const d=r;r=i,i=d}const a="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===vt.PLAYREADY&&a.length===16){const d=Qt(a);t[d]=i,ay(a)}const c=Qt(a);i==="internal-error"&&(this.bannedKeyIds[c]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${c} key-session "${e.mediaKeysSession.sessionId}"`),t[c]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching server certificate for "${e}"`),new Promise((c,d)=>{const h={responseType:"arraybuffer",url:a},f=t.certLoadPolicy.default,m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},x={onSuccess:(v,b,S,A)=>{c(v.data)},onError:(v,b,S,A)=>{d(new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:tt({url:h.url,data:void 0},v)},`"${e}" certificate request failed (${a}). Status: ${v.code} (${v.text})`))},onTimeout:(v,b,S)=>{d(new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(v,b,S)=>{d(new Error("aborted"))}};r.load(h,m,x)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,a)=>{e.setServerCertificate(i).then(c=>{this.log(`setServerCertificate ${c?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),r(e)}).catch(c=>{a(new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:c,fatal:!0},c.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let m;for(let x=0,v=a.length;x<v;x++){var c,d;m=a[x];const b=(c=m.querySelector("name"))==null?void 0:c.textContent,S=(d=m.querySelector("value"))==null?void 0:d.textContent;b&&S&&e.setRequestHeader(b,S)}}const h=r.querySelector("Challenge"),f=h==null?void 0:h.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return Yd(atob(f))}setupLicenseXHR(e,t,i,r){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return a.call(this.hls,e,t,i,r)}).catch(c=>{if(!i.decryptdata)throw c;return e.open("POST",t,!0),a.call(this.hls,e,t,i,r)}).then(c=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:c||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{const c=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${c}`);const d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(d.readyState===4)if(d.status===200){this._requestLicenseFailureCount=0;let h=d.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const f=this.config.licenseResponseCallback;if(f)try{h=f.call(this.hls,d,c,e)}catch(m){this.error(m)}r(h)}else{const h=i.errorRetry,f=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||d.status>=400&&d.status<500)a(new Ss({type:_e.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:d,response:{url:c,data:void 0,code:d.status,text:d.statusText}},`License Request XHR failed (${c}). Status: ${d.status} (${d.statusText})`));else{const m=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,this.setupLicenseXHR(d,c,e,t).then(({xhr:h,licenseChallenge:f})=>{e.keySystem==vt.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(h,f)),h.send(f)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,is(i,"encrypted",this.onMediaEncrypted),is(i,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(hs(e,"encrypted",this.onMediaEncrypted),hs(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,an.clearKeyUriToKeyIdMap();const a=r.length;Dr.CDMCleanupPromise=Promise.all(r.map(c=>this.removeSession(c)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(c=>{this.log(`Could not clear media keys: ${c}`),this.hls&&this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${c}`)})}))||Promise.resolve())).catch(c=>{this.log(`Could not close sessions and clear media keys: ${c}`),this.hls&&this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${c}`)})}).then(()=>{a&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,a)=>(r.indexOf(a.keyFormat)===-1&&r.push(a.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Qt((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const a=this.mediaKeySessions.indexOf(e);a>-1&&this.mediaKeySessions.splice(a,1);const{keyStatusTimeouts:c}=e;c&&Object.keys(c).forEach(f=>self.clearTimeout(c[f]));const{drmSystemOptions:d}=this.config;return(AA(d)?new Promise((f,m)=>{self.setTimeout(()=>m(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(f).catch(m)}):Promise.resolve()).catch(f=>{this.log(`Could not remove session: ${f}`),this.hls&&this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${f}`)})}).then(()=>t.close()).catch(f=>{this.log(`Could not close session: ${f}`),this.hls&&this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${f}`)})})}return Promise.resolve()}}Dr.CDMCleanupPromise=void 0;function fo(o){if(!o)throw new Error("Could not read keyId of undefined decryptdata");if(o.keyId===null)throw new Error("keyId is null");return Qt(o.keyId)}function z_(o,e){if(o.keyId&&e.mediaKeysSession.keyStatuses.has(o.keyId))return e.mediaKeysSession.keyStatuses.get(o.keyId);if(o.matches(e.decryptdata))return e.keyStatus}class Ss extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Jp(o,e){const t=o==="output-restricted",i=t?K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:K.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ss({type:_e.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${o}"`)}class H_{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const a=r-this.lastTime,c=i-this.lastDroppedFrames,d=t-this.lastDecodedFrames,h=1e3*c/a,f=this.hls;if(f.trigger(L.FPS_DROP,{currentDropped:c,currentDecoded:d,totalDroppedFrames:i}),h>0&&c>f.config.fpsDroppedMonitoringThreshold*d){let m=f.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=m)&&(m=m-1,f.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:f.currentLevel}),f.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Zy(o,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=o,e.dispatchEvent(t)}function Jy(o,e){const t=o.mode;if(t==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(e.id))try{if(o.addCue(e),!o.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){st.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,o.addCue(r)}catch(r){st.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(o.mode=t)}function Lr(o,e){const t=o.mode;if(t==="disabled"&&(o.mode="hidden"),o.cues)for(let i=o.cues.length;i--;)e&&o.cues[i].removeEventListener("enter",e),o.removeCue(o.cues[i]);t==="disabled"&&(o.mode=t)}function sf(o,e,t,i){const r=o.mode;if(r==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0){const a=K_(o.cues,e,t);for(let c=0;c<a.length;c++)(!i||i(a[c]))&&o.removeCue(a[c])}r==="disabled"&&(o.mode=r)}function V_(o,e){if(e<=o[0].startTime)return 0;const t=o.length-1;if(e>o[t].endTime)return-1;let i=0,r=t,a;for(;i<=r;)if(a=Math.floor((r+i)/2),e<o[a].startTime)r=a-1;else if(e>o[a].startTime&&i<t)i=a+1;else return a;return o[i].startTime-e<e-o[r].startTime?i:r}function K_(o,e,t){const i=[],r=V_(o,e);if(r>-1)for(let a=r,c=o.length;a<c;a++){const d=o[a];if(d.startTime>=e&&d.endTime<=t)i.push(d);else if(d.startTime>t)return i}return i}function Lo(o){const e=[];for(let t=0;t<o.length;t++){const i=o[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(o[t])}return e}class Y_ extends If{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Lo(this.media.textTracks);for(let a=0;a<i.length;a++)if(i[a].mode==="hidden")t=i[a];else if(i[a].mode==="showing"){t=i[a];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Lo(i.textTracks).forEach(c=>{Lr(c)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:a}=t,c=this.tracksInGroup[i];if(!c||c.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${c==null?void 0:c.groupId}`);return}const d=c.details;c.details=t.details,this.log(`Subtitle track ${i} "${c.name}" lang:${c.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,d)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let a=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(c=>(r==null?void 0:r.indexOf(c))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(m=>m.default)&&(this.selectDefaultTrack=!1),c.forEach((m,x)=>{m.id=x});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const d=this.hls.config.subtitlePreference;if(!a&&d){this.selectDefaultTrack=!1;const m=ni(d,c);if(m>-1)a=c[m];else{const x=ni(d,this.tracks);a=this.tracks[x]}}let h=this.findTrackId(a);h===-1&&a&&(h=this.findTrackId(null));const f={subtitleTracks:c};this.log(`Updating subtitle tracks, ${c.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,f),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const a=t[r];if(!(i&&!a.default||!i&&!e)&&(!e||In(a,e)))return r}if(e){for(let r=0;r<t.length;r++){const a=t[r];if(Ba(e.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const a=t[r];if(Ba(e.attrs,a.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(Zd(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===$e.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&In(e,i))return i;const r=ni(e,this.tracksInGroup);if(r>-1){const a=this.tracksInGroup[r];return this.setSubtitleTrack(r),a}else{if(i)return null;{const a=ni(e,t);if(a>-1)return t[a]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),c=e.details,d=c==null?void 0:c.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${d&&c.live?" age "+d.toFixed(1)+(c.type&&" "+c.type||""):""} ${a}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Lo(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(a=>Zd(i,a))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(a=>{a.mode!=="disabled"&&a!==r&&(a.mode="disabled")}),r){const a=this.subtitleDisplay?"showing":"hidden";r.mode!==a&&(r.mode=a)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ye(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const a=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&a)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:c,groupId:d="",name:h,type:f,url:m}=r;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:c,groupId:d,name:h,type:f,url:m});const x=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(x)}}function q_(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const a=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?a:a&3|8).toString(16)})}}}function Ia(o){let e=5381,t=o.length;for(;t;)e=e*33^o.charCodeAt(--t);return(e>>>0).toString()}const Ir=.025;let Bo=(function(o){return o[o.Point=0]="Point",o[o.Range=1]="Range",o})({});function X_(o,e,t){return`${o.identifier}-${t+1}-${Ia(e)}`}class Q_{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Td(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Td(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ye(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Td(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ir))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Bo.Range:Bo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return W_(this)}}function Td(o,e){return o-e.start<e.duration/2&&!(Math.abs(o-(e.start+e.duration))<Ir)?e.start:e.start+e.duration}function ev(o,e,t){const i=new self.URL(o,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function Ad(o,e){for(;(t=o.assetList[++e])!=null&&t.error;)var t;return e}function W_(o){return`["${o.identifier}" ${o.cue.pre?"<pre>":o.cue.post?"<post>":""}${o.timelineStart.toFixed(2)}-${o.resumeTime.toFixed(2)}]`}function Ar(o){const e=o.timelineStart,t=o.duration||0;return`["${o.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Z_{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new e(t);this.interstitial=i,this.assetItem=r;const c=()=>{this.hasDetails=!0};a.once(L.LEVEL_LOADED,c),a.once(L.AUDIO_TRACK_LOADED,c),a.once(L.SUBTITLE_TRACK_LOADED,c),a.on(L.MEDIA_ATTACHING,(d,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(L.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,a.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=ev(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,a=Oe.bufferInfo(e,r,0);return this.getAssetTime(a.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Oe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,i){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,i){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ar(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const ex=.033;class J_ extends Gs{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(a=r[i])!=null&&a.event;){var a;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let r=0;r<i.length;r++){let a=i[r];if(t&&t!=="primary"&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return r}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){const a=i[r].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){const i=e.assetList,r=i.length;if(r>1)for(let a=0;a<r;a++){const c=i[a];if(!c.error){const d=c.timelineStart;if(t===d||t>d&&(t<d+(c.duration||0)||a===r-1))return a}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:r}=i,a=this.events,c=this.parseDateRanges(r,{url:i.url},t),d=Object.keys(r),h=a?a.filter(f=>!d.includes(f.identifier)):[];c.length&&c.sort((f,m)=>{const x=f.cue.pre,v=f.cue.post,b=m.cue.pre,S=m.cue.post;if(x&&!b)return-1;if(b&&!x||v&&!S)return 1;if(S&&!v)return-1;if(!x&&!b&&!v&&!S){const A=f.startTime,E=m.startTime;if(A!==E)return A-E}return f.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=c,h.forEach(f=>{this.removeEvent(f)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],i=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const a=this.items,c=this.parseSchedule(r,e);(i||t.length||(a==null?void 0:a.length)!==c.length||c.some((h,f)=>Math.abs(h.playout.start-a[f].playout.start)>.005||Math.abs(h.playout.end-a[f].playout.end)>.005))&&(this.items=c,this.onScheduleUpdate(t,a))}}parseDateRanges(e,t,i){const r=[],a=Object.keys(e);for(let c=0;c<a.length;c++){const d=a[c],h=e[d];if(h.isInterstitial){let f=this.eventMap[d];f?f.setDateRange(h):(f=new Q_(h,t),this.eventMap[d]=f,i===!1&&(f.appendInPlace=i)),r.push(f)}}return r}parseSchedule(e,t){const i=[],r=t.main.details,a=r.live?1/0:r.edge;let c=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,f=0;if(e.forEach((m,x)=>{const v=m.cue.pre,b=m.cue.post,S=e[x-1]||null,A=m.appendInPlace,E=b?a:m.startOffset,_=m.duration,R=m.timelineOccupancy===Bo.Range?_:0,D=m.resumptionOffset,k=(S==null?void 0:S.startTime)===E,O=E+m.cumulativeDuration;let F=A?O+_:E+D;if(v||!b&&E<=0){const B=f;f+=R,m.timelineStart=O;const C=c;c+=_,i.push({event:m,start:O,end:F,playout:{start:C,end:c},integrated:{start:B,end:f}})}else if(E<=a){if(!k){const P=E-h;if(P>ex){const W=h,ue=f;f+=P;const me=c;c+=P;const ee={previousEvent:e[x-1]||null,nextEvent:m,start:W,end:W+P,playout:{start:me,end:c},integrated:{start:ue,end:f}};i.push(ee)}else P>0&&S&&(S.cumulativeDuration+=P,i[i.length-1].end=E)}b&&(F=O),m.timelineStart=O;const B=f;f+=R;const C=c;c+=_,i.push({event:m,start:O,end:F,playout:{start:C,end:c},integrated:{start:B,end:f}})}else return;const N=m.resumeTime;b||N>a?h=a:h=N}),h<a){var d;const m=h,x=f,v=a-h;f+=v;const b=c;c+=v,i.push({previousEvent:((d=i[i.length-1])==null?void 0:d.event)||null,nextEvent:null,start:h,end:m+v,playout:{start:b,end:c},integrated:{start:x,end:f}})}this.setDurations(a,c,f)}else i.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,r=i.live?1/0:i.edge;let a=0,c=-1;e.forEach((d,h)=>{const f=d.cue.pre,m=d.cue.post,x=f?0:m?r:d.startTime;this.updateAssetDurations(d),c===x?d.cumulativeDuration=a:(a=0,c=x),!m&&d.snapOptions.in&&(d.resumeAnchor=Nn(null,i.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(d,t)||(d.appendInPlace=!1)),!d.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<ex&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${d}`));const b=ye(d.resumeOffset)?d.resumeOffset:d.duration;a+=b})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>Ir?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(c=>{const d=t[c].details,h=d.edge;if(i>=h)return this.log(`"${e.identifier}" resumption ${i} past ${c} playlist end ${h}`),!1;const f=Nn(null,d.fragments,i);if(!f)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${c} playlist (${d.fragStart}-${d.fragmentEnd})`),!0;const m=c==="audio"?.175:0;return Math.abs(f.start-i)<Ir+m||Math.abs(f.end-i)<Ir+m?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${c} fragment bounds (${f.start}-${f.end} sn: ${f.sn} cc: ${f.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,r=!1,a=!1;for(let c=0;c<e.assetList.length;c++){const d=e.assetList[c],h=t+i;d.startOffset=i,d.timelineStart=h,r||(r=d.duration===null),a||(a=!!d.error);const f=d.error?0:d.duration||0;i+=f}r&&!a?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ks(o){return`[${o.event?'"'+o.event.identifier+'"':"primary"}: ${o.start.toFixed(2)}-${o.end.toFixed(2)}]`}class eR{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let r;try{r=ev(i,this.hls.sessionId,e.baseUrl)}catch(v){const b=this.assignAssetListError(e,K.ASSET_LIST_LOAD_ERROR,v,i);this.hls.trigger(L.ERROR,b);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const a=this.hls.config,c=a.loader,d=new c(a),h={responseType:"json",url:r.href},f=a.interstitialAssetListLoadPolicy.default,m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},x={onSuccess:(v,b,S,A)=>{const E=v.data,_=E==null?void 0:E.ASSETS;if(!Array.isArray(_)){const R=this.assignAssetListError(e,K.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,b,A);this.hls.trigger(L.ERROR,R);return}e.assetListResponse=E,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:A})},onError:(v,b,S,A)=>{const E=this.assignAssetListError(e,K.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${b.url})`),b.url,A,S);this.hls.trigger(L.ERROR,E)},onTimeout:(v,b,S)=>{const A=this.assignAssetListError(e,K.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${b.url})`),b.url,v,S);this.hls.trigger(L.ERROR,A)}};return d.load(h,m,x),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),d}assignAssetListError(e,t,i,r,a,c){return e.error=i,{type:_e.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:c,stats:a}}}function tx(o){var e;o==null||(e=o.play())==null||e.catch(()=>{})}function ho(o,e){return`[${o}] Advancing timeline position to ${e}`}class tR extends Gs{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const c=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const d=this.playingItem;if(!d){this.checkBuffer();return}if(c&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),c&&i<d.start||i>=d.end){var h;const b=this.findItemIndex(d);let S=this.schedule.findItemIndexAtTime(i);if(S===-1&&(S=b+(c?-1:1),this.log(`seeked ${c?"back ":""}to position not covered by schedule ${i} (resolving from ${b} to ${S})`)),!this.isInterstitial(d)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!c&&S>b){const A=this.schedule.findJumpRestrictedIndex(b+1,S);if(A>b){this.setSchedulePosition(A);return}}this.setSchedulePosition(S);return}const f=this.playingAsset;if(!f){if(this.playingLastItem&&this.isInterstitial(d)){const b=d.event.assetList[0];b&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,b))}return}const m=f.timelineStart,x=f.duration||0;if(c&&i<m||i>=m+x){var v;(v=d.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(d.event,d),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,f)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const d=this.findItemIndex(r);this.setSchedulePosition(d+1)}const a=this.playingAsset;if(!a)return;const c=a.timelineStart+(a.duration||0);i>=c&&this.setScheduleToAssetAtTime(i,a)},this.onScheduleUpdate=(i,r)=>{const a=this.schedule;if(!a)return;const c=this.playingItem,d=a.events||[],h=a.items||[],f=a.durations,m=i.map(A=>A.identifier),x=!!(d.length||m.length);(x||r)&&this.log(`INTERSTITIALS_UPDATED (${d.length}): ${d}
Schedule: ${h.map(A=>Ks(A))} pos: ${this.timelinePos}`),m.length&&this.log(`Removed events ${m}`);let v=null,b=null;c&&(v=this.updateItem(c,this.timelinePos),this.itemsMatch(c,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(b=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,b)?this.bufferingItem=b:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),i.forEach(A=>{A.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const E=A.assetItem.timelineStart,_=A.timelineOffset-E;if(_)try{A.timelineOffset=E}catch(R){Math.abs(_)>Ir&&this.warn(`${R} ("${A.assetId}" ${A.timelineOffset}->${E})`)}}}),x||r){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:d.slice(0),schedule:h.slice(0),durations:f,removedIds:m}),this.isInterstitial(c)&&m.includes(c.event.identifier)){this.warn(`Interstitial "${c.event.identifier}" removed while playing`),this.primaryFallback(c.event);return}c&&this.trimInPlace(v,c),S&&b!==v&&this.trimInPlace(b,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new eR(e),this.schedule=new J_(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){hs(e,"play",this.onPlay),hs(e,"pause",this.onPause),hs(e,"seeking",this.onSeeking),hs(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;is(i,"seeking",this.onSeeking),is(i,"timeupdate",this.onTimeupdate),is(i,"play",this.onPlay),is(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const a=this.findItemIndex(i);this.setSchedulePosition(a)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.log(`Removing schedule state for detachedData and ${a}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=x=>x&&e.getAssetPlayer(x.identifier),r=(x,v,b,S,A)=>{if(x){let E=x[v].start;const _=x.event;if(_){if(v==="playout"||_.timelineOccupancy!==Bo.Point){const R=i(b);(R==null?void 0:R.interstitial)===_&&(E+=R.assetItem.startOffset+R[A])}}else{const R=S==="bufferedPos"?c():e[S];E+=R-x.start}return E}return 0},a=(x,v)=>{var b;if(x!==0&&v!=="primary"&&(b=e.schedule)!=null&&b.length){var S;const A=e.schedule.findItemIndexAtTime(x),E=(S=e.schedule.items)==null?void 0:S[A];if(E){const _=E[v].start-E.start;return x+_}}return x},c=()=>{const x=e.bufferedPos;return x===Number.MAX_VALUE?d("primary"):Math.max(x,0)},d=x=>{var v,b;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:((b=e.schedule)==null?void 0:b.durations[x])||0},h=(x,v)=>{var b,S;const A=e.effectivePlayingItem;if(A!=null&&(b=A.event)!=null&&b.restrictions.skip||!e.schedule)return;e.log(`seek to ${x} "${v}"`);const E=e.effectivePlayingItem,_=e.schedule.findItemIndexAtTime(x,v),R=(S=e.schedule.items)==null?void 0:S[_],D=e.getBufferingPlayer(),k=D==null?void 0:D.interstitial,O=k==null?void 0:k.appendInPlace,F=E&&e.itemsMatch(E,R);if(E&&(O||F)){const N=i(e.playingAsset),B=(N==null?void 0:N.media)||e.primaryMedia;if(B){const C=v==="primary"?B.currentTime:r(E,v,e.playingAsset,"timelinePos","currentTime"),P=x-C,W=(O?C:B.currentTime)+P;if(W>=0&&(!N||O||W<=N.duration)){B.currentTime=W;return}}}if(R){let N=x;if(v!=="primary"){const C=R[v].start,P=x-C;N=R.start+P}const B=!e.isInterstitial(R);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(B||R.event.appendInPlace)){const C=e.media||(O?D==null?void 0:D.media:null);C&&(C.currentTime=N)}else if(E){const C=e.findItemIndex(E);if(_>C){const W=e.schedule.findJumpRestrictedIndex(C+1,_);if(W>C){e.setSchedulePosition(W);return}}let P=0;if(B)e.timelinePos=N,e.checkBuffer();else{const W=R.event.assetList,ue=x-(R[v]||R).start;for(let me=W.length;me--;){const ee=W[me];if(ee.duration&&ue>=ee.startOffset&&ue<ee.startOffset+ee.duration){P=me;break}}}e.setSchedulePosition(_,P)}}},f=()=>{const x=e.effectivePlayingItem;if(e.isInterstitial(x))return x;const v=t();return e.isInterstitial(v)?v:null},m={get bufferedEnd(){const x=t(),v=e.bufferingItem;if(v&&v===x){var b;return r(v,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((b=e.bufferingAsset)==null?void 0:b.startOffset)||0}return 0},get currentTime(){const x=f(),v=e.effectivePlayingItem;return v&&v===x?r(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(x){const v=f(),b=e.effectivePlayingItem;b&&b===v&&h(x+b.playout.start,"playout")},get duration(){const x=f();return x?x.playout.end-x.playout.start:0},get assetPlayers(){var x;const v=(x=f())==null?void 0:x.event.assetList;return v?v.map(b=>e.getAssetPlayer(b.identifier)):[]},get playingIndex(){var x;const v=(x=f())==null?void 0:x.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return f()}};return this.manager={get events(){var x;return((x=e.schedule)==null||(x=x.events)==null?void 0:x.slice(0))||[]},get schedule(){var x;return((x=e.schedule)==null||(x=x.items)==null?void 0:x.slice(0))||[]},get interstitialPlayer(){return f()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const x=t();return e.findItemIndex(x)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const x=e.effectivePlayingItem;return e.findItemIndex(x)},primary:{get bufferedEnd(){return c()},get currentTime(){const x=e.timelinePos;return x>0?x:0},set currentTime(x){h(x,"primary")},get duration(){return d("primary")},get seekableStart(){var x;return((x=e.primaryDetails)==null?void 0:x.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(x){h(x,"integrated")},get duration(){return d("integrated")},get seekableStart(){var x;return a(((x=e.primaryDetails)==null?void 0:x.fragmentStart)||0,"integrated")}},skip:()=>{const x=e.effectivePlayingItem,v=x==null?void 0:x.event;if(v&&!v.restrictions.skip){const b=e.findItemIndex(x);if(v.appendInPlace){const S=x.playout.start+x.event.duration;h(S+.001,"playout")}else e.advanceAfterAssetEnded(v,b,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const a=(t=r)==null?void 0:t.currentTime;if(!(a===void 0||!ye(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const a=e.transferMedia();this.log(`transfer MediaSource from ${e} ${dt(a)}`),this.detachedData=a}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let a=null;const c=this.hls,d=e!==c,h=d&&e.interstitial.appendInPlace,f=(i=this.detachedData)==null?void 0:i.mediaSource;let m;if(c.media)h&&(a=c.transferMedia(),this.detachedData=a),m="Primary";else if(f){const S=this.getBufferingPlayer();S?(a=S.transferMedia(),m=`${S}`):m="detached MediaSource"}else m="detached media";if(!a){if(f)a=this.detachedData,this.log(`using detachedData: MediaSource ${dt(a)}`);else if(!this.detachedData||c.media===t){const S=this.playerQueue;S.length>1&&S.forEach(A=>{if(d&&A.interstitial.appendInPlace!==h){const E=A.interstitial;this.clearInterstitial(A.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const x=a&&"mediaSource"in a&&((r=a.mediaSource)==null?void 0:r.readyState)!=="closed",v=x&&a?a:t;this.log(`${x?"transfering MediaSource":"attaching media"} to ${d?e:"Primary"} from ${m} (media.currentTime: ${t.currentTime})`);const b=this.schedule;if(v===a&&b){const S=d&&e.assetId===b.assetIdAtEnd;v.overrides={duration:b.duration,endOfStream:!d||S,cueRemoval:!d}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const a=this.hls.startPosition;if(this.log(ho("checkStart",a)),this.timelinePos=a,t.length&&t[0].cue.pre){const c=e.findEventIndex(t[0].identifier);this.setSchedulePosition(c)}else if(a>=0||!this.primaryLive){const c=this.timelinePos=a>0?a:0,d=e.findItemIndexAtTime(c);this.setSchedulePosition(d)}}else if(r&&!this.playingItem){const a=e.findItemIndex(r);this.setSchedulePosition(a)}}advanceAssetBuffering(e,t){const i=e.event,r=i.findAssetIndex(t),a=Ad(i,r);if(!i.isAssetPastPlayoutLimit(a))this.bufferedToEvent(e,a);else if(this.schedule){var c;const d=(c=this.schedule.items)==null?void 0:c[this.findItemIndex(e)+1];d&&this.bufferedToItem(d)}}advanceAfterAssetEnded(e,t,i){const r=Ad(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const a=this.schedule.items;if(a){const c=t+1,d=a.length;if(c>=d){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(ho("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(c)}}}else{if(e.appendInPlace){const a=e.assetList[r];a&&this.advanceInPlace(a.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const r=t.parentIdentifier,a=i.getEvent(r);if(a){const c=i.findEventIndex(r),d=i.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,c,d-1)}}setSchedulePosition(e,t){var i;const r=(i=this.schedule)==null?void 0:i.items;if(!r||this.playbackDisabled)return;const a=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${a&&Ks(a)}) pos: ${this.timelinePos}`);const c=this.waitingItem||this.playingItem,d=this.playingLastItem;if(this.isInterstitial(c)){const m=c.event,x=this.playingAsset,v=x==null?void 0:x.identifier,b=v?this.getAssetPlayer(v):null;if(b&&v&&(!this.eventItemsMatch(c,a)||t!==void 0&&v!==m.assetList[t].identifier)){var h;const S=m.findAssetIndex(x);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${m.assetList.length} ${Ar(x)}`),this.endedAsset=x,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:x,assetListIndex:S,event:m,schedule:r.slice(0),scheduleIndex:e,player:b}),c!==this.playingItem){this.itemsMatch(c,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(m,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(v,a),b.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&b.detachMedia()}if(!this.eventItemsMatch(c,a)&&(this.endedItem=c,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${m} ${Ks(c)}`),m.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:m,schedule:r.slice(0),scheduleIndex:e}),m.cue.once)){var f;this.updateSchedule();const S=(f=this.schedule)==null?void 0:f.items;if(a&&S){const A=this.findItemIndex(a);this.advanceSchedule(A,S,t,c,d)}return}}this.advanceSchedule(e,r,t,c,d)}advanceSchedule(e,t,i,r,a){const c=this.schedule;if(!c)return;const d=t[e]||null,h=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach(m=>{const x=m.interstitial,v=c.findEventIndex(x.identifier);(v<e||v>e+1)&&this.clearInterstitial(x,d)}),this.isInterstitial(d)){this.timelinePos=Math.min(Math.max(this.timelinePos,d.start),d.end);const m=d.event;if(i===void 0){i=c.findAssetIndex(m,this.timelinePos);const S=Ad(m,i-1);if(m.isAssetPastPlayoutLimit(S)||m.appendInPlace&&this.timelinePos===d.end){this.advanceAfterAssetEnded(m,e,i);return}i=S}const x=this.waitingItem;this.assetsBuffered(d,h)||this.setBufferingItem(d);let v=this.preloadAssets(m,i);if(this.eventItemsMatch(d,x||r)||(this.waitingItem=d,this.log(`INTERSTITIAL_STARTED ${Ks(d)} ${m.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:m,schedule:t.slice(0),scheduleIndex:e})),!m.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${m}`);return}if(m.assetListLoader&&(m.assetListLoader.destroy(),m.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${m}`);return}this.waitingItem=this.endedItem=null,this.playingItem=d;const b=m.assetList[i];if(!b){this.advanceAfterAssetEnded(m,e,i||0);return}if(v||(v=this.getAssetPlayer(b.identifier)),v===null||v.destroyed){const S=m.assetList.length;this.warn(`asset ${i+1}/${S} player destroyed ${m}`),v=this.createAssetPlayer(m,b,i),v.loadSource()}if(!this.eventItemsMatch(d,this.bufferingItem)&&m.appendInPlace&&this.isAssetBuffered(b))return;this.startAssetPlayer(v,i,t,e,h),this.shouldPlay&&tx(v.media)}else d?(this.resumePrimary(d,e,r),this.shouldPlay&&tx(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(c.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r,a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ks(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let d=this.timelinePos;(d<e.start||d>=e.end)&&(d=this.getPrimaryResumption(e,t),this.log(ho("resumePrimary",d)),this.timelinePos=d),this.attachPrimary(d,e)}if(!i)return;const c=(a=this.schedule)==null?void 0:a.items;c&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ks(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:c.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Oe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(ho("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const r=tt(tt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=tt(tt({},this.altSelection),{},{audio:i});return}const a=tt(tt({},r),{},{audio:i});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=tt(tt({},this.altSelection),{},{subtitles:i});return}const a=tt(tt({},r),{},{subtitles:i});this.mediaSelection=a}onAudioTrackSwitching(e,t){const i=up(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=up(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const a=t[r];if(a.cue.post){var i;const c=this.schedule.findEventIndex(a.identifier),d=(i=this.schedule.items)==null?void 0:i[c];this.isInterstitial(d)&&this.eventItemsMatch(d,this.bufferingItem)&&this.bufferedToItem(d,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const r=(i=this.schedule)==null?void 0:i.items;if(e&&r){const a=this.findItemIndex(e,t);return r[a]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((a,c)=>{e.event.isAssetPastPlayoutLimit(c)&&this.clearAssetPlayer(a.identifier,null)});const i=e.end+.25,r=Oe.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${Ks(e)} (was ${Ks(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const r=Oe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,t,i){const r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}const c=this.playingItem,d=this.findItemIndex(c);let h=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var f;const m=this.findItemIndex(a),x=Math.min(m+1,t.length-1),v=t[x];if((h===-1&&a&&e>=a.end||(f=v.event)!=null&&f.appendInPlace&&e+.01>=v.start)&&(h=x),this.isInterstitial(a)){const b=a.event;if(x-d>1&&b.appendInPlace===!1||b.assetList.length===0&&b.assetListLoader)return}if(this.bufferedPos=e,h>m&&h>d)this.bufferedToItem(v);else{const b=this.primaryDetails;this.primaryLive&&b&&e>b.edge-b.targetduration&&v.start<b.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else i&&c&&!this.itemsMatch(c,a)&&(h===d?this.bufferedToItem(c):h===d+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const a=this.getAssetPlayer(r.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:r,events:a}=i;if(!r||!a)return t;const c=this.isInterstitial(e),d=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=d?d.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ks(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(c){const f=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((m,x)=>{const v=this.getAssetPlayer(m.identifier);v&&(x===f&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(f=>f.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,a=i.cue.once;if(r||!a){const c=this.preloadAssets(i,t);if(c!=null&&c.interstitial.appendInPlace){const d=this.primaryMedia;d&&this.bufferAssetPlayer(c,d)}}}preloadAssets(e,t){const i=e.assetUrl,r=e.assetList.length,a=r===0&&!e.assetListLoader,c=e.cue.once;if(a){const h=e.timelineStart;if(e.appendInPlace){var d;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(d=v.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let f,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const v=m-h;v>0&&(f=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${f?` live-start: ${m} start-offset: ${f}`:""}`),i)return this.createAsset(e,0,0,h,e.duration,i);const x=this.assetListLoader.loadAssetList(e,f);x&&(e.assetListLoader=x)}else if(!c&&r){for(let f=t;f<r;f++){const m=e.assetList[f],x=this.getAssetPlayerQueueIndex(m.identifier);(x===-1||this.playerQueue[x].destroyed)&&!m.error&&this.createAssetPlayer(e,m,f)}const h=e.assetList[t];if(h){const f=this.getAssetPlayer(h.identifier);return f&&f.loadSource(),f}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,a,c){const d={parentIdentifier:e.identifier,identifier:X_(e,c,t),duration:a,startOffset:i,timelineStart:r,uri:c};return this.createAssetPlayer(e,d,t)}createAssetPlayer(e,t,i){const r=this.hls,a=r.userConfig;let c=a.videoPreference;const d=r.loadLevelObj||r.levels[r.currentLevel];(c||d)&&(c=ot({},c),d.videoCodec&&(c.videoCodec=d.videoCodec),d.videoRange&&(c.allowedVideoRanges=[d.videoRange]));const h=r.audioTracks[r.audioTrack],f=r.subtitleTracks[r.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const k=this.timelinePos-t.timelineStart;if(k>1){const O=t.duration;O&&k<O&&(m=k)}}const x=t.identifier,v=tt(tt({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:x,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:c,audioPreference:h||a.audioPreference,subtitlePreference:f||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const b=v.cmcd;b!=null&&b.sessionId&&b.contentId&&(v.cmcd=ot({},b,{contentId:Ia(t.uri)})),this.getAssetPlayer(x)&&this.warn(`Duplicate date range identifier ${e} and asset ${x}`);const S=new Z_(this.HlsPlayerClass,v,e,t);this.playerQueue.push(S),e.assetList[i]=t;let A=!0;const E=k=>{if(k.live){var O;const B=new Error(`Interstitials MUST be VOD assets ${e}`),C={fatal:!0,type:_e.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:B},P=((O=this.schedule)==null?void 0:O.findEventIndex(e.identifier))||-1;this.handleAssetItemError(C,e,P,i,B.message);return}const F=k.edge-k.fragmentStart,N=t.duration;(A||N===null||F>N)&&(A=!1,this.log(`Interstitial asset "${x}" duration change ${N} > ${F}`),t.duration=F,this.updateSchedule())};S.on(L.LEVEL_UPDATED,(k,{details:O})=>E(O)),S.on(L.LEVEL_PTS_UPDATED,(k,{details:O})=>E(O)),S.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const _=(k,O)=>{const F=this.getAssetPlayer(x);if(F&&O.tracks){F.off(L.BUFFER_CODECS,_),F.tracks=O.tracks;const N=this.primaryMedia;this.bufferingAsset===F.assetItem&&N&&!F.media&&this.bufferAssetPlayer(F,N)}};S.on(L.BUFFER_CODECS,_);const R=()=>{var k;const O=this.getAssetPlayer(x);if(this.log(`buffered to end of asset ${O}`),!O||!this.schedule)return;const F=this.schedule.findEventIndex(e.identifier),N=(k=this.schedule.items)==null?void 0:k[F];this.isInterstitial(N)&&this.advanceAssetBuffering(N,t)};S.on(L.BUFFERED_TO_END,R);const D=k=>()=>{if(!this.getAssetPlayer(x)||!this.schedule)return;this.shouldPlay=!0;const F=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,F,k)};return S.once(L.MEDIA_ENDED,D(i)),S.once(L.PLAYOUT_LIMIT_REACHED,D(1/0)),S.on(L.ERROR,(k,O)=>{if(!this.schedule)return;const F=this.getAssetPlayer(x);if(O.details===K.BUFFER_STALLED_ERROR){if(F!=null&&F.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(O,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${O.error} ${e}`)}),S.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(x)||!this.schedule)return;const O=new Error(`Asset player destroyed unexpectedly ${x}`),F={fatal:!0,type:_e.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:O};this.handleAssetItemError(F,e,this.schedule.findEventIndex(e.identifier),i,O.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ar(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:S}),S}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const r=this.playerQueue[i];this.log(`clear ${r} toSegment: ${t&&Ks(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,a){const{interstitial:c,assetItem:d,assetId:h}=e,f=c.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=d,(!m||m.identifier!==h)&&(m&&(this.clearAssetPlayer(m.identifier,i[r]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${f} ${Ar(d)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:d,assetListIndex:t,event:c,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var i,r;if(!this.schedule)return;const{interstitial:a,assetItem:c}=e,d=this.schedule.findEventIndex(a.identifier),h=(i=this.schedule.items)==null?void 0:i[d];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=c;const f=this.getBufferingPlayer();if(f===e)return;const m=a.appendInPlace;if(m&&(f==null?void 0:f.interstitial.appendInPlace)===!1)return;const x=(f==null?void 0:f.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(m&&c!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(x&&!Px(x,e.tracks)){const v=new Error(`Asset ${Ar(c)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(x)}')`),b={fatal:!0,type:_e.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},S=a.findAssetIndex(c);this.handleAssetItemError(b,a,d,S,v.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const r=i.currentTime,a=t.findAssetIndex(e,r),c=e.assetList[a];if(c){const d=this.getAssetPlayer(c.identifier);if(d){const h=d.currentTime||r-c.timelineStart,f=d.duration-h;if(this.warn(`Stalled at ${h} of ${h+f} in ${d} ${e} (media.currentTime: ${r})`),h&&(f/i.playbackRate<.5||d.bufferedInPlaceToEnd(i))&&d.hls){const m=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,m,a)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,r,a){if(e.details===K.BUFFER_STALLED_ERROR)return;const c=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${c&&Ar(c)} ${e.error}`),!this.schedule)return;const d=(c==null?void 0:c.identifier)||"",h=this.getAssetPlayerQueueIndex(d),f=this.playerQueue[h]||null,m=this.schedule.items,x=ot({},e,{fatal:!1,errorAction:Rr(!0),asset:c,assetListIndex:r,event:t,schedule:m,scheduleIndex:i,player:f});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,x),!e.fatal)return;const v=this.playingAsset,b=this.bufferingAsset,S=new Error(a);if(c&&(this.clearAssetPlayer(d,null),c.error=S),!t.assetList.some(A=>!A.error))t.error=S;else for(let A=r;A<t.assetList.length;A++)this.resetAssetPlayer(t.assetList[A].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):v&&v.identifier===d?this.advanceAfterAssetEnded(t,i,r):b&&b.identifier===d&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,b)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;let r=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${Ks(i)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const c=this.updateItem(i,r);this.itemsMatch(i,c)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const a=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(a)}onAssetListLoaded(e,t){var i,r;const a=t.event,c=a.identifier,d=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(c)))return;const h=a.timelineStart,f=a.duration;let m=0;d.forEach((A,E)=>{const _=parseFloat(A.DURATION);this.createAsset(a,E,m,h+m,_,A.URI),m+=_}),a.duration=m,this.log(`Loaded asset-list with duration: ${m} (was: ${f}) ${a}`);const x=this.waitingItem,v=(x==null?void 0:x.event.identifier)===c;this.updateSchedule();const b=(r=this.bufferingItem)==null?void 0:r.event;if(v){var S;const A=this.schedule.findEventIndex(c),E=(S=this.schedule.items)==null?void 0:S[A];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){a.error=new Error(`Interstitial ${d.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${a}`),this.log(a.error.message),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(E)}this.setSchedulePosition(A)}else if((b==null?void 0:b.identifier)===c){const A=a.assetList[0];if(A){const E=this.getAssetPlayer(A.identifier);if(b.appendInPlace){const _=this.primaryMedia;E&&_&&this.bufferAssetPlayer(E,_)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case K.ASSET_LIST_PARSING_ERROR:case K.ASSET_LIST_LOAD_ERROR:case K.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case K.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const sx=500;class sR extends Ef{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",ve.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ae.IDLE,this.setInterval(sx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragContextChanged(i)||(wt(i)&&(this.fragPrevious=i),this.state=ae.IDLE),!r)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let c;const d=i.start;for(let f=0;f<a.length;f++)if(d>=a[f].start&&d<=a[f].end){c=a[f];break}const h=i.start+i.duration;c?c.end=h:(c={start:d,end:h},a.push(c)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const a=r-1;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(c=>{for(let d=0;d<c.length;){if(c[d].end<=a){c.shift();continue}else if(c[d].start<a)c[d].start=a;else break;d++}}),this.fragmentTracker.removeFragmentsInRange(i,a,ve.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===ve.SUBTITLE&&(t.details===K.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ae.STOPPED&&(this.state=ae.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Fy(this.levels,t)){this.levels=t.map(i=>new Pa(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new Pa(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ve.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==ae.STOPPED&&this.setInterval(sx)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:a}=this,{details:c,id:d}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${d}`);return}const h=a[d];if(d>=a.length||!h)return;this.log(`Subtitle track ${d} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""},duration:${c.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(c.live||(i=h.details)!=null&&i.live){if(c.deltaUpdateFailed)return;const x=this.mainDetails;if(!x){this.startFragRequested=!1;return}const v=x.fragments[0];if(!h.details)c.hasProgramDateTime&&x.hasProgramDateTime?(Uo(c,x),f=c.fragmentStart):v&&(f=v.start,Xd(c,f));else{var m;f=this.alignPlaylists(c,h.details,(m=this.levelLastLoaded)==null?void 0:m.details),f===0&&v&&(f=v.start,Xd(c,f))}x&&!this.startFragRequested&&this.setStartPosition(x,f)}h.details=c,this.levelLastLoaded=h,d===r&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:c,id:d,groupId:t.groupId}),this.tick(),c.live&&!this.fragCurrent&&this.media&&this.state===ae.IDLE&&(Nn(null,c.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&wr(r.method)){const c=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,bf(r.method)).catch(d=>{throw a.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:t}),d}).then(d=>{const h=performance.now();a.trigger(L.FRAG_DECRYPTED,{frag:t,payload:d,stats:{tstart:c,tdecrypt:h}})}).catch(d=>{this.warn(`${d.name}: ${d.message}`),this.state=ae.IDLE})}}doTick(){if(!this.media){this.state=ae.IDLE;return}if(this.state===ae.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:r}=this,a=this.getLoadPosition(),c=Oe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:d,len:h}=c,f=i.details,m=this.hls.maxBufferLength+f.levelTargetDuration;if(h>m)return;const x=f.fragments,v=x.length,b=f.edge;let S=null;const A=this.fragPrevious;if(d<b){const R=r.maxFragLookUpTolerance,D=d>b-R?0:R;S=Nn(A,x,Math.max(x[0].start,d),D),!S&&A&&A.start<x[0].start&&(S=x[0])}else S=x[v-1];if(S=this.filterReplacedPrimary(S,i.details),!S)return;const E=S.sn-f.startSN,_=x[E-1];if(_&&_.cc===S.cc&&this.fragmentTracker.getState(_)===Ut.NOT_LOADED&&(S=_),this.fragmentTracker.getState(S)===Ut.NOT_LOADED){const R=this.mapToInitFragWhenRequired(S);R&&this.loadFragment(R,i,d)}}}loadFragment(e,t,i){wt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new iR(this.tracksBuffered[this.currentTrackId]||[])}}class iR{constructor(e){this.buffered=void 0;const t=(i,r,a)=>{if(r=r>>>0,r>a-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${a})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const nR={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},tv=o=>String.fromCharCode(nR[o]||o),Ys=15,Ri=100,rR={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},aR={17:2,18:4,21:6,22:8,23:10,19:13,20:15},lR={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},oR={25:2,26:4,29:6,30:8,31:10,27:13,28:15},cR=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class uR{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;st.log(`${this.time} [${e}] ${i}`)}}}const wn=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class sv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class dR{constructor(){this.uchar=" ",this.penState=new sv}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class fR{constructor(e){this.chars=[],this.pos=0,this.currPenState=new sv,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ri;t++)this.chars.push(new dR);this.logger=e}equals(e){for(let t=0;t<Ri;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ri;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ri;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ri&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ri)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=tv(e);if(this.pos>=Ri){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ri;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<Ri;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ld{constructor(e){this.rows=[],this.currRow=Ys-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ys;t++)this.rows.push(new fR(e));this.logger=e}reset(){for(let e=0;e<Ys;e++)this.rows[e].clear();this.currRow=Ys-1}equals(e){let t=!0;for(let i=0;i<Ys;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Ys;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ys;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+dt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let d=0;d<Ys;d++)this.rows[d].clear();const a=this.currRow+1-this.nrRollUpRows,c=this.lastOutputScreen;if(c){const d=c.rows[a].cueStartTime,h=this.logger.time;if(d!==null&&h!==null&&d<h)for(let f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(c.rows[a+f])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const a=e.indent,c=Math.max(a-1,0);i.setCursor(e.indent),e.color=i.chars[c].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+dt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let a=0;a<Ys;a++){const c=this.rows[a].getTextString();c&&(r=a+1,e?t.push("Row "+r+": '"+c+"'"):t.push(c.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class ix{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ld(i),this.nonDisplayedMemory=new Ld(i),this.lastOutputScreen=new Ld(i),this.currRollUpRow=this.displayedMemory.rows[Ys-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ys-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+dt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class nx{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=mR(),this.logger=void 0;const r=this.logger=new uR;this.channels=[null,new ix(e,t,r),new ix(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,a=t[i+1]&127;let c=!1,d=null;if(r===0&&a===0)continue;this.logger.log(3,()=>"["+wn([t[i],t[i+1]])+"] -> ("+wn([r,a])+")");const h=this.cmdHistory;if(r>=16&&r<=31){if(hR(r,a,h)){mo(null,null,h),this.logger.log(3,()=>"Repeated command ("+wn([r,a])+") is dropped");continue}mo(r,a,this.cmdHistory),c=this.parseCmd(r,a),c||(c=this.parseMidrow(r,a)),c||(c=this.parsePAC(r,a)),c||(c=this.parseBackgroundAttributes(r,a))}else mo(null,null,h);if(!c&&(d=this.parseChars(r,a),d)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(d):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!c&&!d&&this.logger.log(2,()=>"Couldn't parse cleaned data "+wn([r,a])+" orig: "+wn([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const a=e===20||e===21||e===23?1:2,c=this.channels[a];return e===20||e===21||e===28||e===29?t===32?c.ccRCL():t===33?c.ccBS():t===34?c.ccAOF():t===35?c.ccAON():t===36?c.ccDER():t===37?c.ccRU(2):t===38?c.ccRU(3):t===39?c.ccRU(4):t===40?c.ccFON():t===41?c.ccRDC():t===42?c.ccTR():t===43?c.ccRTD():t===44?c.ccEDM():t===45?c.ccCR():t===46?c.ccENM():t===47&&c.ccEOC():c.ccTO(t-32),this.currentChannel=a,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+wn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(r||a))return!1;const c=e<=23?1:2;t>=64&&t<=95?i=c===1?rR[e]:lR[e]:i=c===1?aR[e]:oR[e];const d=this.channels[c];return d?(d.setPAC(this.interpretPAC(i,t)),this.currentChannel=c,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,a=null;if(e>=25?(i=2,a=e-8):(i=1,a=e),a>=17&&a<=19){let c;a===17?c=t+80:a===18?c=t+112:c=t+144,this.logger.log(2,()=>"Special char '"+tv(c)+"' in channel "+i),r=[c]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+wn(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let a;const c={};e===16||e===24?(a=Math.floor((t-32)/2),c.background=cR[a],t%2===1&&(c.background=c.background+"_semi")):t===45?c.background="transparent":(c.foreground="black",t===47&&(c.underline=!0));const d=e<=23?1:2;return this.channels[d].setBkgData(c),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}mo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function mo(o,e,t){t.a=o,t.b=e}function hR(o,e,t){return t.a===o&&t.b===e}function mR(){return{a:null,b:null}}var Mf=(function(){if(jo!=null&&jo.VTTCue)return self.VTTCue;const o=["","lr","rl"],e=["start","middle","end","left","right"];function t(d,h){if(typeof h!="string"||!Array.isArray(d))return!1;const f=h.toLowerCase();return~d.indexOf(f)?f:!1}function i(d){return t(o,d)}function r(d){return t(e,d)}function a(d,...h){let f=1;for(;f<arguments.length;f++){const m=arguments[f];for(const x in m)d[x]=m[x]}return d}function c(d,h,f){const m=this,x={enumerable:!0};m.hasBeenReset=!1;let v="",b=!1,S=d,A=h,E=f,_=null,R="",D=!0,k="auto",O="start",F=50,N="middle",B=50,C="middle";Object.defineProperty(m,"id",a({},x,{get:function(){return v},set:function(P){v=""+P}})),Object.defineProperty(m,"pauseOnExit",a({},x,{get:function(){return b},set:function(P){b=!!P}})),Object.defineProperty(m,"startTime",a({},x,{get:function(){return S},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");S=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",a({},x,{get:function(){return A},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");A=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",a({},x,{get:function(){return E},set:function(P){E=""+P,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",a({},x,{get:function(){return _},set:function(P){_=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",a({},x,{get:function(){return R},set:function(P){const W=i(P);if(W===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=W,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",a({},x,{get:function(){return D},set:function(P){D=!!P,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",a({},x,{get:function(){return k},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");k=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",a({},x,{get:function(){return O},set:function(P){const W=r(P);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");O=W,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",a({},x,{get:function(){return F},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");F=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",a({},x,{get:function(){return N},set:function(P){const W=r(P);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");N=W,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",a({},x,{get:function(){return B},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");B=P,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",a({},x,{get:function(){return C},set:function(P){const W=r(P);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");C=W,this.hasBeenReset=!0}})),m.displayState=void 0}return c.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},c})();class gR{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function iv(o){function e(i,r,a,c){return(i|0)*3600+(r|0)*60+(a|0)+parseFloat(c||0)}const t=o.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class pR{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function nv(o,e,t,i){const r=i?o.split(i):[o];for(const a in r){if(typeof r[a]!="string")continue;const c=r[a].split(t);if(c.length!==2)continue;const d=c[0],h=c[1];e(d,h)}}const nf=new Mf(0,0,""),go=nf.align==="middle"?"middle":"center";function xR(o,e,t){const i=o;function r(){const d=iv(o);if(d===null)throw new Error("Malformed timestamp: "+i);return o=o.replace(/^[^\sa-zA-Z-]+/,""),d}function a(d,h){const f=new pR;nv(d,function(v,b){let S;switch(v){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===b){f.set(v,t[A].region);break}break;case"vertical":f.alt(v,b,["rl","lr"]);break;case"line":S=b.split(","),f.integer(v,S[0]),f.percent(v,S[0])&&f.set("snapToLines",!1),f.alt(v,S[0],["auto"]),S.length===2&&f.alt("lineAlign",S[1],["start",go,"end"]);break;case"position":S=b.split(","),f.percent(v,S[0]),S.length===2&&f.alt("positionAlign",S[1],["start",go,"end","line-left","line-right","auto"]);break;case"size":f.percent(v,b);break;case"align":f.alt(v,b,["start",go,"end","left","right"]);break}},/:/,/\s/),h.region=f.get("region",null),h.vertical=f.get("vertical","");let m=f.get("line","auto");m==="auto"&&nf.line===-1&&(m=-1),h.line=m,h.lineAlign=f.get("lineAlign","start"),h.snapToLines=f.get("snapToLines",!0),h.size=f.get("size",100),h.align=f.get("align",go);let x=f.get("position","auto");x==="auto"&&nf.position===50&&(x=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=x}function c(){o=o.replace(/^\s+/,"")}if(c(),e.startTime=r(),c(),o.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);o=o.slice(3),c(),e.endTime=r(),c(),a(o,e)}function rv(o){return o.replace(/<br(?: \/)?>/gi,`
`)}class yR{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new gR,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let a=t.buffer,c=0;for(a=rv(a);c<a.length&&a[c]!=="\r"&&a[c]!==`
`;)++c;const d=a.slice(0,c);return a[c]==="\r"&&++c,a[c]===`
`&&++c,t.buffer=a.slice(c),d}function r(a){nv(a,function(c,d){},/:/)}try{let a="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;a=i();const d=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(d!=null&&d[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let c=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(c?c=!1:a=i(),t.state){case"HEADER":/:/.test(a)?r(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new Mf(0,0,""),t.state="CUE",a.indexOf("-->")===-1){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{xR(a,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const d=a.indexOf("-->")!==-1;if(!a||d&&(c=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=a}continue;case"BADCUE":a||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const vR=/\r\n|\n\r|\n|\r/g,_d=function(e,t,i=0){return e.slice(i,i+t.length)===t},bR=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ye(t)||!ye(i)||!ye(r)||!ye(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=3600*1e3*a,t};function Of(o,e,t){return Ia(o.toString())+Ia(e.toString())+Ia(t)}const SR=function(e,t,i){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(c=a)!=null&&c.new;){var c;e.ccOffset+=r.start-a.start,r.new=!1,r=a,a=e[r.prevCC]}e.presentationOffset=i};function ER(o,e,t,i,r,a,c){const d=new yR,h=ws(new Uint8Array(o)).trim().replace(vR,`
`).split(`
`),f=[],m=e?wL(e.baseTime,e.timescale):0;let x="00:00.000",v=0,b=0,S,A=!0;d.oncue=function(E){const _=t[i];let R=t.ccOffset;const D=(v-m)/9e4;if(_!=null&&_.new&&(b!==void 0?R=t.ccOffset=_.start:SR(t,i,D)),D){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}R=D-t.presentationOffset}const k=E.endTime-E.startTime,O=Ts((E.startTime+R-b)*9e4,r*9e4)/9e4;E.startTime=Math.max(O,0),E.endTime=Math.max(O+k,0);const F=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(F)),E.id||(E.id=Of(E.startTime,E.endTime,F)),E.endTime>0&&f.push(E)},d.onparsingerror=function(E){S=E},d.onflush=function(){if(S){c(S);return}a(f)},h.forEach(E=>{if(A)if(_d(E,"X-TIMESTAMP-MAP=")){A=!1,E.slice(16).split(",").forEach(_=>{_d(_,"LOCAL:")?x=_.slice(6):_d(_,"MPEGTS:")&&(v=parseInt(_.slice(7)))});try{b=bR(x)/1e3}catch(_){S=_}return}else E===""&&(A=!1);d.parse(E+`
`)}),d.flush()}const Rd="stpp.ttml.im1t",av=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,lv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,TR={left:"start",center:"center",right:"end",start:"start",end:"end"};function rx(o,e,t,i){const r=Be(new Uint8Array(o),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const a=r.map(d=>ws(d)),c=RL(e.baseTime,1,e.timescale);try{a.forEach(d=>t(AR(d,c)))}catch(d){i(d)}}function AR(o,e){const r=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},c=Object.keys(a).reduce((x,v)=>(x[v]=r.getAttribute(`ttp:${v}`)||a[v],x),{}),d=r.getAttribute("xml:space")!=="preserve",h=ax(wd(r,"styling","style")),f=ax(wd(r,"layout","region")),m=wd(r,"body","[begin]");return[].map.call(m,x=>{const v=ov(x,d);if(!v||!x.hasAttribute("begin"))return null;const b=Id(x.getAttribute("begin"),c),S=Id(x.getAttribute("dur"),c);let A=Id(x.getAttribute("end"),c);if(b===null)throw lx(x);if(A===null){if(S===null)throw lx(x);A=b+S}const E=new Mf(b-e,A-e,v);E.id=Of(E.startTime,E.endTime,E.text);const _=f[x.getAttribute("region")],R=h[x.getAttribute("style")],D=LR(_,R,h),{textAlign:k}=D;if(k){const O=TR[k];O&&(E.lineAlign=O),E.align=k}return ot(E,D),E}).filter(x=>x!==null)}function wd(o,e,t){const i=o.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function ax(o){return o.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function ov(o,e){return[].slice.call(o.childNodes).reduce((t,i,r)=>{var a;return i.nodeName==="br"&&r?t+`
`:(a=i.childNodes)!=null&&a.length?ov(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function LR(o,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],c=o!=null&&o.hasAttribute("style")?o.getAttribute("style"):null;return c&&t.hasOwnProperty(c)&&(r=t[c]),a.reduce((d,h)=>{const f=Dd(e,i,h)||Dd(o,i,h)||Dd(r,i,h);return f&&(d[h]=f),d},{})}function Dd(o,e,t){return o&&o.hasAttributeNS(e,t)?o.getAttributeNS(e,t):null}function lx(o){return new Error(`Could not parse ttml timestamp ${o}`)}function Id(o,e){if(!o)return null;let t=iv(o);return t===null&&(av.test(o)?t=_R(o,e):lv.test(o)&&(t=RR(o,e))),t}function _R(o,e){const t=av.exec(o),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function RR(o,e){const t=lv.exec(o),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class po{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class wR{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=cx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new po(this,"textTrack1"),t=new po(this,"textTrack2"),i=new po(this,"textTrack3"),r=new po(this,"textTrack4");this.cea608Parser1=new nx(1,e,t),this.cea608Parser2=new nx(3,i,r)}addCues(e,t,i,r,a){let c=!1;for(let d=a.length;d--;){const h=a[d],f=DR(h[0],h[1],t,i);if(f>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],i),c=!0,f/(i-t)>.5))return}if(c||a.push([t,i]),this.config.renderTextTracksNatively){const d=this.captionsTracks[e];this.Cues.newCue(d,t,i,r)}else{const d=this.Cues.newCue(null,t,i,r);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:d,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:a,trackId:c}){const{unparsedVttFrags:d}=this;i===ve.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:a,trackId:c}),d.length&&(this.unparsedVttFrags=[],d.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,h):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const a=i.textTracks[r];if(ox(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:a,languageCode:c}=t[e],d=this.getExistingTrack(a,c);if(d)i[e]=d,Lr(i[e]),Zy(i[e],r);else{const h=this.createTextTrack("captions",a,c);h&&(h[e]=!0,i[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(a=>{Lr(r[a]),delete r[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=cx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Lr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(a=>a.textCodec===Rd);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Fy(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const c=this.media,d=c?Lo(c.textTracks):null;if(this.tracks.forEach((h,f)=>{let m;if(d){let x=null;for(let v=0;v<d.length;v++)if(d[v]&&ox(d[v],h)){x=d[v],d[v]=null;break}x&&(m=x)}if(m)Lr(m);else{const x=cv(h);m=this.createTextTrack(x,h.name,h.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),d!=null&&d.length){const h=d.filter(f=>f!==null).map(f=>f.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const c=this.tracks.map(d=>({label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const a=`textTrack${r[1]}`,c=this.captionsProperties[a];c&&(c.label=i.name,i.lang&&(c.languageCode=i.lang),c.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ve.MAIN){var i,r;const{cea608Parser1:a,cea608Parser2:c,lastSn:d}=this,{cc:h,sn:f}=t.frag,m=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;a&&c&&(f!==d+1||f===d&&m!==this.lastPartIndex+1||h!==this.lastCc)&&(a.reset(),c.reset()),this.lastCc=h,this.lastSn=f,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===ve.SUBTITLE)if(r.byteLength){const a=i.decryptdata,c="stats"in t;if(a==null||!a.encrypted||c){const d=this.tracks[i.level],h=this.vttCCs;h[i.cc]||(h[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),d&&d.textCodec===Rd?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;rx(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:a,unparsedVttFrags:c}=this,d=a.length-1;if(!a[i.cc]&&d===-1){c.push(e);return}const h=this.hls,f=(t=i.initSegment)!=null&&t.data?$s(i.initSegment.data,new Uint8Array(r)).buffer:r;ER(f,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,m=>{this._appendCues(m,i.level),h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},m=>{const x=m.message==="Missing initPTS for VTT MPEGTS";x?c.push(e):this._fallbackToIMSC1(i,r),h.logger.log(`Failed to parse VTT cue: ${m}`),!(x&&d>i.cc)&&h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:m})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||rx(t,this.initPTS[e.cc],()=>{i.textCodec=Rd,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(a=>Jy(r,a))}else{const r=this.tracks[t];if(!r)return;const a=r.default?"default":"subtitles"+t;i.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ve.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=t;if(!(i.type===ve.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let a=0;a<r.length;a++){const c=r[a].bytes;if(c){this.cea608Parser1||this.initCea608Parsers();const d=this.extractCea608Data(c);this.cea608Parser1.addData(r[a].pts,d[0]),this.cea608Parser2.addData(r[a].pts,d[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:a}){const{media:c}=this;if(!(!c||c.currentTime<i)){if(!a||a==="video"){const{captionsTracks:d}=this;Object.keys(d).forEach(h=>sf(d[h],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:d}=this;Object.keys(d).forEach(h=>sf(d[h],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let a=0;a<i;a++){const c=e[r++],d=127&e[r++],h=127&e[r++];if(d===0&&h===0)continue;if((4&c)!==0){const m=3&c;(m===0||m===1)&&(t[m].push(d),t[m].push(h))}}return t}}function cv(o){return o.characteristics&&/transcribes-spoken-dialog/gi.test(o.characteristics)&&/describes-music-and-sound/gi.test(o.characteristics)?"captions":"subtitles"}function ox(o,e){return!!o&&o.kind===cv(e)&&Zd(e,o)}function DR(o,e,t,i){return Math.min(e,i)-Math.max(o,t)}function cx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const IR=/\s/,CR={newCue(o,e,t,i){const r=[];let a,c,d,h,f;const m=self.VTTCue||self.TextTrackCue;for(let v=0;v<i.rows.length;v++)if(a=i.rows[v],d=!0,h=0,f="",!a.isEmpty()){var x;for(let A=0;A<a.chars.length;A++)IR.test(a.chars[A].uchar)&&d?h++:(f+=a.chars[A].uchar,d=!1);a.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const b=rv(f.trim()),S=Of(e,t,b);o!=null&&(x=o.cues)!=null&&x.getCueById(S)||(c=new m(e,t,b),c.id=S,c.line=v+1,c.align="left",c.position=10+Math.min(80,Math.floor(h*8/32)*10),r.push(c))}return o&&r.length&&(r.sort((v,b)=>v.line==="auto"||b.line==="auto"?0:v.line>8&&b.line>8?b.line-v.line:v.line-b.line),r.forEach(v=>Jy(o,v))),r}};function NR(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const kR=/(\d+)-(\d+)\/(\d+)/;class ux{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||jR,this.controller=new self.AbortController,this.stats=new hf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const a=MR(e,this.controller.signal),c=e.responseType==="arraybuffer",d=c?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=h&&ye(h)?h:f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Fa(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(x=>{var v;this.response=this.loader=x;const b=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},f-(b-r.loading.start)),!x.ok){const{status:A,statusText:E}=x;throw new UR(E||"fetch, bad network response",A,x)}r.loading.first=b,r.total=PR(x.headers)||r.total;const S=(v=this.callbacks)==null?void 0:v.onProgress;return S&&ye(t.highWaterMark)?this.loadProgressively(x,r,e,t.highWaterMark,S):c?x.arrayBuffer():e.responseType==="json"?x.json():x.text()}).then(x=>{var v,b;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const A=x[d];A&&(r.loaded=r.total=A);const E={url:S.url,data:x,code:S.status},_=(v=this.callbacks)==null?void 0:v.onProgress;_&&!ye(t.highWaterMark)&&_(r,e,x,S),(b=this.callbacks)==null||b.onSuccess(E,r,e,S)}).catch(x=>{var v;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const b=x&&x.code||0,S=x?x.message:null;(v=this.callbacks)==null||v.onError({code:b,text:S},e,x?x.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,a){const c=new vy,d=e.body.getReader(),h=()=>d.read().then(f=>{if(f.done)return c.dataLength&&a(t,i,c.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=f.value,x=m.length;return t.loaded+=x,x<r||c.dataLength?(c.push(m),c.dataLength>=r&&a(t,i,c.flush().buffer,e)):a(t,i,m.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function MR(o,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ot({},o.headers))};return o.rangeEnd&&t.headers.set("Range","bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)),t}function OR(o){const e=kR.exec(o);if(e)return parseInt(e[2])-parseInt(e[1])+1}function PR(o){const e=o.get("Content-Range");if(e){const i=OR(e);if(ye(i))return i}const t=o.get("Content-Length");if(t)return parseInt(t)}function jR(o,e){return new self.Request(o.url,e)}class UR extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const FR=/^age:\s*[\d.]+\s*$/im;class uv{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new hf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return a(i,t.url)}).catch(c=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),a(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(c=>{var d;(d=this.callbacks)==null||d.onError({code:i.status,text:c.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:c}=i.loadPolicy;if(r)for(const d in r)e.setRequestHeader(d,r[d]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&ye(a)?a:c,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,a=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const f=t.status,m=t.responseType==="text"?t.responseText:null;if(f>=200&&f<300){const S=m??t.response;if(S!=null){var c,d;i.loading.end=Math.max(self.performance.now(),i.loading.first);const A=t.responseType==="arraybuffer"?S.byteLength:S.length;i.loaded=i.total=A,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const E=(c=this.callbacks)==null?void 0:c.onProgress;E&&E(i,e,S,t);const _={url:t.responseURL,data:S,code:f};(d=this.callbacks)==null||d.onSuccess(_,i,e,t);return}}const x=a.loadPolicy.errorRetry,v=i.retry,b={url:e.url,data:void 0,code:f};if(Oo(x,v,!1,b))this.retry(x);else{var h;st.error(`${f} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:f,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Oo(e,t,!0))this.retry(e);else{var i;st.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=xf(e,i.retry),i.retry++,st.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&FR.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const BR={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},$R=tt(tt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:uv,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:JT,bufferController:zL,capLevelController:Cf,errorController:nA,fpsController:H_,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:oy,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:BR},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},GR()),{},{subtitleStreamController:sR,subtitleTrackController:Y_,timelineController:wR,audioStreamController:FL,audioTrackController:BL,emeController:Dr,cmcdController:B_,contentSteeringController:G_,interstitialsController:tR});function GR(){return{cueHandler:CR,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function zR(o,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=rf(o),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(c=>{const d=`${c==="level"?"playlist":c}LoadPolicy`,h=e[d]===void 0,f=[];a.forEach(m=>{const x=`${c}Loading${m}`,v=e[x];if(v!==void 0&&h){f.push(x);const b=i[d].default;switch(e[d]={default:b},m){case"TimeOut":b.maxLoadTimeMs=v,b.maxTimeToFirstByteMs=v;break;case"MaxRetry":b.errorRetry.maxNumRetry=v,b.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":b.errorRetry.retryDelayMs=v,b.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":b.errorRetry.maxRetryDelayMs=v,b.timeoutRetry.maxRetryDelayMs=v;break}}}),f.length&&t.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${d}": ${dt(e[d])}`)}),tt(tt({},i),e)}function rf(o){return o&&typeof o=="object"?Array.isArray(o)?o.map(rf):Object.keys(o).reduce((e,t)=>(e[t]=rf(o[t]),e),{}):o}function HR(o,e){const t=o.loader;t!==ux&&t!==uv?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1):NR()&&(o.loader=ux,o.progressive=!0,o.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const _o=2,VR=.1,KR=.05,YR=100;class qR extends iy{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(YR),this.mediaSource=t.mediaSource;const i=this.media=t.media;is(i,"playing",this.onMediaPlaying),is(i,"waiting",this.onMediaWaiting),is(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(hs(i,"playing",this.onMediaPlaying),hs(i,"waiting",this.onMediaWaiting),hs(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;const a=(i=this.hls)==null?void 0:i.config;if(!a)return;const c=this.media;if(!c)return;const{seeking:d}=c,h=this.seeking&&!d,f=!this.seeking&&d,m=c.paused&&!d||c.ended||c.playbackRate===0;if(this.seeking=d,e!==t){t&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(f||h){h&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&c.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!Oe.getBuffered(c).length){this.nudgeRetry=0;return}const x=Oe.bufferInfo(c,e,0),v=x.nextStart||0,b=this.fragmentTracker;if(d&&b&&this.hls){const F=dx(this.hls.inFlightFragments,e),N=x.len>_o,B=!v||F||v-e>_o&&!b.getPartialFragment(e);if(N||B)return;this.moved=!1}const S=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&b){if(!(x.len>0)&&!v)return;const N=Math.max(v,x.start||0)-e,C=!!(S!=null&&S.live)?S.targetduration*2:_o,P=xo(e,b);if(N>0&&(N<=C||P)){c.paused||this._trySkipBufferHole(P);return}}const A=a.detectStallWithCurrentTimeMs,E=self.performance.now(),_=this.waiting;let R=this.stalled;if(R===null)if(_>0&&E-_<A)R=this.stalled=_;else{this.stalled=E;return}const D=E-R;if(!d&&(D>=A||_)&&this.hls){var k;if(((k=this.mediaSource)==null?void 0:k.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-((S==null?void 0:S.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(x),!this.media||!this.hls)return}const O=Oe.bufferInfo(c,e,a.maxBufferHole);this._tryFixBufferStall(O,D,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const a=Oe.bufferedInfo(Oe.timeRangesToArray(this.buffered.audio),e,0);if(a.len>1&&t>=a.start){const c=Oe.timeRangesToArray(r),d=Oe.bufferedInfo(c,t,0).bufferedIndex;if(d>-1&&d<c.length-1){const h=Oe.bufferedInfo(c,e,0).bufferedIndex,f=c[d].end,m=c[d+1].start;if((h===-1||h>d)&&m-f<1&&e-f<2){const x=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${f} -> ${m} buffered index: ${h}`);this.warn(x.message),this.media.currentTime+=1e-6;let v=xo(e,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const b=Oe.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:x,reason:x.message,frag:v,buffer:b.len,bufferInfo:b})}}}}}_tryFixBufferStall(e,t,i){var r,a;const{fragmentTracker:c,media:d}=this,h=(r=this.hls)==null?void 0:r.config;if(!d||!c||!h)return;const f=(a=this.hls)==null?void 0:a.latestLevelDetails,m=xo(i,c);if((m||f!=null&&f.live&&i<f.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const x=e.buffered,v=this.adjacentTraversal(e,i);(x&&x.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-i<h.maxBufferHole||v))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,r=e.nextStart;if(i&&r){const a=i.getFragAtPos(t,ve.MAIN),c=i.getFragAtPos(r,ve.MAIN);if(a&&c)return c.sn-a.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:r,stalled:a}=this;if(!r&&a!==null&&i&&t){this.stallReported=!0;const c=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${dt(e)})`);this.warn(c.message),t.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,fatal:!1,error:c,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:r}=this,a=(t=this.hls)==null?void 0:t.config;if(!r||!i||!a)return 0;const c=r.currentTime,d=Oe.bufferInfo(r,c,0),h=c<d.start?d.start:d.nextStart;if(h&&this.hls){const m=d.len<=a.maxBufferHole,x=d.len>0&&d.len<1&&r.readyState<3,v=h-c;if(v>0&&(m||x)){if(v>a.maxBufferHole){let S=!1;if(c===0){const A=i.getAppendedFrag(0,ve.MAIN);A&&h<A.end&&(S=!0)}if(!S&&e){var f;if(!((f=this.hls.loadLevelObj)!=null&&f.details)||dx(this.hls.inFlightFragments,h))return 0;let E=!1,_=e.end;for(;_<h;){const R=xo(_,i);if(R)_+=R.duration;else{E=!0;break}}if(E)return 0}}const b=Math.max(h+KR,c+VR);if(this.warn(`skipping hole, adjusting currentTime from ${c} to ${b}`),this.moved=!0,r.currentTime=b,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${c} to ${b}`),A={type:_e.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:d.len,bufferInfo:d};e&&("fragment"in e?A.part=e:A.frag=e),this.hls.trigger(L.ERROR,A)}return b}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:r}=this,a=t==null?void 0:t.config;if(!i||!a)return 0;const c=i.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){const d=c+(r+1)*a.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${c} to ${d}`);this.warn(h.message),i.currentTime=d,t.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const d=new Error(`Playhead still not moving while enough data buffered @${c} after ${a.nudgeMaxRetry} nudges`);this.error(d.message),t.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,error:d,fatal:!0,buffer:e.len,bufferInfo:e})}}}function dx(o,e){const t=fx(o.main);if(t&&t.start<=e)return t;const i=fx(o.audio);return i&&i.start<=e?i:null}function fx(o){if(!o)return null;switch(o.state){case ae.IDLE:case ae.STOPPED:case ae.ENDED:case ae.ERROR:return null}return o.frag}function xo(o,e){return e.getAppendedFrag(o,ve.MAIN)||e.getPartialFragment(o)}const XR=.25;function af(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Cd(o,e,t,i,r){let a=new o(e,t,"");try{a.value=i,r&&(a.type=r)}catch{a=new o(e,t,dt(r?tt({type:r},i):i))}return a}const yo=(()=>{const o=af();try{o&&new o(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class QR{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Lr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return Zy(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;const{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=af();if(c)for(let d=0;d<a.length;d++){const h=a[d].type;if(h===Ls.emsg&&!i||!r)continue;const f=_y(a[d].data),m=a[d].pts;let x=m+a[d].duration;x>yo&&(x=yo),x-m<=0&&(x=m+XR);for(let b=0;b<f.length;b++){const S=f[b];if(!Ry(S)){this.updateId3CueEnds(m,h);const A=Cd(c,m,x,S,h);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let a=r.length;a--;){const c=r[a];c.type===t&&c.startTime<e&&c.endTime===yo&&(c.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:a,hls:c}=this;if(!c)return;const{config:{enableEmsgMetadataCues:d,enableID3MetadataCues:h}}=c;if(a&&(d||h)){let f;r==="audio"?f=m=>m.type===Ls.audioId3&&h:r==="video"?f=m=>m.type===Ls.emsg&&d:f=m=>m.type===Ls.audioId3&&h||m.type===Ls.emsg&&d,sf(a,t,i,f)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:a,interstitialsController:c}=this.hls.config;if(!a)return;const d=af();if(i&&r&&!c){const{fragmentStart:A,fragmentEnd:E}=e;let _=this.assetCue;_?(_.startTime=A,_.endTime=E):d&&(_=this.assetCue=Cd(d,A,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),_&&(_.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(_),_.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:f}=e,m=Object.keys(f);let x=this.dateRangeCuesAppended;if(h&&t){var v;if((v=h.cues)!=null&&v.length){const A=Object.keys(x).filter(E=>!m.includes(E));for(let E=A.length;E--;){var b;const _=A[E],R=(b=x[_])==null?void 0:b.cues;delete x[_],R&&Object.keys(R).forEach(D=>{const k=R[D];if(k){k.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(k)}catch{}}})}}else x=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(m.length===0||!ye(S==null?void 0:S.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<m.length;A++){const E=m[A],_=f[E],R=_.startTime,D=x[E],k=(D==null?void 0:D.cues)||{};let O=(D==null?void 0:D.durationKnown)||!1,F=yo;const{duration:N,endDate:B}=_;if(B&&N!==null)F=R+N,O=!0;else if(_.endOnNext&&!O){const P=m.reduce((W,ue)=>{if(ue!==_.id){const me=f[ue];if(me.class===_.class&&me.startDate>_.startDate&&(!W||_.startDate<W.startDate))return me}return W},null);P&&(F=P.startTime,O=!0)}const C=Object.keys(_.attr);for(let P=0;P<C.length;P++){const W=C[P];if(!xA(W))continue;const ue=k[W];if(ue)O&&!(D!=null&&D.durationKnown)?ue.endTime=F:Math.abs(ue.startTime-R)>.01&&(ue.startTime=R,ue.endTime=F);else if(d){let me=_.attr[W];yA(W)&&(me=jx(me));const ce=Cd(d,R,F,{key:W,data:me},Ls.dateRange);ce&&(ce.id=E,this.id3Track.addCue(ce),k[W]=ce,c&&(W==="X-ASSET-LIST"||W==="X-ASSET-URL")&&ce.addEventListener("enter",this.onEventCueEnter))}}x[E]={cues:k,dateRange:_,durationKnown:O}}}}}class WR{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:c}=this.config;if(!a||c===1||!i.live)return;const d=this.targetLatency;if(d===null)return;const h=r-d,f=Math.min(this.maxLatency,d+i.targetduration);if(h<f&&h>.05&&this.forwardBufferLength>1){const x=Math.min(2,Math.max(1,c)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,b=Math.min(x,Math.max(1,v));this.changeMediaPlaybackRate(t,b)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:c,lowLatencyMode:d}=this.config,h=this.hls.userConfig;let f=d&&i||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||f===0)&&(f=a!==void 0?a:c*r);const m=r;return f+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,a=e-t-this.edgeStalled,c=r-i.totalduration,d=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(c,a),d)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===K.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class ZR extends If{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],a={},c={};let d=!1,h=!1,f=!1;t.levels.forEach(m=>{const x=m.attrs;let{audioCodec:v,videoCodec:b}=m;v&&(m.audioCodec=v=Co(v,i)||void 0),b&&(b=m.videoCodec=MT(b));const{width:S,height:A,unknownCodecs:E}=m,_=(E==null?void 0:E.length)||0;if(d||(d=!!(S&&A)),h||(h=!!b),f||(f=!!v),_||v&&!this.isAudioSupported(v)||b&&!this.isVideoSupported(b)){this.log(`Some or all CODECS not supported "${x.CODECS}"`);return}const{CODECS:R,"FRAME-RATE":D,"HDCP-LEVEL":k,"PATHWAY-ID":O,RESOLUTION:F,"VIDEO-RANGE":N}=x,C=`${`${O||"."}-`}${m.bitrate}-${F}-${D}-${R}-${N}-${k}`;if(a[C])if(a[C].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const P=c[C]+=1;m.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const W=this.createLevel(m);a[C]=W,r.push(W)}else a[C].addGroupId("audio",x.AUDIO),a[C].addGroupId("text",x.SUBTITLES);else{const P=this.createLevel(m);a[C]=P,c[C]=1,r.push(P)}}),this.filterAndSortMediaOptions(r,t,d,h,f)}createLevel(e){const t=new Pa(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=Xx(r,[])}return t}isAudioSupported(e){return Ma(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ma(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,a){var c;let d=[],h=[],f=e;const m=((c=t.stats)==null?void 0:c.parsing)||{};if((i||r)&&a&&(f=f.filter(({videoCodec:R,videoRange:D,width:k,height:O})=>(!!R||!!(k&&O))&&HT(D))),f.length===0){Promise.resolve().then(()=>{if(this.hls){let R="no level with compatible codecs found in manifest",D=R;t.levels.length&&(D=`one or more CODECS in variant not supported: ${dt(t.levels.map(O=>O.attrs.CODECS).filter((O,F,N)=>N.indexOf(O)===F))}`,this.warn(D),R+=` (${D})`);const k=new Error(R);this.hls.trigger(L.ERROR,{type:_e.MEDIA_ERROR,details:K.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:k,reason:D})}}),m.end=performance.now();return}t.audioTracks&&(d=t.audioTracks.filter(R=>!R.audioCodec||this.isAudioSupported(R.audioCodec)),hx(d)),t.subtitles&&(h=t.subtitles,hx(h));const x=f.slice(0);f.sort((R,D)=>{if(R.attrs["HDCP-LEVEL"]!==D.attrs["HDCP-LEVEL"])return(R.attrs["HDCP-LEVEL"]||"")>(D.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&R.height!==D.height)return R.height-D.height;if(R.frameRate!==D.frameRate)return R.frameRate-D.frameRate;if(R.videoRange!==D.videoRange)return No.indexOf(R.videoRange)-No.indexOf(D.videoRange);if(R.videoCodec!==D.videoCodec){const k=np(R.videoCodec),O=np(D.videoCodec);if(k!==O)return O-k}if(R.uri===D.uri&&R.codecSet!==D.codecSet){const k=Io(R.codecSet),O=Io(D.codecSet);if(k!==O)return O-k}return R.averageBitrate!==D.averageBitrate?R.averageBitrate-D.averageBitrate:0});let v=x[0];if(this.steering&&(f=this.steering.filterParsedLevels(f),f.length!==x.length)){for(let R=0;R<x.length;R++)if(x[R].pathwayId===f[0].pathwayId){v=x[R];break}}this._levels=f;for(let R=0;R<f.length;R++)if(f[R]===v){var b;this._firstLevel=R;const D=v.bitrate,k=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${f.length} level(s) found, first bitrate: ${D}`),((b=this.hls.userConfig)==null?void 0:b.abrEwmaDefaultEstimate)===void 0){const O=Math.min(D,this.hls.config.abrEwmaDefaultEstimateMax);O>k&&k===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=O)}break}const S=a&&!r,A=this.hls.config,E=!!(A.audioStreamController&&A.audioTrackController),_={levels:f,audioTracks:d,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:E&&!S&&d.some(R=>!!R.url)};m.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,_)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),x=e<0;if(this.hls.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.LEVEL_SWITCH_ERROR,level:e,fatal:x,error:m,reason:m.message}),x)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,c=t[e],d=c.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=c,i===e&&r&&a===d)return;this.log(`Switching to level ${e} (${c.height?c.height+"p ":""}${c.videoRange?c.videoRange+" ":""}${c.codecSet?c.codecSet+" ":""}@${c.bitrate})${d?" with Pathway "+d:""} from level ${i}${a?" with Pathway "+a:""}`);const h={level:e,attrs:c.attrs,details:c.details,bitrate:c.bitrate,averageBitrate:c.averageBitrate,maxBitrate:c.maxBitrate,realBitrate:c.realBitrate,width:c.width,height:c.height,codecSet:c.codecSet,audioCodec:c.audioCodec,videoCodec:c.videoCodec,audioGroups:c.audioGroups,subtitleGroups:c.subtitleGroups,loaded:c.loaded,loadError:c.loadError,fragmentError:c.fragmentError,name:c.name,id:c.id,uri:c.uri,url:c.url,urlId:0,audioGroupIds:c.audioGroupIds,textGroupIds:c.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,h);const f=c.details;if(!f||f.live){const m=this.switchParams(c.uri,r==null?void 0:r.details,f);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===$e.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ve.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(a=>!!i[a]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:a}=t,c=t.levelInfo;if(!c){var d;this.warn(`Invalid level index ${r}`),(d=t.deliveryDirectives)!=null&&d.skip&&(a.deltaUpdateFailed=!0);return}if(c===this.currentLevel||t.withoutMultiVariant){c.fragmentError===0&&(c.loadError=0);let h=c.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(r,t,h)}else(i=t.deliveryDirectives)!=null&&i.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],c=e.details,d=c==null?void 0:c.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a?" Pathway "+a:""}${d&&c.live?" age "+d.toFixed(1)+(c.type&&" "+c.type||""):""} ${i}`),this.hls.trigger(L.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((a,c)=>c!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(d=>d.level=-1)),!1));py(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(L.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function hx(o){const e={};o.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function dv(){return self.SourceBuffer||self.WebKitSourceBuffer}function fv(){if(!ln())return!1;const e=dv();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function JR(){if(!fv())return!1;const o=ln();return typeof(o==null?void 0:o.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>o.isTypeSupported(Oa(e,"video")))||["mp4a.40.2","fLaC"].some(e=>o.isTypeSupported(Oa(e,"audio"))))}function ew(){var o;const e=dv();return typeof(e==null||(o=e.prototype)==null?void 0:o.changeType)=="function"}const tw=100;class sw extends Ef{constructor(e,t,i){super(e,t,i,"stream-controller",ve.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,a=r?r.currentTime:null;if(a===null||!ye(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const c=this.getFwdBufferInfoAtPos(r,a,ve.MAIN,0);if(c===null||c.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${c?c.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(tw),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ae.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ae.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ae.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e==null?void 0:e[t],r=i==null?void 0:i.details;if(r&&(!r.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(r))break;this.state=ae.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ae.IDLE;break}break}case ae.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ae.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[a]))return;const c=i[a],d=this.getMainFwdBufferInfo();if(d===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(d,h)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(L.BUFFER_EOS,A),this.state=ae.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const f=c.details;if(!f||this.state===ae.WAITING_LEVEL||this.waitForLive(c)){this.level=a,this.state=ae.WAITING_LEVEL,this.startFragRequested=!1;return}const m=d.len,x=this.getMaxBufferLength(c.maxBitrate);if(m>=x)return;this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:d.end;let b=this.getNextFragment(v,f);if(this.couldBacktrack&&!this.fragPrevious&&b&&wt(b)&&this.fragmentTracker.getState(b)!==Ut.OK){var S;const E=((S=this.backtrackFragment)!=null?S:b).sn-f.startSN,_=f.fragments[E-1];_&&b.cc===_.cc&&(b=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(b&&this.isLoopLoading(b,v)){if(!b.gap){const E=this.audioOnly&&!this.altAudio?ut.AUDIO:ut.VIDEO,_=(E===ut.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,E,ve.MAIN)}b=this.getNextFragmentLoopLoading(b,f,d,ve.MAIN,x)}b&&(b.initSegment&&!b.initSegment.data&&!this.bitrateTest&&(b=b.initSegment),this.loadFragment(b,c,v))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);r===Ut.NOT_LOADED||r===Ut.PARTIAL?wt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ve.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const d=this.getMainFwdBufferInfo();if(!d||d.len<a.targetduration*2)return}if(!t.paused&&e){const d=this.hls.nextLoadLevel,h=e[d],f=this.fragLastKbps;f&&this.fragCurrent?i=this.fragCurrent.duration*h.maxBitrate/(1e3*f)+1:i=0}else i=0;const c=this.getBufferedFrag(t.currentTime+i);if(c){const d=this.followingBufferedFrag(c);if(d){this.abortCurrentFrag();const h=d.maxStartPTS?d.maxStartPTS:d.start,f=d.duration,m=Math.max(c.end,h+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ae.KEY_LOADING:case ae.FRAG_LOADING:case ae.FRAG_LOADING_WAITING_RETRY:case ae.PARSING:case ae.PARSED:this.state=ae.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;is(i,"playing",this.onMediaPlaying),is(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(hs(i,"playing",this.onMediaPlaying),hs(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;for(let a=0;a<t.levels.length;a++){const c=t.levels[a].audioCodec;c&&(i=i||c.indexOf("mp4a.40.2")!==-1,r=r||c.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&r&&!ew(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ae.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ae.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r,startFragRequested:a}=this,c=t.level,d=t.details,h=d.totalduration;if(!r){this.warn(`Levels were reset while loading level ${c}`);return}this.log(`Level ${c} loaded [${d.startSN},${d.endSN}]${d.lastPartSn?`[part-${d.lastPartSn}-${d.lastPartIndex}]`:""}, cc [${d.startCC}, ${d.endCC}] duration:${h}`);const f=t.levelInfo,m=this.fragCurrent;m&&(this.state===ae.FRAG_LOADING||this.state===ae.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let x=0;if(d.live||(i=f.details)!=null&&i.live){var v;if(this.checkLiveUpdate(d),d.deltaUpdateFailed)return;x=this.alignPlaylists(d,f.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(f.details=d,this.levelLastLoaded=f,a||this.setStartPosition(d,x),this.hls.trigger(L.LEVEL_UPDATED,{details:d,level:c}),this.state===ae.WAITING_LEVEL){if(this.waitForCdnTuneIn(d))return;this.state=ae.IDLE}a&&d.live&&this.synchronizeToLiveEdge(d),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,a=this.getLoadPosition(),c=e.fragmentStart,d=e.edge,h=a>=c-t.maxFragLookUpTolerance&&a<=d;if(r!==null&&i.duration>r&&(a<r||!h)){const m=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&i.readyState<4||a<d-m)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${d}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var f;const x=Oe.bufferInfo(i,r,0);if(!((f=x.buffered)!=null&&f.length)){i.currentTime=r;return}if(x.start<=a){i.currentTime=r;return}const{nextStart:b}=Oe.bufferedInfo(x.buffered,a,0);b&&(i.currentTime=b)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:a}=e,{levels:c}=this;if(!c){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const d=c[i.level];if(!d){this.warn(`Level ${i.level} not found on progress`);return}const h=d.details;if(!h){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const f=d.videoCodec,m=h.PTSKnown||!h.live,x=(t=i.initSegment)==null?void 0:t.data,v=this._getAudioCodec(d),b=this.transmuxer=this.transmuxer||new Uy(this.hls,ve.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=r?r.index:-1,A=S!==-1,E=new vf(i.level,i.sn,i.stats.chunkCount,a.byteLength,S,A),_=this.initPTS[i.cc];b.push(a,x,v,f,i,r,h.totalduration,m,E,_)}onAudioTrackSwitching(e,t){const i=this.hls,r=this.altAudio!==0;if(ko(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const c=this.fragCurrent;c&&(this.log("Switching to main audio track, cancel main fragment load"),c.abortRequests(),this.fragmentTracker.removeFragment(c)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),i.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=ko(t.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,a,c=!1;for(const d in i){const h=i[d];if(h.id==="main"){if(a=d,r=h,d==="video"){const f=i[d];f&&(this.videoBuffer=f.buffer)}}else c=!0}c&&r?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t,a=i.type===ve.MAIN;if(a){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ae.PARSED&&(this.state=ae.IDLE);return}const d=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),wt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const c=this.media;c&&(!this._hasEnoughToStart&&Oe.getBuffered(c).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ae.ERROR;return}switch(t.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ve.MAIN,t);break;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ae.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===$e.LEVEL&&(this.state=ae.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ae.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ut.AUDIO||!this.altAudio){const i=(t===ut.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,ve.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const a=this.getLevelDetails(),c=Oe.getBuffered(e),d=c.length?c.start(0):0,h=d-i,f=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<f||this.loadingParts&&h<2*((a==null?void 0:a.partTarget)||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),i+=h,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${d}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this,a=i==null?void 0:i.frag;if(!a||this.fragContextChanged(a))return;t.fragmentError=0,this.state=ae.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const c=a.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),r.trigger(L.FRAG_LOADED,i),a.bitrateTest=!1}).catch(i=>{this.state===ae.STOPPED||this.state===ae.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:d,part:h,level:f}=c,{video:m,text:x,id3:v,initSegment:b}=r,{details:S}=f,A=this.altAudio?void 0:r.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=ae.PARSING,b){const E=b.tracks;if(E){const k=d.initSegment||d;if(this.unhandledEncryptionError(b,d))return;this._bufferInitSegment(f,E,k,a),i.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:t,tracks:E})}const _=b.initPTS,R=b.timescale,D=this.initPTS[d.cc];if(ye(_)&&(!D||D.baseTime!==_||D.timescale!==R)){const k=b.trackId;this.initPTS[d.cc]={baseTime:_,timescale:R,trackId:k},i.trigger(L.INIT_PTS_FOUND,{frag:d,id:t,initPTS:_,timescale:R,trackId:k})}}if(m&&S){A&&m.type==="audiovideo"&&this.logMuxedErr(d);const E=S.fragments[d.sn-1-S.startSN],_=d.sn===S.startSN,R=!E||d.cc>E.cc;if(r.independent!==!1){const{startPTS:D,endPTS:k,startDTS:O,endDTS:F}=m;if(h)h.elementaryStreams[m.type]={startPTS:D,endPTS:k,startDTS:O,endDTS:F};else if(m.firstKeyFrame&&m.independent&&a.id===1&&!R&&(this.couldBacktrack=!0),m.dropped&&m.independent){const N=this.getMainFwdBufferInfo(),B=(N?N.end:this.getLoadPosition())+this.config.maxBufferHole,C=m.firstKeyFramePTS?m.firstKeyFramePTS:D;if(!_&&B<C-this.config.maxBufferHole&&!R){this.backtrack(d);return}else R&&(d.gap=!0);d.setElementaryStreamInfo(m.type,d.start,k,d.start,F,!0)}else _&&D-(S.appliedTimelineOffset||0)>_o&&(d.gap=!0);d.setElementaryStreamInfo(m.type,D,k,O,F),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(m,d,h,a,_||R)}else if(_||R)d.gap=!0;else{this.backtrack(d);return}}if(A){const{startPTS:E,endPTS:_,startDTS:R,endDTS:D}=A;h&&(h.elementaryStreams[ut.AUDIO]={startPTS:E,endPTS:_,startDTS:R,endDTS:D}),d.setElementaryStreamInfo(ut.AUDIO,E,_,R,D),this.bufferFragmentData(A,d,h,a)}if(S&&v!=null&&v.samples.length){const E={id:t,frag:d,details:S,samples:v.samples};i.trigger(L.FRAG_PARSING_METADATA,E)}if(S&&x){const E={id:t,frag:d,details:S,samples:x.samples};i.trigger(L.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${wt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==ae.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:a,video:c,audiovideo:d}=t;if(a){const f=e.audioCodec;let m=vo(a.codec,f);m==="mp4a"&&(m="mp4a.40.5");const x=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){m&&(m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5");const v=a.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&x.indexOf("firefox")===-1&&(m="mp4a.40.5")}m&&m.indexOf("mp4a.40.5")!==-1&&x.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log(`Android: force audio codec to ${m}`)),f&&f!==m&&this.log(`Swapping manifest audio codec "${f}" for "${m}"`),a.levelCodec=m,a.id=ve.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${m||""}/${f||""}/${a.codec}]`),delete t.audiovideo}if(c){c.levelCodec=e.videoCodec,c.id=ve.MAIN;const f=c.codec;if((f==null?void 0:f.length)===4)switch(f){case"hvc1":case"hev1":c.codec="hvc1.1.6.L120.90";break;case"av01":c.codec="av01.0.04M.08";break;case"avc1":c.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${c.container}, codecs[level/parsed]=[${e.videoCodec||""}/${f}]${c.codec!==f?" parsed-corrected="+c.codec:""}${c.supplemental?" supplemental="+c.supplemental:""}`),delete t.audiovideo}d&&(this.log(`Init audiovideo buffer, container:${d.container}, codecs[level/parsed]=[${e.codecs}/${d.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;h.forEach(f=>{const x=t[f].initSegment;x!=null&&x.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:f,data:x,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ve.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ae.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Oe.isBuffered(e,i)?t=this.getAppendedFrag(i):Oe.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,a=t.level;(!r||t.sn!==r.sn||r.level!==a)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!r||r.level!==a)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ye(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ye(t)){const i=this.getLevelDetails(),r=this.currentFrag||(i?Nn(null,i.fragments,t):null);if(r){const a=r.programDateTime;if(a!==null){const c=a+(t-r.start)*1e3;return new Date(c)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class iw extends Gs{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=K.KEY_LOAD_ERROR,i,r,a){return new wi({type:_e.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,a=t.length;r<a;r++){const c=t[r];if(e.cc<=c.cc&&(!wt(e)||!wt(c)||e.sn<c.sn)||!i&&r==a-1)return this.emeController.selectKeySystemFormat(c).then(d=>{if(!this.emeController)return;c.setKeyFormat(d);const h=So(d);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const r=Ra(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const a=e.decryptdata;if(!a){const f=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,f))}const c=a.uri;if(!c)return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${c}"`)));const d=Nd(a);let h=this.keyIdToKeyInfo[d];if((i=h)!=null&&i.decryptdata.key)return a.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(r=h)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(m=>{const{keyInfo:x}=m;return a.key=x.decryptdata.key,{frag:e,keyInfo:x}})}switch(this.log(`${this.keyIdToKeyInfo[d]?"Rel":"L"}oading${a.keyId?" keyId: "+Qt(a.keyId):""} URI: ${a.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[d]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const c=ET(t.initSegment.data);if(c.length){let d=c[0];d.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Qt(d)}`),an.setKeyIdForUri(e.decryptdata.uri,d)):(d=an.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Qt(d)}`)),e.decryptdata.keyId=d}}if(!e.decryptdata.keyId&&!wt(t))return Promise.resolve(i);const a=this.emeController.loadKey(i);return(e.keyLoadPromise=a.then(c=>(e.mediaKeySessionContext=c,i))).catch(c=>{throw e.keyLoadPromise=null,"data"in c&&(c.data.frag=t),c})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,a=new r(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((c,d)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},f=i.keyLoadPolicy.default,m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},x={onSuccess:(v,b,S,A)=>{const{frag:E,keyInfo:_}=S,R=Nd(_.decryptdata);if(!E.decryptdata||_!==this.keyIdToKeyInfo[R])return d(this.createKeyLoadError(E,K.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));_.decryptdata.key=E.decryptdata.key=new Uint8Array(v.data),E.keyLoader=null,_.loader=null,c({frag:E,keyInfo:_})},onError:(v,b,S,A)=>{this.resetLoader(b),d(this.createKeyLoadError(t,K.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),S,tt({url:h.url,data:void 0},v)))},onTimeout:(v,b,S)=>{this.resetLoader(b),d(this.createKeyLoadError(t,K.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(v,b,S)=>{this.resetLoader(b),d(this.createKeyLoadError(t,K.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};a.load(h,m,x)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,a=i.loader;t.keyLoader===a&&(t.keyLoader=null,i.loader=null);const c=Nd(i.decryptdata)||r;delete this.keyIdToKeyInfo[c],a&&a.destroy()}}function Nd(o){if(o.keyFormat!==Wt.FAIRPLAY){const e=o.keyId;if(e)return Qt(e)}return o.uri}function mx(o){const{type:e}=o;switch(e){case $e.AUDIO_TRACK:return ve.AUDIO;case $e.SUBTITLE_TRACK:return ve.SUBTITLE;default:return ve.MAIN}}function kd(o,e){let t=o.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class nw{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,a=i||r,c=new a(t);return this.loaders[e.type]=c,c}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:$e.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:a,url:c,deliveryDirectives:d,levelInfo:h}=t;this.load({id:i,level:r,pathwayId:a,responseType:"text",type:$e.LEVEL,url:c,deliveryDirectives:d,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:a,deliveryDirectives:c,track:d}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:$e.AUDIO_TRACK,url:a,deliveryDirectives:c,levelOrTrack:d})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:a,deliveryDirectives:c,track:d}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:$e.SUBTITLE_TRACK,url:a,deliveryDirectives:c,levelOrTrack:d})}onLevelsUpdated(e,t){const i=this.loaders[$e.LEVEL];if(i){const r=i.context;r&&!t.levels.some(a=>a===r.levelOrTrack)&&(i.abort(),delete this.loaders[$e.LEVEL])}}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const f=this.hls.logger,m=r.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?f.log(`[playlist-loader]: ignore ${e.url} ongoing request`):f.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}f.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let a;if(e.type===$e.MANIFEST?a=i.manifestLoadPolicy.default:a=ot({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),ye((t=e.deliveryDirectives)==null?void 0:t.part)){let f;if(e.type===$e.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===$e.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===$e.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){const m=f.partTarget,x=f.targetduration;if(m&&x){const v=Math.max(m*3,x*.8)*1e3;a=ot({},a,{maxTimeToFirstByteMs:Math.min(v,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,a.maxTimeToFirstByteMs)})}}}const c=a.errorRetry||a.timeoutRetry||{},d={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(f,m,x,v)=>{const b=this.getInternalLoader(x);this.resetInternalLoader(x.type);const S=f.data;m.parsing.start=performance.now(),ri.isMediaPlaylist(S)||x.type!==$e.MANIFEST?this.handleTrackOrLevelPlaylist(f,m,x,v||null,b):this.handleMasterPlaylist(f,m,x,v)},onError:(f,m,x,v)=>{this.handleNetworkError(m,x,!1,f,v)},onTimeout:(f,m,x)=>{this.handleNetworkError(m,x,!0,void 0,f)}};r.load(e,d,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){const a=this.hls,c=e.data,d=kd(e,i),h=ri.parseMasterPlaylist(c,d);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,h.playlistParsingError,r,t);return}const{contentSteering:f,levels:m,sessionData:x,sessionKeys:v,startTimeOffset:b,variableList:S}=h;this.variableList=S,m.forEach(R=>{const{unknownCodecs:D}=R;if(D){const{preferManagedMediaSource:k}=this.hls.config;let{audioCodec:O,videoCodec:F}=R;for(let N=D.length;N--;){const B=D[N];Ma(B,"audio",k)?(R.audioCodec=O=O?`${O},${B}`:B,Cr.audio[O.substring(0,4)]=2,D.splice(N,1)):Ma(B,"video",k)&&(R.videoCodec=F=F?`${F},${B}`:B,Cr.video[F.substring(0,4)]=2,D.splice(N,1))}}});const{AUDIO:A=[],SUBTITLES:E,"CLOSED-CAPTIONS":_}=ri.parseMasterPlaylistMedia(c,d,h);A.length&&!A.some(D=>!D.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new yt({}),bitrate:0,url:""})),a.trigger(L.MANIFEST_LOADED,{levels:m,audioTracks:A,subtitles:E,captions:_,contentSteering:f,url:d,stats:t,networkDetails:r,sessionData:x,sessionKeys:v,startTimeOffset:b,variableList:S})}handleTrackOrLevelPlaylist(e,t,i,r,a){const c=this.hls,{id:d,level:h,type:f}=i,m=kd(e,i),x=ye(h)?h:ye(d)?d:0,v=mx(i),b=ri.parseLevelPlaylist(e.data,m,x,v,0,this.variableList);if(f===$e.MANIFEST){const S={attrs:new yt({}),bitrate:0,details:b,name:"",url:m};b.requestScheduled=t.loading.start+hy(b,0),c.trigger(L.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:m,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=b,this.handlePlaylistLoaded(b,e,t,i,r,a)}handleManifestParsingError(e,t,i,r,a){this.hls.trigger(L.ERROR,{type:_e.NETWORK_ERROR,details:K.MANIFEST_PARSING_ERROR,fatal:t.type===$e.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,i=!1,r,a){let c=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===$e.LEVEL?c+=`: ${e.level} id: ${e.id}`:(e.type===$e.AUDIO_TRACK||e.type===$e.SUBTITLE_TRACK)&&(c+=` id: ${e.id} group-id: "${e.groupId}"`);const d=new Error(c);this.hls.logger.warn(`[playlist-loader]: ${c}`);let h=K.UNKNOWN,f=!1;const m=this.getInternalLoader(e);switch(e.type){case $e.MANIFEST:h=i?K.MANIFEST_LOAD_TIMEOUT:K.MANIFEST_LOAD_ERROR,f=!0;break;case $e.LEVEL:h=i?K.LEVEL_LOAD_TIMEOUT:K.LEVEL_LOAD_ERROR,f=!1;break;case $e.AUDIO_TRACK:h=i?K.AUDIO_TRACK_LOAD_TIMEOUT:K.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case $e.SUBTITLE_TRACK:h=i?K.SUBTITLE_TRACK_LOAD_TIMEOUT:K.SUBTITLE_LOAD_ERROR,f=!1;break}m&&this.resetInternalLoader(e.type);const x={type:_e.NETWORK_ERROR,details:h,fatal:f,url:e.url,loader:m,context:e,error:d,networkDetails:t,stats:a};if(r){const v=(t==null?void 0:t.url)||e.url;x.response=tt({url:v,data:void 0},r)}this.hls.trigger(L.ERROR,x)}handlePlaylistLoaded(e,t,i,r,a,c){const d=this.hls,{type:h,level:f,levelOrTrack:m,id:x,groupId:v,deliveryDirectives:b}=r,S=kd(t,r),A=mx(r);let E=typeof r.level=="number"&&A===ve.MAIN?f:void 0;const _=e.playlistParsingError;if(_){if(this.hls.logger.warn(`${_} ${e.url}`),!d.config.ignorePlaylistParsingErrors){d.trigger(L.ERROR,{type:_e.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:_,reason:_.message,response:t,context:r,level:E,parent:A,networkDetails:a,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const R=e.playlistParsingError=new Error("No Segments found in Playlist");d.trigger(L.ERROR,{type:_e.NETWORK_ERROR,details:K.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:R,reason:R.message,response:t,context:r,level:E,parent:A,networkDetails:a,stats:i});return}switch(e.live&&c&&(c.getCacheAge&&(e.ageHeader=c.getCacheAge()||0),(!c.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case $e.MANIFEST:case $e.LEVEL:if(E){if(!m)E=0;else if(m!==d.levels[E]){const R=d.levels.indexOf(m);R>-1&&(E=R)}}d.trigger(L.LEVEL_LOADED,{details:e,levelInfo:m||d.levels[0],level:E||0,id:x||0,stats:i,networkDetails:a,deliveryDirectives:b,withoutMultiVariant:h===$e.MANIFEST});break;case $e.AUDIO_TRACK:d.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:m,id:x||0,groupId:v||"",stats:i,networkDetails:a,deliveryDirectives:b});break;case $e.SUBTITLE_TRACK:d.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:m,id:x||0,groupId:v||"",stats:i,networkDetails:a,deliveryDirectives:b});break}}}class _s{static get version(){return ja}static isMSESupported(){return fv()}static isSupported(){return JR()}static getMediaSource(){return ln()}static get Events(){return L}static get MetadataSchema(){return Ls}static get ErrorTypes(){return _e}static get ErrorDetails(){return K}static get DefaultConfig(){return _s.defaultConfig?_s.defaultConfig:$R}static set DefaultConfig(e){_s.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Tf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=uT(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=zR(_s.DefaultConfig,e,t);this.userConfig=e,i.progressive&&HR(i,t);const{abrController:r,bufferController:a,capLevelController:c,errorController:d,fpsController:h}=i,f=new d(this),m=this.abrController=new r(this),x=new rA(this),v=i.interstitialsController,b=v?this.interstitialsController=new v(this,_s):null,S=this.bufferController=new a(this,x),A=this.capLevelController=new c(this),E=new h(this),_=new nw(this),R=i.contentSteeringController,D=R?new R(this):null,k=this.levelController=new ZR(this,D),O=new QR(this),F=new iw(this.config,this.logger),N=this.streamController=new sw(this,x,F),B=this.gapController=new qR(this,x);A.setStreamController(N),E.setStreamController(N);const C=[_,k,N];b&&C.splice(1,0,b),D&&C.splice(1,0,D),this.networkControllers=C;const P=[m,S,B,A,E,O,x];this.audioTrackController=this.createController(i.audioTrackController,C);const W=i.audioStreamController;W&&C.push(this.audioStreamController=new W(this,x,F)),this.subtitleTrackController=this.createController(i.subtitleTrackController,C);const ue=i.subtitleStreamController;ue&&C.push(this.subtititleStreamController=new ue(this,x,F)),this.createController(i.timelineController,P),F.emeController=this.emeController=this.createController(i.emeController,P),this.cmcdController=this.createController(i.cmcdController,P),this.latencyController=this.createController(WR,P),this.coreComponents=P,C.push(f);const me=f.onErrorOut;typeof me=="function"&&this.on(L.ERROR,me,f),this.on(L.MANIFEST_LOADED,_.onManifestLoaded,_)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===L.ERROR;this.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const a=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:_e.OTHER_ERROR,details:K.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(L.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,r=this._url=ff.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ve.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ve.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ve.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=q_()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){zT(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let a=r;a--;){const c=e[a].attrs["HDCP-LEVEL"];if(c&&c<=i)return a}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=Zx(t);return Qx(e,i,navigator.mediaCapabilities)}}_s.defaultConfig=void 0;const gx=({url:o,title:e,type:t,onClose:i,playlist:r,currentItem:a,onChannelSelect:c,isEmbedded:d=!1,onToggleEmbed:h,account:f})=>{const m=Y.useRef(null),x=Y.useRef(null),v=Y.useRef(null),b=Y.useRef(null),S=Y.useRef(null),[A,E]=Y.useState(!0),[_,R]=Y.useState(1),[D,k]=Y.useState(!1),[O,F]=Y.useState(0),[N,B]=Y.useState(0),[C,P]=Y.useState(!1),[W,ue]=Y.useState(!0),[me,ee]=Y.useState(!0),[ce,j]=Y.useState(0),[X,se]=Y.useState(!1),[de,te]=Y.useState(!1),[I,M]=Y.useState(null),[G,Z]=Y.useState(null),[re,V]=Y.useState(0),ge=Y.useRef(null);Y.useEffect(()=>{if(de&&a&&v.current){const pe=document.getElementById(`channel-${a.stream_id}`);pe&&pe.scrollIntoView({block:"center",behavior:"smooth"})}},[de,a]),Y.useEffect(()=>{if(M(null),Z(null),V(0),t!=="live"||!f||!a||!a.stream_id)return;const pe=async()=>{try{const Xe=`${f.protocol}://${f.host}:${f.port}/player_api.php?username=${f.username}&password=${f.password}&action=get_short_epg&stream_id=${a.stream_id}&limit=4`,Ge=Fs(Xe),nt=await(await fetch(Ge)).json();nt&&nt.epg_listings&&Array.isArray(nt.epg_listings)&&be(nt.epg_listings)}catch(Xe){console.warn("EPG Fetch failed",Xe)}},be=Xe=>{const Ge=Date.now()/1e3;let Zt=null,nt=null;const Jt=Xe.sort((gt,xt)=>gt.start_timestamp-xt.start_timestamp);for(let gt=0;gt<Jt.length;gt++){const xt=Jt[gt],Ft=parseInt(xt.start_timestamp),Lt=parseInt(xt.stop_timestamp);if(Ge>=Ft&&Ge<Lt){if(Zt={title:xt.title&&Ye(xt.title)?atob(xt.title):xt.title,description:xt.description&&Ye(xt.description)?atob(xt.description):xt.description,start_timestamp:Ft,stop_timestamp:Lt},gt+1<Jt.length){const es=Jt[gt+1];nt={title:es.title&&Ye(es.title)?atob(es.title):es.title,description:es.description&&Ye(es.description)?atob(es.description):es.description,start_timestamp:parseInt(es.start_timestamp),stop_timestamp:parseInt(es.stop_timestamp)}}break}}M(Zt),Z(nt)};return pe(),S.current&&clearInterval(S.current),S.current=window.setInterval(()=>{M(Xe=>Xe?{...Xe}:null)},6e4),()=>{S.current&&clearInterval(S.current)}},[t,a,f]),Y.useEffect(()=>{if(!I){V(0);return}const pe=Date.now()/1e3,be=I.stop_timestamp-I.start_timestamp,Xe=pe-I.start_timestamp,Ge=Math.min(100,Math.max(0,Xe/be*100));V(Ge)},[I,O]),Y.useEffect(()=>{const pe=m.current;if(!pe)return;let be=null;ee(!0),se(!1);const Xe=o.includes(".m3u8"),Ge=()=>{if(!pe)return;const Ft=pe.play();Ft!==void 0&&Ft.catch(Lt=>{Lt.name!=="AbortError"&&console.error("Auto-play blocked",Lt)})};Xe&&_s.isSupported()?(be=new _s({enableWorker:!0,lowLatencyMode:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:3}),be.loadSource(o),be.attachMedia(pe),be.on(_s.Events.MANIFEST_PARSED,()=>{ee(!1),se(!1),Ge()}),be.on(_s.Events.ERROR,(Ft,Lt)=>{if(console.error("HLS Error",Lt),Lt.fatal)switch(Lt.type){case _s.ErrorTypes.MEDIA_ERROR:console.warn("Media error encountered, trying to recover..."),be==null||be.recoverMediaError();break;case _s.ErrorTypes.NETWORK_ERROR:default:console.warn("Fatal network error, scheduling retry in 5s..."),be==null||be.destroy(),ee(!0),se(!0),b.current&&clearTimeout(b.current),b.current=window.setTimeout(()=>{j(es=>es+1)},5e3);break}})):(pe.src=o,pe.load(),Ge(),pe.onerror=()=>{console.error("Native Video Error",pe.error),ee(!0),se(!0),b.current&&clearTimeout(b.current),b.current=window.setTimeout(()=>{j(Ft=>Ft+1)},5e3)});const Zt=()=>F(pe.currentTime),nt=()=>B(pe.duration),Jt=()=>ee(!0),gt=()=>{ee(!1),se(!1),E(!0)},xt=()=>E(!1);return pe.addEventListener("timeupdate",Zt),pe.addEventListener("loadedmetadata",nt),pe.addEventListener("waiting",Jt),pe.addEventListener("playing",gt),pe.addEventListener("pause",xt),()=>{be&&be.destroy(),b.current&&clearTimeout(b.current),pe&&(pe.removeAttribute("src"),pe.load(),pe.removeEventListener("timeupdate",Zt),pe.removeEventListener("loadedmetadata",nt),pe.removeEventListener("waiting",Jt),pe.removeEventListener("playing",gt),pe.removeEventListener("pause",xt),pe.onerror=null)}},[o,ce]);const Re=()=>{ue(!0),ge.current&&window.clearTimeout(ge.current),de||(ge.current=window.setTimeout(()=>{A&&!me&&ue(!1)},3e3))},Ae=()=>{m.current&&(A?m.current.pause():m.current.play())},Ce=()=>{m.current&&(m.current.pause(),m.current.currentTime=0,E(!1))},it=()=>{m.current&&(m.current.muted=!D,k(!D))},Mt=pe=>{const be=parseFloat(pe.target.value);R(be),m.current&&(m.current.volume=be,m.current.muted=be===0,k(be===0))},bt=pe=>{const be=parseFloat(pe.target.value);F(be),m.current&&(m.current.currentTime=be)},ft=pe=>{m.current&&(m.current.currentTime+=pe)},At=()=>{var pe;document.fullscreenElement?(document.exitFullscreen(),P(!1)):((pe=x.current)==null||pe.requestFullscreen(),P(!0))},le=pe=>{if(!r||!a||!c)return;const be=r.findIndex(Ge=>Ge.stream_id===a.stream_id);if(be===-1)return;let Xe=pe==="next"?be+1:be-1;Xe>=r.length&&(Xe=0),Xe<0&&(Xe=r.length-1),c(r[Xe])},Te=pe=>{if(isNaN(pe))return"00:00";const be=Math.floor(pe/3600),Xe=Math.floor(pe%3600/60),Ge=Math.floor(pe%60);return be>0?`${be}:${Xe.toString().padStart(2,"0")}:${Ge.toString().padStart(2,"0")}`:`${Xe}:${Ge.toString().padStart(2,"0")}`},Ye=pe=>{try{return btoa(atob(pe))===pe}catch{return!1}},ke=pe=>new Date(pe*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});Y.useEffect(()=>{const pe=be=>{be.key==="Escape"&&i(),(be.key===" "||be.key==="k")&&Ae(),be.key==="f"&&At(),be.key==="s"&&Ce(),t!=="live"?(be.key==="ArrowRight"&&ft(10),be.key==="ArrowLeft"&&ft(-10)):(be.key==="ArrowRight"&&le("next"),be.key==="ArrowLeft"&&le("prev")),be.key==="m"&&it()};return window.addEventListener("keydown",pe),()=>window.removeEventListener("keydown",pe)},[A,D,C,t,r,a]);const Fe=d?"absolute inset-0 z-50 bg-black flex flex-col items-center justify-center animate-in fade-in duration-300 overflow-hidden":"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-in fade-in duration-300 overflow-hidden";return g.jsxs("div",{ref:x,onMouseMove:Re,className:Fe,children:[me&&g.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-10 pointer-events-none bg-black/40 backdrop-blur-sm",children:[g.jsx("div",{className:"w-16 h-16 border-4 border-fluent-accent border-t-transparent rounded-full animate-spin mb-4"}),X&&g.jsxs("div",{className:"text-white text-sm font-medium animate-pulse flex items-center gap-2",children:[g.jsx(Fd,{size:14,className:"animate-spin"}),"Connexion perdue. Reconnexion dans 5s..."]})]}),g.jsx("video",{ref:m,className:"w-full h-full object-contain",onClick:Ae,onDoubleClick:h||At}),t==="live"&&r&&g.jsxs("div",{ref:v,className:`absolute top-0 right-0 bottom-16 w-80 bg-black/80 backdrop-blur-xl border-l border-white/10 transition-transform duration-300 ease-in-out z-20 flex flex-col
                    ${de?"translate-x-0":"translate-x-full"}`,children:[g.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[g.jsx("h3",{className:"text-white font-semibold",children:"Chanes"}),g.jsx("button",{onClick:()=>te(!1),className:"text-white/60 hover:text-white",children:g.jsx(Rs,{size:18})})]}),g.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1",children:r.map((pe,be)=>{const Xe=a&&pe.stream_id===a.stream_id;return g.jsxs("div",{id:`channel-${pe.stream_id}`,onClick:()=>c&&c(pe),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors group
                                    ${Xe?"bg-fluent-accent/20 border border-fluent-accent/20":"hover:bg-white/10 border border-transparent"}`,children:[g.jsx("div",{className:"w-10 h-10 rounded bg-black/40 flex items-center justify-center shrink-0 overflow-hidden",children:pe.stream_icon?g.jsx("img",{src:pe.stream_icon,className:"w-full h-full object-contain",loading:"lazy"}):g.jsx("div",{className:"text-white/20 text-xs",children:be+1})}),g.jsx("div",{className:"min-w-0",children:g.jsx("p",{className:`text-sm font-medium truncate ${Xe?"text-fluent-accent":"text-white/80 group-hover:text-white"}`,children:pe.name})}),Xe&&g.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-fluent-accent ml-auto animate-pulse"})]},pe.stream_id)})})]}),g.jsx("div",{className:`absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent transition-opacity duration-300 ${W?"opacity-100":"opacity-0"}`,children:g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"bg-fluent-accent text-black text-xs font-bold px-2 py-0.5 rounded uppercase",children:t}),g.jsx("h2",{className:"text-white font-medium text-lg drop-shadow-md truncate max-w-2xl",children:e})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[h&&g.jsx("button",{onClick:h,className:"text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10 transition-colors",title:d?"Agrandir":"Rduire",children:d?g.jsx(H0,{size:20}):g.jsx(V0,{size:20})}),g.jsx("button",{onClick:i,className:"text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10 transition-colors",children:g.jsx(Rs,{size:24})})]})]})}),g.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-[#111111]/95 backdrop-blur-md border-t border-white/10 transition-transform duration-300 z-30 pb-2 ${W?"translate-y-0":"translate-y-full"}`,children:[t==="live"&&I&&g.jsxs("div",{className:"px-4 pt-3 pb-1 border-b border-white/5 animate-in slide-in-from-bottom-2",children:[g.jsxs("div",{className:"flex items-end justify-between mb-1",children:[g.jsxs("div",{className:"min-w-0 flex-1 mr-4",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("h3",{className:"text-white font-bold text-lg truncate leading-tight drop-shadow-sm",children:I.title}),g.jsxs("span",{className:"text-xs text-fluent-accent font-mono bg-fluent-accent/10 px-1.5 py-0.5 rounded border border-fluent-accent/20",children:[ke(I.start_timestamp)," - ",ke(I.stop_timestamp)]})]}),G&&g.jsxs("div",{className:"text-white/50 text-xs truncate flex items-center gap-1",children:[g.jsx("span",{className:"uppercase font-bold tracking-wider text-[10px] opacity-70",children:" suivre :"}),g.jsx("span",{className:"text-white/70",children:G.title}),g.jsxs("span",{className:"opacity-50",children:["(",ke(G.start_timestamp),")"]})]})]}),g.jsxs("div",{className:"text-xs font-mono text-fluent-accent/80 font-bold mb-1",children:[Math.round(re),"%"]})]}),g.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-fluent-accent shadow-[0_0_8px_rgba(96,205,255,0.6)] transition-all duration-1000 ease-linear",style:{width:`${re}%`}})})]}),t!=="live"?g.jsxs("div",{className:"w-full relative h-1.5 bg-white/20 cursor-pointer group hover:h-3 transition-all",children:[g.jsx("div",{className:"absolute top-0 left-0 h-full bg-orange-500 shadow-[0_0_10px_rgba(249,115,22,0.5)]",style:{width:`${O/N*100}%`}}),g.jsx("input",{type:"range",min:"0",max:N||100,value:O,onChange:bt,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}):!I&&g.jsx("div",{className:"w-full h-[1px] bg-white/10 mb-1"}),g.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("button",{onClick:Ae,className:"text-white hover:text-orange-400 transition-colors",title:A?"Pause":"Lecture",children:A?g.jsx(WE,{size:24,fill:"currentColor"}):g.jsx(ii,{size:24,fill:"currentColor"})}),g.jsx("button",{onClick:Ce,className:"text-white/70 hover:text-white transition-colors",title:"Arrter",children:g.jsx(Dx,{size:18,fill:"currentColor"})}),g.jsx("div",{className:"flex items-center gap-1 mx-2",children:t==="live"?g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>le("prev"),className:"text-white/70 hover:text-white p-1 hover:bg-white/10 rounded",title:"Chane prcdente",children:g.jsx(K0,{size:18})}),g.jsx("button",{onClick:()=>le("next"),className:"text-white/70 hover:text-white p-1 hover:bg-white/10 rounded",title:"Chane suivante",children:g.jsx(Y0,{size:18})})]}):g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:()=>ft(-10),className:"text-white/70 hover:text-white p-1 hover:bg-white/10 rounded",title:"-10s",children:g.jsx(K0,{size:18})}),g.jsx("button",{onClick:()=>ft(10),className:"text-white/70 hover:text-white p-1 hover:bg-white/10 rounded",title:"+10s",children:g.jsx(Y0,{size:18})})]})}),g.jsxs("div",{className:"flex items-center gap-2 group",children:[g.jsx("button",{onClick:it,className:"text-white/80 hover:text-white",title:"Volume",children:D?g.jsx(Cx,{size:20}):g.jsx(Ix,{size:20})}),g.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:_,onChange:Mt,className:"w-20 h-1 bg-white/30 rounded-lg appearance-none cursor-pointer accent-fluent-accent opacity-0 group-hover:opacity-100 transition-opacity"})]})]}),g.jsxs("div",{className:"flex items-center gap-4",children:[t!=="live"&&g.jsxs("div",{className:"text-xs font-mono text-white/80 select-none",children:[g.jsx("span",{children:Te(O)}),g.jsx("span",{className:"mx-1 text-white/40",children:"/"}),g.jsx("span",{children:Te(N)})]}),t==="live"&&g.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded text-red-500 text-[10px] font-bold uppercase tracking-widest animate-pulse select-none",children:[g.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"})," Live"]}),g.jsx("div",{className:"h-4 w-[1px] bg-white/10 mx-1"}),t==="live"&&g.jsx("button",{onClick:()=>te(!de),className:`transition-colors ${de?"text-fluent-accent":"text-white/70 hover:text-white"}`,title:"Liste des chanes",children:g.jsx(_x,{size:20})}),g.jsx("button",{className:"text-white/70 hover:text-white",title:"Paramtres",children:g.jsx(Go,{size:20})}),h&&g.jsx("button",{onClick:h,className:"text-white/70 hover:text-white",title:d?"Agrandir":"Rduire",children:d?g.jsx(H0,{size:20}):g.jsx(V0,{size:20})}),g.jsx("button",{onClick:At,className:"text-white/70 hover:text-white",title:"Plein cran (Navigateur)",children:C?g.jsx(YE,{size:20}):g.jsx(zE,{size:20})})]})]})]})]})},rw=`
let cachedData = [];

self.onmessage = async (e) => {
  const { type, payload, id } = e.data;

  try {
    switch (type) {
      case 'FETCH_AND_GROUP':
        // Payload: { url: string, limit: number }
        const response = await fetch(payload.url);
        if (!response.ok) throw new Error("HTTP " + response.status);
        
        const data = await response.json();
        cachedData = Array.isArray(data) ? data : [];

        // Grouping for "Home" view (limit items per category)
        const grouped = {};
        const limit = payload.limit || 15;

        cachedData.forEach((item) => {
            const catId = item.category_id;
            if (!catId) return;
            if (!grouped[catId]) grouped[catId] = [];
            if (grouped[catId].length < limit) {
                grouped[catId].push(item);
            }
        });

        self.postMessage({ type: 'SUCCESS', id, data: { full: cachedData, grouped } });
        break;

      case 'FILTER':
        const q = payload.query.toLowerCase();
        const filtered = cachedData.filter((item) => {
            const name = item.name || item.title || "";
            return name.toLowerCase().includes(q);
        });
        self.postMessage({ type: 'FILTER_RESULT', id, data: filtered });
        break;

      default:
        break;
    }
  } catch (err) {
    self.postMessage({ type: 'ERROR', id, error: err.message });
  }
};
`,px=({item:o,detail:e,phase:t,isFading:i,ytContainerId:r,onNext:a,onPlay:c,onInfo:d,isMuted:h,onToggleMute:f})=>{var S,A,E,_;const m=((A=(S=e==null?void 0:e.info)==null?void 0:S.backdrop_path)==null?void 0:A[0])||o.stream_icon||o.cover,x=o.stream_icon||o.cover,v=((E=e==null?void 0:e.info)==null?void 0:E.genre)||o.genre,b=v?v.split(/,|;/).map(R=>R.trim()).filter(Boolean).slice(0,3):[];return g.jsxs("div",{className:`relative w-full h-[420px] mb-8 rounded-window overflow-hidden group shadow-window transition-opacity duration-500 ring-1 ring-white/10 ${i?"opacity-0":"opacity-100"}`,children:[g.jsxs("div",{className:"absolute inset-0 bg-black",children:[t==="trailer"&&((_=e==null?void 0:e.info)!=null&&_.youtube_trailer)?g.jsxs("div",{className:"absolute inset-0 w-full h-full scale-125",children:[g.jsx("div",{id:r,className:"w-full h-full pointer-events-none"}),g.jsx("div",{className:"absolute inset-0 bg-black/40"})]}):g.jsx("div",{className:"absolute inset-0 animate-in fade-in duration-700",children:m?g.jsx("img",{src:m,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-[10s]",alt:"Backdrop"}):g.jsx("div",{className:"w-full h-full bg-fluent-layer flex items-center justify-center text-white/5",children:g.jsx(Tx,{size:64})})}),g.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#202020] via-black/30 to-black/40"}),g.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/80 via-black/20 to-transparent"})]}),g.jsx("div",{className:"absolute inset-0 flex items-center px-10",children:g.jsxs("div",{className:"flex gap-8 items-end max-w-4xl",children:[g.jsx("div",{className:"hidden md:block w-48 shrink-0 aspect-[2/3] rounded-lg overflow-hidden shadow-window border border-white/10 animate-in slide-in-from-bottom-4 duration-500",children:x?g.jsx("img",{src:x,className:"w-full h-full object-cover",alt:"Poster"}):g.jsx("div",{className:"w-full h-full bg-white/5 flex items-center justify-center",children:g.jsx(Cn,{size:32,className:"opacity-10"})})}),g.jsxs("div",{className:"flex-1 pb-2",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[g.jsx("span",{className:"bg-fluent-accent/90 text-black px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider",children:"Projecteur"}),o.rating&&g.jsxs("span",{className:"flex items-center gap-1 text-yellow-400 text-xs font-bold bg-black/40 px-2 py-0.5 rounded border border-yellow-400/20",children:[g.jsx(Bs,{size:12,fill:"currentColor"}),o.rating]}),t==="trailer"&&g.jsx("span",{className:"text-[10px] text-white/80 uppercase font-bold tracking-tight bg-red-500/80 px-2 py-0.5 rounded ml-2 animate-pulse",children:"Bande-annonce en cours"})]}),b.length>0&&g.jsx("div",{className:"flex flex-wrap gap-2 mb-2 animate-in slide-in-from-left-2 duration-500 delay-100",children:b.map((R,D)=>g.jsx("span",{className:"text-[10px] font-medium px-2 py-0.5 rounded bg-white/10 border border-white/5 text-white/90 uppercase tracking-wide backdrop-blur-md flex items-center gap-1",children:R},D))}),g.jsx("h1",{className:"text-3xl font-bold text-white mb-2 line-clamp-2 drop-shadow-md",children:o.name}),g.jsx("p",{className:"text-sm text-white/80 line-clamp-2 mb-6 max-w-xl leading-relaxed font-medium",children:o.plot||"Un titre exceptionnel  dcouvrir immdiatement dans votre catalogue streaming."}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsxs(Me,{variant:"primary",onClick:()=>c(o),className:"!px-6 h-10 font-semibold shadow-lg",children:[g.jsx(ii,{fill:"currentColor",size:16})," Regarder"]}),g.jsxs(Me,{variant:"secondary",onClick:()=>d(o),className:"!px-6 h-10 backdrop-blur-xl bg-white/10 border-white/10 text-sm font-medium",children:[g.jsx($o,{size:16})," Dtails"]})]})]})]})}),g.jsxs("div",{className:"absolute bottom-6 right-6 z-30 flex items-center gap-3",children:[t==="trailer"&&f&&g.jsx("button",{onClick:R=>{R.stopPropagation(),f()},className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-xl border border-white/20 hover:bg-white/10 transition-all text-white active:scale-90 shadow-lg",title:h?"Activer le son":"Couper le son",children:h?g.jsx(Cx,{size:20}):g.jsx(Ix,{size:20})}),g.jsx("button",{onClick:a,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-xl border border-white/20 hover:bg-white/10 transition-all text-white active:scale-90 shadow-lg",title:"Suivant",children:g.jsx(ZS,{size:20})})]}),t==="backdrop"&&g.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[3px] bg-white/10 z-40 overflow-hidden",children:g.jsx("div",{className:"h-full bg-fluent-accent w-full origin-left shadow-[0_0_12px_#60CDFF]",style:{animation:"heroProgress 8s linear forwards"}},`${o.stream_id||o.series_id}-${o.name}-${t}`)})]})},aw=({categories:o,selectedCategoryId:e,onSelectCategory:t})=>g.jsx("div",{className:"w-[240px] shrink-0 border-r border-white/5 pr-4 flex flex-col gap-1 overflow-y-auto custom-scrollbar h-full bg-fluent-micaAlt/30 backdrop-blur-xl",children:g.jsxs("div",{className:"px-4 py-6",children:[g.jsx("h3",{className:"text-[10px] font-bold text-fluent-accent uppercase tracking-widest mb-4 opacity-70",children:"Navigation"}),g.jsxs("button",{onClick:()=>t(null),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-[13px] transition-all group relative mb-2 ${e===null?"bg-fluent-accent/10 text-fluent-accent font-semibold":"hover:bg-white/5 text-fluent-subtext"}`,children:[e===null&&g.jsx("div",{className:"absolute left-0 w-1 h-4 bg-fluent-accent rounded-r-full"}),g.jsx(Ax,{size:18})," Tout le catalogue"]}),g.jsx("div",{className:"h-[1px] bg-white/5 my-6 mx-2"}),g.jsx("h3",{className:"text-[10px] font-bold text-fluent-subtext uppercase tracking-widest mb-3 opacity-50",children:"Catgories"}),g.jsx("div",{className:"space-y-1",children:o.map(i=>{const r=e===i.category_id;return g.jsxs("button",{onClick:()=>t(i),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-[13px] transition-all group relative ${r?"bg-fluent-accent/10 text-fluent-accent font-semibold":"hover:bg-white/5 text-fluent-subtext"}`,children:[r&&g.jsx("div",{className:"absolute left-0 w-1 h-4 bg-fluent-accent rounded-r-full"}),g.jsx(Ex,{size:18,className:r?"text-fluent-accent":"opacity-40 group-hover:opacity-100"}),g.jsx("span",{className:"truncate",children:i.category_name})]},i.category_id)})})]})}),xx=({items:o,type:e,onItemClick:t})=>{const[i,r]=Y.useState(60);Y.useEffect(()=>{r(60)},[o]);const a=o.slice(0,i),c=o.length>i;return g.jsxs("div",{className:"space-y-8 pb-20",children:[g.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:a.map(d=>g.jsxs("div",{onClick:()=>t(d),className:"group bg-fluent-layer hover:bg-fluent-layerHover border border-fluent-border rounded-window overflow-hidden cursor-pointer transition-all active:scale-[0.98] relative shadow-sm hover:shadow-md",children:[g.jsxs("div",{className:`${e==="live"?"aspect-video":"aspect-[2/3]"} w-full bg-black/20 relative flex items-center justify-center overflow-hidden`,children:[d.stream_icon||d.cover?g.jsx("img",{src:d.stream_icon||d.cover,className:"max-w-full max-h-full object-contain group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):g.jsx(Tx,{size:32,className:"opacity-10"}),g.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 bg-black/30 transition-all duration-300",children:g.jsx(ii,{size:32,fill:"currentColor"})})]}),g.jsxs("div",{className:"p-3",children:[g.jsx("h4",{className:"text-[11px] font-semibold truncate mb-1 group-hover:text-fluent-accent transition-colors",title:d.name,children:d.name}),d.rating&&g.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-yellow-400 font-medium",children:[g.jsx(Bs,{size:10,fill:"currentColor"})," ",d.rating]})]})]},d.stream_id||d.series_id||d.num))}),c&&g.jsx("div",{className:"flex justify-center pt-4",children:g.jsxs(Me,{variant:"secondary",onClick:()=>r(d=>d+60),className:"!px-8 h-10 border-white/10 hover:bg-white/5",children:[g.jsx(aE,{size:16})," Afficher plus (",o.length-i," restants)"]})})]})},lw=({categoryId:o,name:e,items:t,onItemClick:i,onExplore:r})=>{const a=Y.useRef(null),c=d=>{a.current&&a.current.scrollBy({left:d==="left"?-500:500,behavior:"smooth"})};return g.jsxs("div",{className:"mb-8 last:mb-0",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[g.jsxs("h3",{className:"text-base font-semibold flex items-center gap-2",children:[g.jsx(wx,{size:16,className:"text-fluent-accent"})," ",e]}),g.jsxs("button",{onClick:()=>r(o),className:"flex items-center gap-1 text-[11px] text-fluent-accent hover:text-white transition-all font-bold uppercase tracking-widest bg-fluent-accent/5 px-3 py-1 rounded-full border border-fluent-accent/10 hover:bg-fluent-accent/10 whitespace-nowrap",children:["Explorer ",g.jsx(jd,{size:14})]})]}),g.jsxs("div",{className:"relative group/row",children:[g.jsx("button",{onClick:()=>c("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-20 bg-black/60 hover:bg-fluent-accent/80 text-white p-2 rounded-full opacity-0 group-hover/row:opacity-100 transition-all backdrop-blur-sm -ml-2 shadow-lg border border-white/10",children:g.jsx(Ca,{size:20})}),g.jsx("div",{ref:a,className:"flex overflow-x-auto gap-4 px-2 pb-4 no-scrollbar custom-scrollbar scroll-smooth",children:t.map(d=>g.jsxs("div",{onClick:()=>i(d),className:"shrink-0 w-[140px] group cursor-pointer transition-all active:scale-95",children:[g.jsxs("div",{className:"aspect-[2/3] rounded-lg overflow-hidden border border-white/5 bg-black/20 relative shadow-md group-hover:ring-2 group-hover:ring-fluent-accent/30 transition-all duration-300",children:[d.stream_icon||d.cover?g.jsx("img",{src:d.stream_icon||d.cover,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",loading:"lazy"}):g.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/5",children:g.jsx(Cn,{size:32})}),g.jsx("div",{className:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:g.jsx(ii,{fill:"currentColor",size:24,className:"text-white"})})]}),g.jsx("h4",{className:"text-[11px] font-medium mt-2 truncate group-hover:text-fluent-accent transition-colors leading-tight",children:d.name})]},d.stream_id||d.series_id))}),g.jsx("button",{onClick:()=>c("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-20 bg-black/60 hover:bg-fluent-accent/80 text-white p-2 rounded-full opacity-0 group-hover/row:opacity-100 transition-all backdrop-blur-sm -mr-2 shadow-lg border border-white/10",children:g.jsx(jd,{size:20})})]})]})},yx=({item:o,detail:e,loading:t,type:i,onBack:r,onClose:a,onPlay:c,onPlayEpisode:d,account:h,siblingItems:f=[],onSwitchItem:m})=>{var Z,re,V,ge,Re,Ae,Ce,it,Mt,bt,ft,At;const[x,v]=Y.useState(!1),b=Y.useRef(null),S=Y.useRef(null),[A,E]=Y.useState("1");Y.useEffect(()=>{if(S.current&&S.current.scrollTo({top:0,behavior:"smooth"}),b.current&&b.current.scrollTo({left:0,behavior:"smooth"}),i==="series"&&(e!=null&&e.episodes)){const le=Object.keys(e.episodes).sort((Te,Ye)=>parseInt(Te)-parseInt(Ye));le.length>0&&E(le[0])}},[o.stream_id,o.series_id,e]);const _=((re=(Z=e==null?void 0:e.info)==null?void 0:Z.backdrop_path)==null?void 0:re[0])||(o==null?void 0:o.stream_icon)||(o==null?void 0:o.cover),R=(o==null?void 0:o.stream_icon)||(o==null?void 0:o.cover),D=o==null?void 0:o.name,k=((V=e==null?void 0:e.info)==null?void 0:V.plot)||((ge=e==null?void 0:e.info)==null?void 0:ge.description)||"Aucun synopsis disponible pour ce titre.",O=((Re=e==null?void 0:e.info)==null?void 0:Re.rating)||(o==null?void 0:o.rating),F=(Ae=e==null?void 0:e.info)==null?void 0:Ae.director,N=((Ce=e==null?void 0:e.info)==null?void 0:Ce.genre)||(o==null?void 0:o.genre),B=N?N.split(/,|;/).map(le=>le.trim()).filter(Boolean):[],C=((it=e==null?void 0:e.info)==null?void 0:it.releasedate)||((Mt=e==null?void 0:e.info)==null?void 0:Mt.releaseDate)||(o==null?void 0:o.releaseDate),P=(bt=e==null?void 0:e.info)==null?void 0:bt.duration,W=(ft=e==null?void 0:e.info)==null?void 0:ft.cast,ue=(e==null?void 0:e.episodes)||{},me=Object.keys(ue).sort((le,Te)=>parseInt(le)-parseInt(Te)),ee=ue[A]||[],ce=(At=e==null?void 0:e.info)==null?void 0:At.youtube_trailer,X=ce?(le=>{if(!le)return null;let Te=le;try{(le.includes("youtube.com")||le.includes("youtu.be"))&&(le.includes("v=")?Te=le.split("v=")[1].split("&")[0]:le.includes("youtu.be/")&&(Te=le.split("youtu.be/")[1].split("?")[0]))}catch{return null}return`https://www.youtube.com/embed/${Te}?autoplay=1&modestbranding=1&rel=0&showinfo=0`})(ce):null,de=(()=>{var Te;if(i!=="vod")return null;const le=((Te=e==null?void 0:e.movie_data)==null?void 0:Te.container_extension)||o.container_extension||"mp4";return`${h.protocol}://${h.host}:${h.port}/movie/${h.username}/${h.password}/${o.stream_id}.${le}`})(),te=le=>{const Te=le.container_extension||"mp4";return`${h.protocol}://${h.host}:${h.port}/series/${h.username}/${h.password}/${le.id}.${Te}`},I=()=>{de&&window.open(de,"_blank")},M=Y.useMemo(()=>{if(!f||f.length===0)return[];const le=o.stream_id||o.series_id,Te=o.name.toLowerCase().split(/[\s\-_:.]+/).filter(ke=>ke.length>3);F==null||F.toLowerCase();const Ye=f.filter(ke=>(ke.stream_id||ke.series_id)!==le).map(ke=>{let Fe=0;const pe=ke.name.toLowerCase();if(Te.forEach(be=>{pe.includes(be)&&(Fe+=2)}),ke.genre&&B.length>0){const be=ke.genre.toLowerCase();B.forEach(Xe=>{be.includes(Xe.toLowerCase())&&(Fe+=3)})}return{stream:ke,score:Fe}});return Ye.sort((ke,Fe)=>Fe.score-ke.score),Ye.slice(0,18).map(ke=>ke.stream)},[f,o,F,B]),G=le=>{b.current&&b.current.scrollBy({left:le==="left"?-600:600,behavior:"smooth"})};return g.jsxs("div",{ref:S,className:"h-full overflow-y-auto custom-scrollbar relative",children:[g.jsxs("div",{className:"absolute inset-0 h-[60vh] opacity-40 pointer-events-none",children:[_&&g.jsx("img",{src:_,className:"w-full h-full object-cover mask-image-b",alt:""}),g.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#191919] via-[#191919]/80 to-transparent"}),g.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#191919] via-[#191919]/40 to-transparent"})]}),g.jsxs("div",{className:"relative z-10 p-8 md:p-12 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[g.jsxs("button",{onClick:r,title:"Revenir  l'lment prcdent",className:"flex items-center gap-2 text-white/70 hover:text-white transition-colors text-sm font-semibold uppercase tracking-wider bg-black/20 hover:bg-black/40 px-4 py-2 rounded-full backdrop-blur-md border border-white/5",children:[g.jsx(Sx,{size:16})," Retour"]}),a&&g.jsxs("button",{onClick:a,title:"Fermer et revenir au catalogue",className:"flex items-center gap-2 text-white/70 hover:text-fluent-accent transition-colors text-sm font-semibold uppercase tracking-wider bg-black/20 hover:bg-black/40 px-4 py-2 rounded-full backdrop-blur-md border border-white/5",children:[g.jsx(Lx,{size:16})," Catalogue"]})]}),g.jsxs("div",{className:"flex flex-col lg:flex-row gap-12 items-start max-w-7xl mx-auto mb-12",children:[g.jsxs("div",{className:"w-full lg:w-[350px] shrink-0 flex flex-col gap-6",children:[g.jsx("div",{className:"aspect-[2/3] rounded-xl overflow-hidden shadow-2xl border border-white/10 relative group bg-white/5",children:R?g.jsx("img",{src:R,className:"w-full h-full object-cover",alt:D}):g.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/10",children:g.jsx(Cn,{size:64})})}),g.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[O&&g.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3 flex flex-col items-center justify-center gap-1",children:[g.jsx(Bs,{size:18,className:"text-yellow-400 fill-current"}),g.jsx("span",{className:"text-lg font-bold",children:O}),g.jsx("span",{className:"text-[10px] text-white/50 uppercase tracking-widest",children:"Note"})]}),P&&g.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3 flex flex-col items-center justify-center gap-1",children:[g.jsx(z0,{size:18,className:"text-fluent-accent"}),g.jsx("span",{className:"text-sm font-bold text-center",children:P}),g.jsx("span",{className:"text-[10px] text-white/50 uppercase tracking-widest",children:"Dure"})]})]})]}),g.jsxs("div",{className:"flex-1 min-w-0 pt-2",children:[g.jsxs("div",{className:"mb-6",children:[g.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[g.jsx("span",{className:"bg-fluent-accent text-black px-3 py-1 rounded text-xs font-bold uppercase tracking-widest",children:i}),C&&g.jsxs("span",{className:"flex items-center gap-1.5 text-white/60 text-sm font-medium bg-white/5 px-3 py-1 rounded border border-white/5",children:[g.jsx(Pd,{size:14})," ",C]}),B.map((le,Te)=>g.jsx("span",{className:"flex items-center gap-1.5 text-white/80 text-sm font-medium bg-white/10 px-3 py-1 rounded border border-white/5 hover:bg-white/20 transition-colors cursor-default",children:le},Te))]}),g.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6 leading-tight drop-shadow-xl",children:D}),g.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-8",children:[g.jsxs(Me,{variant:"primary",onClick:()=>c(o),className:"!px-8 h-12 text-base font-bold active:scale-95 transition-all",children:[g.jsx(ii,{fill:"currentColor",size:20})," ",i==="series"?"Reprendre":"Regarder"]}),X&&g.jsxs(Me,{variant:"secondary",onClick:()=>v(!0),className:"!px-6 h-12 text-sm border-white/10 bg-white/5 hover:bg-white/10 backdrop-blur-md",children:[g.jsx(H1,{size:20,className:"text-red-500"})," Bande-annonce"]}),de&&g.jsxs(Me,{variant:"secondary",onClick:I,className:"!px-6 h-12 text-sm border-white/10 bg-white/5 hover:bg-white/10 backdrop-blur-md",children:[g.jsx(Ud,{size:20,className:"text-green-400"})," Tlcharger"]})]})]}),g.jsxs("div",{className:"mb-10 bg-white/5 p-6 rounded-xl border border-white/5 backdrop-blur-sm",children:[g.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-white mb-3",children:[g.jsx(A1,{size:20,className:"text-fluent-accent"})," Synopsis"]}),g.jsx("p",{className:"text-white/80 leading-relaxed text-base font-light",children:k})]}),g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-10",children:F&&g.jsxs("div",{className:"flex gap-4 items-start p-4 rounded-lg hover:bg-white/5 transition-colors",children:[g.jsx("div",{className:"p-3 bg-purple-500/20 rounded-lg text-purple-400",children:g.jsx(q0,{size:20})}),g.jsxs("div",{children:[g.jsx("span",{className:"text-xs text-white/50 font-bold uppercase tracking-wider block mb-1",children:"Ralisateur"}),g.jsx("span",{className:"text-white font-medium",children:F})]})]})}),W&&g.jsxs("div",{children:[g.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-white mb-4",children:[g.jsx(q0,{size:20,className:"text-fluent-accent"})," Distribution"]}),g.jsx("div",{className:"flex flex-wrap gap-3",children:W.split(",").map((le,Te)=>g.jsx("span",{className:"bg-white/5 border border-white/10 px-3 py-1.5 rounded-md text-sm text-white/80 hover:bg-white/10 hover:text-white transition-colors cursor-default",children:le.trim()},Te))})]})]})]}),i==="series"&&me.length>0&&g.jsxs("div",{className:"w-full max-w-7xl mx-auto border-t border-white/5 pt-10 mb-10",children:[g.jsx("div",{className:"flex items-center justify-between mb-6",children:g.jsxs("h3",{className:"flex items-center gap-2 text-xl font-semibold text-white",children:[g.jsx(Ax,{size:22,className:"text-fluent-accent"})," Saisons & pisodes"]})}),g.jsx("div",{className:"flex overflow-x-auto gap-2 pb-6 px-1 no-scrollbar",children:me.map(le=>g.jsxs("button",{onClick:()=>E(le),className:`px-5 py-2 rounded-full text-sm font-bold uppercase tracking-wider transition-all whitespace-nowrap
                                        ${A===le?"bg-fluent-accent text-black scale-105":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white border border-white/5"}`,children:["Saison ",le]},le))}),g.jsx("div",{className:"space-y-3",children:ee.map(le=>{var Te,Ye,ke,Fe,pe;return g.jsxs("div",{className:"group flex flex-col md:flex-row gap-4 p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-all cursor-pointer hover:shadow-lg hover:border-white/10 relative",onClick:()=>d&&d({...le,season:A}),children:[g.jsxs("div",{className:"w-full md:w-48 shrink-0 aspect-video rounded-lg overflow-hidden relative bg-black/40",children:[(Te=le.info)!=null&&Te.movie_image?g.jsx("img",{src:le.info.movie_image,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",alt:"",loading:"lazy"}):_?g.jsx("img",{src:_,className:"w-full h-full object-cover opacity-50 group-hover:scale-105 transition-transform duration-500",alt:"",loading:"lazy"}):g.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/10",children:g.jsx(za,{size:32})}),g.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity",children:g.jsx(ii,{fill:"currentColor",size:24,className:"text-white drop-shadow-md"})})]}),g.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[g.jsxs("span",{className:"text-fluent-accent font-bold text-lg",children:[le.episode_num,"."]}),g.jsx("h4",{className:"text-white font-semibold text-lg truncate group-hover:text-fluent-accent transition-colors",children:le.title})]}),g.jsxs("div",{className:"flex items-center gap-3 text-xs text-white/50 mb-2 font-mono",children:[((Ye=le.info)==null?void 0:Ye.duration)&&g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx(z0,{size:12})," ",le.info.duration]}),((ke=le.info)==null?void 0:ke.rating)&&g.jsxs("span",{className:"flex items-center gap-1 text-yellow-500/80",children:[g.jsx(Bs,{size:12,fill:"currentColor"})," ",le.info.rating]}),((Fe=le.info)==null?void 0:Fe.releasedate)&&g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx(Pd,{size:12})," ",le.info.releasedate]})]}),g.jsx("p",{className:"text-sm text-white/70 line-clamp-2 leading-relaxed",children:((pe=le.info)==null?void 0:pe.plot)||"Pas de description disponible."})]}),g.jsxs("div",{className:"hidden md:flex items-center gap-3 px-4 border-l border-white/5",children:[g.jsx("div",{className:"w-10 h-10 rounded-full bg-fluent-accent text-black flex items-center justify-center opacity-0 group-hover:opacity-100 scale-75 group-hover:scale-100 transition-all shadow-lg",title:"Lire",children:g.jsx(ii,{fill:"currentColor",size:18})}),g.jsx("button",{onClick:be=>{be.stopPropagation(),window.open(te(le),"_blank")},className:"w-10 h-10 rounded-full bg-white/10 text-white hover:bg-white/20 flex items-center justify-center opacity-0 group-hover:opacity-100 scale-75 group-hover:scale-100 transition-all shadow-lg border border-white/5",title:"Tlcharger",children:g.jsx(Ud,{size:18})})]})]},le.id)})})]}),M.length>0&&g.jsxs("div",{className:"max-w-7xl mx-auto border-t border-white/5 pt-10 mb-10",children:[g.jsxs("h3",{className:"flex items-center gap-2 text-xl font-semibold text-white mb-6",children:[g.jsx(wx,{size:22,className:"text-fluent-accent"})," Titres similaires"]}),g.jsxs("div",{className:"relative group/scroll",children:[g.jsx("button",{onClick:()=>G("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-20 bg-black/60 hover:bg-fluent-accent/80 text-white p-3 rounded-full opacity-0 group-hover/scroll:opacity-100 transition-all backdrop-blur-sm -ml-4",children:g.jsx(Ca,{size:24})}),g.jsx("div",{ref:b,className:"flex gap-5 overflow-x-auto no-scrollbar scroll-smooth pb-4",children:M.map(le=>g.jsxs("div",{onClick:()=>m&&m(le),className:"w-[160px] shrink-0 group cursor-pointer",children:[g.jsxs("div",{className:"aspect-[2/3] rounded-lg overflow-hidden border border-white/5 bg-black/20 relative shadow-md group-hover:ring-2 group-hover:ring-fluent-accent/50 transition-all duration-300",children:[le.stream_icon||le.cover?g.jsx("img",{src:le.stream_icon||le.cover,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:le.name,loading:"lazy"}):g.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/5",children:g.jsx(Cn,{size:32})}),g.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:g.jsx(ii,{fill:"currentColor",size:32,className:"text-white drop-shadow-lg"})})]}),g.jsx("h4",{className:"text-xs font-medium mt-3 truncate group-hover:text-fluent-accent transition-colors",children:le.name}),le.rating&&g.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-yellow-500/80 mt-1",children:[g.jsx(Bs,{size:8,fill:"currentColor"})," ",le.rating]})]},le.stream_id||le.series_id))}),g.jsx("button",{onClick:()=>G("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-20 bg-black/60 hover:bg-fluent-accent/80 text-white p-3 rounded-full opacity-0 group-hover/scroll:opacity-100 transition-all backdrop-blur-sm -mr-4",children:g.jsx(jd,{size:24})})]})]})]}),x&&X&&g.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md animate-in fade-in duration-300",onClick:()=>v(!1),children:g.jsxs("div",{className:"relative w-full max-w-6xl aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10 mx-4 animate-in zoom-in-95 duration-300",onClick:le=>le.stopPropagation(),children:[g.jsx("button",{onClick:()=>v(!1),className:"absolute top-4 right-4 z-10 p-2 bg-black/50 hover:bg-red-500 text-white rounded-full transition-all backdrop-blur-md border border-white/10 group",children:g.jsx(Rs,{size:24,className:"group-hover:scale-110 transition-transform"})}),g.jsx("iframe",{src:X,title:"Trailer",className:"w-full h-full border-0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})]})})]})},Md=({type:o,mode:e="grid"})=>g.jsxs("div",{className:"w-full relative animate-in fade-in duration-500",children:[g.jsx("style",{children:`
        @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        .shimmer-wrapper {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent 0%,
            rgba(255, 255, 255, 0.05) 40%,
            rgba(255, 255, 255, 0.1) 50%,
            rgba(255, 255, 255, 0.05) 60%,
            transparent 100%
          );
          animation: shimmer 1.5s infinite linear;
          pointer-events: none;
          z-index: 20;
        }
        .skeleton-bg {
            background-color: rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden;
        }
      `}),e==="detail"?g.jsxs("div",{className:"p-8 md:p-12 max-w-7xl mx-auto",children:[g.jsx("div",{className:"h-10 w-32 skeleton-bg rounded-full mb-8",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsxs("div",{className:"flex flex-col lg:flex-row gap-12 items-start",children:[g.jsxs("div",{className:"w-full lg:w-[350px] shrink-0",children:[g.jsx("div",{className:"aspect-[2/3] rounded-xl skeleton-bg border border-white/5 shadow-2xl",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6",children:[g.jsx("div",{className:"h-16 rounded-lg skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsx("div",{className:"h-16 rounded-lg skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})})]})]}),g.jsxs("div",{className:"flex-1 w-full space-y-6 pt-2",children:[g.jsxs("div",{className:"flex gap-3 mb-4",children:[g.jsx("div",{className:"h-6 w-20 rounded skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsx("div",{className:"h-6 w-32 rounded skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsx("div",{className:"h-6 w-24 rounded skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})})]}),g.jsx("div",{className:"h-16 w-3/4 rounded skeleton-bg mb-6",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsxs("div",{className:"flex gap-4 mb-8",children:[g.jsx("div",{className:"h-12 w-40 rounded skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsx("div",{className:"h-12 w-40 rounded skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})})]}),g.jsx("div",{className:"h-48 w-full rounded-xl skeleton-bg mb-10",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[g.jsx("div",{className:"h-20 rounded-lg skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})}),g.jsx("div",{className:"h-20 rounded-lg skeleton-bg",children:g.jsx("div",{className:"shimmer-wrapper"})})]})]})]})]}):g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{className:"relative w-full h-[420px] mb-8 rounded-window bg-white/5 border border-white/5 overflow-hidden",children:[g.jsx("div",{className:"shimmer-wrapper"}),g.jsx("div",{className:"absolute inset-0 flex items-center px-10",children:g.jsxs("div",{className:"flex gap-8 items-end max-w-4xl w-full",children:[g.jsx("div",{className:"hidden md:block w-48 shrink-0 aspect-[2/3] rounded-lg bg-white/10 border border-white/5"}),g.jsxs("div",{className:"flex-1 pb-2 space-y-4",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("div",{className:"h-5 w-24 bg-white/10 rounded"}),g.jsx("div",{className:"h-5 w-12 bg-white/10 rounded"})]}),g.jsx("div",{className:"h-10 w-3/4 bg-white/10 rounded-md"}),g.jsxs("div",{className:"space-y-2 max-w-xl",children:[g.jsx("div",{className:"h-4 w-full bg-white/5 rounded"}),g.jsx("div",{className:"h-4 w-5/6 bg-white/5 rounded"})]}),g.jsxs("div",{className:"flex gap-3 pt-2",children:[g.jsx("div",{className:"h-10 w-32 bg-white/10 rounded-control"}),g.jsx("div",{className:"h-10 w-32 bg-white/5 rounded-control"})]})]})]})})]}),g.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 relative",children:Array.from({length:18}).map((t,i)=>g.jsxs("div",{className:"bg-white/5 border border-fluent-border rounded-window overflow-hidden relative h-full",children:[g.jsx("div",{className:"shimmer-wrapper",style:{animationDelay:`${i*.05}s`}}),g.jsx("div",{className:`${o==="live"?"aspect-video":"aspect-[2/3]"} w-full bg-white/5 relative`}),g.jsxs("div",{className:"p-3 space-y-2",children:[g.jsx("div",{className:"h-3 bg-white/10 rounded w-3/4"}),g.jsx("div",{className:"h-2 bg-white/5 rounded w-1/4"})]})]},i))})]})]}),ow=({items:o,selectedItem:e,onSelect:t,onClose:i,title:r})=>{const a=Y.useRef(null);return Y.useEffect(()=>{a.current&&a.current.scrollIntoView({block:"center",behavior:"smooth"})},[e]),g.jsxs("div",{className:"w-[300px] shrink-0 border-r border-white/5 flex flex-col bg-[#1a1a1a]/95 backdrop-blur-xl h-full animate-in slide-in-from-left-4 duration-300",children:[g.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between shrink-0",children:[g.jsx("h3",{className:"font-semibold text-sm truncate pr-2",title:r,children:r}),g.jsx(Me,{variant:"ghost",onClick:i,className:"!p-1.5 h-8 w-8 rounded-full hover:bg-white/10",children:g.jsx(Ca,{size:18})})]}),g.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1",children:o.length===0?g.jsx("div",{className:"p-4 text-center text-fluent-subtext text-xs",children:"Aucun contenu disponible"}):o.map(c=>{const d=e&&(c.stream_id&&c.stream_id===e.stream_id||c.series_id&&c.series_id===e.series_id);return g.jsxs("div",{ref:d?a:null,onClick:()=>t(c),className:`group flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-all border border-transparent
                   ${d?"bg-fluent-accent/20 border-fluent-accent/20":"hover:bg-white/5 hover:border-white/5"}`,children:[g.jsxs("div",{className:"w-10 h-10 shrink-0 rounded bg-black/40 overflow-hidden relative flex items-center justify-center",children:[c.stream_icon||c.cover?g.jsx("img",{src:c.stream_icon||c.cover,className:"w-full h-full object-contain",loading:"lazy",alt:""}):g.jsx(ii,{size:16,className:"text-white/20"}),d&&g.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:g.jsx("div",{className:"w-2 h-2 bg-fluent-accent rounded-full animate-pulse shadow-[0_0_8px_#60CDFF]"})})]}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("p",{className:`text-[12px] font-medium truncate ${d?"text-white":"text-white/80 group-hover:text-white"}`,children:c.name}),c.rating&&g.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[g.jsx(Bs,{size:8,className:"text-yellow-400 fill-current"}),g.jsx("span",{className:"text-[10px] text-white/50",children:c.rating})]})]})]},c.stream_id||c.series_id||c.num)})}),g.jsxs("div",{className:"p-2 border-t border-white/5 text-[10px] text-center text-fluent-subtext bg-black/20 shrink-0",children:[o.length," lments"]})]})},Od=({account:o,type:e,fetchCached:t})=>{const[i,r]=Y.useState(()=>localStorage.getItem("category_ui_mode")||"normal"),[a,c]=Y.useState("categories"),[d,h]=Y.useState(null),[f,m]=Y.useState(null),[x,v]=Y.useState([]),[b,S]=Y.useState([]),[A,E]=Y.useState([]),[_,R]=Y.useState([]),[D,k]=Y.useState({}),[O,F]=Y.useState(-1),[N,B]=Y.useState(null),[C,P]=Y.useState("backdrop"),[W,ue]=Y.useState(!1),[me,ee]=Y.useState(!0),[ce,j]=Y.useState(null),[X,se]=Y.useState(!1),[de,te]=Y.useState(!0),I=Y.useRef(null),M=Y.useRef(null),G=Y.useRef(null),Z=Y.useRef(null),re=Y.useMemo(()=>`yt-player-${Math.random().toString(36).substr(2,9)}`,[]),V=Y.useRef(null),ge=Y.useRef(null),Re=Y.useRef(!0),[Ae,Ce]=Y.useState(!0),[it,Mt]=Y.useState(null),[bt,ft]=Y.useState(""),[At,le]=Y.useState(null),Te=Y.useMemo(()=>({live:{catAction:"get_live_categories",listAction:"get_live_streams",icon:za,label:"Live TV"},vod:{catAction:"get_vod_categories",listAction:"get_vod_streams",icon:Cn,label:"Films"},series:{catAction:"get_series_categories",listAction:"get_series",icon:of,label:"Sries"}})[e],[e]);Y.useEffect(()=>{try{V.current=Mx(rw),V.current.onmessage=he=>{const{type:Se,data:we,error:Bt}=he.data;Se==="SUCCESS"?(E(we.full),R(we.full),k(we.grouped),F(we.full.length>0?Math.floor(Math.random()*Math.min(we.full.length,100)):-1),Ce(!1)):Se==="ERROR"?(console.error("Worker Error:",Bt),Ce(!1)):Se==="FILTER_RESULT"&&R(we)}}catch(he){console.error("Worker Init Failed",he)}return()=>{var he;return(he=V.current)==null?void 0:he.terminate()}},[]),Y.useEffect(()=>{ge.current=N},[N]),Y.useEffect(()=>{Re.current=me},[me]);const Ye=Y.useCallback(()=>{j(null),se(!1),te(!0)},[]);Y.useEffect(()=>{var he;if(!document.getElementById("youtube-api-script")){const Se=document.createElement("script");Se.id="youtube-api-script",Se.src="https://www.youtube.com/iframe_api";const we=document.getElementsByTagName("script")[0];(he=we.parentNode)==null||he.insertBefore(Se,we)}},[]),Y.useEffect(()=>{i==="normal"&&G.current&&(G.current.scrollTop=0)},[a,d,i]),Y.useEffect(()=>{const he=new IntersectionObserver(([we])=>{!M.current||typeof M.current.mute!="function"||(we.isIntersecting?Re.current||M.current.unMute():M.current.mute())},{threshold:.15}),Se=Z.current;return Se&&he.observe(Se),()=>{Se&&he.unobserve(Se),he.disconnect()}},[C,O,i]);const ke=Y.useCallback((he,Se={})=>{const we=`${o.protocol}://${o.host}:${o.port}/player_api.php`,Bt=new URLSearchParams({username:o.username,password:o.password,action:he,...Se});return Fs(`${we}?${Bt.toString()}`)},[o]),Fe=Y.useCallback(()=>{if(!(_.length<=1)){if(ue(!0),I.current&&window.clearTimeout(I.current),M.current){try{M.current.destroy()}catch{}M.current=null}setTimeout(()=>{B(null),P("backdrop"),F(he=>{const Se=Math.min(_.length,100);let we=Math.floor(Math.random()*Se);return we===he?(we+1)%_.length:we}),setTimeout(()=>ue(!1),50)},500)}},[_]),pe=Y.useCallback(()=>{M.current&&typeof M.current.isMuted=="function"&&(M.current.isMuted()?(M.current.unMute(),ee(!1)):(M.current.mute(),ee(!0)))},[]);Y.useEffect(()=>(C==="backdrop"&&O!==-1&&(I.current&&window.clearTimeout(I.current),I.current=window.setTimeout(()=>{var he,Se;(Se=(he=ge.current)==null?void 0:he.info)!=null&&Se.youtube_trailer?P("trailer"):Fe()},8e3)),()=>{I.current&&window.clearTimeout(I.current)}),[C,O,Fe]),Y.useEffect(()=>{var Se;let he=null;if(C==="trailer"){const we=(Se=N==null?void 0:N.info)==null?void 0:Se.youtube_trailer;if(!we){Fe();return}const Dt=(Ot=>{if(!Ot)return null;const Mn=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,Ii=Ot.match(Mn);return Ii&&Ii[2].length===11?Ii[2]:Ot})(we);if(!Dt){Fe();return}const kn=()=>{if(M.current)try{M.current.destroy()}catch{}try{M.current=new window.YT.Player(re,{videoId:Dt,playerVars:{autoplay:1,controls:0,mute:1,modestbranding:1,rel:0,start:10,origin:window.location.origin},events:{onReady:Ot=>{Ot.target.playVideo(),Re.current||Ot.target.unMute()},onStateChange:Ot=>{Ot.data===window.YT.PlayerState.ENDED&&Fe()},onError:Ot=>Fe()}})}catch{Fe()}};if(window.YT&&window.YT.Player)kn();else{let Ot=0;he=window.setInterval(()=>{Ot++,window.YT&&window.YT.Player?(he&&clearInterval(he),kn()):Ot>30&&(he&&clearInterval(he),Fe())},100)}}return()=>{he&&clearInterval(he)}},[C,N,re,Fe]);const be=Y.useCallback(async()=>{Ce(!0);try{const he=await t(ke(Te.catAction));if(Array.isArray(he)&&S(he),i==="flow"){const Se=ke(Te.listAction);if(V.current)V.current.postMessage({type:"FETCH_AND_GROUP",payload:{url:Se,limit:20},id:Date.now()});else{const we=await t(Se);Array.isArray(we)&&(E(we),R(we),F(we.length>0?Math.floor(Math.random()*Math.min(we.length,100)):-1)),Ce(!1)}}else Ce(!1)}catch{Mt("Erreur de chargement."),Ce(!1)}},[ke,Te,t,i]);Y.useEffect(()=>{be()},[be]);const Xe=Y.useMemo(()=>!bt||a!=="categories"?b:b.filter(he=>he.category_name.toLowerCase().includes(bt.toLowerCase())),[b,bt,a]),Ge=async he=>{if(ft(""),h(he),c("items"),v([]),m(null),R([]),F(-1),he===null)if(i==="flow"){Ce(!0);const Se=ke(Te.listAction);V.current&&V.current.postMessage({type:"FETCH_AND_GROUP",payload:{url:Se,limit:20},id:Date.now()})}else E([]);else{Ce(!0);try{const Se=await t(ke(Te.listAction,{category_id:he.category_id}));Array.isArray(Se)&&(E(Se),R(Se),F(Se.length>0?Math.floor(Math.random()*Math.min(Se.length,50)):-1))}catch{Mt("Erreur de filtrage.")}finally{Ce(!1)}}},Zt=Y.useCallback(he=>{const Se=he.stream_id||he.series_id;if(!Se)return;Ce(!0),t(ke(e==="vod"?"get_vod_info":"get_series_info",{[e==="vod"?"vod_id":"series_id"]:Se.toString()})).then(Dt=>{le(Array.isArray(Dt)?Dt[0]:Dt),Ce(!1)}).catch(()=>Ce(!1))},[e,ke,t]),nt=Y.useCallback(he=>{const Se=`${o.protocol}://${o.host}:${o.port}`;if(e==="live")j({url:Fs(`${Se}/live/${o.username}/${o.password}/${he.stream_id}.m3u8`),title:he.name,type:"live",currentItem:he});else if(e==="vod"){const we=he.container_extension||"mp4";j({url:Fs(`${Se}/movie/${o.username}/${o.password}/${he.stream_id}.${we}`),title:he.name,type:"vod",currentItem:he})}else if(e==="series"){if(a==="detail"&&At&&At.episodes){const we=Object.keys(At.episodes).sort((Bt,Dt)=>parseInt(Bt)-parseInt(Dt));if(we.length>0){const Bt=At.episodes[we[0]];if(Bt&&Bt.length>0){const Dt=Bt[0],kn=Dt.container_extension||"mp4";j({url:Fs(`${Se}/series/${o.username}/${o.password}/${Dt.id}.${kn}`),title:`${he.name} - S${we[0]}E${Dt.episode_num}`,type:"series",currentItem:he});return}}}gt(he)}},[o,e,a,At]),Jt=Y.useCallback(he=>{const Se=`${o.protocol}://${o.host}:${o.port}`,we=he.container_extension||"mp4";j({url:Fs(`${Se}/series/${o.username}/${o.password}/${he.id}.${we}`),title:`${(f==null?void 0:f.name)||"Srie"} - S${he.season}E${he.episode_num} - ${he.title}`,type:"series",currentItem:f||void 0})},[o,f]),gt=Y.useCallback(he=>{v(a==="detail"&&f?Se=>[...Se,f]:[]),m(he),c("detail"),Zt(he)},[a,f,Zt]),xt=Y.useCallback(()=>{if(x.length>0){const he=[...x],Se=he.pop();v(he),Se&&(m(Se),Zt(Se))}else c("items"),m(null),v([])},[x,Zt]),Ft=Y.useCallback(()=>{a==="detail"?(c("items"),m(null),v([])):a==="items"&&(c("categories"),h(null),ft(""))},[a]),Lt=he=>{e==="live"?nt(he):gt(he)},es=he=>{ft(he);const Se=he.toLowerCase().trim();V.current&&i==="flow"?V.current.postMessage({type:"FILTER",payload:{query:Se},id:Date.now()}):R(Se?A.filter(we=>(we.name||"").toLowerCase().includes(Se)):A)},ns=Y.useMemo(()=>O!==-1&&O<_.length?_[O]:null,[O,_]);return Y.useEffect(()=>{let he=!0;if(ns&&a==="items"&&e!=="live"){const Se=ns.stream_id||ns.series_id;t(ke(e==="vod"?"get_vod_info":"get_series_info",{[e==="vod"?"vod_id":"series_id"]:Se.toString()})).then(Dt=>{he&&B(Array.isArray(Dt)?Dt[0]:Dt)})}return()=>{he=!1}},[ns,a,e,ke,t]),g.jsxs("div",{className:"h-full flex flex-col bg-transparent relative",children:[g.jsx("style",{children:`
          @keyframes heroProgress { from { transform: scaleX(0); } to { transform: scaleX(1); } } 
          .no-scrollbar::-webkit-scrollbar { display: none; }
        `}),ce&&i==="normal"&&g.jsx(gx,{url:ce.url,title:ce.title,type:ce.type,onClose:Ye,playlist:e==="live"?_:void 0,currentItem:ce.currentItem,onChannelSelect:nt,account:o}),g.jsxs("div",{className:"flex-none flex items-center justify-between bg-[#1e1e1e]/90 backdrop-blur-xl py-4 px-8 border-b border-white/5 shadow-sm z-30",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[a!=="categories"&&i==="normal"&&g.jsx(Me,{variant:"ghost",onClick:Ft,className:"!px-2 hover:bg-white/5",children:g.jsx(Sx,{size:20})}),g.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-3",children:[g.jsx(Te.icon,{size:24,className:"text-fluent-accent"}),g.jsx("span",{children:i==="flow"?Te.label:(d==null?void 0:d.category_name)||Te.label})]})]}),g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsxs("div",{className:"relative group w-72",children:[g.jsx("input",{className:"w-full bg-black/40 border border-white/10 rounded-control pl-9 pr-4 py-2 text-[13px] text-white focus:border-fluent-accent focus:bg-black/60 transition-all placeholder:text-fluent-subtext/40 font-normal",placeholder:`Chercher dans ${Te.label}...`,value:bt,onChange:he=>es(he.target.value)}),g.jsx(Bd,{size:15,className:"absolute left-3 top-2.5 text-fluent-subtext/50"})]}),g.jsxs(Me,{variant:"secondary",onClick:()=>{const he=i==="normal"?"flow":"normal";r(he),localStorage.setItem("category_ui_mode",he)},className:"!px-4 h-9 flex items-center gap-2 border-white/10 bg-white/5 hover:bg-white/10 transition-all",children:[i==="normal"?g.jsx(mE,{size:18}):g.jsx(_x,{size:18}),g.jsx("span",{className:"text-[11px] font-bold uppercase tracking-wider",children:i==="normal"?"Flow":"Classique"})]})]})]}),g.jsx("div",{className:"flex-1 overflow-hidden relative",children:i==="flow"?g.jsxs("div",{className:"flex h-full overflow-hidden",children:[g.jsx(aw,{categories:b,selectedCategoryId:(d==null?void 0:d.category_id)||null,onSelectCategory:Ge}),g.jsx("div",{className:"flex-1 flex overflow-hidden relative h-full",children:ce?g.jsxs(g.Fragment,{children:[de&&g.jsx(ow,{items:_,selectedItem:ce.currentItem||null,onSelect:nt,onClose:()=>te(!1),title:(d==null?void 0:d.category_name)||"Chanes"}),g.jsxs("div",{className:"flex-1 flex flex-col relative h-full bg-black",children:[!de&&g.jsx("button",{onClick:()=>te(!0),className:"absolute left-0 top-1/2 -translate-y-1/2 z-[60] p-3 bg-black/60 rounded-r-xl text-white hover:bg-fluent-accent hover:text-black transition-all border-y border-r border-white/10 backdrop-blur-md shadow-lg transform hover:scale-110 active:scale-95",title:"Afficher la liste",children:g.jsx(uf,{size:20})}),g.jsx(gx,{url:ce.url,title:ce.title,type:ce.type,onClose:Ye,playlist:e==="live"?_:void 0,currentItem:ce.currentItem,onChannelSelect:nt,isEmbedded:!X,onToggleEmbed:()=>se(!X),account:o})]})]}):g.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative h-full",children:Ae?g.jsx("div",{className:a==="detail"?"":"px-10 pt-8",children:g.jsx(Md,{type:e,mode:a==="detail"?"detail":"grid"})}):a==="detail"&&f?g.jsx(yx,{item:f,detail:At,loading:Ae,type:e,onBack:xt,onClose:Ft,onPlay:nt,onPlayEpisode:Jt,account:o,siblingItems:_,onSwitchItem:gt}):g.jsxs("div",{className:"px-10",children:[ns&&g.jsx("div",{ref:Z,children:g.jsx(px,{item:ns,detail:N,phase:C,isFading:W,ytContainerId:re,onNext:Fe,onPlay:nt,onInfo:gt,isMuted:me,onToggleMute:pe})}),d===null&&!bt?Object.entries(D).map(([he,Se])=>{var we;return g.jsx(lw,{categoryId:he,name:((we=b.find(Bt=>Bt.category_id===he))==null?void 0:we.category_name)||"Catgorie",items:Se,onItemClick:Lt,onExplore:Bt=>Ge(b.find(Dt=>Dt.category_id===Bt)||null)},he)}):g.jsx(xx,{items:_,type:e,onItemClick:Lt}),g.jsx("div",{className:"h-24"})]},(d==null?void 0:d.category_id)||"all")})})]}):g.jsx("div",{ref:G,className:"h-full overflow-y-auto custom-scrollbar px-10 relative",children:a==="categories"?g.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 py-8 animate-in fade-in duration-300",children:Xe.map(he=>g.jsxs("div",{onClick:()=>Ge(he),className:"bg-fluent-layer hover:bg-fluent-layerHover border border-fluent-border p-5 rounded-window cursor-pointer transition-all flex items-center gap-4 group shadow-sm",children:[g.jsx(Ex,{className:"text-fluent-accent group-hover:scale-110 transition-transform"})," ",g.jsx("span",{className:"font-semibold text-sm",children:he.category_name})]},he.category_id))}):a==="detail"&&f?Ae?g.jsx(Md,{type:e,mode:"detail"}):g.jsx(yx,{item:f,detail:At,loading:Ae,type:e,onBack:xt,onClose:Ft,onPlay:nt,onPlayEpisode:Jt,account:o,siblingItems:_,onSwitchItem:gt}):g.jsx("div",{className:"pt-8 pb-20 relative min-h-[500px]",children:Ae?g.jsx(Md,{type:e,mode:"grid"}):g.jsxs("div",{className:"animate-in fade-in duration-300",children:[ns&&g.jsx("div",{ref:Z,children:g.jsx(px,{item:ns,detail:N,phase:C,isFading:W,ytContainerId:re,onNext:Fe,onPlay:nt,onInfo:gt,isMuted:me,onToggleMute:pe})}),g.jsx(xx,{items:_,type:e,onItemClick:Lt})]})})})})]})},cw=({account:o,onBack:e})=>{var j,X,se,de,te,I,M;const[t,i]=Y.useState("info"),[r,a]=Y.useState(new Set(["info"])),[c,d]=Y.useState(!1),[h,f]=Y.useState(!0),[m,x]=Y.useState(null),[v,b]=Y.useState(null),[S,A]=Y.useState(!1),[E,_]=Y.useState({step:"",percent:0}),[R,D]=Y.useState(null),[k,O]=Y.useState(!1),[F,N]=Y.useState({ping:0,jitter:0,downloadSpeed:0,downloadedSize:0,progress:0,status:"idle"}),B=Y.useRef(new Map),C=Y.useCallback(G=>{if(B.current.has(G))return B.current.get(G);const Z=fetch(G).then(async re=>{if(!re.ok)throw new Error(`HTTP Error: ${re.status}`);return await re.json()}).catch(re=>{throw B.current.delete(G),re});return B.current.set(G,Z),Z},[]);Y.useEffect(()=>{a(G=>G.has(t)?G:new Set(G).add(t))},[t]),Y.useEffect(()=>{B.current.clear(),W()},[o]);const P=G=>{const Z=`${o.protocol}://${o.host}:${o.port}/player_api.php?username=${o.username}&password=${o.password}&action=${G}`;return Fs(Z)},W=async()=>{f(!0),x(null);const G=`${o.protocol}://${o.host}:${o.port}/player_api.php?username=${o.username}&password=${o.password}`,Z=Fs(G);try{let re=await C(Z);Array.isArray(re)&&re.length>0&&(re=re[0]);const V=re;if(!V||!V.user_info&&!V.server_info)throw new Error("Invalid response format from server.");V.user_info&&V.user_info.auth===0?x("Authentication failed: Access denied by server."):b(V)}catch(re){console.error("Fetch error:",re),x(re.message||"Failed to connect to server.")}finally{f(!1)}},ue=async()=>{A(!0),D(null),_({step:"Initializing...",percent:0});const G={userInfo:null,serverInfo:null,live:{categories:0,streams:0},vod:{categories:0,streams:0},series:{categories:0,streams:0},timestamp:Date.now()};try{_({step:"Authenticating...",percent:10,details:"Verifying credentials and fetching server metadata"});const Z=Fs(`${o.protocol}://${o.host}:${o.port}/player_api.php?username=${o.username}&password=${o.password}`),re=await C(Z);G.userInfo=re.user_info,G.serverInfo=re.server_info,_({step:"Analyzing Live TV...",percent:25,details:"Fetching channel categories"});const V=await C(P("get_live_categories"));G.live.categories=Array.isArray(V)?V.length:0,_({step:"Analyzing Live TV...",percent:40,details:"Counting active channels"});const ge=await C(P("get_live_streams"));G.live.streams=Array.isArray(ge)?ge.length:0,_({step:"Scanning Movies...",percent:55,details:"Fetching movie categories"});const Re=await C(P("get_vod_categories"));G.vod.categories=Array.isArray(Re)?Re.length:0,_({step:"Scanning Movies...",percent:70,details:"Indexing movie library"});const Ae=await C(P("get_vod_streams"));G.vod.streams=Array.isArray(Ae)?Ae.length:0,_({step:"Checking Series...",percent:85,details:"Fetching series categories"});const Ce=await C(P("get_series_categories"));G.series.categories=Array.isArray(Ce)?Ce.length:0,_({step:"Checking Series...",percent:95,details:"Indexing series titles"});const it=await C(P("get_series"));G.series.streams=Array.isArray(it)?it.length:0,_({step:"Complete",percent:100,details:"Analysis finished successfully."}),D(G)}catch(Z){_({step:"Error Occurred",percent:100,details:Z.message||"Failed to complete revision."})}},me=async()=>{var re;O(!0),N({ping:0,jitter:0,downloadSpeed:0,downloadedSize:0,progress:0,status:"pinging"});const G=Fs(`${o.protocol}://${o.host}:${o.port}/player_api.php?username=${o.username}&password=${o.password}`),Z=Fs(`${o.protocol}://${o.host}:${o.port}/player_api.php?username=${o.username}&password=${o.password}&action=get_live_streams&_t=${Date.now()}`);try{const V=[];for(let le=0;le<5;le++){const Te=performance.now();await fetch(G,{method:"HEAD"});const Ye=performance.now();V.push(Ye-Te),N(ke=>({...ke,progress:(le+1)/5*20}))}const Re=V.reduce((le,Te)=>le+Te,0)/V.length,Ae=V.reduce((le,Te)=>le+Math.abs(Te-Re),0)/V.length;N(le=>({...le,ping:Math.round(Re),jitter:Math.round(Ae),status:"downloading",progress:20}));const Ce=performance.now(),it=await fetch(Z),Mt=(re=it.body)==null?void 0:re.getReader();if(!Mt)throw new Error("Browser does not support stream reading.");let bt=0;const ft=it.headers.get("Content-Length"),At=ft?parseInt(ft,10):10*1024*1024;for(;;){const{done:le,value:Te}=await Mt.read();if(le)break;bt+=Te.length;const ke=(performance.now()-Ce)/1e3,pe=bt*8/ke/1e6;N(be=>({...be,downloadedSize:parseFloat((bt/(1024*1024)).toFixed(2)),downloadSpeed:parseFloat(pe.toFixed(2)),progress:20+Math.min(bt/At*80,80)}))}N(le=>({...le,status:"complete",progress:100}))}catch(V){N(ge=>({...ge,status:"error",error:V.message||"Connection failed during test."}))}},ee=()=>{var it;if(h)return g.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[g.jsx(Fd,{className:"animate-spin mb-4 text-fluent-accent",size:32}),g.jsxs("p",{className:"text-fluent-subtext",children:["Connecting to ",o.host,"..."]})]});if(m)return g.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8",children:[g.jsx(Na,{size:48,className:"text-fluent-danger mb-4"}),g.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Connection Failed"}),g.jsx("p",{className:"text-fluent-subtext mb-6 max-w-md",children:m}),g.jsx(Me,{onClick:()=>window.location.reload(),children:"Retry"})]});if(!v)return null;const{user_info:G,server_info:Z}=v,re=G==null?void 0:G.exp_date,V=re?q1(re):0,ge=V<=0,Re=parseInt((G==null?void 0:G.active_cons)||"0"),Ae=parseInt((G==null?void 0:G.max_connections)||"1"),Ce=Math.min(Re/Ae*100,100);return g.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 p-8 pb-32",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[g.jsx(As,{className:"bg-gradient-to-br from-green-900/20 to-green-600/10 border-green-500/20",children:g.jsxs("div",{className:"flex justify-between items-start",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-xs text-green-300/70 uppercase tracking-wider font-semibold",children:"Status"}),g.jsx("p",{className:"text-2xl font-bold text-green-100 mt-1",children:(G==null?void 0:G.status)||"Unknown"})]}),g.jsx(Ro,{size:20,className:"text-green-400"})]})}),g.jsx(As,{className:`${ge?"bg-red-900/20 border-red-500/20":"bg-fluent-layer"}`,children:g.jsxs("div",{className:"flex justify-between items-start",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-xs text-fluent-subtext uppercase tracking-wider font-semibold",children:"Expiration"}),g.jsx("p",{className:"text-2xl font-bold mt-1",children:ge?"Expired":`${V} Days`}),g.jsx("p",{className:"text-[10px] text-fluent-subtext mt-1",children:Q0(re||"")})]}),g.jsx(Pd,{size:20,className:ge?"text-red-400":"text-fluent-accent"})]})}),g.jsxs(As,{children:[g.jsxs("div",{className:"flex justify-between items-start mb-2",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-xs text-fluent-subtext uppercase tracking-wider font-semibold",children:"Connections"}),g.jsxs("p",{className:"text-2xl font-bold mt-1",children:[Re," / ",Ae]})]}),g.jsx(X0,{size:20,className:"text-blue-400"})]}),g.jsx("div",{className:"w-full bg-white/10 h-1.5 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-blue-400 transition-all duration-500",style:{width:`${Ce}%`}})})]}),g.jsx(As,{children:g.jsxs("div",{className:"flex justify-between items-start",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-xs text-fluent-subtext uppercase tracking-wider font-semibold",children:"Protocol"}),g.jsx("p",{className:"text-2xl font-bold mt-1 uppercase",children:(Z==null?void 0:Z.server_protocol)||"HTTP"}),g.jsxs("p",{className:"text-[10px] text-fluent-subtext mt-1",children:["Port: ",(Z==null?void 0:Z.port)||"80"]})]}),g.jsx(_r,{size:20,className:"text-purple-400"})]})})]}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[g.jsx("div",{className:"lg:col-span-2 space-y-6",children:g.jsxs("div",{className:"bg-fluent-layer border border-fluent-border rounded-window p-6 shadow-sm",children:[g.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[g.jsx($o,{size:18,className:"text-fluent-accent"})," Account Details"]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-8",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx("span",{className:"text-xs text-fluent-subtext block",children:"Username"}),g.jsx("span",{className:"font-mono text-sm bg-black/20 px-2 py-1 rounded border border-white/5 block",children:G==null?void 0:G.username})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsx("span",{className:"text-xs text-fluent-subtext block",children:"Created At"}),g.jsx("span",{className:"text-sm",children:Q0((G==null?void 0:G.created_at)||"")})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsx("span",{className:"text-xs text-fluent-subtext block",children:"Max Connections"}),g.jsxs("span",{className:"text-sm",children:[G==null?void 0:G.max_connections," Device(s)"]})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsx("span",{className:"text-xs text-fluent-subtext block",children:"Allowed Formats"}),g.jsx("div",{className:"flex gap-2",children:(it=G==null?void 0:G.allowed_output_formats)==null?void 0:it.map(Mt=>g.jsx("span",{className:"text-[10px] bg-white/10 px-1.5 py-0.5 rounded uppercase",children:Mt},Mt))})]}),g.jsxs("div",{className:"space-y-1 md:col-span-2",children:[g.jsx("span",{className:"text-xs text-fluent-subtext block",children:"Message from Server"}),g.jsx("p",{className:"text-sm italic text-white/80 border-l-2 border-fluent-accent pl-3 py-1 bg-white/5 rounded-r",children:(G==null?void 0:G.message)||"No message provided."})]})]})]})}),g.jsx("div",{className:"space-y-6",children:g.jsxs("div",{className:"bg-fluent-layer border border-fluent-border rounded-window p-6 shadow-sm",children:[g.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[g.jsx(_r,{size:18,className:"text-purple-400"})," Server Info"]}),g.jsxs("ul",{className:"space-y-3 text-sm",children:[g.jsxs("li",{className:"flex justify-between border-b border-white/5 pb-2",children:[g.jsx("span",{className:"text-fluent-subtext",children:"URL"}),g.jsx("span",{className:"font-mono",children:Z==null?void 0:Z.url})]}),g.jsxs("li",{className:"flex justify-between border-b border-white/5 pb-2",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Port"}),g.jsx("span",{children:Z==null?void 0:Z.port})]}),g.jsxs("li",{className:"flex justify-between border-b border-white/5 pb-2",children:[g.jsx("span",{className:"text-fluent-subtext",children:"RTMP Port"}),g.jsx("span",{children:Z==null?void 0:Z.rtmp_port})]}),g.jsxs("li",{className:"flex justify-between border-b border-white/5 pb-2",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Timezone"}),g.jsx("span",{children:Z==null?void 0:Z.timezone})]}),g.jsxs("li",{className:"flex justify-between pt-1",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Server Time"}),g.jsx("span",{className:"text-right",children:Z==null?void 0:Z.time_now})]})]})]})})]})]})},ce=()=>g.jsxs("div",{className:"p-8 animate-in fade-in slide-in-from-bottom-4",children:[g.jsxs("div",{className:"mb-6",children:[g.jsx("h2",{className:"text-2xl font-light mb-2",children:"Account Tools"}),g.jsx("p",{className:"text-fluent-subtext",children:"Utilities to analyze and manage your Xtream connection."})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[g.jsxs(As,{className:"hover:bg-fluent-layerHover transition-colors border-l-4 border-l-fluent-accent",children:[g.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[g.jsx("div",{className:"p-3 bg-fluent-accent/10 rounded-lg text-fluent-accent",children:g.jsx(Ro,{size:24})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-medium",children:"Complete Revision"}),g.jsx("p",{className:"text-sm text-fluent-subtext mt-1",children:"Scan the entire account to count streams, categories, and verify server integrity."})]})]}),g.jsxs(Me,{onClick:ue,className:"w-full mt-2",children:[g.jsx(ii,{size:16})," Run Analysis"]})]}),g.jsxs(As,{className:"hover:bg-fluent-layerHover transition-colors border-l-4 border-l-green-400",children:[g.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[g.jsx("div",{className:"p-3 bg-green-500/10 rounded-lg text-green-400",children:g.jsx(qS,{size:24})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-medium",children:"Bandwidth Test"}),g.jsx("p",{className:"text-sm text-fluent-subtext mt-1",children:"Check download speeds and latency from this specific server."})]})]}),g.jsxs(Me,{onClick:me,variant:"secondary",className:"w-full mt-2 hover:bg-green-500/10 hover:text-green-300 hover:border-green-500/30",children:[g.jsx(Nx,{size:16})," Start Speed Test"]})]})]})]});return g.jsxs("div",{className:"flex h-full w-full overflow-hidden",children:[g.jsx(Q1,{activeTab:t,setTab:i,onBack:e,accountName:o.name,isCollapsed:c,onToggle:()=>d(!c)}),g.jsxs("div",{className:"flex-1 bg-black/20 overflow-hidden relative transition-all duration-300",children:[r.has("info")&&g.jsx("div",{className:"w-full h-full",style:{display:t==="info"?"block":"none"},children:g.jsx("div",{className:"h-full overflow-y-auto custom-scrollbar",children:ee()})}),r.has("tools")&&g.jsx("div",{className:"w-full h-full",style:{display:t==="tools"?"block":"none"},children:g.jsx("div",{className:"h-full overflow-y-auto custom-scrollbar",children:ce()})}),r.has("live")&&g.jsx("div",{className:"w-full h-full",style:{display:t==="live"?"block":"none"},children:g.jsx(Od,{account:o,type:"live",fetchCached:C})}),r.has("vod")&&g.jsx("div",{className:"w-full h-full",style:{display:t==="vod"?"block":"none"},children:g.jsx(Od,{account:o,type:"vod",fetchCached:C})}),r.has("series")&&g.jsx("div",{className:"w-full h-full",style:{display:t==="series"?"block":"none"},children:g.jsx(Od,{account:o,type:"series",fetchCached:C})}),S&&g.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in",children:g.jsxs("div",{className:"bg-[#1c1c1c] border border-fluent-border rounded-xl shadow-2xl w-full max-w-2xl p-0 relative animate-in zoom-in-95 overflow-hidden",children:[g.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-white/5 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx(d1,{className:"text-fluent-accent",size:20}),g.jsx("h3",{className:"text-lg font-semibold",children:"Xtream Account Revision"})]}),g.jsx("button",{onClick:()=>A(!1),className:"text-fluent-subtext hover:text-white transition-colors",children:g.jsx(Rs,{size:20})})]}),g.jsx("div",{className:"p-8",children:R?g.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3 text-fluent-subtext text-xs uppercase tracking-widest font-bold",children:[g.jsx(X0,{size:14})," User Verification"]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex justify-between text-sm",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Auth Status"}),g.jsxs("span",{className:"text-green-400 font-medium",children:["Verified (Code ",(j=R.userInfo)==null?void 0:j.auth,")"]})]}),g.jsxs("div",{className:"flex justify-between text-sm",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Account Status"}),g.jsx("span",{className:"text-white",children:(X=R.userInfo)==null?void 0:X.status})]}),g.jsxs("div",{className:"flex justify-between text-sm",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Active Cons"}),g.jsxs("span",{className:"text-white",children:[(se=R.userInfo)==null?void 0:se.active_cons," / ",(de=R.userInfo)==null?void 0:de.max_connections]})]})]})]}),g.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3 text-fluent-subtext text-xs uppercase tracking-widest font-bold",children:[g.jsx(_r,{size:14})," Server Metadata"]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex justify-between text-sm",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Protocol"}),g.jsx("span",{className:"text-white uppercase",children:(te=R.serverInfo)==null?void 0:te.server_protocol})]}),g.jsxs("div",{className:"flex justify-between text-sm",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Server Time"}),g.jsx("span",{className:"text-white",children:(I=R.serverInfo)==null?void 0:I.time_now})]}),g.jsxs("div",{className:"flex justify-between text-sm",children:[g.jsx("span",{className:"text-fluent-subtext",children:"Timezone"}),g.jsx("span",{className:"text-white",children:(M=R.serverInfo)==null?void 0:M.timezone})]})]})]})]}),g.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/5 flex flex-col h-full",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-4 text-fluent-subtext text-xs uppercase tracking-widest font-bold",children:[g.jsx(Ga,{size:14})," Content Distribution"]}),g.jsxs("div",{className:"flex-1 flex flex-col gap-3 justify-center",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded-lg bg-fluent-accent/10 flex items-center justify-center text-fluent-accent",children:g.jsx(za,{size:20})}),g.jsxs("div",{className:"flex-1",children:[g.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[g.jsx("span",{children:"Live TV"}),g.jsx("span",{children:R.live.streams.toLocaleString()})]}),g.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-fluent-accent",style:{width:`${Math.min(100,R.live.streams/2e4*100)}%`}})})]})]}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-400",children:g.jsx(Cn,{size:20})}),g.jsxs("div",{className:"flex-1",children:[g.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[g.jsx("span",{children:"Movies"}),g.jsx("span",{children:R.vod.streams.toLocaleString()})]}),g.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-blue-400",style:{width:`${Math.min(100,R.vod.streams/2e4*100)}%`}})})]})]}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center text-purple-400",children:g.jsx(of,{size:20})}),g.jsxs("div",{className:"flex-1",children:[g.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[g.jsx("span",{children:"Series"}),g.jsx("span",{children:R.series.streams.toLocaleString()})]}),g.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-purple-400",style:{width:`${Math.min(100,R.series.streams/2e4*100)}%`}})})]})]})]}),g.jsxs("div",{className:"mt-6 pt-4 border-t border-white/5 text-center",children:[g.jsx("p",{className:"text-[10px] text-fluent-subtext uppercase tracking-widest mb-1",children:"Total Assets Indexed"}),g.jsx("p",{className:"text-3xl font-bold text-white",children:(R.live.streams+R.vod.streams+R.series.streams).toLocaleString()})]})]})]}),g.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[g.jsxs("div",{className:"bg-white/5 p-3 rounded-lg border border-white/5 text-center",children:[g.jsx("p",{className:"text-[10px] text-fluent-subtext mb-1 uppercase tracking-tighter",children:"Live Cats"}),g.jsx("p",{className:"text-xl font-semibold",children:R.live.categories})]}),g.jsxs("div",{className:"bg-white/5 p-3 rounded-lg border border-white/5 text-center",children:[g.jsx("p",{className:"text-[10px] text-fluent-subtext mb-1 uppercase tracking-tighter",children:"Movie Cats"}),g.jsx("p",{className:"text-xl font-semibold",children:R.vod.categories})]}),g.jsxs("div",{className:"bg-white/5 p-3 rounded-lg border border-white/5 text-center",children:[g.jsx("p",{className:"text-[10px] text-fluent-subtext mb-1 uppercase tracking-tighter",children:"Series Cats"}),g.jsx("p",{className:"text-xl font-semibold",children:R.series.categories})]})]}),g.jsxs("div",{className:"flex justify-between items-center bg-fluent-accent/5 border border-fluent-accent/20 p-4 rounded-xl",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx($a,{className:"text-fluent-accent",size:24}),g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-medium text-white",children:"Verification Complete"}),g.jsxs("p",{className:"text-xs text-fluent-subtext",children:["Scan date: ",new Date(R.timestamp).toLocaleString()]})]})]}),g.jsx(Me,{onClick:()=>A(!1),children:"Close Summary"})]})]}):g.jsxs("div",{className:"text-center py-10",children:[g.jsxs("div",{className:"mb-8 relative w-20 h-20 mx-auto",children:[g.jsx("div",{className:"absolute inset-0 border-4 border-fluent-accent/20 rounded-full"}),g.jsx("div",{className:"absolute inset-0 border-4 border-fluent-accent border-t-transparent rounded-full animate-spin"}),g.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:g.jsxs("span",{className:"text-xs font-bold text-fluent-accent",children:[E.percent,"%"]})})]}),g.jsx("h3",{className:"text-xl font-medium mb-2 text-white",children:"Scanning Account..."}),g.jsx("p",{className:"text-fluent-accent font-medium mb-4",children:E.step}),g.jsx("div",{className:"max-w-xs mx-auto text-xs text-fluent-subtext bg-white/5 p-3 rounded-lg border border-white/5 italic",children:E.details}),g.jsx("div",{className:"mt-8 w-full bg-white/10 h-1.5 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-fluent-accent transition-all duration-500 ease-out shadow-[0_0_10px_rgba(96,205,255,0.4)]",style:{width:`${E.percent}%`}})})]})})]})}),k&&g.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in",children:g.jsxs("div",{className:"bg-[#1c1c1c] border border-fluent-border rounded-xl shadow-2xl w-full max-w-lg p-0 relative animate-in zoom-in-95 overflow-hidden",children:[g.jsxs("div",{className:"flex justify-between items-center px-6 py-4 bg-white/5 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx(LE,{size:20,className:"text-green-400"}),g.jsx("h3",{className:"text-lg font-semibold",children:"Bandwidth Diagnostic"})]}),g.jsx("button",{onClick:()=>O(!1),className:"text-fluent-subtext hover:text-white transition-colors",children:g.jsx(Rs,{size:20})})]}),g.jsx("div",{className:"p-8",children:F.status==="error"?g.jsxs("div",{className:"text-center py-6 text-red-300 bg-red-500/10 rounded-lg border border-red-500/20",children:[g.jsx(Na,{size:32,className:"mx-auto mb-2"}),g.jsx("p",{className:"font-medium",children:"Test Failed"}),g.jsx("p",{className:"text-sm opacity-80 mt-1",children:F.error}),g.jsx(Me,{variant:"secondary",onClick:me,className:"mt-4 mx-auto",children:"Retry"})]}):g.jsxs("div",{className:"space-y-10",children:[g.jsxs("div",{className:"text-center py-4",children:[g.jsxs("div",{className:"relative inline-block",children:[g.jsx("div",{className:"text-7xl font-light tabular-nums tracking-tighter text-white",children:F.downloadSpeed.toFixed(1)}),g.jsx("span",{className:"absolute -right-10 bottom-2 text-sm text-fluent-subtext uppercase font-bold tracking-widest",children:"Mbps"})]}),F.status!=="complete"?g.jsx("div",{className:"mt-8 max-w-xs mx-auto h-1.5 bg-white/10 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-green-400 shadow-[0_0_10px_rgba(74,222,128,0.5)] transition-all duration-200",style:{width:`${F.progress}%`}})}):g.jsx("div",{className:"mt-8 flex justify-center gap-2",children:g.jsx("div",{className:"px-3 py-1 bg-green-500/10 text-green-400 text-xs font-bold rounded-full border border-green-500/20",children:"READY FOR 4K UHD"})})]}),g.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[g.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center border border-white/5",children:[g.jsx("div",{className:"text-[10px] text-fluent-subtext uppercase tracking-widest font-bold mb-2",children:"Latency"}),g.jsxs("div",{className:"text-2xl font-semibold tabular-nums",children:[F.ping," ",g.jsx("span",{className:"text-xs font-normal opacity-40",children:"ms"})]})]}),g.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center border border-white/5",children:[g.jsx("div",{className:"text-[10px] text-fluent-subtext uppercase tracking-widest font-bold mb-2",children:"Jitter"}),g.jsxs("div",{className:"text-2xl font-semibold tabular-nums",children:[F.jitter," ",g.jsx("span",{className:"text-xs font-normal opacity-40",children:"ms"})]})]}),g.jsxs("div",{className:"bg-white/5 rounded-xl p-4 text-center border border-white/5",children:[g.jsx("div",{className:"text-[10px] text-fluent-subtext uppercase tracking-widest font-bold mb-2",children:"Payload"}),g.jsxs("div",{className:"text-2xl font-semibold tabular-nums",children:[F.downloadedSize.toFixed(1)," ",g.jsx("span",{className:"text-xs font-normal opacity-40",children:"MB"})]})]})]}),g.jsxs("div",{className:"flex justify-center pt-2 gap-3",children:[F.status==="complete"&&g.jsxs(Me,{onClick:me,variant:"secondary",children:[g.jsx(Fd,{size:14})," Retest"]}),g.jsx(Me,{variant:F.status==="complete"?"primary":"secondary",onClick:()=>O(!1),children:F.status==="complete"?"Done":"Cancel"})]}),F.status!=="complete"&&g.jsx("div",{className:"text-center text-[10px] uppercase tracking-widest text-fluent-subtext animate-pulse",children:F.status==="pinging"?"Analyzing latency samples...":"Measuring downlink throughput..."})]})})]})})]})]})},uw=({servers:o,onSave:e,onDelete:t,onAddAccount:i,onViewAccounts:r})=>{const[a,c]=Y.useState(!1),[d,h]=Y.useState(null),[f,m]=Y.useState(""),[x,v]=Y.useState(""),[b,S]=Y.useState("80"),[A,E]=Y.useState("http"),[_,R]=Y.useState(""),[D,k]=Y.useState([]),[O,F]=Y.useState(""),[N,B]=Y.useState(null),C=()=>{m(""),v(""),S("80"),E("http"),R(""),k([]),h(null),B(null),c(!1)},P=ee=>{m(ee.alias),v(ee.host),S(ee.port),E(ee.protocol),R(ee.description||""),k(ee.tags||[]),h(ee.id),B(null),c(!0)},W=()=>{const ee=O.trim();ee&&!D.includes(ee)&&(k([...D,ee]),F(""))},ue=ee=>{k(D.filter(ce=>ce!==ee))},me=()=>{if(B(null),!x.trim()){B("Please enter the Host URL or IP.");return}let ee=x.trim(),ce=A;ee.startsWith("https://")?(ce="https",ee=ee.substring(8)):ee.startsWith("http://")&&(ce="http",ee=ee.substring(7)),ee.endsWith("/")&&(ee=ee.slice(0,-1));const j=f.trim()||ee,X={id:d||Do(),alias:j,host:ee,port:b.trim(),protocol:ce,tags:D,description:_.trim(),addedAt:Date.now()};e(X),C()};return g.jsxs("div",{className:"max-w-5xl mx-auto h-full flex flex-col animate-in fade-in",children:[g.jsxs("div",{className:"flex items-end justify-between mb-6",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-semibold mb-1",children:"Server Library"}),g.jsx("p",{className:"text-fluent-subtext",children:"Save your favorite providers' host details for quick access."})]}),!a&&g.jsxs(Me,{onClick:()=>c(!0),children:[g.jsx(wo,{size:16})," Add Server"]})]}),g.jsxs("div",{className:"flex flex-col md:flex-row gap-6 h-full overflow-hidden",children:[g.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3 ${a?"hidden md:block":""}`,children:o.length===0?g.jsxs("div",{className:"text-center p-8 border border-dashed border-white/10 rounded-xl text-fluent-subtext",children:[g.jsx(_r,{size:32,className:"mx-auto mb-3 opacity-50"}),g.jsx("p",{children:"No saved servers yet."})]}):o.map(ee=>g.jsxs("div",{className:"bg-fluent-layer hover:bg-fluent-layerHover border border-fluent-border p-4 rounded-window transition-all group",children:[g.jsxs("div",{className:"flex justify-between items-start mb-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400",children:g.jsx(RE,{size:16})}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-semibold text-white leading-tight",children:ee.alias}),g.jsxs("div",{className:"text-xs text-fluent-subtext font-mono mt-0.5",children:[ee.protocol,"://",ee.host,":",ee.port]})]})]}),g.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[g.jsx(Me,{className:"!px-2 !py-1 text-fluent-accent hover:bg-fluent-accent/10 hover:text-fluent-accentHover border border-fluent-accent/20",onClick:()=>i(ee),title:"Add Account from this Server",children:g.jsx(N1,{size:14})}),g.jsx(Me,{variant:"secondary",className:"!px-2 !py-1",onClick:()=>r(ee),title:"View Accounts using this Server",children:g.jsx(FE,{size:14})}),g.jsx(Me,{variant:"secondary",className:"!px-2 !py-1",onClick:()=>P(ee),children:g.jsx(JE,{size:14})}),g.jsx(Me,{variant:"danger",className:"!px-2 !py-1",onClick:()=>t(ee.id),children:g.jsx(df,{size:14})})]})]}),ee.description&&g.jsx("p",{className:"text-sm text-white/70 mb-3 line-clamp-2",children:ee.description}),ee.tags&&ee.tags.length>0&&g.jsx("div",{className:"flex flex-wrap gap-1.5",children:ee.tags.map(ce=>g.jsxs("span",{className:"text-[10px] bg-white/5 border border-white/10 px-2 py-0.5 rounded text-fluent-subtext flex items-center gap-1",children:[g.jsx(ka,{size:10})," ",ce]},ce))})]},ee.id))}),a&&g.jsx("div",{className:"w-full md:w-[400px] shrink-0 overflow-y-auto custom-scrollbar animate-in slide-in-from-right-4 fade-in pb-4",children:g.jsxs(As,{className:"h-fit",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h3",{className:"text-lg font-semibold",children:d?"Edit Server":"New Server"}),g.jsx("button",{onClick:C,className:"text-fluent-subtext hover:text-white",children:g.jsx(Rs,{size:18})})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsx(ti,{label:"Friendly Name (Optional)",placeholder:"Defaults to Host if empty",value:f,onChange:ee=>m(ee.target.value)}),g.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[g.jsxs("div",{className:"col-span-1",children:[g.jsx("label",{className:"text-[13px] text-fluent-text font-normal mb-1.5 block",children:"Protocol"}),g.jsxs("select",{className:"w-full bg-white/5 border border-white/10 rounded-control h-[32px] px-2 text-sm text-white outline-none focus:border-fluent-accent",value:A,onChange:ee=>E(ee.target.value),children:[g.jsx("option",{value:"http",children:"HTTP"}),g.jsx("option",{value:"https",children:"HTTPS"})]})]}),g.jsx("div",{className:"col-span-2",children:g.jsx(ti,{label:"Host / URL",placeholder:"line.srv-ip.com",value:x,onChange:ee=>v(ee.target.value)})})]}),g.jsx(ti,{label:"Port",placeholder:"80 or 8080",value:b,onChange:ee=>S(ee.target.value)}),g.jsxs("div",{children:[g.jsx("label",{className:"text-[13px] text-fluent-text font-normal mb-1.5 block",children:"Description (Optional)"}),g.jsx("textarea",{className:"w-full bg-white/5 border border-white/10 rounded-control p-2 text-sm text-white placeholder-white/40 focus:outline-none focus:border-fluent-accent min-h-[80px]",placeholder:"Notes about stability, content...",value:_,onChange:ee=>R(ee.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"text-[13px] text-fluent-text font-normal mb-1.5 block",children:"Tags"}),g.jsxs("div",{className:"flex gap-2 mb-2",children:[g.jsx("input",{className:"flex-1 bg-white/5 border border-white/10 rounded-control h-[32px] px-3 text-sm text-white focus:outline-none focus:border-fluent-accent",placeholder:"Add tag...",value:O,onChange:ee=>F(ee.target.value),onKeyDown:ee=>ee.key==="Enter"&&W()}),g.jsx(Me,{variant:"secondary",onClick:W,children:"Add"})]}),g.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(ee=>g.jsxs("span",{className:"bg-fluent-accent/10 text-fluent-accent px-2 py-1 rounded text-xs flex items-center gap-1 border border-fluent-accent/20",children:[ee,g.jsx("button",{onClick:()=>ue(ee),className:"hover:text-white",children:g.jsx(Rs,{size:12})})]},ee))})]}),N&&g.jsxs("div",{className:"flex items-start gap-2 text-red-300 bg-red-500/10 p-3 rounded-md text-sm",children:[g.jsx(Na,{size:16,className:"shrink-0 mt-0.5"}),g.jsx("span",{children:N})]}),g.jsxs("div",{className:"pt-4 mt-2 border-t border-white/5 flex justify-end gap-2",children:[g.jsx(Me,{variant:"ghost",onClick:C,children:"Cancel"}),g.jsxs(Me,{onClick:me,children:[g.jsx(a1,{size:16})," Save Server"]})]})]})]})})]})]})},dw=()=>g.jsxs("div",{className:"h-[36px] w-full flex items-center justify-between select-none drag-region bg-transparent z-50 shrink-0",children:[g.jsxs("div",{className:"flex items-center gap-3 px-4",children:[g.jsx("div",{className:"w-4 h-4 rounded-sm bg-fluent-accent/80 flex items-center justify-center shadow-sm",children:g.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-80"})}),g.jsx("span",{className:"text-xs font-medium text-fluent-subtext tracking-wide",children:"XtreamFlow"})]}),g.jsxs("div",{className:"flex h-full no-drag",children:[g.jsx("button",{className:"w-[46px] h-full flex items-center justify-center hover:bg-white/5 text-white transition-colors",children:g.jsx(VE,{size:14})}),g.jsx("button",{className:"w-[46px] h-full flex items-center justify-center hover:bg-white/5 text-white transition-colors",children:g.jsx(Dx,{size:12,strokeWidth:2})}),g.jsx("button",{className:"w-[46px] h-full flex items-center justify-center hover:bg-red-500 text-white transition-colors group",children:g.jsx(Rs,{size:14})})]})]});function fw(){const[o,e]=Y.useState("dashboard"),[t,i]=Y.useState(!1),[r,a]=Y.useState([]),[c,d]=Y.useState([]),[h,f]=Y.useState(null),[m,x]=Y.useState(null),[v,b]=Y.useState(null),[S,A]=Y.useState(""),[E,_]=Y.useState({isOpen:!1,type:"info",title:"",message:null}),[R,D]=Y.useState({message:"",show:!1});Y.useEffect(()=>{const te=localStorage.getItem("xtream_accounts"),I=localStorage.getItem("xtream_servers"),M=localStorage.getItem("sidebar_collapsed");if(te)try{a(JSON.parse(te))}catch(G){console.error("Failed to load accounts",G)}if(I)try{d(JSON.parse(I))}catch(G){console.error("Failed to load servers",G)}M!==null&&i(M==="true")},[]),Y.useEffect(()=>{localStorage.setItem("xtream_accounts",JSON.stringify(r))},[r]),Y.useEffect(()=>{localStorage.setItem("xtream_servers",JSON.stringify(c))},[c]),Y.useEffect(()=>{localStorage.setItem("sidebar_collapsed",t.toString())},[t]);const k=()=>{_(te=>({...te,isOpen:!1}))},O=te=>{D({message:te,show:!0}),setTimeout(()=>D(I=>({...I,show:!1})),3e3)},F=(te,I,M,G,Z="Confirm",re="Cancel")=>{_({isOpen:!0,type:te,title:I,message:M,onConfirm:G?()=>{G(),k()}:void 0,onCancel:k,confirmLabel:Z,cancelLabel:re})},N=(te,I=!1)=>{a(M=>M.find(Z=>Z.id===te.id)?M.map(Z=>Z.id===te.id?te:Z):[...M,te]),I||F("success","Account Saved",`The account "${te.name}" has been successfully ${h?"updated":"added"}.`,()=>{f(null),e("manage-accounts")},"OK")},B=te=>{a(I=>I.map(M=>M.id===te?{...M,isFavorite:!M.isFavorite}:M))},C=te=>{F("confirm","Delete Account","Are you sure you want to permanently remove this account? This action cannot be undone.",()=>{a(I=>I.filter(M=>M.id!==te)),(h==null?void 0:h.id)===te&&(f(null),e("manage-accounts"))},"Delete","Cancel")},P=te=>{f(te),e("edit-account")},W=()=>{f(null),e("manage-accounts")},ue=te=>{d(I=>I.find(G=>G.id===te.id)?I.map(G=>G.id===te.id?te:G):[...I,te]),O("Server saved to library")},me=te=>{F("confirm","Delete Server","Remove this server from your library? Linked accounts will not be deleted.",()=>{d(I=>I.filter(M=>M.id!==te)),O("Server removed")})},ee=te=>{b(te),e("add-account")},ce=te=>{A(te.host),e("manage-accounts")},j=te=>{te!=="edit-account"&&f(null),te!=="account-detail"&&x(null),te!=="add-account"&&b(null),te!=="manage-accounts"&&o!=="server-library"&&A(""),e(te)},X=te=>{x(te),e("account-detail")},se=()=>{try{const te={version:"1.0",timestamp:Date.now(),accounts:r,servers:c},I=JSON.stringify(te,null,2),M="data:application/json;charset=utf-8,"+encodeURIComponent(I),G=`xtreamflow-backup-${new Date().toISOString().slice(0,10)}.json`,Z=document.createElement("a");Z.setAttribute("href",M),Z.setAttribute("download",G),Z.click(),F("success","Export Successful","Your accounts and server library have been exported.")}catch{F("error","Export Failed","An error occurred while generating the backup file.")}},de=te=>{let I=[],M=[];if(Array.isArray(te))I=te;else if(typeof te=="object"&&te!==null)Array.isArray(te.accounts)&&(I=te.accounts),Array.isArray(te.servers)&&(M=te.servers);else{F("error","Import Failed","The selected file is invalid or corrupted.");return}const G=I.filter(ge=>ge.host&&ge.username&&ge.password).map(ge=>({...ge,id:ge.id||Do(),status:"untested"})),Z=M.filter(ge=>ge.host&&(ge.protocol==="http"||ge.protocol==="https")).map(ge=>({...ge,id:ge.id||Do()}));if(G.length===0&&Z.length===0){F("warning","No Data Found","No valid accounts or servers were found in the file.");return}let re=0;G.length>0&&a(ge=>{const Re=new Set(ge.map(Ce=>Ce.id)),Ae=G.filter(Ce=>!Re.has(Ce.id));return re=Ae.length,[...ge,...Ae]});let V=0;Z.length>0&&d(ge=>{const Re=new Set(ge.map(Ce=>Ce.id)),Ae=Z.filter(Ce=>!Re.has(Ce.id));return V=Ae.length,[...ge,...Ae]}),F("success","Import Successful",`Data restored successfully.

Accounts added: ${re}
Servers added: ${V}`)};return g.jsxs(V1,{children:[g.jsx(dw,{}),g.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[o==="account-detail"&&m?g.jsx(cw,{account:m,onBack:()=>j("manage-accounts")}):g.jsxs(g.Fragment,{children:[g.jsx(X1,{activeView:o==="edit-account"?"manage-accounts":o,setView:j,isCollapsed:t,onToggle:()=>i(!t)}),g.jsxs("main",{className:"flex-1 overflow-y-auto p-6 md:p-8 relative scroll-smooth bg-transparent transition-all duration-300",children:[o==="dashboard"&&g.jsx(W1,{accounts:r,setView:j}),o==="add-account"&&g.jsx(W0,{onSave:N,onCancel:()=>j("dashboard"),savedServers:c,prefillServer:v}),o==="edit-account"&&g.jsx(W0,{onSave:N,initialData:h,onCancel:W,onDelete:C,savedServers:c}),o==="manage-accounts"&&g.jsx(J1,{accounts:r,onDelete:C,onEdit:P,onToggleFavorite:B,showToast:O,onOpenAdvancedSearch:()=>{},onSelect:X,onUpdate:te=>N(te,!0),initialQuery:S}),o==="server-library"&&g.jsx(uw,{servers:c,onSave:ue,onDelete:me,onAddAccount:ee,onViewAccounts:ce}),o==="settings"&&g.jsx(tT,{accounts:r,onImport:de,onExport:se})]})]}),R.show&&g.jsx("div",{className:"absolute bottom-6 right-6 z-50 animate-in slide-in-from-bottom-5 fade-in duration-300 pointer-events-none",children:g.jsxs("div",{className:"bg-fluent-layer border border-fluent-border text-white px-4 py-3 rounded-window shadow-flyout flex items-center gap-3 ring-1 ring-white/5",children:[g.jsx($a,{size:18,className:"text-fluent-accent"}),g.jsx("span",{className:"text-sm",children:R.message})]})}),g.jsx("div",{className:`fixed inset-0 z-[49] ${E.isOpen?"pointer-events-auto":"pointer-events-none"}`,children:g.jsx(K1,{isOpen:E.isOpen,type:E.type,title:E.title,onConfirm:E.onConfirm,onCancel:E.onCancel,confirmLabel:E.confirmLabel,cancelLabel:E.cancelLabel,children:E.message})})]})]})}const hv=document.getElementById("root");if(!hv)throw new Error("Could not find root element to mount to");const hw=US.createRoot(hv);hw.render(g.jsx(IS.StrictMode,{children:g.jsx(fw,{})}));
